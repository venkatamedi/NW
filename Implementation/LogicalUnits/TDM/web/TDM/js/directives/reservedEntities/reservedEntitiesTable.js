function reservedEntitiesTableDirective(){return{restrict:"E",templateUrl:"views/reservedEntities/reservedEntitiesTable.html",scope:{},controller:function($scope,$compile,TDMService,DTColumnBuilder,DTOptionsBuilder,$q,$element,$timeout,toastr,$uibModal,SweetAlert){var reservedEntitiesTableCtrl=this;reservedEntitiesTableCtrl.loadingTable=!0,reservedEntitiesTableCtrl.initTable=()=>{reservedEntitiesTableCtrl.dtInstance={},reservedEntitiesTableCtrl.dtColumns=[],reservedEntitiesTableCtrl.dtColumnDefs=[],reservedEntitiesTableCtrl.headers=[{column:"select_row",name:"",selectable:!0},{column:"target_entity_id",name:"Target Entity ID",clickAble:!1},{column:"environment_name",name:"Environment Name",clickAble:!1},{column:"task_title",name:"Task Name",clickAble:!1},{column:"task_execution_id",name:"Task Execution ID",clickAble:!1},{column:"be_name",name:"Business Entity",clickAble:!1},{column:"reserve_owner",name:"Reservation Owner",clickAble:!1},{column:"reserve_date",name:"Reservation Date",clickAble:!1,type:"date"},{column:"expiration_date",name:"Expiration Date",clickAble:!1,type:"date"},{column:"reserve_notes",name:"Notes",clickAble:!1}];for(var changeToLocalDate=function(data,type,full,meta){return data?moment(data,"YYYY-MM-DD HH:mm:ss.SSS").format("DD MMM YYYY, HH:mm"):""},reservedEntitiesSelection=function(data,type,full,meta){return full.allow_edit?`\n                    <div style="display: flex;justify-content: space-around;max-width: 100px;">\n                        <input ng-disabled="false" type="checkbox" ng-click="reservedEntitiesTableCtrl.checkAllSelection()"\n                          ng-model="reservedEntitiesTableCtrl.entitiesSelection[${full.target_entity_id}]"/>\n                    </div>\n                    `:""},i=0;i<reservedEntitiesTableCtrl.headers.length;i++)reservedEntitiesTableCtrl.headers[i].selectable?reservedEntitiesTableCtrl.dtColumns.push(DTColumnBuilder.newColumn(reservedEntitiesTableCtrl.headers[i].column).withTitle(reservedEntitiesTableCtrl.headers[i].name).renderWith(reservedEntitiesSelection)):"date"==reservedEntitiesTableCtrl.headers[i].type?reservedEntitiesTableCtrl.dtColumns.push(DTColumnBuilder.newColumn(reservedEntitiesTableCtrl.headers[i].column).withTitle(reservedEntitiesTableCtrl.headers[i].name).renderWith(changeToLocalDate)):reservedEntitiesTableCtrl.dtColumns.push(DTColumnBuilder.newColumn(reservedEntitiesTableCtrl.headers[i].column).withTitle(reservedEntitiesTableCtrl.headers[i].name));var getTableData=function(){var deferred=$q.defer();return deferred.resolve(reservedEntitiesTableCtrl.reservedEntitiesData),deferred.promise};reservedEntitiesTableCtrl.dtOptions=DTOptionsBuilder.fromFnPromise((function(){return getTableData()})).withDOM('<"html5buttons"B>lTfgitp').withOption("createdRow",(function(row){$compile(angular.element(row).contents())($scope)})).withOption("scrollX",!1).withOption("aaSorting",[[2,"asc"],[4,"desc"],[8,"desc"]]).withButtons([]).withOption("search",{caseInsensitive:!1}),reservedEntitiesTableCtrl.reservedEntitiesData&&reservedEntitiesTableCtrl.reservedEntitiesData.length>0&&reservedEntitiesTableCtrl.dtOptions.withLightColumnFilter({1:{type:"text"},2:{type:"select",values:_.map(_.unique(_.map(reservedEntitiesTableCtrl.reservedEntitiesData,"environment_name")),(function(el){return{value:el,label:el}}))},3:{type:"select",values:_.map(_.unique(_.map(reservedEntitiesTableCtrl.reservedEntitiesData,"task_name")),(function(el){return{value:el,label:el}}))},4:{type:"text"},5:{type:"select",values:_.map(_.unique(_.map(reservedEntitiesTableCtrl.reservedEntitiesData,"business_entity")),(function(el){return{value:el,label:el}}))},6:{type:"text"},7:{type:"text"},8:{type:"text"},9:{type:"text"}}),reservedEntitiesTableCtrl.dtInstanceCallback=function(dtInstance){angular.isFunction(reservedEntitiesTableCtrl.dtInstance)?reservedEntitiesTableCtrl.dtInstance(dtInstance):angular.isDefined(reservedEntitiesTableCtrl.dtInstance)&&(reservedEntitiesTableCtrl.dtInstance=dtInstance)},null!=reservedEntitiesTableCtrl.dtInstance.changeData&&reservedEntitiesTableCtrl.dtInstance.changeData(getTableData()),$timeout(()=>{reservedEntitiesTableCtrl.loadingTable=!1})},reservedEntitiesTableCtrl.all_selected=!1,reservedEntitiesTableCtrl.toggleAll=()=>{reservedEntitiesTableCtrl.reservedEntitiesData&&reservedEntitiesTableCtrl.reservedEntitiesData.forEach(reservedEntity=>{reservedEntity.allow_edit&&(reservedEntitiesTableCtrl.entitiesSelection[reservedEntity.target_entity_id]=reservedEntitiesTableCtrl.all_selected)})},reservedEntitiesTableCtrl.getData=entityId=>{TDMService.getReservedEntities(entityId).then(response=>{"SUCCESS"!=response.errorCode&&toastr.error(response.message),reservedEntitiesTableCtrl.all_selected=!1,reservedEntitiesTableCtrl.entitiesSelection={},reservedEntitiesTableCtrl.reservedEntitiesData=(response.result||[]).map(row=>(row.allow_edit&&(reservedEntitiesTableCtrl.entitiesSelection[row.target_entity_id]=!1),row.notes=row.notes||"",row)),reservedEntitiesTableCtrl.dtInstance?reservedEntitiesTableCtrl.dtInstance.reloadData((function(data){}),!0):reservedEntitiesTableCtrl.initTable()})},reservedEntitiesTableCtrl.getData(),reservedEntitiesTableCtrl.deletePermisionGroup=fabric_role=>{console.log("delete permission group,"+fabric_role),TDMService.deleteRoleFromPermissionGroup(fabric_role).then(response=>{if("SUCCESS"==response.errorCode){const index=_.findIndex(reservedEntitiesTableCtrl.reservedEntitiesData,{fabric_role:fabric_role});index>=0&&(reservedEntitiesTableCtrl.reservedEntitiesData.splice(index,1),reservedEntitiesTableCtrl.dtInstance.reloadData((function(data){}),!0))}else toastr.error(`Unable to remove Role ${fabric_role}, err=[${response.message}]`)})},reservedEntitiesTableCtrl.getDataForSave=()=>{const result=[],visibleRows=reservedEntitiesTableCtrl.dtInstance.DataTable.rows({filter:"applied"}).data();for(let i=0;i<visibleRows.length;i++)reservedEntitiesTableCtrl.entitiesSelection[visibleRows[i].target_entity_id]&&result.push({environment_name:visibleRows[i].environment_name,be_name:visibleRows[i].be_name,target_entity_id:visibleRows[i].target_entity_id});return result},reservedEntitiesTableCtrl.releaseEntities=()=>{const result=reservedEntitiesTableCtrl.getDataForSave();0!==result.length&&SweetAlert.swal({title:"Are you sure you want to release these entities?",text:"the entites will be deleted from the reserved entity list",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Cancel",cancelButtonText:"Release",closeOnConfirm:!0,closeOnCancel:!0,animation:"false",customClass:"animated fadeInUp"},(function(isConfirm){isConfirm||TDMService.releaseEntities({listOfEntities:result}).then(response=>{"SUCCESS"==response.errorCode?(reservedEntitiesTableCtrl.getData(),response.message&&toastr.warning(response.message)):toastr.error(response.message)})}))},reservedEntitiesTableCtrl.extendReservationPeriod=()=>{const result=reservedEntitiesTableCtrl.getDataForSave();0!==result.length&&$uibModal.open({templateUrl:"views/reservedEntities/extendReservationPeriod.html",resolve:{selectedData:()=>result},controller:function($scope,$uibModalInstance,selectedData){var extendReservationPeriodCtrl=this;extendReservationPeriodCtrl.minDate=moment(new Date),extendReservationPeriodCtrl.close=function(){$uibModalInstance.close()},extendReservationPeriodCtrl.extend=()=>{let newEndDate=null;extendReservationPeriodCtrl.endBy&&(newEndDate=extendReservationPeriodCtrl.endBy.format("YYYYMMDD")+"235900"),TDMService.extendReservedEntities({newEndDate:newEndDate,listOfEntities:selectedData}).then(response=>{"SUCCESS"==response.errorCode?(response.message&&toastr.warning(response.message),$uibModalInstance.close(!0)):toastr.error(response.message)})}},controllerAs:"extendReservationPeriodCtrl"}).result.then((function(result){result&&reservedEntitiesTableCtrl.getData()}))},reservedEntitiesTableCtrl.addNote=()=>{const result=reservedEntitiesTableCtrl.getDataForSave();0!==result.length&&$uibModal.open({templateUrl:"views/reservedEntities/addNote.html",resolve:{selectedData:()=>result},controller:function($scope,$uibModalInstance,selectedData){var addNoteCtrl=this;addNoteCtrl.close=function(){$uibModalInstance.close()},addNoteCtrl.addNote=()=>{TDMService.addNote({newNote:addNoteCtrl.note,listOfEntities:selectedData}).then(response=>{"SUCCESS"==response.errorCode?(response.message&&toastr.warning(response.message),$uibModalInstance.close(!0)):toastr.error(response.message)})}},controllerAs:"addNoteCtrl"}).result.then((function(result){result&&reservedEntitiesTableCtrl.getData()}))},reservedEntitiesTableCtrl.isAllSelected=()=>{const data=reservedEntitiesTableCtrl.entitiesSelection;if(!data)return!1;const keys=Object.keys(data);for(let i=0;i<keys.length;i++)if(!data[keys[i]])return!1;return!0},reservedEntitiesTableCtrl.checkAllSelection=()=>{$timeout(()=>{reservedEntitiesTableCtrl.isAllSelected()?reservedEntitiesTableCtrl.all_selected=!0:reservedEntitiesTableCtrl.all_selected=!1},100)},reservedEntitiesTableCtrl.isSelected=()=>{const data=reservedEntitiesTableCtrl.entitiesSelection;if(!data)return!1;const keys=Object.keys(data);for(let i=0;i<keys.length;i++)if(data[keys[i]])return!0;return!1},reservedEntitiesTableCtrl.toggleActivitiesMenu=()=>{reservedEntitiesTableCtrl.isSelected()&&(reservedEntitiesTableCtrl.activtiesView=!reservedEntitiesTableCtrl.activtiesView)},reservedEntitiesTableCtrl.searchText="",$element.on("search.dt",(function(e,api){reservedEntitiesTableCtrl.searchText!=api.oPreviousSearch.sSearch&&(reservedEntitiesTableCtrl.searchText=api.oPreviousSearch.sSearch,reservedEntitiesTableCtrl.searchTimeout&&$timeout.cancel(reservedEntitiesTableCtrl.searchTimeout),reservedEntitiesTableCtrl.searchTimeout=$timeout((function(){reservedEntitiesTableCtrl.getData(reservedEntitiesTableCtrl.searchText)}),1e3))}))},controllerAs:"reservedEntitiesTableCtrl"}}angular.module("TDM-FE").directive("reservedEntitiesTableDirective",reservedEntitiesTableDirective);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpcmVjdGl2ZXMvcmVzZXJ2ZWRFbnRpdGllcy9yZXNlcnZlZEVudGl0aWVzVGFibGUuanMiXSwibmFtZXMiOlsicmVzZXJ2ZWRFbnRpdGllc1RhYmxlRGlyZWN0aXZlIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZVVybCIsInNjb3BlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRjb21waWxlIiwiVERNU2VydmljZSIsIkRUQ29sdW1uQnVpbGRlciIsIkRUT3B0aW9uc0J1aWxkZXIiLCIkcSIsIiRlbGVtZW50IiwiJHRpbWVvdXQiLCJ0b2FzdHIiLCIkdWliTW9kYWwiLCJTd2VldEFsZXJ0IiwicmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybCIsInRoaXMiLCJsb2FkaW5nVGFibGUiLCJpbml0VGFibGUiLCJkdEluc3RhbmNlIiwiZHRDb2x1bW5zIiwiZHRDb2x1bW5EZWZzIiwiaGVhZGVycyIsImNvbHVtbiIsIm5hbWUiLCJzZWxlY3RhYmxlIiwiY2xpY2tBYmxlIiwidHlwZSIsImNoYW5nZVRvTG9jYWxEYXRlIiwiZGF0YSIsImZ1bGwiLCJtZXRhIiwibW9tZW50IiwiZm9ybWF0IiwicmVzZXJ2ZWRFbnRpdGllc1NlbGVjdGlvbiIsImFsbG93X2VkaXQiLCJ0YXJnZXRfZW50aXR5X2lkIiwiaSIsImxlbmd0aCIsInB1c2giLCJuZXdDb2x1bW4iLCJ3aXRoVGl0bGUiLCJyZW5kZXJXaXRoIiwiZ2V0VGFibGVEYXRhIiwiZGVmZXJyZWQiLCJkZWZlciIsInJlc29sdmUiLCJyZXNlcnZlZEVudGl0aWVzRGF0YSIsInByb21pc2UiLCJkdE9wdGlvbnMiLCJmcm9tRm5Qcm9taXNlIiwid2l0aERPTSIsIndpdGhPcHRpb24iLCJyb3ciLCJhbmd1bGFyIiwiZWxlbWVudCIsImNvbnRlbnRzIiwid2l0aEJ1dHRvbnMiLCJjYXNlSW5zZW5zaXRpdmUiLCJ3aXRoTGlnaHRDb2x1bW5GaWx0ZXIiLCIxIiwiMiIsInZhbHVlcyIsIl8iLCJtYXAiLCJ1bmlxdWUiLCJlbCIsInZhbHVlIiwibGFiZWwiLCIzIiwiNCIsIjUiLCI2IiwiNyIsIjgiLCI5IiwiZHRJbnN0YW5jZUNhbGxiYWNrIiwiaXNGdW5jdGlvbiIsImlzRGVmaW5lZCIsImNoYW5nZURhdGEiLCJhbGxfc2VsZWN0ZWQiLCJ0b2dnbGVBbGwiLCJmb3JFYWNoIiwicmVzZXJ2ZWRFbnRpdHkiLCJlbnRpdGllc1NlbGVjdGlvbiIsImdldERhdGEiLCJlbnRpdHlJZCIsImdldFJlc2VydmVkRW50aXRpZXMiLCJ0aGVuIiwicmVzcG9uc2UiLCJlcnJvckNvZGUiLCJlcnJvciIsIm1lc3NhZ2UiLCJyZXN1bHQiLCJub3RlcyIsInJlbG9hZERhdGEiLCJkZWxldGVQZXJtaXNpb25Hcm91cCIsImZhYnJpY19yb2xlIiwiY29uc29sZSIsImxvZyIsImRlbGV0ZVJvbGVGcm9tUGVybWlzc2lvbkdyb3VwIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJzcGxpY2UiLCJnZXREYXRhRm9yU2F2ZSIsInZpc2libGVSb3dzIiwiRGF0YVRhYmxlIiwicm93cyIsImZpbHRlciIsImVudmlyb25tZW50X25hbWUiLCJiZV9uYW1lIiwicmVsZWFzZUVudGl0aWVzIiwic3dhbCIsInRpdGxlIiwidGV4dCIsInNob3dDYW5jZWxCdXR0b24iLCJjb25maXJtQnV0dG9uQ29sb3IiLCJjb25maXJtQnV0dG9uVGV4dCIsImNhbmNlbEJ1dHRvblRleHQiLCJjbG9zZU9uQ29uZmlybSIsImNsb3NlT25DYW5jZWwiLCJhbmltYXRpb24iLCJjdXN0b21DbGFzcyIsImlzQ29uZmlybSIsImxpc3RPZkVudGl0aWVzIiwid2FybmluZyIsImV4dGVuZFJlc2VydmF0aW9uUGVyaW9kIiwib3BlbiIsInNlbGVjdGVkRGF0YSIsIiR1aWJNb2RhbEluc3RhbmNlIiwiZXh0ZW5kUmVzZXJ2YXRpb25QZXJpb2RDdHJsIiwibWluRGF0ZSIsIkRhdGUiLCJjbG9zZSIsImV4dGVuZCIsIm5ld0VuZERhdGUiLCJlbmRCeSIsImV4dGVuZFJlc2VydmVkRW50aXRpZXMiLCJjb250cm9sbGVyQXMiLCJhZGROb3RlIiwiYWRkTm90ZUN0cmwiLCJuZXdOb3RlIiwibm90ZSIsImlzQWxsU2VsZWN0ZWQiLCJrZXlzIiwiT2JqZWN0IiwiY2hlY2tBbGxTZWxlY3Rpb24iLCJpc1NlbGVjdGVkIiwidG9nZ2xlQWN0aXZpdGllc01lbnUiLCJhY3RpdnRpZXNWaWV3Iiwic2VhcmNoVGV4dCIsIm9uIiwiZSIsImFwaSIsIm9QcmV2aW91c1NlYXJjaCIsInNTZWFyY2giLCJzZWFyY2hUaW1lb3V0IiwiY2FuY2VsIiwibW9kdWxlIiwiZGlyZWN0aXZlIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxpQ0F1YkwsTUFBTyxDQUNIQyxTQUFVLElBQ1ZDLFlBdmJXLG9EQXdiWEMsTUFBTyxHQUVQQyxXQXhiYSxTQUFVQyxPQUFPQyxTQUFTQyxXQUFXQyxnQkFBZ0JDLGlCQUFpQkMsR0FBSUMsU0FDdkZDLFNBQVVDLE9BQVFDLFVBQVdDLFlBQzdCLElBQUlDLDBCQUE0QkMsS0FFaENELDBCQUEwQkUsY0FBZSxFQUN6Q0YsMEJBQTBCRyxVQUFZLEtBQ2xDSCwwQkFBMEJJLFdBQWEsR0FDdkNKLDBCQUEwQkssVUFBWSxHQUN0Q0wsMEJBQTBCTSxhQUFlLEdBQ3pDTiwwQkFBMEJPLFFBQVUsQ0FDaEMsQ0FDSUMsT0FBUyxhQUNUQyxLQUFPLEdBQ1BDLFlBQWEsR0FFakIsQ0FDSUYsT0FBUyxtQkFDVEMsS0FBTyxtQkFDUEUsV0FBWSxHQUVoQixDQUNJSCxPQUFTLG1CQUNUQyxLQUFPLG1CQUNQRSxXQUFZLEdBRWhCLENBQ0lILE9BQVMsYUFDVEMsS0FBTyxZQUNQRSxXQUFZLEdBRWhCLENBQ0lILE9BQVMsb0JBQ1RDLEtBQU8sb0JBQ1BFLFdBQVksR0FFaEIsQ0FDSUgsT0FBUyxVQUNUQyxLQUFPLGtCQUNQRSxXQUFZLEdBRWhCLENBQ0lILE9BQVMsZ0JBQ1RDLEtBQU8sb0JBQ1BFLFdBQVksR0FFaEIsQ0FDSUgsT0FBUyxlQUNUQyxLQUFPLG1CQUNQRSxXQUFZLEVBQ1pDLEtBQU0sUUFFVixDQUNJSixPQUFTLGtC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bnRpdGllcy9yZXNlcnZlZEVudGl0aWVzVGFibGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiByZXNlcnZlZEVudGl0aWVzVGFibGVEaXJlY3RpdmUoKXtcblxuICAgIHZhciB0ZW1wbGF0ZSA9IFwidmlld3MvcmVzZXJ2ZWRFbnRpdGllcy9yZXNlcnZlZEVudGl0aWVzVGFibGUuaHRtbFwiO1xuXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCRjb21waWxlLFRETVNlcnZpY2UsRFRDb2x1bW5CdWlsZGVyLERUT3B0aW9uc0J1aWxkZXIsJHEsICRlbGVtZW50LFxuICAgICAgICAkdGltZW91dCwgdG9hc3RyLCAkdWliTW9kYWwsIFN3ZWV0QWxlcnQpIHtcbiAgICAgICAgdmFyIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwgPSB0aGlzO1xuXG4gICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwubG9hZGluZ1RhYmxlID0gdHJ1ZTtcbiAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5pbml0VGFibGUgPSAoKSA9PiB7XG4gICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmR0SW5zdGFuY2UgPSB7fTtcbiAgICAgICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuZHRDb2x1bW5zID0gW107XG4gICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmR0Q29sdW1uRGVmcyA9IFtdO1xuICAgICAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5oZWFkZXJzID0gW1xuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uIDogJ3NlbGVjdF9yb3cnLFxuICAgICAgICAgICAgICAgICAgICBuYW1lIDogJycsXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGFibGUgOiB0cnVlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbiA6ICd0YXJnZXRfZW50aXR5X2lkJyxcbiAgICAgICAgICAgICAgICAgICAgbmFtZSA6ICdUYXJnZXQgRW50aXR5IElEJyxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlIDogZmFsc2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uIDogJ2Vudmlyb25tZW50X25hbWUnLFxuICAgICAgICAgICAgICAgICAgICBuYW1lIDogJ0Vudmlyb25tZW50IE5hbWUnLFxuICAgICAgICAgICAgICAgICAgICBjbGlja0FibGUgOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW4gOiAndGFza190aXRsZScsXG4gICAgICAgICAgICAgICAgICAgIG5hbWUgOiAnVGFzayBOYW1lJyxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbiA6ICd0YXNrX2V4ZWN1dGlvbl9pZCcsXG4gICAgICAgICAgICAgICAgICAgIG5hbWUgOiAnVGFzayBFeGVjdXRpb24gSUQnLFxuICAgICAgICAgICAgICAgICAgICBjbGlja0FibGUgOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBjb2x1bW4gOiAnYmVfbmFtZScsXG4gICAgICAgICAgICAgICAgICAgIG5hbWUgOiAnQnVzaW5lc3MgRW50aXR5JyxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlIDogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbiA6ICdyZXNlcnZlX293bmVyJyxcbiAgICAgICAgICAgICAgICAgICAgbmFtZSA6ICdSZXNlcnZhdGlvbiBPd25lcicsXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrQWJsZSA6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbiA6ICdyZXNlcnZlX2RhdGUnLFxuICAgICAgICAgICAgICAgICAgICBuYW1lIDogJ1Jlc2VydmF0aW9uIERhdGUnLFxuICAgICAgICAgICAgICAgICAgICBjbGlja0FibGUgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RhdGUnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGNvbHVtbiA6ICdleHBpcmF0aW9uX2RhdGUnLFxuICAgICAgICAgICAgICAgICAgICBuYW1lIDogJ0V4cGlyYXRpb24gRGF0ZScsXG4gICAgICAgICAgICAgICAgICAgIGNsaWNrQWJsZSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnZGF0ZSdcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uIDogJ3Jlc2VydmVfbm90ZXMnLFxuICAgICAgICAgICAgICAgICAgICBuYW1lIDogJ05vdGVzJyxcbiAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlIDogZmFsc2VcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgdmFyIGNoYW5nZVRvTG9jYWxEYXRlID0gZnVuY3Rpb24oZGF0YSwgdHlwZSwgZnVsbCwgbWV0YSl7XG4gICAgICAgICAgICAgICAgaWYgKGRhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1vbWVudChkYXRhLCdZWVlZLU1NLUREIEhIOm1tOnNzLlNTUycpLmZvcm1hdCgnREQgTU1NIFlZWVksIEhIOm1tJylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfTtcblxuXG4gICAgICAgICAgICB2YXIgcmVzZXJ2ZWRFbnRpdGllc1NlbGVjdGlvbiA9IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIGZ1bGwsIG1ldGEpe1xuICAgICAgICAgICAgICAgIGlmIChmdWxsLmFsbG93X2VkaXQpe1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYFxuICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPVwiZGlzcGxheTogZmxleDtqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWFyb3VuZDttYXgtd2lkdGg6IDEwMHB4O1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgPGlucHV0IG5nLWRpc2FibGVkPVwiZmFsc2VcIiB0eXBlPVwiY2hlY2tib3hcIiBuZy1jbGljaz1cInJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuY2hlY2tBbGxTZWxlY3Rpb24oKVwiXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5nLW1vZGVsPVwicmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5lbnRpdGllc1NlbGVjdGlvblske2Z1bGwudGFyZ2V0X2VudGl0eV9pZH1dXCIvPlxuICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgYDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICcnO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5oZWFkZXJzLmxlbmd0aCA7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChyZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmhlYWRlcnNbaV0uc2VsZWN0YWJsZSl7XG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuZHRDb2x1bW5zLnB1c2goRFRDb2x1bW5CdWlsZGVyLm5ld0NvbHVtbihyZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmhlYWRlcnNbaV0uY29sdW1uKS53aXRoVGl0bGUocmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5oZWFkZXJzW2ldLm5hbWUpLnJlbmRlcldpdGgocmVzZXJ2ZWRFbnRpdGllc1NlbGVjdGlvbikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmIChyZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmhlYWRlcnNbaV0udHlwZSA9PSAnZGF0ZScpe1xuICAgICAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmR0Q29sdW1ucy5wdXNoKERUQ29sdW1uQnVpbGRlci5uZXdDb2x1bW4ocmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5oZWFkZXJzW2ldLmNvbHVtbikud2l0aFRpdGxlKHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuaGVhZGVyc1tpXS5uYW1lKS5yZW5kZXJXaXRoKGNoYW5nZVRvTG9jYWxEYXRlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmR0Q29sdW1ucy5wdXNoKERUQ29sdW1uQnVpbGRlci5uZXdDb2x1bW4ocmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5oZWFkZXJzW2ldLmNvbHVtbikud2l0aFRpdGxlKHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuaGVhZGVyc1tpXS5uYW1lKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB2YXIgZ2V0VGFibGVEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLnJlc2VydmVkRW50aXRpZXNEYXRhKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuZHRPcHRpb25zID0gRFRPcHRpb25zQnVpbGRlci5mcm9tRm5Qcm9taXNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGdldFRhYmxlRGF0YSgpO1xuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLndpdGhET00oJzxcImh0bWw1YnV0dG9uc1wiQj5sVGZnaXRwJylcbiAgICAgICAgICAgICAgICAud2l0aE9wdGlvbignY3JlYXRlZFJvdycsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gUmVjb21waWxpbmcgc28gd2UgY2FuIGJpbmQgQW5ndWxhciBkaXJlY3RpdmUgdG8gdGhlIERUXG4gICAgICAgICAgICAgICAgICAgICRjb21waWxlKGFuZ3VsYXIuZWxlbWVudChyb3cpLmNvbnRlbnRzKCkpKCRzY29wZSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAud2l0aE9wdGlvbignc2Nyb2xsWCcsIGZhbHNlKVxuICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdhYVNvcnRpbmcnLCBbIFsyLCAnYXNjJ10sIFs0LCdkZXNjJ10sIFs4LCdkZXNjJ10gXSlcbiAgICAgICAgICAgICAgICAud2l0aEJ1dHRvbnMoW1xuICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgLndpdGhPcHRpb24oJ3NlYXJjaCcse1xuICAgICAgICAgICAgICAgICAgICBcImNhc2VJbnNlbnNpdGl2ZVwiOiBmYWxzZVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgaWYgKHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwucmVzZXJ2ZWRFbnRpdGllc0RhdGEgJiYgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5yZXNlcnZlZEVudGl0aWVzRGF0YS5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5kdE9wdGlvbnMud2l0aExpZ2h0Q29sdW1uRmlsdGVyKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAxIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAyIDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc2VsZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBfLm1hcChfLnVuaXF1ZShfLm1hcChyZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLnJlc2VydmVkRW50aXRpZXNEYXRhLCAnZW52aXJvbm1lbnRfbmFtZScpKSxmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge3ZhbHVlIDogZWwsbGFiZWwgOmVsfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgMyA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3NlbGVjdCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlczogXy5tYXAoXy51bmlxdWUoXy5tYXAocmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5yZXNlcnZlZEVudGl0aWVzRGF0YSwgJ3Rhc2tfbmFtZScpKSxmdW5jdGlvbihlbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4ge3ZhbHVlIDogZWwsbGFiZWwgOmVsfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgNCA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA1IDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc2VsZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBfLm1hcChfLnVuaXF1ZShfLm1hcChyZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLnJlc2VydmVkRW50aXRpZXNEYXRhLCAnYnVzaW5lc3NfZW50aXR5JykpLGZ1bmN0aW9uKGVsKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7dmFsdWUgOiBlbCxsYWJlbCA6ZWx9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA2IDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDcgOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgOCA6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA5IDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5kdEluc3RhbmNlQ2FsbGJhY2sgPSBmdW5jdGlvbiAoZHRJbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24ocmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5kdEluc3RhbmNlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmR0SW5zdGFuY2UoZHRJbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChhbmd1bGFyLmlzRGVmaW5lZChyZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmR0SW5zdGFuY2UpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuZHRJbnN0YW5jZSA9IGR0SW5zdGFuY2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChyZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmR0SW5zdGFuY2UuY2hhbmdlRGF0YSAhPSBudWxsKXtcbiAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmR0SW5zdGFuY2UuY2hhbmdlRGF0YShnZXRUYWJsZURhdGEoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkdGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5sb2FkaW5nVGFibGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgIFxuICAgICAgICB9O1xuXG5cbiAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5hbGxfc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwudG9nZ2xlQWxsID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwucmVzZXJ2ZWRFbnRpdGllc0RhdGEpIHtcbiAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLnJlc2VydmVkRW50aXRpZXNEYXRhLmZvckVhY2gocmVzZXJ2ZWRFbnRpdHkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzZXJ2ZWRFbnRpdHkuYWxsb3dfZWRpdCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmVudGl0aWVzU2VsZWN0aW9uW3Jlc2VydmVkRW50aXR5LnRhcmdldF9lbnRpdHlfaWRdID0gcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5hbGxfc2VsZWN0ZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmdldERhdGEgPSAoZW50aXR5SWQpID0+IHtcbiAgICAgICAgICAgIFRETVNlcnZpY2UuZ2V0UmVzZXJ2ZWRFbnRpdGllcyhlbnRpdHlJZCkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JDb2RlICE9ICdTVUNDRVNTJyl7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5hbGxfc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmVudGl0aWVzU2VsZWN0aW9uID0ge307XG4gICAgICAgICAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5yZXNlcnZlZEVudGl0aWVzRGF0YSA9IChyZXNwb25zZS5yZXN1bHQgfHwgW10pLm1hcChyb3cgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAocm93LmFsbG93X2VkaXQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5lbnRpdGllc1NlbGVjdGlvbltyb3cudGFyZ2V0X2VudGl0eV9pZF0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByb3cubm90ZXMgPSByb3cubm90ZXMgfHwgJyc7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByb3c7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgaWYgKHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuZHRJbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmR0SW5zdGFuY2UucmVsb2FkRGF0YShmdW5jdGlvbihkYXRhKXt9LCB0cnVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuaW5pdFRhYmxlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5nZXREYXRhKCk7XG5cbiAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5kZWxldGVQZXJtaXNpb25Hcm91cCA9IChmYWJyaWNfcm9sZSkgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2RlbGV0ZSBwZXJtaXNzaW9uIGdyb3VwLCcgKyAgZmFicmljX3JvbGUpO1xuICAgICAgICAgICAgVERNU2VydmljZS5kZWxldGVSb2xlRnJvbVBlcm1pc3Npb25Hcm91cChmYWJyaWNfcm9sZSkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JDb2RlID09IFwiU1VDQ0VTU1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gXy5maW5kSW5kZXgocmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5yZXNlcnZlZEVudGl0aWVzRGF0YSx7ZmFicmljX3JvbGU6IGZhYnJpY19yb2xlfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA+PSAwKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwucmVzZXJ2ZWRFbnRpdGllc0RhdGEuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuZHRJbnN0YW5jZS5yZWxvYWREYXRhKGZ1bmN0aW9uKGRhdGEpe30sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoYFVuYWJsZSB0byByZW1vdmUgUm9sZSAke2ZhYnJpY19yb2xlfSwgZXJyPVske3Jlc3BvbnNlLm1lc3NhZ2V9XWApO1xuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5nZXREYXRhRm9yU2F2ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgICAgICAgICAgY29uc3QgdmlzaWJsZVJvd3MgPSByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmR0SW5zdGFuY2UuRGF0YVRhYmxlLnJvd3MoIHsgZmlsdGVyIDogJ2FwcGxpZWQnfSApLmRhdGEoKTtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IHZpc2libGVSb3dzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgICAgICAgICBpZiAocmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5lbnRpdGllc1NlbGVjdGlvblt2aXNpYmxlUm93c1tpXS50YXJnZXRfZW50aXR5X2lkXSl7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZW52aXJvbm1lbnRfbmFtZVwiOiB2aXNpYmxlUm93c1tpXS5lbnZpcm9ubWVudF9uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJiZV9uYW1lXCI6IHZpc2libGVSb3dzW2ldLmJlX25hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBcInRhcmdldF9lbnRpdHlfaWRcIjogdmlzaWJsZVJvd3NbaV0udGFyZ2V0X2VudGl0eV9pZCxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5yZWxlYXNlRW50aXRpZXMgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmdldERhdGFGb3JTYXZlKCk7XG4gICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFN3ZWV0QWxlcnQuc3dhbCh7XG4gICAgICAgICAgICAgICAgdGl0bGU6IGBBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmVsZWFzZSB0aGVzZSBlbnRpdGllcz9gLFxuICAgICAgICAgICAgICAgIHRleHQ6ICd0aGUgZW50aXRlcyB3aWxsIGJlIGRlbGV0ZWQgZnJvbSB0aGUgcmVzZXJ2ZWQgZW50aXR5IGxpc3QnLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwid2FybmluZ1wiLFxuICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiBcIiNERDZCNTVcIixcbiAgICAgICAgICAgICAgICBjb25maXJtQnV0dG9uVGV4dDogXCJDYW5jZWxcIixcbiAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIlJlbGVhc2VcIixcbiAgICAgICAgICAgICAgICBjbG9zZU9uQ29uZmlybTogdHJ1ZSxcbiAgICAgICAgICAgICAgICBjbG9zZU9uQ2FuY2VsOiB0cnVlLFxuICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogXCJmYWxzZVwiLFxuICAgICAgICAgICAgICAgIGN1c3RvbUNsYXNzOiBcImFuaW1hdGVkIGZhZGVJblVwXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAoaXNDb25maXJtKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFpc0NvbmZpcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgVERNU2VydmljZS5yZWxlYXNlRW50aXRpZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgXCJsaXN0T2ZFbnRpdGllc1wiOiByZXN1bHQsXG4gICAgICAgICAgICAgICAgICAgICAgfSkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvckNvZGUgPT0gXCJTVUNDRVNTXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmdldERhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIud2FybmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5leHRlbmRSZXNlcnZhdGlvblBlcmlvZCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuZ2V0RGF0YUZvclNhdmUoKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcmVzZXJ2ZWRFbnRpdGllcy9leHRlbmRSZXNlcnZhdGlvblBlcmlvZC5odG1sJyxcbiAgICAgICAgICAgICAgICByZXNvbHZlIDoge1xuICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZERhdGEgOiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoJHNjb3BlLCAkdWliTW9kYWxJbnN0YW5jZSwgc2VsZWN0ZWREYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBleHRlbmRSZXNlcnZhdGlvblBlcmlvZEN0cmwgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICBleHRlbmRSZXNlcnZhdGlvblBlcmlvZEN0cmwubWluRGF0ZSA9IG1vbWVudChuZXcgRGF0ZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgZXh0ZW5kUmVzZXJ2YXRpb25QZXJpb2RDdHJsLmNsb3NlID0gZnVuY3Rpb24gKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICBleHRlbmRSZXNlcnZhdGlvblBlcmlvZEN0cmwuZXh0ZW5kID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5ld0VuZERhdGUgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV4dGVuZFJlc2VydmF0aW9uUGVyaW9kQ3RybC5lbmRCeSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0VuZERhdGUgPSBleHRlbmRSZXNlcnZhdGlvblBlcmlvZEN0cmwuZW5kQnkuZm9ybWF0KCdZWVlZTU1ERCcpICsgJzIzNTkwMCc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBURE1TZXJ2aWNlLmV4dGVuZFJlc2VydmVkRW50aXRpZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld0VuZERhdGUgOiAgbmV3RW5kRGF0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcImxpc3RPZkVudGl0aWVzXCI6IHNlbGVjdGVkRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbigocmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JDb2RlID09IFwiU1VDQ0VTU1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5tZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIud2FybmluZyhyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdWliTW9kYWxJbnN0YW5jZS5jbG9zZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihyZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAnZXh0ZW5kUmVzZXJ2YXRpb25QZXJpb2RDdHJsJ1xuICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpe1xuICAgICAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmdldERhdGEoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuYWRkTm90ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuZ2V0RGF0YUZvclNhdmUoKTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJHVpYk1vZGFsLm9wZW4oe1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAndmlld3MvcmVzZXJ2ZWRFbnRpdGllcy9hZGROb3RlLmh0bWwnLFxuICAgICAgICAgICAgICAgIHJlc29sdmUgOiB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkRGF0YSA6ICgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IGZ1bmN0aW9uICgkc2NvcGUsICR1aWJNb2RhbEluc3RhbmNlLCBzZWxlY3RlZERhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGFkZE5vdGVDdHJsID0gdGhpcztcbiAgICAgICAgICAgICAgICAgICAgYWRkTm90ZUN0cmwuY2xvc2UgPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICR1aWJNb2RhbEluc3RhbmNlLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBhZGROb3RlQ3RybC5hZGROb3RlID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgVERNU2VydmljZS5hZGROb3RlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm5ld05vdGVcIjogIGFkZE5vdGVDdHJsLm5vdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJsaXN0T2ZFbnRpdGllc1wiOiBzZWxlY3RlZERhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgIH0pLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yQ29kZSA9PSBcIlNVQ0NFU1NcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UubWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLndhcm5pbmcocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UodHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IocmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICdhZGROb3RlQ3RybCdcbiAgICAgICAgICAgIH0pLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0KXtcbiAgICAgICAgICAgICAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5nZXREYXRhKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmlzQWxsU2VsZWN0ZWQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBkYXRhID0gcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5lbnRpdGllc1NlbGVjdGlvbjtcbiAgICAgICAgICAgIGlmICghZGF0YSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhkYXRhKTtcbiAgICAgICAgICAgIGZvcihsZXQgaSA9MDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoIWRhdGFba2V5c1tpXV0peyBcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuY2hlY2tBbGxTZWxlY3Rpb24gPSAoKSA9PiB7XG4gICAgICAgICAgICAkdGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgZGVidWdnZXI7XG4gICAgICAgICAgICAgICAgaWYgKHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuaXNBbGxTZWxlY3RlZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuYWxsX3NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuYWxsX3NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuaXNTZWxlY3RlZCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmVudGl0aWVzU2VsZWN0aW9uO1xuICAgICAgICAgICAgaWYgKCFkYXRhKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKGRhdGEpO1xuICAgICAgICAgICAgZm9yKGxldCBpID0wOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGlmIChkYXRhW2tleXNbaV1dKXsgXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLnRvZ2dsZUFjdGl2aXRpZXNNZW51ID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuaXNTZWxlY3RlZCgpKSB7XG4gICAgICAgICAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5hY3RpdnRpZXNWaWV3ID0gIXJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuYWN0aXZ0aWVzVmlldztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICAgICAgcmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5zZWFyY2hUZXh0ID0gJyc7XG4gICAgICAgICRlbGVtZW50Lm9uKCdzZWFyY2guZHQnLCBmdW5jdGlvbihlLCBhcGkpIHtcbiAgICAgICAgICAgIGlmIChyZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLnNlYXJjaFRleHQgIT0gYXBpLm9QcmV2aW91c1NlYXJjaC5zU2VhcmNoKXtcbiAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLnNlYXJjaFRleHQgPSBhcGkub1ByZXZpb3VzU2VhcmNoLnNTZWFyY2g7XG4gICAgICAgICAgICAgICAgaWYgKHJlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwuc2VhcmNoVGltZW91dCl7XG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbChyZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLnNlYXJjaFRpbWVvdXQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLnNlYXJjaFRpbWVvdXQgPSAkdGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICByZXNlcnZlZEVudGl0aWVzVGFibGVDdHJsLmdldERhdGEocmVzZXJ2ZWRFbnRpdGllc1RhYmxlQ3RybC5zZWFyY2hUZXh0KTtcbiAgICAgICAgICAgICAgICB9LDEwMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiRVwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogdGVtcGxhdGUsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRyb2xsZXI6IGNvbnRyb2xsZXIsXG4gICAgICAgIGNvbnRyb2xsZXJBcyA6J3Jlc2VydmVkRW50aXRpZXNUYWJsZUN0cmwnXG4gICAgfTtcbn1cblxuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgnVERNLUZFJylcbiAgICAuZGlyZWN0aXZlKCdyZXNlcnZlZEVudGl0aWVzVGFibGVEaXJlY3RpdmUnLCByZXNlcnZlZEVudGl0aWVzVGFibGVEaXJlY3RpdmUpOyJdfQ==
