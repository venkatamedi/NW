function environmentRolesDirective(){return{restrict:"E",templateUrl:"views/environments/roles/roles.html",scope:{content:"="},controller:function($scope,$compile,TDMService,DTColumnBuilder,DTOptionsBuilder,$q,BreadCrumbsService){var environmentRolesCtrl=this;environmentRolesCtrl.environmentID=$scope.content.environmentData.environment_id,environmentRolesCtrl.pageDisplay="rolesTable",environmentRolesCtrl.openRoles=function(){environmentRolesCtrl.rolesData={openRole:environmentRolesCtrl.openRole,openNewRole:environmentRolesCtrl.openNewRole,environmentID:environmentRolesCtrl.environmentID,isOwner:$scope.content.environmentData.isOwner},environmentRolesCtrl.pageDisplay="rolesTable",BreadCrumbsService.breadCrumbChange(2)},environmentRolesCtrl.openRole=function(roleData){environmentRolesCtrl.roleData={roleData:roleData,environment_id:environmentRolesCtrl.environmentID,environment_name:$scope.content.environmentData.environment_name,openRoles:environmentRolesCtrl.openRoles,openRole:environmentRolesCtrl.openRole,isOwner:$scope.content.environmentData.isOwner},environmentRolesCtrl.pageDisplay="role"},environmentRolesCtrl.openNewRole=function(roles){environmentRolesCtrl.newRoleData={roles:roles,openRoles:environmentRolesCtrl.openRoles,environmentID:environmentRolesCtrl.environmentID,environmentName:$scope.content.environmentData.environment_name,isOwner:$scope.content.environmentData.isOwner},environmentRolesCtrl.pageDisplay="newRole"},BreadCrumbsService.push({},"ROLES",(function(){environmentRolesCtrl.openRoles()})),environmentRolesCtrl.openRoles()},controllerAs:"rolesCtrl"}}function environmentNewRoleDirective(){return{restrict:"E",templateUrl:"views/environments/roles/newRole.html",scope:{content:"="},controller:function($scope,TDMService,BreadCrumbsService,toastr,$timeout){var environmentNewRoleCtrl=this;environmentNewRoleCtrl.environmentID=$scope.content.environmentID,environmentNewRoleCtrl.roles=$scope.content.roles,environmentNewRoleCtrl.roleData={allowed_creation_of_synthetic_data:!1,allowed_delete_before_load:!1,allowed_random_entity_selection:!1,allowed_request_of_fresh_data:!1,allowed_task_scheduling:!1,allowed_replace_sequences:!1,allowed_refresh_reference_data:!1,allowed_number_of_entities_to_copy:0,role_description:"",role_name:""},environmentNewRoleCtrl.addRole=function(){if(_.find(environmentNewRoleCtrl.roles,{role_name:environmentNewRoleCtrl.roleData.role_name}))return toastr.error("Role # "+environmentNewRoleCtrl.roleData.role_name+" Already Exists");TDMService.postEnvironmentRole(environmentNewRoleCtrl.environmentID,$scope.content.environmentName,environmentNewRoleCtrl.roleData).then((function(response){"SUCCESS"==response.errorCode?(toastr.success("Role # "+environmentNewRoleCtrl.roleData.role_name,"Created Successfully"),$timeout((function(){$scope.content.openRoles()}),300)):toastr.error("Role # "+environmentNewRoleCtrl.roleData.role_name,"Unable to Create : "+response.message)}))},BreadCrumbsService.push({},"NEW_ROLE",(function(){}))},controllerAs:"environmentNewRoleCtrl"}}function environmentRolesTableDirective(){return{restrict:"E",templateUrl:"views/environments/roles/rolesTable.html",scope:{content:"="},controller:function($scope,$compile,TDMService,DTColumnBuilder,DTOptionsBuilder,$q,AuthService,$timeout){var rolesTableCtrl=this;rolesTableCtrl.environmentID=$scope.content.environmentID,rolesTableCtrl.disableChange=!(AuthService.authorizedToEdit(0)||AuthService.authorizedToEdit(1)&&$scope.content.isOwner),TDMService.getEnvironmentRoles(rolesTableCtrl.environmentID).then((function(response){if("SUCCESS"==response.errorCode){rolesTableCtrl.roles=response.result,rolesTableCtrl.dtInstance={},rolesTableCtrl.dtColumns=[],rolesTableCtrl.dtColumnDefs=[],rolesTableCtrl.headers=[{column:"role_name",name:"Name",clickAble:!0},{column:"role_description",name:"Description",clickAble:!1},{column:"role_creation_date",name:"Creation Date",clickAble:!1,type:"date"},{column:"role_created_by",name:"Created By",clickAble:!1},{column:"role_last_updated_date",name:"Last Update Date",clickAble:!1,type:"date"},{column:"role_last_updated_by",name:"Updated By",clickAble:!1},{column:"role_status",name:"Status",clickAble:!1}];for(var clickAbleColumn=function(data,type,full,meta){return'<a ng-click="rolesTableCtrl.openRole('+full.role_id+')">'+data+"</a>"},changeToLocalDate=function(data,type,full,meta){return moment(data).format("D MMM YYYY, h:mm")},i=0;i<rolesTableCtrl.headers.length;i++)1==rolesTableCtrl.headers[i].clickAble?rolesTableCtrl.dtColumns.push(DTColumnBuilder.newColumn(rolesTableCtrl.headers[i].column).withTitle(rolesTableCtrl.headers[i].name).renderWith(clickAbleColumn)):"date"==rolesTableCtrl.headers[i].type?rolesTableCtrl.dtColumns.push(DTColumnBuilder.newColumn(rolesTableCtrl.headers[i].column).withTitle(rolesTableCtrl.headers[i].name).renderWith(changeToLocalDate)):rolesTableCtrl.dtColumns.push(DTColumnBuilder.newColumn(rolesTableCtrl.headers[i].column).withTitle(rolesTableCtrl.headers[i].name));var getTableData=function(){var deferred=$q.defer();return deferred.resolve(rolesTableCtrl.roles),deferred.promise};rolesTableCtrl.dtOptions=DTOptionsBuilder.fromFnPromise((function(){return getTableData()})).withDOM('<"html5buttons"B>lTfgitp').withOption("createdRow",(function(row){$compile(angular.element(row).contents())($scope)})).withOption("scrollX",!1).withButtons([]).withColumnFilter({aoColumns:[{type:"text",bRegex:!0,bSmart:!0},{type:"text",bRegex:!0,bSmart:!0},{type:"text",bRegex:!0,bSmart:!0},{type:"select",bRegex:!1,values:_.unique(_.map(rolesTableCtrl.roles,"role_created_by"))},{type:"text",bRegex:!0,bSmart:!0},{type:"select",bRegex:!1,values:_.unique(_.map(rolesTableCtrl.roles,"role_last_updated_by"))}]}),rolesTableCtrl.dtInstanceCallback=function(dtInstance){angular.isFunction(rolesTableCtrl.dtInstance)?rolesTableCtrl.dtInstance(dtInstance):angular.isDefined(rolesTableCtrl.dtInstance)&&(rolesTableCtrl.dtInstance=dtInstance)},null!=rolesTableCtrl.dtInstance.changeData&&rolesTableCtrl.dtInstance.changeData(getTableData()),$timeout(()=>{rolesTableCtrl.loadingTable=!1})}})),rolesTableCtrl.openRole=function(roleID){if($scope.content.openRole){var roleData=_.find(rolesTableCtrl.roles,{role_id:roleID});if(roleData)return void $scope.content.openRole(roleData)}},rolesTableCtrl.openNewRole=function(){$scope.content.openNewRole&&$scope.content.openNewRole(rolesTableCtrl.roles)}},controllerAs:"rolesTableCtrl"}}function environmentRoleDirective(){return{restrict:"E",templateUrl:"views/environments/roles/role.html",scope:{content:"="},controller:function($scope,TDMService,BreadCrumbsService,$timeout,toastr,SweetAlert,AuthService){var environmentRoleCtrl=this;environmentRoleCtrl.roleData=$scope.content.roleData,environmentRoleCtrl.environment_id=$scope.content.environment_id,environmentRoleCtrl.disableChange="Inactive"==environmentRoleCtrl.roleData.role_status||!AuthService.authorizedToEdit(1)||!$scope.content.isOwner,TDMService.getTesters(environmentRoleCtrl.environment_id).then((function(response){"SUCCESS"==response.errorCode?(environmentRoleCtrl.allTesters=response.result,TDMService.getEnvironmentRoleTesters(environmentRoleCtrl.environment_id,environmentRoleCtrl.roleData.role_id).then((function(response){"SUCCESS"==response.errorCode?(environmentRoleCtrl.testers=response.result,environmentRoleCtrl.allTesters=environmentRoleCtrl.allTesters.concat(environmentRoleCtrl.testers)):(environmentRoleCtrl.hideUsersInput=!0,toastr.error("Role # "+environmentRoleCtrl.roleData.role_name,"failed to get Role Users : "+response.message))}))):(environmentRoleCtrl.hideUsersInput=!0,toastr.error("Role # "+environmentRoleCtrl.roleData.role_name,"failed to get All Testers : "+response.message))})),environmentRoleCtrl.saveChanges=function(){TDMService.postEnvironmentRoleTesters(environmentRoleCtrl.environment_id,$scope.content.environment_name,environmentRoleCtrl.roleData.role_id,environmentRoleCtrl.roleData.role_name,environmentRoleCtrl.testers).then((function(response){"SUCCESS"==response.errorCode?toastr.success("Role Users # "+environmentRoleCtrl.roleData.role_name,"Updated Successfully"):toastr.error("Role Users # "+environmentRoleCtrl.roleData.role_name,"failed to Update : "+response.message)})),TDMService.updateEnvironmentRole(environmentRoleCtrl.environment_id,$scope.content.environment_name,environmentRoleCtrl.roleData.role_id,environmentRoleCtrl.roleData).then((function(response){"SUCCESS"==response.errorCode?toastr.success("Role # "+environmentRoleCtrl.roleData.role_name,"Updated Successfully"):toastr.error("Role # "+environmentRoleCtrl.roleData.role_name,"failed to Update : "+response.message)}))},environmentRoleCtrl.deleteEnvironmentRole=function(){SweetAlert.swal({title:"Are you sure you want to remove Role "+environmentRoleCtrl.roleData.role_name,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes",cancelButtonText:"No",closeOnConfirm:!0,closeOnCancel:!0,animation:"false",customClass:"animated fadeInUp"},(function(isConfirm){isConfirm&&TDMService.deleteEnvironmentRole(environmentRoleCtrl.environment_id,$scope.content.environment_name,environmentRoleCtrl.roleData.role_id,environmentRoleCtrl.roleData.role_name).then((function(response){"SUCCESS"==response.errorCode?(toastr.success("Role # "+environmentRoleCtrl.roleData.role_name,"deleted Successfully"),$timeout((function(){$scope.content.openRoles()}),400)):toastr.error("Role # "+environmentRoleCtrl.roleData.role_name,"failed to delete")}))}))},BreadCrumbsService.push({role_name:environmentRoleCtrl.roleData.role_name},"ROLE_BREADCRUMB",(function(){$scope.content.openRole(environmentRoleCtrl.roleData)}))},controllerAs:"environmentRoleCtrl"}}angular.module("TDM-FE").directive("environmentRolesDirective",environmentRolesDirective).directive("environmentRolesTableDirective",environmentRolesTableDirective).directive("environmentNewRoleDirective",environmentNewRoleDirective).directive("environmentRoleDirective",environmentRoleDirective);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpcmVjdGl2ZXMvZW52aXJvbm1lbnRzL2Vudmlyb25tZW50Um9sZXNEaXJlY3RpdmUuanMiXSwibmFtZXMiOlsiZW52aXJvbm1lbnRSb2xlc0RpcmVjdGl2ZSIsInJlc3RyaWN0IiwidGVtcGxhdGVVcmwiLCJzY29wZSIsImNvbnRlbnQiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJGNvbXBpbGUiLCJURE1TZXJ2aWNlIiwiRFRDb2x1bW5CdWlsZGVyIiwiRFRPcHRpb25zQnVpbGRlciIsIiRxIiwiQnJlYWRDcnVtYnNTZXJ2aWNlIiwiZW52aXJvbm1lbnRSb2xlc0N0cmwiLCJ0aGlzIiwiZW52aXJvbm1lbnRJRCIsImVudmlyb25tZW50RGF0YSIsImVudmlyb25tZW50X2lkIiwicGFnZURpc3BsYXkiLCJvcGVuUm9sZXMiLCJyb2xlc0RhdGEiLCJvcGVuUm9sZSIsIm9wZW5OZXdSb2xlIiwiaXNPd25lciIsImJyZWFkQ3J1bWJDaGFuZ2UiLCJyb2xlRGF0YSIsImVudmlyb25tZW50X25hbWUiLCJyb2xlcyIsIm5ld1JvbGVEYXRhIiwiZW52aXJvbm1lbnROYW1lIiwicHVzaCIsImNvbnRyb2xsZXJBcyIsImVudmlyb25tZW50TmV3Um9sZURpcmVjdGl2ZSIsInRvYXN0ciIsIiR0aW1lb3V0IiwiZW52aXJvbm1lbnROZXdSb2xlQ3RybCIsImFsbG93ZWRfY3JlYXRpb25fb2Zfc3ludGhldGljX2RhdGEiLCJhbGxvd2VkX2RlbGV0ZV9iZWZvcmVfbG9hZCIsImFsbG93ZWRfcmFuZG9tX2VudGl0eV9zZWxlY3Rpb24iLCJhbGxvd2VkX3JlcXVlc3Rfb2ZfZnJlc2hfZGF0YSIsImFsbG93ZWRfdGFza19zY2hlZHVsaW5nIiwiYWxsb3dlZF9yZXBsYWNlX3NlcXVlbmNlcyIsImFsbG93ZWRfcmVmcmVzaF9yZWZlcmVuY2VfZGF0YSIsImFsbG93ZWRfbnVtYmVyX29mX2VudGl0aWVzX3RvX2NvcHkiLCJyb2xlX2Rlc2NyaXB0aW9uIiwicm9sZV9uYW1lIiwiYWRkUm9sZSIsIl8iLCJmaW5kIiwiZXJyb3IiLCJwb3N0RW52aXJvbm1lbnRSb2xlIiwidGhlbiIsInJlc3BvbnNlIiwiZXJyb3JDb2RlIiwic3VjY2VzcyIsIm1lc3NhZ2UiLCJlbnZpcm9ubWVudFJvbGVzVGFibGVEaXJlY3RpdmUiLCJBdXRoU2VydmljZSIsInJvbGVzVGFibGVDdHJsIiwiZGlzYWJsZUNoYW5nZSIsImF1dGhvcml6ZWRUb0VkaXQiLCJnZXRFbnZpcm9ubWVudFJvbGVzIiwicmVzdWx0IiwiZHRJbnN0YW5jZSIsImR0Q29sdW1ucyIsImR0Q29sdW1uRGVmcyIsImhlYWRlcnMiLCJjb2x1bW4iLCJuYW1lIiwiY2xpY2tBYmxlIiwidHlwZSIsImNsaWNrQWJsZUNvbHVtbiIsImRhdGEiLCJmdWxsIiwibWV0YSIsInJvbGVfaWQiLCJjaGFuZ2VUb0xvY2FsRGF0ZSIsIm1vbWVudCIsImZvcm1hdCIsImkiLCJsZW5ndGgiLCJuZXdDb2x1bW4iLCJ3aXRoVGl0bGUiLCJyZW5kZXJXaXRoIiwiZ2V0VGFibGVEYXRhIiwiZGVmZXJyZWQiLCJkZWZlciIsInJlc29sdmUiLCJwcm9taXNlIiwiZHRPcHRpb25zIiwiZnJvbUZuUHJvbWlzZSIsIndpdGhET00iLCJ3aXRoT3B0aW9uIiwicm93IiwiYW5ndWxhciIsImVsZW1lbnQiLCJjb250ZW50cyIsIndpdGhCdXR0b25zIiwid2l0aENvbHVtbkZpbHRlciIsImFvQ29sdW1ucyIsImJSZWdleCIsImJTbWFydCIsInZhbHVlcyIsInVuaXF1ZSIsIm1hcCIsImR0SW5zdGFuY2VDYWxsYmFjayIsImlzRnVuY3Rpb24iLCJpc0RlZmluZWQiLCJjaGFuZ2VEYXRhIiwibG9hZGluZ1RhYmxlIiwicm9sZUlEIiwiZW52aXJvbm1lbnRSb2xlRGlyZWN0aXZlIiwiU3dlZXRBbGVydCIsImVudmlyb25tZW50Um9sZUN0cmwiLCJyb2xlX3N0YXR1cyIsImdldFRlc3RlcnMiLCJhbGxUZXN0ZXJzIiwiZ2V0RW52aXJvbm1lbnRSb2xlVGVzdGVycyIsInRlc3RlcnMiLCJjb25jYXQiLCJoaWRlVXNlcnNJbnB1dCIsInNhdmVDaGFuZ2VzIiwicG9zdEVudmlyb25tZW50Um9sZVRlc3RlcnMiLCJ1cGRhdGVFbnZpcm9ubWVudFJvbGUiLCJkZWxldGVFbnZpcm9ubWVudFJvbGUiLCJzd2FsIiwidGl0bGUiLCJzaG93Q2FuY2VsQnV0dG9uIiwiY29uZmlybUJ1dHRvbkNvbG9yIiwiY29uZmlybUJ1dHRvblRleHQiLCJjYW5jZWxCdXR0b25UZXh0IiwiY2xvc2VPbkNvbmZpcm0iLCJjbG9zZU9uQ2FuY2VsIiwiYW5pbWF0aW9uIiwiY3VzdG9tQ2xhc3MiLCJpc0NvbmZpcm0iLCJtb2R1bGUiLCJkaXJlY3RpdmUiXSwibWFwcGluZ3MiOiJBQUFBLFNBQVNBLDRCQW9ETCxNQUFPLENBQ0hDLFNBQVUsSUFDVkMsWUFwRFcsc0NBcURYQyxNQUFPLENBQ0hDLFFBQVMsS0FFYkMsV0F0RGEsU0FBVUMsT0FBUUMsU0FBVUMsV0FBWUMsZ0JBQWlCQyxpQkFBa0JDLEdBQUlDLG9CQUM1RixJQUFJQyxxQkFBdUJDLEtBRTNCRCxxQkFBcUJFLGNBQWdCVCxPQUFPRixRQUFRWSxnQkFBZ0JDLGVBRXBFSixxQkFBcUJLLFlBQWMsYUFFbkNMLHFCQUFxQk0sVUFBWSxXQUM3Qk4scUJBQXFCTyxVQUFZLENBQzdCQyxTQUFVUixxQkFBcUJRLFNBQy9CQyxZQUFhVCxxQkFBcUJTLFlBQ2xDUCxjQUFlRixxQkFBcUJFLGNBQ3BDUSxRQUFTakIsT0FBT0YsUUFBUVksZ0JBQWdCTyxTQUU1Q1YscUJBQXFCSyxZQUFjLGFBQ25DTixtQkFBbUJZLGlCQUFpQixJQUd4Q1gscUJBQXFCUSxTQUFXLFNBQVVJLFVBQ3RDWixxQkFBcUJZLFNBQVcsQ0FDNUJBLFNBQVVBLFNBQ1ZSLGVBQWdCSixxQkFBcUJFLGNBQ3JDVyxpQkFBa0JwQixPQUFPRixRQUFRWSxnQkFBZ0JVLGlCQUNqRFAsVUFBV04scUJBQXFCTSxVQUNoQ0UsU0FBVVIscUJBQXFCUSxTQUMvQkUsUUFBU2pCLE9BQU9GLFFBQVFZLGdCQUFnQk8s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ekN5RyxVQUFVLDJCQUE0QjFCIiwiZmlsZSI6ImRpcmVjdGl2ZXMvZW52aXJvbm1lbnRzL2Vudmlyb25tZW50Um9sZXNEaXJlY3RpdmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBlbnZpcm9ubWVudFJvbGVzRGlyZWN0aXZlKCkge1xuXG4gICAgdmFyIHRlbXBsYXRlID0gXCJ2aWV3cy9lbnZpcm9ubWVudHMvcm9sZXMvcm9sZXMuaHRtbFwiO1xuXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCAkY29tcGlsZSwgVERNU2VydmljZSwgRFRDb2x1bW5CdWlsZGVyLCBEVE9wdGlvbnNCdWlsZGVyLCAkcSwgQnJlYWRDcnVtYnNTZXJ2aWNlKSB7XG4gICAgICAgIHZhciBlbnZpcm9ubWVudFJvbGVzQ3RybCA9IHRoaXM7XG5cbiAgICAgICAgZW52aXJvbm1lbnRSb2xlc0N0cmwuZW52aXJvbm1lbnRJRCA9ICRzY29wZS5jb250ZW50LmVudmlyb25tZW50RGF0YS5lbnZpcm9ubWVudF9pZDtcblxuICAgICAgICBlbnZpcm9ubWVudFJvbGVzQ3RybC5wYWdlRGlzcGxheSA9ICdyb2xlc1RhYmxlJztcblxuICAgICAgICBlbnZpcm9ubWVudFJvbGVzQ3RybC5vcGVuUm9sZXMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBlbnZpcm9ubWVudFJvbGVzQ3RybC5yb2xlc0RhdGEgPSB7XG4gICAgICAgICAgICAgICAgb3BlblJvbGU6IGVudmlyb25tZW50Um9sZXNDdHJsLm9wZW5Sb2xlLFxuICAgICAgICAgICAgICAgIG9wZW5OZXdSb2xlOiBlbnZpcm9ubWVudFJvbGVzQ3RybC5vcGVuTmV3Um9sZSxcbiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudElEOiBlbnZpcm9ubWVudFJvbGVzQ3RybC5lbnZpcm9ubWVudElELFxuICAgICAgICAgICAgICAgIGlzT3duZXI6ICRzY29wZS5jb250ZW50LmVudmlyb25tZW50RGF0YS5pc093bmVyXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZW52aXJvbm1lbnRSb2xlc0N0cmwucGFnZURpc3BsYXkgPSAncm9sZXNUYWJsZSc7XG4gICAgICAgICAgICBCcmVhZENydW1ic1NlcnZpY2UuYnJlYWRDcnVtYkNoYW5nZSgyKTtcbiAgICAgICAgfTtcblxuICAgICAgICBlbnZpcm9ubWVudFJvbGVzQ3RybC5vcGVuUm9sZSA9IGZ1bmN0aW9uIChyb2xlRGF0YSkge1xuICAgICAgICAgICAgZW52aXJvbm1lbnRSb2xlc0N0cmwucm9sZURhdGEgPSB7XG4gICAgICAgICAgICAgICAgcm9sZURhdGE6IHJvbGVEYXRhLFxuICAgICAgICAgICAgICAgIGVudmlyb25tZW50X2lkOiBlbnZpcm9ubWVudFJvbGVzQ3RybC5lbnZpcm9ubWVudElELFxuICAgICAgICAgICAgICAgIGVudmlyb25tZW50X25hbWU6ICRzY29wZS5jb250ZW50LmVudmlyb25tZW50RGF0YS5lbnZpcm9ubWVudF9uYW1lLFxuICAgICAgICAgICAgICAgIG9wZW5Sb2xlczogZW52aXJvbm1lbnRSb2xlc0N0cmwub3BlblJvbGVzLFxuICAgICAgICAgICAgICAgIG9wZW5Sb2xlOiBlbnZpcm9ubWVudFJvbGVzQ3RybC5vcGVuUm9sZSxcbiAgICAgICAgICAgICAgICBpc093bmVyOiAkc2NvcGUuY29udGVudC5lbnZpcm9ubWVudERhdGEuaXNPd25lclxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGVudmlyb25tZW50Um9sZXNDdHJsLnBhZ2VEaXNwbGF5ID0gJ3JvbGUnO1xuICAgICAgICB9O1xuXG4gICAgICAgIGVudmlyb25tZW50Um9sZXNDdHJsLm9wZW5OZXdSb2xlID0gZnVuY3Rpb24gKHJvbGVzKSB7XG4gICAgICAgICAgICBlbnZpcm9ubWVudFJvbGVzQ3RybC5uZXdSb2xlRGF0YSA9IHtcbiAgICAgICAgICAgICAgICByb2xlczogcm9sZXMsXG4gICAgICAgICAgICAgICAgb3BlblJvbGVzOiBlbnZpcm9ubWVudFJvbGVzQ3RybC5vcGVuUm9sZXMsXG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnRJRDogZW52aXJvbm1lbnRSb2xlc0N0cmwuZW52aXJvbm1lbnRJRCxcbiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudE5hbWU6ICRzY29wZS5jb250ZW50LmVudmlyb25tZW50RGF0YS5lbnZpcm9ubWVudF9uYW1lLFxuICAgICAgICAgICAgICAgIGlzT3duZXI6ICRzY29wZS5jb250ZW50LmVudmlyb25tZW50RGF0YS5pc093bmVyXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZW52aXJvbm1lbnRSb2xlc0N0cmwucGFnZURpc3BsYXkgPSAnbmV3Um9sZSc7XG4gICAgICAgIH07XG5cbiAgICAgICAgQnJlYWRDcnVtYnNTZXJ2aWNlLnB1c2goe30sICdST0xFUycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGVudmlyb25tZW50Um9sZXNDdHJsLm9wZW5Sb2xlcygpO1xuICAgICAgICB9KTtcblxuICAgICAgICBlbnZpcm9ubWVudFJvbGVzQ3RybC5vcGVuUm9sZXMoKTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiRVwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogdGVtcGxhdGUsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBjb250ZW50OiAnPSdcbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbGxlcjogY29udHJvbGxlcixcbiAgICAgICAgY29udHJvbGxlckFzOiAncm9sZXNDdHJsJ1xuICAgIH07XG59XG5cblxuZnVuY3Rpb24gZW52aXJvbm1lbnROZXdSb2xlRGlyZWN0aXZlKCkge1xuXG4gICAgdmFyIHRlbXBsYXRlID0gXCJ2aWV3cy9lbnZpcm9ubWVudHMvcm9sZXMvbmV3Um9sZS5odG1sXCI7XG5cbiAgICB2YXIgY29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsIFRETVNlcnZpY2UsIEJyZWFkQ3J1bWJzU2VydmljZSwgdG9hc3RyLCAkdGltZW91dCkge1xuICAgICAgICB2YXIgZW52aXJvbm1lbnROZXdSb2xlQ3RybCA9IHRoaXM7XG4gICAgICAgIGVudmlyb25tZW50TmV3Um9sZUN0cmwuZW52aXJvbm1lbnRJRCA9ICRzY29wZS5jb250ZW50LmVudmlyb25tZW50SUQ7XG4gICAgICAgIGVudmlyb25tZW50TmV3Um9sZUN0cmwucm9sZXMgPSAkc2NvcGUuY29udGVudC5yb2xlcztcbiAgICAgICAgZW52aXJvbm1lbnROZXdSb2xlQ3RybC5yb2xlRGF0YSA9IHtcbiAgICAgICAgICAgIGFsbG93ZWRfY3JlYXRpb25fb2Zfc3ludGhldGljX2RhdGE6IGZhbHNlLFxuICAgICAgICAgICAgYWxsb3dlZF9kZWxldGVfYmVmb3JlX2xvYWQ6IGZhbHNlLFxuICAgICAgICAgICAgYWxsb3dlZF9yYW5kb21fZW50aXR5X3NlbGVjdGlvbjogZmFsc2UsXG4gICAgICAgICAgICBhbGxvd2VkX3JlcXVlc3Rfb2ZfZnJlc2hfZGF0YTogZmFsc2UsXG4gICAgICAgICAgICBhbGxvd2VkX3Rhc2tfc2NoZWR1bGluZzogZmFsc2UsXG4gICAgICAgICAgICBhbGxvd2VkX3JlcGxhY2Vfc2VxdWVuY2VzOiBmYWxzZSxcbiAgICAgICAgICAgIGFsbG93ZWRfcmVmcmVzaF9yZWZlcmVuY2VfZGF0YTogZmFsc2UsXG4gICAgICAgICAgICBhbGxvd2VkX251bWJlcl9vZl9lbnRpdGllc190b19jb3B5OiAwLFxuICAgICAgICAgICAgcm9sZV9kZXNjcmlwdGlvbjogXCJcIixcbiAgICAgICAgICAgIHJvbGVfbmFtZTogXCJcIlxuICAgICAgICB9O1xuXG4gICAgICAgIGVudmlyb25tZW50TmV3Um9sZUN0cmwuYWRkUm9sZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmIChfLmZpbmQoZW52aXJvbm1lbnROZXdSb2xlQ3RybC5yb2xlcywge3JvbGVfbmFtZTogZW52aXJvbm1lbnROZXdSb2xlQ3RybC5yb2xlRGF0YS5yb2xlX25hbWV9KSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0b2FzdHIuZXJyb3IoXCJSb2xlICMgXCIgKyBlbnZpcm9ubWVudE5ld1JvbGVDdHJsLnJvbGVEYXRhLnJvbGVfbmFtZSArIFwiIEFscmVhZHkgRXhpc3RzXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgVERNU2VydmljZS5wb3N0RW52aXJvbm1lbnRSb2xlKGVudmlyb25tZW50TmV3Um9sZUN0cmwuZW52aXJvbm1lbnRJRCwgJHNjb3BlLmNvbnRlbnQuZW52aXJvbm1lbnROYW1lLCBlbnZpcm9ubWVudE5ld1JvbGVDdHJsLnJvbGVEYXRhKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvckNvZGUgPT0gXCJTVUNDRVNTXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoXCJSb2xlICMgXCIgKyBlbnZpcm9ubWVudE5ld1JvbGVDdHJsLnJvbGVEYXRhLnJvbGVfbmFtZSwgXCJDcmVhdGVkIFN1Y2Nlc3NmdWxseVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQub3BlblJvbGVzKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDMwMCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoXCJSb2xlICMgXCIgKyBlbnZpcm9ubWVudE5ld1JvbGVDdHJsLnJvbGVEYXRhLnJvbGVfbmFtZSwgXCJVbmFibGUgdG8gQ3JlYXRlIDogXCIgKyByZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIEJyZWFkQ3J1bWJzU2VydmljZS5wdXNoKHt9LCAnTkVXX1JPTEUnLCBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiBcIkVcIixcbiAgICAgICAgdGVtcGxhdGVVcmw6IHRlbXBsYXRlLFxuICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgY29udGVudDogJz0nXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRyb2xsZXI6IGNvbnRyb2xsZXIsXG4gICAgICAgIGNvbnRyb2xsZXJBczogJ2Vudmlyb25tZW50TmV3Um9sZUN0cmwnXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gZW52aXJvbm1lbnRSb2xlc1RhYmxlRGlyZWN0aXZlKCkge1xuXG4gICAgdmFyIHRlbXBsYXRlID0gXCJ2aWV3cy9lbnZpcm9ubWVudHMvcm9sZXMvcm9sZXNUYWJsZS5odG1sXCI7XG5cbiAgICB2YXIgY29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsICRjb21waWxlLCBURE1TZXJ2aWNlLCBEVENvbHVtbkJ1aWxkZXIsIERUT3B0aW9uc0J1aWxkZXIsICRxLCBBdXRoU2VydmljZSwkdGltZW91dCkge1xuICAgICAgICB2YXIgcm9sZXNUYWJsZUN0cmwgPSB0aGlzO1xuICAgICAgICByb2xlc1RhYmxlQ3RybC5lbnZpcm9ubWVudElEID0gJHNjb3BlLmNvbnRlbnQuZW52aXJvbm1lbnRJRDtcbiAgICAgICAgcm9sZXNUYWJsZUN0cmwuZGlzYWJsZUNoYW5nZSA9ICghQXV0aFNlcnZpY2UuYXV0aG9yaXplZFRvRWRpdCgwKSAmJiAoIUF1dGhTZXJ2aWNlLmF1dGhvcml6ZWRUb0VkaXQoMSkgfHwgISRzY29wZS5jb250ZW50LmlzT3duZXIpKTtcbiAgICAgICAgVERNU2VydmljZS5nZXRFbnZpcm9ubWVudFJvbGVzKHJvbGVzVGFibGVDdHJsLmVudmlyb25tZW50SUQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JDb2RlID09IFwiU1VDQ0VTU1wiKSB7XG4gICAgICAgICAgICAgICAgLy9UT0RPIFNVQ0NFU1NcbiAgICAgICAgICAgICAgICByb2xlc1RhYmxlQ3RybC5yb2xlcyA9IHJlc3BvbnNlLnJlc3VsdDtcbiAgICAgICAgICAgICAgICByb2xlc1RhYmxlQ3RybC5kdEluc3RhbmNlID0ge307XG4gICAgICAgICAgICAgICAgcm9sZXNUYWJsZUN0cmwuZHRDb2x1bW5zID0gW107XG4gICAgICAgICAgICAgICAgcm9sZXNUYWJsZUN0cmwuZHRDb2x1bW5EZWZzID0gW107XG4gICAgICAgICAgICAgICAgcm9sZXNUYWJsZUN0cmwuaGVhZGVycyA9IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiAncm9sZV9uYW1lJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdOYW1lJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrQWJsZTogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46ICdyb2xlX2Rlc2NyaXB0aW9uJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdEZXNjcmlwdGlvbicsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3JvbGVfY3JlYXRpb25fZGF0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnQ3JlYXRpb24gRGF0ZScsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2RhdGUnXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3JvbGVfY3JlYXRlZF9ieScsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnQ3JlYXRlZCBCeScsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3JvbGVfbGFzdF91cGRhdGVkX2RhdGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0xhc3QgVXBkYXRlIERhdGUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkYXRlJ1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46ICdyb2xlX2xhc3RfdXBkYXRlZF9ieScsXG4gICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnVXBkYXRlZCBCeScsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3JvbGVfc3RhdHVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdTdGF0dXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXTtcblxuICAgICAgICAgICAgICAgIHZhciBjbGlja0FibGVDb2x1bW4gPSBmdW5jdGlvbiAoZGF0YSwgdHlwZSwgZnVsbCwgbWV0YSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gJzxhIG5nLWNsaWNrPVwicm9sZXNUYWJsZUN0cmwub3BlblJvbGUoJyArIGZ1bGwucm9sZV9pZCArICcpXCI+JyArIGRhdGEgKyAnPC9hPic7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIHZhciBjaGFuZ2VUb0xvY2FsRGF0ZSA9IGZ1bmN0aW9uIChkYXRhLCB0eXBlLCBmdWxsLCBtZXRhKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBtb21lbnQoZGF0YSkuZm9ybWF0KCdEIE1NTSBZWVlZLCBoOm1tJylcbiAgICAgICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJvbGVzVGFibGVDdHJsLmhlYWRlcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvbGVzVGFibGVDdHJsLmhlYWRlcnNbaV0uY2xpY2tBYmxlID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGVzVGFibGVDdHJsLmR0Q29sdW1ucy5wdXNoKERUQ29sdW1uQnVpbGRlci5uZXdDb2x1bW4ocm9sZXNUYWJsZUN0cmwuaGVhZGVyc1tpXS5jb2x1bW4pLndpdGhUaXRsZShyb2xlc1RhYmxlQ3RybC5oZWFkZXJzW2ldLm5hbWUpLnJlbmRlcldpdGgoY2xpY2tBYmxlQ29sdW1uKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAocm9sZXNUYWJsZUN0cmwuaGVhZGVyc1tpXS50eXBlID09ICdkYXRlJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9sZXNUYWJsZUN0cmwuZHRDb2x1bW5zLnB1c2goRFRDb2x1bW5CdWlsZGVyLm5ld0NvbHVtbihyb2xlc1RhYmxlQ3RybC5oZWFkZXJzW2ldLmNvbHVtbikud2l0aFRpdGxlKHJvbGVzVGFibGVDdHJsLmhlYWRlcnNbaV0ubmFtZSkucmVuZGVyV2l0aChjaGFuZ2VUb0xvY2FsRGF0ZSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9sZXNUYWJsZUN0cmwuZHRDb2x1bW5zLnB1c2goRFRDb2x1bW5CdWlsZGVyLm5ld0NvbHVtbihyb2xlc1RhYmxlQ3RybC5oZWFkZXJzW2ldLmNvbHVtbikud2l0aFRpdGxlKHJvbGVzVGFibGVDdHJsLmhlYWRlcnNbaV0ubmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIGdldFRhYmxlRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShyb2xlc1RhYmxlQ3RybC5yb2xlcyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICByb2xlc1RhYmxlQ3RybC5kdE9wdGlvbnMgPSBEVE9wdGlvbnNCdWlsZGVyLmZyb21GblByb21pc2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VGFibGVEYXRhKCk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLndpdGhET00oJzxcImh0bWw1YnV0dG9uc1wiQj5sVGZnaXRwJylcbiAgICAgICAgICAgICAgICAgICAgLndpdGhPcHRpb24oJ2NyZWF0ZWRSb3cnLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBSZWNvbXBpbGluZyBzbyB3ZSBjYW4gYmluZCBBbmd1bGFyIGRpcmVjdGl2ZSB0byB0aGUgRFRcbiAgICAgICAgICAgICAgICAgICAgICAgICRjb21waWxlKGFuZ3VsYXIuZWxlbWVudChyb3cpLmNvbnRlbnRzKCkpKCRzY29wZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdzY3JvbGxYJywgZmFsc2UpXG4gICAgICAgICAgICAgICAgICAgIC53aXRoQnV0dG9ucyhbXSkud2l0aENvbHVtbkZpbHRlcih7XG4gICAgICAgICAgICAgICAgICAgICAgICBhb0NvbHVtbnM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYlJlZ2V4OiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiU21hcnQ6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiUmVnZXg6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJTbWFydDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJSZWdleDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYlNtYXJ0OiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdzZWxlY3QnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiUmVnZXg6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IF8udW5pcXVlKF8ubWFwKHJvbGVzVGFibGVDdHJsLnJvbGVzLCAncm9sZV9jcmVhdGVkX2J5JykpXG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBiUmVnZXg6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJTbWFydDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAnc2VsZWN0JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYlJlZ2V4OiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBfLnVuaXF1ZShfLm1hcChyb2xlc1RhYmxlQ3RybC5yb2xlcywgJ3JvbGVfbGFzdF91cGRhdGVkX2J5JykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIHJvbGVzVGFibGVDdHJsLmR0SW5zdGFuY2VDYWxsYmFjayA9IGZ1bmN0aW9uIChkdEluc3RhbmNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24ocm9sZXNUYWJsZUN0cmwuZHRJbnN0YW5jZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGVzVGFibGVDdHJsLmR0SW5zdGFuY2UoZHRJbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYW5ndWxhci5pc0RlZmluZWQocm9sZXNUYWJsZUN0cmwuZHRJbnN0YW5jZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGVzVGFibGVDdHJsLmR0SW5zdGFuY2UgPSBkdEluc3RhbmNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAocm9sZXNUYWJsZUN0cmwuZHRJbnN0YW5jZS5jaGFuZ2VEYXRhICE9IG51bGwpXG4gICAgICAgICAgICAgICAgICAgIHJvbGVzVGFibGVDdHJsLmR0SW5zdGFuY2UuY2hhbmdlRGF0YShnZXRUYWJsZURhdGEoKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcm9sZXNUYWJsZUN0cmwubG9hZGluZ1RhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvL1RPRE8gRVJST1JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgcm9sZXNUYWJsZUN0cmwub3BlblJvbGUgPSBmdW5jdGlvbiAocm9sZUlEKSB7XG4gICAgICAgICAgICBpZiAoJHNjb3BlLmNvbnRlbnQub3BlblJvbGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgcm9sZURhdGEgPSBfLmZpbmQocm9sZXNUYWJsZUN0cmwucm9sZXMsIHtyb2xlX2lkOiByb2xlSUR9KTtcbiAgICAgICAgICAgICAgICBpZiAocm9sZURhdGEpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQub3BlblJvbGUocm9sZURhdGEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9UT0RPIHNob3cgZXJyb3IgPz9cbiAgICAgICAgfTtcblxuICAgICAgICByb2xlc1RhYmxlQ3RybC5vcGVuTmV3Um9sZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGlmICgkc2NvcGUuY29udGVudC5vcGVuTmV3Um9sZSkge1xuICAgICAgICAgICAgICAgICRzY29wZS5jb250ZW50Lm9wZW5OZXdSb2xlKHJvbGVzVGFibGVDdHJsLnJvbGVzKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL1RPRE8gc2hvdyBlcnJvciA/P1xuICAgICAgICB9XG5cbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiRVwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogdGVtcGxhdGUsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBjb250ZW50OiAnPSdcbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbGxlcjogY29udHJvbGxlcixcbiAgICAgICAgY29udHJvbGxlckFzOiAncm9sZXNUYWJsZUN0cmwnXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gZW52aXJvbm1lbnRSb2xlRGlyZWN0aXZlKCkge1xuXG4gICAgdmFyIHRlbXBsYXRlID0gXCJ2aWV3cy9lbnZpcm9ubWVudHMvcm9sZXMvcm9sZS5odG1sXCI7XG5cbiAgICB2YXIgY29udHJvbGxlciA9IGZ1bmN0aW9uICgkc2NvcGUsIFRETVNlcnZpY2UsIEJyZWFkQ3J1bWJzU2VydmljZSwgJHRpbWVvdXQsIHRvYXN0ciwgU3dlZXRBbGVydCwgQXV0aFNlcnZpY2UpIHtcbiAgICAgICAgdmFyIGVudmlyb25tZW50Um9sZUN0cmwgPSB0aGlzO1xuICAgICAgICBlbnZpcm9ubWVudFJvbGVDdHJsLnJvbGVEYXRhID0gJHNjb3BlLmNvbnRlbnQucm9sZURhdGE7XG4gICAgICAgIGVudmlyb25tZW50Um9sZUN0cmwuZW52aXJvbm1lbnRfaWQgPSAkc2NvcGUuY29udGVudC5lbnZpcm9ubWVudF9pZDtcbiAgICAgICAgZW52aXJvbm1lbnRSb2xlQ3RybC5kaXNhYmxlQ2hhbmdlID0gKGVudmlyb25tZW50Um9sZUN0cmwucm9sZURhdGEucm9sZV9zdGF0dXMgPT0gJ0luYWN0aXZlJyB8fCAhQXV0aFNlcnZpY2UuYXV0aG9yaXplZFRvRWRpdCgxKSB8fCAhJHNjb3BlLmNvbnRlbnQuaXNPd25lcik7XG5cbiAgICAgICAgVERNU2VydmljZS5nZXRUZXN0ZXJzKGVudmlyb25tZW50Um9sZUN0cmwuZW52aXJvbm1lbnRfaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JDb2RlID09IFwiU1VDQ0VTU1wiKSB7XG4gICAgICAgICAgICAgICAgZW52aXJvbm1lbnRSb2xlQ3RybC5hbGxUZXN0ZXJzID0gcmVzcG9uc2UucmVzdWx0O1xuXG4gICAgICAgICAgICAgICAgVERNU2VydmljZS5nZXRFbnZpcm9ubWVudFJvbGVUZXN0ZXJzKGVudmlyb25tZW50Um9sZUN0cmwuZW52aXJvbm1lbnRfaWQsIGVudmlyb25tZW50Um9sZUN0cmwucm9sZURhdGEucm9sZV9pZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yQ29kZSA9PSBcIlNVQ0NFU1NcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW52aXJvbm1lbnRSb2xlQ3RybC50ZXN0ZXJzID0gcmVzcG9uc2UucmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgZW52aXJvbm1lbnRSb2xlQ3RybC5hbGxUZXN0ZXJzID0gZW52aXJvbm1lbnRSb2xlQ3RybC5hbGxUZXN0ZXJzLmNvbmNhdChlbnZpcm9ubWVudFJvbGVDdHJsLnRlc3RlcnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW52aXJvbm1lbnRSb2xlQ3RybC5oaWRlVXNlcnNJbnB1dCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoXCJSb2xlICMgXCIgKyBlbnZpcm9ubWVudFJvbGVDdHJsLnJvbGVEYXRhLnJvbGVfbmFtZSwgXCJmYWlsZWQgdG8gZ2V0IFJvbGUgVXNlcnMgOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudFJvbGVDdHJsLmhpZGVVc2Vyc0lucHV0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoXCJSb2xlICMgXCIgKyBlbnZpcm9ubWVudFJvbGVDdHJsLnJvbGVEYXRhLnJvbGVfbmFtZSwgXCJmYWlsZWQgdG8gZ2V0IEFsbCBUZXN0ZXJzIDogXCIgKyByZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgZW52aXJvbm1lbnRSb2xlQ3RybC5zYXZlQ2hhbmdlcyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIFRETVNlcnZpY2UucG9zdEVudmlyb25tZW50Um9sZVRlc3RlcnMoZW52aXJvbm1lbnRSb2xlQ3RybC5lbnZpcm9ubWVudF9pZCwgJHNjb3BlLmNvbnRlbnQuZW52aXJvbm1lbnRfbmFtZSxcbiAgICAgICAgICAgICAgICBlbnZpcm9ubWVudFJvbGVDdHJsLnJvbGVEYXRhLnJvbGVfaWQsIGVudmlyb25tZW50Um9sZUN0cmwucm9sZURhdGEucm9sZV9uYW1lLCBlbnZpcm9ubWVudFJvbGVDdHJsLnRlc3RlcnMpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yQ29kZSA9PSBcIlNVQ0NFU1NcIikge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhcIlJvbGUgVXNlcnMgIyBcIiArIGVudmlyb25tZW50Um9sZUN0cmwucm9sZURhdGEucm9sZV9uYW1lLCBcIlVwZGF0ZWQgU3VjY2Vzc2Z1bGx5XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKFwiUm9sZSBVc2VycyAjIFwiICsgZW52aXJvbm1lbnRSb2xlQ3RybC5yb2xlRGF0YS5yb2xlX25hbWUsIFwiZmFpbGVkIHRvIFVwZGF0ZSA6IFwiICsgcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIFRETVNlcnZpY2UudXBkYXRlRW52aXJvbm1lbnRSb2xlKGVudmlyb25tZW50Um9sZUN0cmwuZW52aXJvbm1lbnRfaWQsICRzY29wZS5jb250ZW50LmVudmlyb25tZW50X25hbWUsIGVudmlyb25tZW50Um9sZUN0cmwucm9sZURhdGEucm9sZV9pZCwgZW52aXJvbm1lbnRSb2xlQ3RybC5yb2xlRGF0YSkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JDb2RlID09IFwiU1VDQ0VTU1wiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKFwiUm9sZSAjIFwiICsgZW52aXJvbm1lbnRSb2xlQ3RybC5yb2xlRGF0YS5yb2xlX25hbWUsIFwiVXBkYXRlZCBTdWNjZXNzZnVsbHlcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoXCJSb2xlICMgXCIgKyBlbnZpcm9ubWVudFJvbGVDdHJsLnJvbGVEYXRhLnJvbGVfbmFtZSwgXCJmYWlsZWQgdG8gVXBkYXRlIDogXCIgKyByZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICBlbnZpcm9ubWVudFJvbGVDdHJsLmRlbGV0ZUVudmlyb25tZW50Um9sZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIFN3ZWV0QWxlcnQuc3dhbCh7XG4gICAgICAgICAgICAgICAgICAgIHRpdGxlOiBcIkFyZSB5b3Ugc3VyZSB5b3Ugd2FudCB0byByZW1vdmUgUm9sZSBcIiArIGVudmlyb25tZW50Um9sZUN0cmwucm9sZURhdGEucm9sZV9uYW1lLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICAgICAgICAgICAgc2hvd0NhbmNlbEJ1dHRvbjogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvbkNvbG9yOiBcIiNERDZCNTVcIixcbiAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiWWVzXCIsXG4gICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiTm9cIixcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VPbkNvbmZpcm06IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlT25DYW5jZWw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGFuaW1hdGlvbjogXCJmYWxzZVwiLFxuICAgICAgICAgICAgICAgICAgICBjdXN0b21DbGFzczogXCJhbmltYXRlZCBmYWRlSW5VcFwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoaXNDb25maXJtKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0NvbmZpcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFRETVNlcnZpY2UuZGVsZXRlRW52aXJvbm1lbnRSb2xlKGVudmlyb25tZW50Um9sZUN0cmwuZW52aXJvbm1lbnRfaWQsICRzY29wZS5jb250ZW50LmVudmlyb25tZW50X25hbWUsIGVudmlyb25tZW50Um9sZUN0cmwucm9sZURhdGEucm9sZV9pZCwgZW52aXJvbm1lbnRSb2xlQ3RybC5yb2xlRGF0YS5yb2xlX25hbWUpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yQ29kZSA9PSBcIlNVQ0NFU1NcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhcIlJvbGUgIyBcIiArIGVudmlyb25tZW50Um9sZUN0cmwucm9sZURhdGEucm9sZV9uYW1lLCBcImRlbGV0ZWQgU3VjY2Vzc2Z1bGx5XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUuY29udGVudC5vcGVuUm9sZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSwgNDAwKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKFwiUm9sZSAjIFwiICsgZW52aXJvbm1lbnRSb2xlQ3RybC5yb2xlRGF0YS5yb2xlX25hbWUsIFwiZmFpbGVkIHRvIGRlbGV0ZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIEJyZWFkQ3J1bWJzU2VydmljZS5wdXNoKHtyb2xlX25hbWU6IGVudmlyb25tZW50Um9sZUN0cmwucm9sZURhdGEucm9sZV9uYW1lfSwgJ1JPTEVfQlJFQURDUlVNQicsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICRzY29wZS5jb250ZW50Lm9wZW5Sb2xlKGVudmlyb25tZW50Um9sZUN0cmwucm9sZURhdGEpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiRVwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogdGVtcGxhdGUsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBjb250ZW50OiAnPSdcbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbGxlcjogY29udHJvbGxlcixcbiAgICAgICAgY29udHJvbGxlckFzOiAnZW52aXJvbm1lbnRSb2xlQ3RybCdcbiAgICB9O1xufVxuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgnVERNLUZFJylcbiAgICAuZGlyZWN0aXZlKCdlbnZpcm9ubWVudFJvbGVzRGlyZWN0aXZlJywgZW52aXJvbm1lbnRSb2xlc0RpcmVjdGl2ZSlcbiAgICAuZGlyZWN0aXZlKCdlbnZpcm9ubWVudFJvbGVzVGFibGVEaXJlY3RpdmUnLCBlbnZpcm9ubWVudFJvbGVzVGFibGVEaXJlY3RpdmUpXG4gICAgLmRpcmVjdGl2ZSgnZW52aXJvbm1lbnROZXdSb2xlRGlyZWN0aXZlJywgZW52aXJvbm1lbnROZXdSb2xlRGlyZWN0aXZlKVxuICAgIC5kaXJlY3RpdmUoJ2Vudmlyb25tZW50Um9sZURpcmVjdGl2ZScsIGVudmlyb25tZW50Um9sZURpcmVjdGl2ZSk7Il19
