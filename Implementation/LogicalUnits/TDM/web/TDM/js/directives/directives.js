function pageTitle($rootScope,$timeout){return{link:function(scope,element){$rootScope.$on("$stateChangeStart",(function(event,toState,toParams,fromState,fromParams){var title="TDM | Responsive Admin Theme";toState.data&&toState.data.pageTitle&&(title="TDM | "+toState.data.pageTitle),$timeout((function(){element.text(title)}))}))}}}function sideNavigation($timeout){return{restrict:"A",link:function(scope,element){$timeout((function(){element.metisMenu()}))}}}function iboxTools($timeout){return{restrict:"A",scope:!0,templateUrl:"views/common/ibox_tools.html",controller:function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first");ibox.find("div.ibox-content").slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout((function(){ibox.resize(),ibox.find("[id^=map-]").resize()}),50)},$scope.closebox=function(){$element.closest("div.ibox").remove()}}}}function iboxToolsFullScreen($timeout){return{restrict:"A",scope:!0,templateUrl:"views/common/ibox_tools_full_screen.html",controller:function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first");ibox.find("div.ibox-content").slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout((function(){ibox.resize(),ibox.find("[id^=map-]").resize()}),50)},$scope.closebox=function(){$element.closest("div.ibox").remove()},$scope.fullscreen=function(){var ibox=$element.closest("div.ibox"),button=$element.find("i.fa-expand");$("body").toggleClass("fullscreen-ibox-mode"),button.toggleClass("fa-expand").toggleClass("fa-compress"),ibox.toggleClass("fullscreen"),setTimeout((function(){$(window).trigger("resize")}),100)}}}}function minimalizaSidebar($timeout){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="" ng-click="minimalize()"><i class="fa fa-bars"></i></a>',scope:{parentController:"="},controller:function($scope,$element){$scope.minimalize=function(){$("body").toggleClass("mini-navbar"),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("#side-menu").hide(),setTimeout((function(){$("#side-menu").fadeIn(400),$(window).trigger("resize")}),200),$scope.parentController.showTooltip=!1):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout((function(){$("#side-menu").fadeIn(400),$(window).trigger("resize")}),100)):($("#side-menu").removeAttr("style"),$(window).trigger("resize"),$scope.parentController.showTooltip=!0)}}}}function roleHandler($timeout){return{restrict:"A",link:function(scope,element,attr){scope.currentUserRole.id>scope.role&&element.remove()},controller:function($scope,AuthService){$scope.currentUserRole=AuthService.getRole()},scope:{role:"="}}}function icheck($timeout){return{restrict:"A",require:"ngModel",link:function($scope,element,$attrs,ngModel){return $timeout((function(){var value;return value=$attrs.value,$scope.$watch($attrs.ngModel,(function(newValue){$(element).iCheck("update")})),$scope.$watch($attrs.ngDisabled,(function(newValue){$(element).iCheck("update")})),$(element).iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green"}).on("ifChanged",(function(event){if("checkbox"===$(element).attr("type")&&$attrs.ngModel&&$scope.$apply((function(){return ngModel.$setViewValue(event.target.checked)})),"radio"===$(element).attr("type")&&$attrs.ngModel)return $scope.$apply((function(){return ngModel.$setViewValue(value)}))}))}))}}}function treeMenuPopup(){return{scope:{treeMenuPopup:"=treeMenuPopup"},template:'<li ng-repeat="item in treeMenuPopup track by $index" style="padding-bottom: 10px"><tree-menu-item-popup></tree-menu-item-popup></li>',link:function(scope,elem){}}}function treeMenuItemPopup($rootScope,$compile){return{template:'<div style="cursor: pointer;padding-top:5px" ng-style="item.selected && {\'background-color\':\'rgba(208, 235, 255, 0.7)\'}"><i ng-click="collapse(item)" class="fa fa-caret-right" ng-if="item.children"></i><i ng-if="item.isRoot && item.luStatus == \'failed\'" style="text-align: center;color: white;background: red;padding: 5px;width: 22px;border-radius: 50px;" class="fa fa-exclamation"></i><span ng-click="updateTable(item, treeMenu)" ng-style="getCss(item)"ng-bind="item.luName"></span></div>',link:function(scope,element){angular.isArray(scope.item.children)&&element.append($compile('<ul style="list-style: none;" ng-if="collapsed" tree-menu-popup="item.children"></ul>')(scope)),scope.getCss=item=>{let res={};return"failed"==item.luStatus&&(res.color="red"),res["margin-left"]=item.hasChildren?"10px":"15px",res},scope.collapse=function(item){scope.collapsed=!scope.collapsed},scope.updateTable=function(item,treeMenu){$rootScope.$broadcast("updatePopUpTable",{item:item}),item.selected=!0}}}}function treeMenu(){return{scope:{treeMenu:"=treeMenu"},template:'<li ng-repeat="item in treeMenu track by $index" style="padding-bottom: 10px"><tree-menu-item></tree-menu-item></li>',link:function(scope,elem){}}}function treeMenuItem($rootScope,$compile){return{template:'<div style="cursor: pointer;padding-top:5px" ng-style="item.selected && {\'background-color\':\'rgba(208, 235, 255, 0.7)\'}"><i ng-click="collapse(item)" class="fa fa-caret-right" ng-if="item.hasChildren"></i><span ng-click="updateTable(item, treeMenu)" ng-style="getCss(item)"ng-bind="item.lu_name"></span></div>',link:function(scope,element){angular.isArray(scope.item.children)&&element.append($compile('<ul style="list-style: none;" ng-if="collapsed" tree-menu="item.children"></ul>')(scope)),scope.getCss=item=>{let res={};return"failed"==item.lu_status&&(res.color="red"),res["margin-left"]=item.hasChildren?"10px":"15px",res},scope.collapse=function(item){scope.collapsed=!scope.collapsed,$rootScope.$broadcast("showRootLUChildren",{item:item})},scope.updateTable=function(item,treeMenu){$rootScope.$broadcast("updateTDMStats",{item:item}),item.selected=!0}}}}treeMenuItem().$inject=["$compile"],angular.module("TDM-FE").directive("pageTitle",pageTitle).directive("sideNavigation",sideNavigation).directive("iboxTools",iboxTools).directive("minimalizaSidebar",minimalizaSidebar).directive("iboxToolsFullScreen",iboxToolsFullScreen).directive("roleHandler",roleHandler).directive("icheck",icheck).directive("treeMenu",treeMenu).directive("treeMenuPopup",treeMenuPopup).directive("treeMenuItem",treeMenuItem).directive("treeMenuItemPopup",treeMenuItemPopup).directive("autoFocus",["$timeout",function($timeout){return{restrict:"A",link:function($scope,$element){$timeout((function(){$element[0].focus()}),2e3)}}}]).filter("customOptionsFilter",(function(){return function(logicalUnits,be){return logicalUnits?be?_.filter(logicalUnits,(function(lu){return be.be_id==lu.be_id})):logicalUnits:[]}}));
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpcmVjdGl2ZXMvZGlyZWN0aXZlcy5qcyJdLCJuYW1lcyI6WyJwYWdlVGl0bGUiLCIkcm9vdFNjb3BlIiwiJHRpbWVvdXQiLCJsaW5rIiwic2NvcGUiLCJlbGVtZW50IiwiJG9uIiwiZXZlbnQiLCJ0b1N0YXRlIiwidG9QYXJhbXMiLCJmcm9tU3RhdGUiLCJmcm9tUGFyYW1zIiwidGl0bGUiLCJkYXRhIiwidGV4dCIsInNpZGVOYXZpZ2F0aW9uIiwicmVzdHJpY3QiLCJtZXRpc01lbnUiLCJpYm94VG9vbHMiLCJ0ZW1wbGF0ZVVybCIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkZWxlbWVudCIsInNob3doaWRlIiwiaWJveCIsImNsb3Nlc3QiLCJpY29uIiwiZmluZCIsInNsaWRlVG9nZ2xlIiwidG9nZ2xlQ2xhc3MiLCJyZXNpemUiLCJjbG9zZWJveCIsInJlbW92ZSIsImlib3hUb29sc0Z1bGxTY3JlZW4iLCJmdWxsc2NyZWVuIiwiYnV0dG9uIiwiJCIsInNldFRpbWVvdXQiLCJ3aW5kb3ciLCJ0cmlnZ2VyIiwibWluaW1hbGl6YVNpZGViYXIiLCJ0ZW1wbGF0ZSIsInBhcmVudENvbnRyb2xsZXIiLCJtaW5pbWFsaXplIiwiaGFzQ2xhc3MiLCJoaWRlIiwiZmFkZUluIiwic2hvd1Rvb2x0aXAiLCJyZW1vdmVBdHRyIiwicm9sZUhhbmRsZXIiLCJhdHRyIiwiY3VycmVudFVzZXJSb2xlIiwiaWQiLCJyb2xlIiwiQXV0aFNlcnZpY2UiLCJnZXRSb2xlIiwiaWNoZWNrIiwicmVxdWlyZSIsIiRhdHRycyIsIm5nTW9kZWwiLCJ2YWx1ZSIsIiR3YXRjaCIsIm5ld1ZhbHVlIiwiaUNoZWNrIiwiY2hlY2tib3hDbGFzcyIsInJhZGlvQ2xhc3MiLCJvbiIsIiRhcHBseSIsIiRzZXRWaWV3VmFsdWUiLCJ0YXJnZXQiLCJjaGVja2VkIiwidHJlZU1lbnVQb3B1cCIsImVsZW0iLCJ0cmVlTWVudUl0ZW1Qb3B1cCIsIiRjb21waWxlIiwiYW5ndWxhciIsImlzQXJyYXkiLCJpdGVtIiwiY2hpbGRyZW4iLCJhcHBlbmQiLCJnZXRDc3MiLCJyZXMiLCJsdVN0YXR1cyIsImNvbG9yIiwiaGFzQ2hpbGRyZW4iLCJjb2xsYXBzZSIsImNvbGxhcHNlZCIsInVwZGF0ZVRhYmxlIiwidHJlZU1lbnUiLCIkYnJvYWRjYXN0Iiwic2VsZWN0ZWQiLCJ0cmVlTWVudUl0ZW0iLCJsdV9zdGF0dXMiLCIkaW5qZWN0IiwibW9kdWxlIiwiZGlyZWN0aXZlIiwiZm9jdXMiLCJmaWx0ZXIiLCJsb2dpY2FsVW5pdHMiLCJiZSIsIl8iLCJsdSIsImJlX2lkIl0sIm1hcHBpbmdzIjoiQUFTQSxTQUFTQSxVQUFVQyxXQUFZQyxVQUMzQixNQUFPLENBQ0hDLEtBQU0sU0FBVUMsTUFBT0MsU0FVbkJKLFdBQVdLLElBQUkscUJBVEEsU0FBVUMsTUFBT0MsUUFBU0MsU0FBVUMsVUFBV0MsWUFFMUQsSUFBSUMsTUFBUSwrQkFFUkosUUFBUUssTUFBUUwsUUFBUUssS0FBS2IsWUFBV1ksTUFBUSxTQUFXSixRQUFRSyxLQUFLYixXQUM1RUUsVUFBUyxXQUNMRyxRQUFRUyxLQUFLRixlQVdqQyxTQUFTRyxlQUFlYixVQUNwQixNQUFPLENBQ0hjLFNBQVUsSUFDVmIsS0FBTSxTQUFVQyxNQUFPQyxTQUVuQkgsVUFBUyxXQUNMRyxRQUFRWSxpQkFTeEIsU0FBU0MsVUFBVWhCLFVBQ2YsTUFBTyxDQUNIYyxTQUFVLElBQ1ZaLE9BQU8sRUFDUGUsWUFBYSwrQkFDYkMsV0FBWSxTQUFVQyxPQUFRQyxVQUUxQkQsT0FBT0UsU0FBVyxXQUNkLElBQUlDLEtBQU9GLFNBQVNHLFFBQVEsWUFDeEJDLEtBQU9KLFNBQVNLLEtBQUssV0FDWEgsS0FBS0csS0FBSyxvQkFDaEJDLFlBQVksS0FFcEJGLEtBQUtHLFlBQVksaUJBQWlCQSxZQUFZLG1CQUM5Q0wsS0FBS0ssWUFBWSxJQUFJQSxZQUFZLGlCQUNqQzNCLFVBQVMsV0FDTHNCLEtBQUtNLFNBQ0xOLEtBQUtHLEtBQUssY0FBY0csV0FDekIsS0FHSFQsT0FBT1UsU0FBVyxX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ekJyRixXQUFXd0YsV0FBVyxxQkFBc0IsQ0FBQ1osS0FBTUEsUUFFdkR6RSxNQUFNbUYsWUFBYyxTQUFVVixLQUFNVyxVQUNoQ3ZGLFdBQVd3RixXQUFXLGlCQUFrQixDQUFDWixLQUFNQSxPQUMvQ0EsS0FBS2EsVUFBVyxLQTVCaENDLGVBQWVFLFFBQVUsQ0FBQyxZQXNDMUJsQixRQUNLbUIsT0FBTyxVQUNQQyxVQUFVLFlBQWEvRixXQUN2QitGLFVBQVUsaUJBQWtCaEYsZ0JBQzVCZ0YsVUFBVSxZQUFhN0UsV0FDdkI2RSxVQUFVLG9CQUFxQnZELG1CQUMvQnVELFVBQVUsc0JBQXVCOUQscUJBQ2pDOEQsVUFBVSxjQUFlOUMsYUFDekI4QyxVQUFVLFNBQVV2QyxRQUNwQnVDLFVBQVUsV0FBWVAsVUFDdEJPLFVBQVUsZ0JBQWlCeEIsZUFDM0J3QixVQUFVLGVBQWdCSixjQUMxQkksVUFBVSxvQkFBcUJ0QixtQkFDL0JzQixVQUFVLFlBQWEsQ0FBQyxXQUFZLFNBQVU3RixVQUMzQyxNQUFPLENBQ0hjLFNBQVUsSUFDVmIsS0FBTSxTQUFVa0IsT0FBUUMsVUFDcEJwQixVQUFTLFdBQ0xvQixTQUFTLEdBQUcwRSxVQUNiLFVBSWRDLE9BQU8sdUJBQXVCLFdBQzNCLE9BQU8sU0FBVUMsYUFBY0MsSUFDM0IsT0FBS0QsYUFHQUMsR0FHRUMsRUFBRUgsT0FBT0MsY0FBYyxTQUFVRyxJQUNwQyxPQUFJRixHQUFHRyxPQUFTRCxHQUFHQyxTQUhaSixhQUhBIiwiZmlsZSI6ImRpcmVjdGl2ZXMvZGlyZWN0aXZlcy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogSU5TUElOSUEgLSBSZXNwb25zaXZlIEFkbWluIFRoZW1lXG4gKlxuICovXG5cblxuLyoqXG4gKiBwYWdlVGl0bGUgLSBEaXJlY3RpdmUgZm9yIHNldCBQYWdlIHRpdGxlIC0gbWF0YSB0aXRsZVxuICovXG5mdW5jdGlvbiBwYWdlVGl0bGUoJHJvb3RTY29wZSwgJHRpbWVvdXQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIHZhciBsaXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcykge1xuICAgICAgICAgICAgICAgIC8vIERlZmF1bHQgdGl0bGUgLSBsb2FkIG9uIERhc2hib2FyZCAxXG4gICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gJ1RETSB8IFJlc3BvbnNpdmUgQWRtaW4gVGhlbWUnO1xuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSB5b3VyIG93biB0aXRsZSBwYXR0ZXJuXG4gICAgICAgICAgICAgICAgaWYgKHRvU3RhdGUuZGF0YSAmJiB0b1N0YXRlLmRhdGEucGFnZVRpdGxlKSB0aXRsZSA9ICdURE0gfCAnICsgdG9TdGF0ZS5kYXRhLnBhZ2VUaXRsZTtcbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQudGV4dCh0aXRsZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN0YXJ0JywgbGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIHNpZGVOYXZpZ2F0aW9uIC0gRGlyZWN0aXZlIGZvciBydW4gbWV0c2lNZW51IG9uIHNpZGViYXIgbmF2aWdhdGlvblxuICovXG5mdW5jdGlvbiBzaWRlTmF2aWdhdGlvbigkdGltZW91dCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiAnQScsXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCkge1xuICAgICAgICAgICAgLy8gQ2FsbCB0aGUgbWV0c2lNZW51IHBsdWdpbiBhbmQgcGx1ZyBpdCB0byBzaWRlYmFyIG5hdmlnYXRpb25cbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50Lm1ldGlzTWVudSgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vKipcbiAqIGlib3hUb29scyAtIERpcmVjdGl2ZSBmb3IgaUJveCB0b29scyBlbGVtZW50cyBpbiByaWdodCBjb3JuZXIgb2YgaWJveFxuICovXG5mdW5jdGlvbiBpYm94VG9vbHMoJHRpbWVvdXQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICBzY29wZTogdHJ1ZSxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jb21tb24vaWJveF90b29scy5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQpIHtcbiAgICAgICAgICAgIC8vIEZ1bmN0aW9uIGZvciBjb2xsYXBzZSBpYm94XG4gICAgICAgICAgICAkc2NvcGUuc2hvd2hpZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlib3ggPSAkZWxlbWVudC5jbG9zZXN0KCdkaXYuaWJveCcpO1xuICAgICAgICAgICAgICAgIHZhciBpY29uID0gJGVsZW1lbnQuZmluZCgnaTpmaXJzdCcpO1xuICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gaWJveC5maW5kKCdkaXYuaWJveC1jb250ZW50Jyk7XG4gICAgICAgICAgICAgICAgY29udGVudC5zbGlkZVRvZ2dsZSgyMDApO1xuICAgICAgICAgICAgICAgIC8vIFRvZ2dsZSBpY29uIGZyb20gdXAgdG8gZG93blxuICAgICAgICAgICAgICAgIGljb24udG9nZ2xlQ2xhc3MoJ2ZhLWNoZXZyb24tdXAnKS50b2dnbGVDbGFzcygnZmEtY2hldnJvbi1kb3duJyk7XG4gICAgICAgICAgICAgICAgaWJveC50b2dnbGVDbGFzcygnJykudG9nZ2xlQ2xhc3MoJ2JvcmRlci1ib3R0b20nKTtcbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlib3gucmVzaXplKCk7XG4gICAgICAgICAgICAgICAgICAgIGlib3guZmluZCgnW2lkXj1tYXAtXScpLnJlc2l6ZSgpO1xuICAgICAgICAgICAgICAgIH0sIDUwKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgLy8gRnVuY3Rpb24gZm9yIGNsb3NlIGlib3hcbiAgICAgICAgICAgICAgICAkc2NvcGUuY2xvc2Vib3ggPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBpYm94ID0gJGVsZW1lbnQuY2xvc2VzdCgnZGl2Lmlib3gnKTtcbiAgICAgICAgICAgICAgICAgICAgaWJveC5yZW1vdmUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vKipcbiAqIGlib3hUb29scyB3aXRoIGZ1bGwgc2NyZWVuIC0gRGlyZWN0aXZlIGZvciBpQm94IHRvb2xzIGVsZW1lbnRzIGluIHJpZ2h0IGNvcm5lciBvZiBpYm94IHdpdGggZnVsbCBzY3JlZW4gb3B0aW9uXG4gKi9cbmZ1bmN0aW9uIGlib3hUb29sc0Z1bGxTY3JlZW4oJHRpbWVvdXQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICBzY29wZTogdHJ1ZSxcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy9jb21tb24vaWJveF90b29sc19mdWxsX3NjcmVlbi5odG1sJyxcbiAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQpIHtcbiAgICAgICAgICAgIC8vIEZ1bmN0aW9uIGZvciBjb2xsYXBzZSBpYm94XG4gICAgICAgICAgICAkc2NvcGUuc2hvd2hpZGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlib3ggPSAkZWxlbWVudC5jbG9zZXN0KCdkaXYuaWJveCcpO1xuICAgICAgICAgICAgICAgIHZhciBpY29uID0gJGVsZW1lbnQuZmluZCgnaTpmaXJzdCcpO1xuICAgICAgICAgICAgICAgIHZhciBjb250ZW50ID0gaWJveC5maW5kKCdkaXYuaWJveC1jb250ZW50Jyk7XG4gICAgICAgICAgICAgICAgY29udGVudC5zbGlkZVRvZ2dsZSgyMDApO1xuICAgICAgICAgICAgICAgIC8vIFRvZ2dsZSBpY29uIGZyb20gdXAgdG8gZG93blxuICAgICAgICAgICAgICAgIGljb24udG9nZ2xlQ2xhc3MoJ2ZhLWNoZXZyb24tdXAnKS50b2dnbGVDbGFzcygnZmEtY2hldnJvbi1kb3duJyk7XG4gICAgICAgICAgICAgICAgaWJveC50b2dnbGVDbGFzcygnJykudG9nZ2xlQ2xhc3MoJ2JvcmRlci1ib3R0b20nKTtcbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlib3gucmVzaXplKCk7XG4gICAgICAgICAgICAgICAgICAgIGlib3guZmluZCgnW2lkXj1tYXAtXScpLnJlc2l6ZSgpO1xuICAgICAgICAgICAgICAgIH0sIDUwKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBGdW5jdGlvbiBmb3IgY2xvc2UgaWJveFxuICAgICAgICAgICAgJHNjb3BlLmNsb3NlYm94ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBpYm94ID0gJGVsZW1lbnQuY2xvc2VzdCgnZGl2Lmlib3gnKTtcbiAgICAgICAgICAgICAgICBpYm94LnJlbW92ZSgpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIEZ1bmN0aW9uIGZvciBmdWxsIHNjcmVlblxuICAgICAgICAgICAgJHNjb3BlLmZ1bGxzY3JlZW4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIGlib3ggPSAkZWxlbWVudC5jbG9zZXN0KCdkaXYuaWJveCcpO1xuICAgICAgICAgICAgICAgIHZhciBidXR0b24gPSAkZWxlbWVudC5maW5kKCdpLmZhLWV4cGFuZCcpO1xuICAgICAgICAgICAgICAgICQoJ2JvZHknKS50b2dnbGVDbGFzcygnZnVsbHNjcmVlbi1pYm94LW1vZGUnKTtcbiAgICAgICAgICAgICAgICBidXR0b24udG9nZ2xlQ2xhc3MoJ2ZhLWV4cGFuZCcpLnRvZ2dsZUNsYXNzKCdmYS1jb21wcmVzcycpO1xuICAgICAgICAgICAgICAgIGlib3gudG9nZ2xlQ2xhc3MoJ2Z1bGxzY3JlZW4nKTtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgICAgICAgICAgICAgIH0sIDEwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG4vKipcbiAqIG1pbmltYWxpemFTaWRlYmFyIC0gRGlyZWN0aXZlIGZvciBtaW5pbWFsaXplIHNpZGViYXJcbiAqL1xuZnVuY3Rpb24gbWluaW1hbGl6YVNpZGViYXIoJHRpbWVvdXQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICB0ZW1wbGF0ZTogJzxhIGNsYXNzPVwibmF2YmFyLW1pbmltYWxpemUgbWluaW1hbGl6ZS1zdHlsLTIgYnRuIGJ0bi1wcmltYXJ5IFwiIGhyZWY9XCJcIiBuZy1jbGljaz1cIm1pbmltYWxpemUoKVwiPjxpIGNsYXNzPVwiZmEgZmEtYmFyc1wiPjwvaT48L2E+JyxcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgIHBhcmVudENvbnRyb2xsZXI6ICc9J1xuICAgICAgICB9LFxuICAgICAgICBjb250cm9sbGVyOiBmdW5jdGlvbiAoJHNjb3BlLCAkZWxlbWVudCkge1xuICAgICAgICAgICAgJHNjb3BlLm1pbmltYWxpemUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJChcImJvZHlcIikudG9nZ2xlQ2xhc3MoXCJtaW5pLW5hdmJhclwiKTtcbiAgICAgICAgICAgICAgICBpZiAoISQoJ2JvZHknKS5oYXNDbGFzcygnbWluaS1uYXZiYXInKSB8fCAkKCdib2R5JykuaGFzQ2xhc3MoJ2JvZHktc21hbGwnKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBIaWRlIG1lbnUgaW4gb3JkZXIgdG8gc21vb3RobHkgdHVybiBvbiB3aGVuIG1heGltaXplIG1lbnVcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NpZGUtbWVudScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gRm9yIHNtb290aGx5IHR1cm4gb24gbWVudVxuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJyNzaWRlLW1lbnUnKS5mYWRlSW4oNDAwKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHdpbmRvdykudHJpZ2dlcigncmVzaXplJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCAyMDApO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyZW50Q29udHJvbGxlci5zaG93VG9vbHRpcCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoJCgnYm9keScpLmhhc0NsYXNzKCdmaXhlZC1zaWRlYmFyJykpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI3NpZGUtbWVudScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcjc2lkZS1tZW51JykuZmFkZUluKDQwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYWxsIGlubGluZSBzdHlsZSBmcm9tIGpxdWVyeSBmYWRlSW4gZnVuY3Rpb24gdG8gcmVzZXQgbWVudSBzdGF0ZVxuICAgICAgICAgICAgICAgICAgICAkKCcjc2lkZS1tZW51JykucmVtb3ZlQXR0cignc3R5bGUnKTtcbiAgICAgICAgICAgICAgICAgICAgJCh3aW5kb3cpLnRyaWdnZXIoJ3Jlc2l6ZScpO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucGFyZW50Q29udHJvbGxlci5zaG93VG9vbHRpcCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbn1cblxuXG4vKipcbiAqIHNob3cvaGlkZSBlbGVtZW50IGJ5IHJvbGVcbiAqL1xuZnVuY3Rpb24gcm9sZUhhbmRsZXIoJHRpbWVvdXQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQsIGF0dHIpIHtcbiAgICAgICAgICAgIGlmIChzY29wZS5jdXJyZW50VXNlclJvbGUuaWQgPiBzY29wZS5yb2xlKSB7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5yZW1vdmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24gKCRzY29wZSwgQXV0aFNlcnZpY2UpIHtcbiAgICAgICAgICAgICRzY29wZS5jdXJyZW50VXNlclJvbGUgPSBBdXRoU2VydmljZS5nZXRSb2xlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICByb2xlOiAnPSdcbiAgICAgICAgfVxuICAgIH07XG59XG5cblxuZnVuY3Rpb24gaWNoZWNrKCR0aW1lb3V0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6ICdBJyxcbiAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoJHNjb3BlLCBlbGVtZW50LCAkYXR0cnMsIG5nTW9kZWwpIHtcbiAgICAgICAgICAgIHJldHVybiAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlO1xuICAgICAgICAgICAgICAgIHZhbHVlID0gJGF0dHJzWyd2YWx1ZSddO1xuXG4gICAgICAgICAgICAgICAgJHNjb3BlLiR3YXRjaCgkYXR0cnNbJ25nTW9kZWwnXSwgZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICQoZWxlbWVudCkuaUNoZWNrKCd1cGRhdGUnKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICRzY29wZS4kd2F0Y2goJGF0dHJzWyduZ0Rpc2FibGVkJ10sIGZ1bmN0aW9uIChuZXdWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAkKGVsZW1lbnQpLmlDaGVjaygndXBkYXRlJyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gJChlbGVtZW50KS5pQ2hlY2soe1xuICAgICAgICAgICAgICAgICAgICBjaGVja2JveENsYXNzOiAnaWNoZWNrYm94X3NxdWFyZS1ncmVlbicsXG4gICAgICAgICAgICAgICAgICAgIHJhZGlvQ2xhc3M6ICdpcmFkaW9fc3F1YXJlLWdyZWVuJ1xuXG4gICAgICAgICAgICAgICAgfSkub24oJ2lmQ2hhbmdlZCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJChlbGVtZW50KS5hdHRyKCd0eXBlJykgPT09ICdjaGVja2JveCcgJiYgJGF0dHJzWyduZ01vZGVsJ10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS4kYXBwbHkoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBuZ01vZGVsLiRzZXRWaWV3VmFsdWUoZXZlbnQudGFyZ2V0LmNoZWNrZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKCQoZWxlbWVudCkuYXR0cigndHlwZScpID09PSAncmFkaW8nICYmICRhdHRyc1snbmdNb2RlbCddKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5nTW9kZWwuJHNldFZpZXdWYWx1ZSh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9O1xufVxuXG5mdW5jdGlvbiB0cmVlTWVudVBvcHVwKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICB0cmVlTWVudVBvcHVwOiAnPXRyZWVNZW51UG9wdXAnXG4gICAgICAgIH0sXG4gICAgICAgIHRlbXBsYXRlOiAnPGxpIG5nLXJlcGVhdD1cIml0ZW0gaW4gdHJlZU1lbnVQb3B1cCB0cmFjayBieSAkaW5kZXhcIiBzdHlsZT1cInBhZGRpbmctYm90dG9tOiAxMHB4XCI+PHRyZWUtbWVudS1pdGVtLXBvcHVwPjwvdHJlZS1tZW51LWl0ZW0tcG9wdXA+PC9saT4nLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW0pIHtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gdHJlZU1lbnVJdGVtUG9wdXAoJHJvb3RTY29wZSwgJGNvbXBpbGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgc3R5bGU9XCJjdXJzb3I6IHBvaW50ZXI7cGFkZGluZy10b3A6NXB4XCIgbmctc3R5bGU9XCJpdGVtLnNlbGVjdGVkICYmIHtcXCdiYWNrZ3JvdW5kLWNvbG9yXFwnOlxcJ3JnYmEoMjA4LCAyMzUsIDI1NSwgMC43KVxcJ31cIj4nICtcbiAgICAgICAgICAgICc8aSBuZy1jbGljaz1cImNvbGxhcHNlKGl0ZW0pXCIgY2xhc3M9XCJmYSBmYS1jYXJldC1yaWdodFwiIG5nLWlmPVwiaXRlbS5jaGlsZHJlblwiPjwvaT4nICtcbiAgICAgICAgICAgICc8aSBuZy1pZj1cIml0ZW0uaXNSb290ICYmIGl0ZW0ubHVTdGF0dXMgPT0gXFwnZmFpbGVkXFwnXCIgc3R5bGU9XCJ0ZXh0LWFsaWduOiBjZW50ZXI7Y29sb3I6IHdoaXRlO2JhY2tncm91bmQ6IHJlZDtwYWRkaW5nOiA1cHg7d2lkdGg6IDIycHg7Ym9yZGVyLXJhZGl1czogNTBweDtcIiBjbGFzcz1cImZhIGZhLWV4Y2xhbWF0aW9uXCI+PC9pPicgK1xuICAgICAgICAgICAgJzxzcGFuIG5nLWNsaWNrPVwidXBkYXRlVGFibGUoaXRlbSwgdHJlZU1lbnUpXCIgbmctc3R5bGU9XCJnZXRDc3MoaXRlbSlcIm5nLWJpbmQ9XCJpdGVtLmx1TmFtZVwiPjwvc3Bhbj48L2Rpdj4nLFxuICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsZW1lbnQpIHtcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoc2NvcGUuaXRlbS5jaGlsZHJlbikpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LmFwcGVuZCgkY29tcGlsZSgnPHVsIHN0eWxlPVwibGlzdC1zdHlsZTogbm9uZTtcIiBuZy1pZj1cImNvbGxhcHNlZFwiIHRyZWUtbWVudS1wb3B1cD1cIml0ZW0uY2hpbGRyZW5cIj48L3VsPicpKHNjb3BlKSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNjb3BlLmdldENzcyA9IGl0ZW0gPT4ge1xuICAgICAgICAgICAgICAgIGxldCByZXMgPSB7fTtcblxuICAgICAgICAgICAgICAgIGlmIChpdGVtLmx1U3RhdHVzID09ICdmYWlsZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcy5jb2xvciA9ICdyZWQnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJlc1snbWFyZ2luLWxlZnQnXSA9IGl0ZW0uaGFzQ2hpbGRyZW4gPyAnMTBweCcgOiAnMTVweCc7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc2NvcGUuY29sbGFwc2UgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIHNjb3BlLmNvbGxhcHNlZCA9ICFzY29wZS5jb2xsYXBzZWQ7XG4gICAgICAgICAgICAgICAgLy8gJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzaG93Um9vdExVQ2hpbGRyZW4nLCB7aXRlbTogaXRlbX0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNjb3BlLnVwZGF0ZVRhYmxlID0gZnVuY3Rpb24gKGl0ZW0sIHRyZWVNZW51KSB7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd1cGRhdGVQb3BVcFRhYmxlJywge2l0ZW06IGl0ZW19KTtcbiAgICAgICAgICAgICAgICBpdGVtLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG59XG5cblxuZnVuY3Rpb24gdHJlZU1lbnUoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgIHRyZWVNZW51OiAnPXRyZWVNZW51J1xuICAgICAgICB9LFxuICAgICAgICB0ZW1wbGF0ZTogJzxsaSBuZy1yZXBlYXQ9XCJpdGVtIGluIHRyZWVNZW51IHRyYWNrIGJ5ICRpbmRleFwiIHN0eWxlPVwicGFkZGluZy1ib3R0b206IDEwcHhcIj48dHJlZS1tZW51LWl0ZW0+PC90cmVlLW1lbnUtaXRlbT48L2xpPicsXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbSkge1xuICAgICAgICB9XG4gICAgfVxufVxuXG50cmVlTWVudUl0ZW0oKS4kaW5qZWN0ID0gWyckY29tcGlsZSddO1xuXG5mdW5jdGlvbiB0cmVlTWVudUl0ZW0oJHJvb3RTY29wZSwgJGNvbXBpbGUpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0ZW1wbGF0ZTogJzxkaXYgc3R5bGU9XCJjdXJzb3I6IHBvaW50ZXI7cGFkZGluZy10b3A6NXB4XCIgbmctc3R5bGU9XCJpdGVtLnNlbGVjdGVkICYmIHtcXCdiYWNrZ3JvdW5kLWNvbG9yXFwnOlxcJ3JnYmEoMjA4LCAyMzUsIDI1NSwgMC43KVxcJ31cIj48aSBuZy1jbGljaz1cImNvbGxhcHNlKGl0ZW0pXCIgY2xhc3M9XCJmYSBmYS1jYXJldC1yaWdodFwiIG5nLWlmPVwiaXRlbS5oYXNDaGlsZHJlblwiPjwvaT48c3BhbiBuZy1jbGljaz1cInVwZGF0ZVRhYmxlKGl0ZW0sIHRyZWVNZW51KVwiIG5nLXN0eWxlPVwiZ2V0Q3NzKGl0ZW0pXCJuZy1iaW5kPVwiaXRlbS5sdV9uYW1lXCI+PC9zcGFuPjwvZGl2PicsXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCkge1xuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheShzY29wZS5pdGVtLmNoaWxkcmVuKSkge1xuICAgICAgICAgICAgICAgIGVsZW1lbnQuYXBwZW5kKCRjb21waWxlKCc8dWwgc3R5bGU9XCJsaXN0LXN0eWxlOiBub25lO1wiIG5nLWlmPVwiY29sbGFwc2VkXCIgdHJlZS1tZW51PVwiaXRlbS5jaGlsZHJlblwiPjwvdWw+Jykoc2NvcGUpKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2NvcGUuZ2V0Q3NzID0gaXRlbSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHJlcyA9IHt9O1xuXG4gICAgICAgICAgICAgICAgaWYgKGl0ZW0ubHVfc3RhdHVzID09ICdmYWlsZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlcy5jb2xvciA9ICdyZWQnO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJlc1snbWFyZ2luLWxlZnQnXSA9IGl0ZW0uaGFzQ2hpbGRyZW4gPyAnMTBweCcgOiAnMTVweCc7XG5cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzO1xuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc2NvcGUuY29sbGFwc2UgPSBmdW5jdGlvbiAoaXRlbSkge1xuICAgICAgICAgICAgICAgIHNjb3BlLmNvbGxhcHNlZCA9ICFzY29wZS5jb2xsYXBzZWQ7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdzaG93Um9vdExVQ2hpbGRyZW4nLCB7aXRlbTogaXRlbX0pO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHNjb3BlLnVwZGF0ZVRhYmxlID0gZnVuY3Rpb24gKGl0ZW0sIHRyZWVNZW51KSB7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCd1cGRhdGVURE1TdGF0cycsIHtpdGVtOiBpdGVtfSk7XG4gICAgICAgICAgICAgICAgaXRlbS5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqXG4gKiBQYXNzIGFsbCBmdW5jdGlvbnMgaW50byBtb2R1bGVcbiAqL1xuYW5ndWxhclxuICAgIC5tb2R1bGUoJ1RETS1GRScpXG4gICAgLmRpcmVjdGl2ZSgncGFnZVRpdGxlJywgcGFnZVRpdGxlKVxuICAgIC5kaXJlY3RpdmUoJ3NpZGVOYXZpZ2F0aW9uJywgc2lkZU5hdmlnYXRpb24pXG4gICAgLmRpcmVjdGl2ZSgnaWJveFRvb2xzJywgaWJveFRvb2xzKVxuICAgIC5kaXJlY3RpdmUoJ21pbmltYWxpemFTaWRlYmFyJywgbWluaW1hbGl6YVNpZGViYXIpXG4gICAgLmRpcmVjdGl2ZSgnaWJveFRvb2xzRnVsbFNjcmVlbicsIGlib3hUb29sc0Z1bGxTY3JlZW4pXG4gICAgLmRpcmVjdGl2ZSgncm9sZUhhbmRsZXInLCByb2xlSGFuZGxlcilcbiAgICAuZGlyZWN0aXZlKCdpY2hlY2snLCBpY2hlY2spXG4gICAgLmRpcmVjdGl2ZSgndHJlZU1lbnUnLCB0cmVlTWVudSlcbiAgICAuZGlyZWN0aXZlKCd0cmVlTWVudVBvcHVwJywgdHJlZU1lbnVQb3B1cClcbiAgICAuZGlyZWN0aXZlKCd0cmVlTWVudUl0ZW0nLCB0cmVlTWVudUl0ZW0pXG4gICAgLmRpcmVjdGl2ZSgndHJlZU1lbnVJdGVtUG9wdXAnLCB0cmVlTWVudUl0ZW1Qb3B1cClcbiAgICAuZGlyZWN0aXZlKCdhdXRvRm9jdXMnLCBbJyR0aW1lb3V0JywgZnVuY3Rpb24gKCR0aW1lb3V0KSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXN0cmljdDogJ0EnLFxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKCRzY29wZSwgJGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICRlbGVtZW50WzBdLmZvY3VzKCk7XG4gICAgICAgICAgICAgICAgfSwgMjAwMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XSlcbiAgICAuZmlsdGVyKCdjdXN0b21PcHRpb25zRmlsdGVyJywgZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGxvZ2ljYWxVbml0cywgYmUpIHtcbiAgICAgICAgICAgIGlmICghbG9naWNhbFVuaXRzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFiZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBsb2dpY2FsVW5pdHM7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gXy5maWx0ZXIobG9naWNhbFVuaXRzLCBmdW5jdGlvbiAobHUpIHtcbiAgICAgICAgICAgICAgICBpZiAoYmUuYmVfaWQgPT0gbHUuYmVfaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9KTtcblxuIl19
