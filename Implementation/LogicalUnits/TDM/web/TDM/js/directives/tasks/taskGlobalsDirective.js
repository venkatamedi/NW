function taskGlobals(){return{restrict:"E",templateUrl:"views/tasks/taskGlobals.html",scope:{data:"=",logicalUnits:"="},controller:function($scope,TDMService,$timeout,DTOptionsBuilder,DTColumnBuilder,$q,$uibModal,$compile){var taskGlobals=this;taskGlobals.dtInstance={},taskGlobals.dtColumns=[],taskGlobals.dtColumnDefs=[],taskGlobals.globals=$scope.data,$scope.$watch("data",()=>{taskGlobals.globals=$scope.data,taskGlobals.dtInstance&&taskGlobals.dtInstance.reloadData&&taskGlobals.dtInstance.reloadData((function(){}))},!0,!0),taskGlobals.headers=[{column:"actions",name:""},{column:"global_name",name:"Variable Name"},{column:"global_value",name:"Variable Value"},{column:"global_value",name:"Logical Unit"}];for(var renderSelectionColumn=function(data,type,full,meta){return'<div style="display: flex;justify-content: space-around;max-width: 100px;"><div><img src="icons/edit.svg"  alt="edit" uib-tooltip="Edit Global" tooltip-placement="top"ng-click="taskGlobals.editGlobal(taskGlobals.globals['+meta.row+'])"></div><div><img  src="icons/delete-icon.svg" alt="edit" uib-tooltip="Delete Global" tooltip-placement="top" ng-click="taskGlobals.removeGlobal(\''+full.global_name+"')\"></div></div>"},i=0;i<taskGlobals.headers.length;i++)"actions"==taskGlobals.headers[i].column?taskGlobals.dtColumns.push(DTColumnBuilder.newColumn(taskGlobals.headers[i].column).withTitle(taskGlobals.headers[i].name).renderWith(renderSelectionColumn).withOption("width","200")):taskGlobals.dtColumns.push(DTColumnBuilder.newColumn(taskGlobals.headers[i].column).withTitle(taskGlobals.headers[i].name));taskGlobals.dtOptions=DTOptionsBuilder.fromFnPromise((function(){return(deferred=$q.defer()).resolve(taskGlobals.globals),console.log(taskGlobals.globals),deferred.promise;var deferred})).withDOM('<"html5buttons"B>lTfgitp').withOption("createdRow",(function(row){$compile(angular.element(row).contents())($scope)})).withOption("scrollX",!1).withOption("lengthChange",!1).withOption("paging",!1).withButtons([]).withOption("caseInsensitive",!0).withOption("search",{caseInsensitive:!1}),taskGlobals.dtOptions.withLightColumnFilter({1:{type:"text"},2:{type:"text"}}),taskGlobals.removeGlobal=function(globalName){var index=_.findIndex(taskGlobals.globals,{global_name:globalName});index>=0&&(taskGlobals.globals.splice(index,1),$timeout((function(){taskGlobals.dtInstance&&taskGlobals.dtInstance.reloadData&&taskGlobals.dtInstance.reloadData((function(){}))}),100))},taskGlobals.editGlobal=function(globalName){taskGlobals.addGlobals(!0,globalName)},taskGlobals.addGlobals=function(edit,global){$uibModal.open({template:"views/tasks/addGlobal.html",windowTopClass:"taskGlobals",resolve:{globals:function(){return taskGlobals.globals},logicalUnits:function(){return $scope.logicalUnits}},controller:function($scope,$uibModalInstance,TDMService,globals,logicalUnits){var addGlobalCtrl=this;addGlobalCtrl.edit=edit,addGlobalCtrl.data={},edit?(addGlobalCtrl.data=global,addGlobalCtrl.globals=[{globalName:global.global_name}]):TDMService.getAllGlobals({lus:_.map(logicalUnits,"lu_name")}).then((function(response){addGlobalCtrl.globals=_.filter(response.result,(function(global){return _.findIndex(globals,{global_name:global})<0}))})),addGlobalCtrl.addNewGlobal=function(){$uibModalInstance.close(addGlobalCtrl.data)},addGlobalCtrl.close=function(){$uibModalInstance.close()}},controllerAs:"addGlobalCtrl"}).result.then((function(global){if(global&&global.global_name&&global.global_value){var origGlobal=_.find(taskGlobals.globals,{global_name:global.global_name});origGlobal?origGlobal.global_value=global.global_value:taskGlobals.globals.push(global),$timeout((function(){taskGlobals.dtInstance&&taskGlobals.dtInstance.reloadData&&taskGlobals.dtInstance.reloadData((function(){}))}),100)}}))}},controllerAs:"taskGlobals"}}angular.module("TDM-FE").directive("taskGlobals",taskGlobals);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpcmVjdGl2ZXMvdGFza3MvdGFza0dsb2JhbHNEaXJlY3RpdmUuanMiXSwibmFtZXMiOlsidGFza0dsb2JhbHMiLCJyZXN0cmljdCIsInRlbXBsYXRlVXJsIiwic2NvcGUiLCJkYXRhIiwibG9naWNhbFVuaXRzIiwiY29udHJvbGxlciIsIiRzY29wZSIsIlRETVNlcnZpY2UiLCIkdGltZW91dCIsIkRUT3B0aW9uc0J1aWxkZXIiLCJEVENvbHVtbkJ1aWxkZXIiLCIkcSIsIiR1aWJNb2RhbCIsIiRjb21waWxlIiwidGhpcyIsImR0SW5zdGFuY2UiLCJkdENvbHVtbnMiLCJkdENvbHVtbkRlZnMiLCJnbG9iYWxzIiwiJHdhdGNoIiwicmVsb2FkRGF0YSIsImhlYWRlcnMiLCJjb2x1bW4iLCJuYW1lIiwicmVuZGVyU2VsZWN0aW9uQ29sdW1uIiwidHlwZSIsImZ1bGwiLCJtZXRhIiwicm93IiwiZ2xvYmFsX25hbWUiLCJpIiwibGVuZ3RoIiwicHVzaCIsIm5ld0NvbHVtbiIsIndpdGhUaXRsZSIsInJlbmRlcldpdGgiLCJ3aXRoT3B0aW9uIiwiZHRPcHRpb25zIiwiZnJvbUZuUHJvbWlzZSIsImRlZmVycmVkIiwiZGVmZXIiLCJyZXNvbHZlIiwiY29uc29sZSIsImxvZyIsInByb21pc2UiLCJ3aXRoRE9NIiwiYW5ndWxhciIsImVsZW1lbnQiLCJjb250ZW50cyIsIndpdGhCdXR0b25zIiwiY2FzZUluc2Vuc2l0aXZlIiwid2l0aExpZ2h0Q29sdW1uRmlsdGVyIiwiMSIsIjIiLCJyZW1vdmVHbG9iYWwiLCJnbG9iYWxOYW1lIiwiaW5kZXgiLCJfIiwiZmluZEluZGV4Iiwic3BsaWNlIiwiZWRpdEdsb2JhbCIsImFkZEdsb2JhbHMiLCJlZGl0IiwiZ2xvYmFsIiwib3BlbiIsInRlbXBsYXRlIiwid2luZG93VG9wQ2xhc3MiLCIkdWliTW9kYWxJbnN0YW5jZSIsImFkZEdsb2JhbEN0cmwiLCJnZXRBbGxHbG9iYWxzIiwibHVzIiwibWFwIiwidGhlbiIsInJlc3BvbnNlIiwiZmlsdGVyIiwicmVzdWx0IiwiYWRkTmV3R2xvYmFsIiwiY2xvc2UiLCJjb250cm9sbGVyQXMiLCJnbG9iYWxfdmFsdWUiLCJvcmlnR2xvYmFsIiwiZmluZCIsIm1vZHVsZSIsImRpcmVjdGl2ZSJdLCJtYXBwaW5ncyI6IkFBQUEsU0FBU0EsY0ErS0wsTUFBTyxDQUNIQyxTQUFVLElBQ1ZDLFlBL0tXLCtCQWdMWEMsTUFBTyxDQUNIQyxLQUFNLElBQ05DLGFBQWMsS0FFbEJDLFdBbExhLFNBQVVDLE9BQVFDLFdBQVlDLFNBQVNDLGlCQUFtQkMsZ0JBQWlCQyxHQUFJQyxVQUFXQyxVQUN2RyxJQUFJZCxZQUFjZSxLQUNsQmYsWUFBWWdCLFdBQWEsR0FDekJoQixZQUFZaUIsVUFBWSxHQUN4QmpCLFlBQVlrQixhQUFlLEdBQzNCbEIsWUFBWW1CLFFBQVVaLE9BQU9ILEtBQzdCRyxPQUFPYSxPQUFPLE9BQVEsS0FDbEJwQixZQUFZbUIsUUFBVVosT0FBT0gsS0FDekJKLFlBQVlnQixZQUFjaEIsWUFBWWdCLFdBQVdLLFlBQ2pEckIsWUFBWWdCLFdBQVdLLFlBQVcsaUJBSXZDLEdBQU0sR0FDVHJCLFlBQVlzQixRQUFVLENBQ2xCLENBQ0lDLE9BQVMsVUFDVEMsS0FBTyxJQUVYLENBQ0lELE9BQVMsY0FDVEMsS0FBTyxpQkFFWCxDQUNJRCxPQUFTLGVBQ1RDLEtBQU8sa0JBRVgsQ0FDSUQsT0FBUyxlQUNUQyxLQUFPLGlCQWlCZixJQWJBLElBQUlDLHNCQUF3QixTQUFTckIsS0FBTXNCLEtBQU1DLEtBQU1DLE1BQ25ELE1BQU8sK05BR21EQSxLQUFLQyxJQUh4RCx3SkFNbUNGLEtBQUtHLFlBTnhDLHFCQVlGQyxFQUFJLEVBQUdBLEVBQUsvQixZQUFZc0IsUUFBUVUsT0FBU0QsSUFDVCxXQUFqQy9CLFlBQVlzQixRQUFRUyxHQUFHUixPQUN2QnZCLFlBQVlpQixVQUFVZ0IsS0FBS3RCLGdCQUFnQnVCLFVBQVVsQyxZQUFZc0IsUUFBUVMsR0FBR1IsUUFBUVksVUFBVW5DLFlBQVlzQixRQUFRUyxHQUFHUCxNQUFNWSxXQUFXWCx1QkFBdUJZLFdBQVcsUUFBUyxRQUdqTHJDLFlBQVlpQixVQUFVZ0IsS0FBS3RCLGdCQUFnQnVCLFVBQVVsQyxZQUFZc0IsUUFBUVMsR0FBR1IsUUFBUVksVUFBVW5DLFlBQVlzQixRQUFRUyxHQUFHUCxPQVc3SHhCLFlBQVlzQyxVQUFZNUIsaUJBQWlCNkIsZUFBYyxXQUMvQyxPQVBBQyxTQUFXNUIsR0FBRzZCLFNBQ1RDLFFBQVExQyxZQUFZbUIsU0FDN0J3QixRQUFRQyxJQUFJNUMsWUFBWW1CLFNBQ2pCcUIsU0FBU0ssUUFKRCxJQUNYTCxZQVNITSxRQUFRLDRCQUNSVCxXQUFXLGNBQWMsU0FBVVIsS0FFaENmLFNBQVNpQyxRQUFRQyxRQUFRbkIsS0FBS29CLFdBQTlCbkMsQ0FBMENQLFdBRTdDOEIsV0FBVyxXQUFXLEdBQ3RCQSxXQUFXLGdCQUFnQixHQUMzQkEsV0FBVyxVQUFVLEdBQ3JCYSxZQUFZLElBQ1piLFdBQVcsbUJBQW1CLEdBQzlCQSxXQUFXLFNBQVMsQ0FDakJjLGlCQUFtQixJQUd2Qm5ELFlBQVlzQyxVQUFVYyxzQkFBc0IsQ0FDeENDLEVBQUcsQ0FDQzNCLEtBQU0sUUFFVjRCLEVBQUcsQ0FDQzVCLEtBQU0sVUFJZDFCLFlBQVl1RCxhQUFlLFNBQVNDLFlBQ2hDLElBQUlDLE1BQVFDLEVBQUVDLFVBQVUzRCxZQUFZbUIsUUFBUSxDQUFDVyxZQUFjMEIsYUFDdkRDLE9BQVMsSUFDVHpELFlBQVltQixRQUFReUMsT0FBT0gsTUFBTSxHQUNqQ2hELFVBQVMsV0FDRFQsWUFBWWdCLFlBQWNoQixZQUFZZ0IsV0FBV0ssWUFDakRyQixZQUFZZ0IsV0FBV0ssWUFBVyxpQkFJeEMsT0FJVnJCLFlBQVk2RCxXQUFhLFNBQVNMLFlBQzlCeEQsWUFBWThELFlBQVcsRUFBS04sYUFHaEN4RCxZQUFZOEQsV0FBYSxTQUFTQyxLQUFLQyxRQUNuQ25ELFVBQVVvRCxLQUFLLENBRVhDLFNBQVUsNkJBQ1ZDLGVBQWlCLGNBQ2pCekIsUUFBUyxDQUNMdkIsUUFBUyxXQUNMLE9BQU9uQixZQUFZbUIsU0FFdkJkLGFBQWMsV0FDVixPQUFPRSxPQUFPRixlQUd0QkMsV0FBWSxTQUFVQyxPQUFRNkQsa0JBQW1CNUQsV0FBWVcsUUFBU2QsY0FDbEUsSUFBSWdFLGNBQWdCdEQsS0FDcEJzRCxjQUFjTixLQUFPQSxLQUNyQk0sY0FBY2pFLEtBQU8sR0FHaEIyRCxNQVVETSxjQUFjakUsS0FBTzRELE9BQ3JCSyxjQUFjbEQsUUFBVSxDQUFDLENBQ3JCcUMsV0FBYVEsT0FBT2xDLGVBWHhCdEIsV0FBVzhELGNBQWMsQ0FDckJDLElBQUtiLEVBQUVjLElBQUluRSxhQUFhLGFBQ3pCb0UsTUFBSyxTQUFTQyxVQUNiTCxjQUFjbEQsUUFBVXVDLEVBQUVpQixPQUFPRCxTQUFTRSxRQUFRLFNBQVNaLFFBQ3ZELE9BQU9OLEVBQUVDLFVBQVV4QyxRQUFRLENBQUNXLFlBQWNrQyxTQUFXLFFBV2pFSyxjQUFjUSxhQUFlLFdBQ3pCVCxrQkFBa0JVLE1BQU1ULGNBQWNqRSxPQUcxQ2lFLGNBQWNTLE1BQVEsV0FDbEJWLGtCQUFrQlUsVUFHMUJDLGFBQWMsa0JBQ2ZILE9BQU9ILE1BQUssU0FBVVQsUUFDckIsR0FBSUEsUUFBVUEsT0FBT2xDLGFBQWVrQyxPQUFPZ0IsYUFBYSxDQUNwRCxJQUFJQyxXQUFhdkIsRUFBRXdCLEtBQUtsRixZQUFZbUIsUUFBUSxDQUFDVyxZQUFja0MsT0FBT2xDLGNBQzlEbUQsV0FDQUEsV0FBV0QsYUFBZWhCLE9BQU9nQixhQUdqQ2hGLFlBQVltQixRQUFRYyxLQUFLK0IsUUFFN0J2RCxVQUFTLFdBQ0RULFlBQVlnQixZQUFjaEIsWUFBWWdCLFdBQVdLLFlBQ2pEckIsWUFBWWdCLFdBQVdLLFlBQVcsaUJBSXhDLFdBY2xCMEQsYUFBYyxlQUt0QmhDLFFBQ0tvQyxPQUFPLFVBQ1BDLFVBQVUsY0FBZXBGIiwiZmlsZSI6ImRpcmVjdGl2ZXMvdGFza3MvdGFza0dsb2JhbHNEaXJlY3RpdmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiB0YXNrR2xvYmFscygpIHtcblxuICAgIHZhciB0ZW1wbGF0ZSA9IFwidmlld3MvdGFza3MvdGFza0dsb2JhbHMuaHRtbFwiO1xuXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCBURE1TZXJ2aWNlLCAkdGltZW91dCxEVE9wdGlvbnNCdWlsZGVyICwgRFRDb2x1bW5CdWlsZGVyLCAkcSwgJHVpYk1vZGFsLCAkY29tcGlsZSkge1xuICAgICAgICB2YXIgdGFza0dsb2JhbHMgPSB0aGlzO1xuICAgICAgICB0YXNrR2xvYmFscy5kdEluc3RhbmNlID0ge307XG4gICAgICAgIHRhc2tHbG9iYWxzLmR0Q29sdW1ucyA9IFtdO1xuICAgICAgICB0YXNrR2xvYmFscy5kdENvbHVtbkRlZnMgPSBbXTtcbiAgICAgICAgdGFza0dsb2JhbHMuZ2xvYmFscyA9ICRzY29wZS5kYXRhO1xuICAgICAgICAkc2NvcGUuJHdhdGNoKCdkYXRhJywgKCkgPT4ge1xuICAgICAgICAgICAgdGFza0dsb2JhbHMuZ2xvYmFscyA9ICRzY29wZS5kYXRhO1xuICAgICAgICAgICAgaWYgKHRhc2tHbG9iYWxzLmR0SW5zdGFuY2UgJiYgdGFza0dsb2JhbHMuZHRJbnN0YW5jZS5yZWxvYWREYXRhKXtcbiAgICAgICAgICAgICAgICB0YXNrR2xvYmFscy5kdEluc3RhbmNlLnJlbG9hZERhdGEoZnVuY3Rpb24oKXtcblxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCB0cnVlLCB0cnVlKTtcbiAgICAgICAgdGFza0dsb2JhbHMuaGVhZGVycyA9IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb2x1bW4gOiAnYWN0aW9ucycsXG4gICAgICAgICAgICAgICAgbmFtZSA6ICcnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvbHVtbiA6ICdnbG9iYWxfbmFtZScsXG4gICAgICAgICAgICAgICAgbmFtZSA6ICdWYXJpYWJsZSBOYW1lJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb2x1bW4gOiAnZ2xvYmFsX3ZhbHVlJyxcbiAgICAgICAgICAgICAgICBuYW1lIDogJ1ZhcmlhYmxlIFZhbHVlJ1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb2x1bW4gOiAnZ2xvYmFsX3ZhbHVlJyxcbiAgICAgICAgICAgICAgICBuYW1lIDogJ0xvZ2ljYWwgVW5pdCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF07XG5cbiAgICAgICAgdmFyIHJlbmRlclNlbGVjdGlvbkNvbHVtbiA9IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIGZ1bGwsIG1ldGEpe1xuICAgICAgICAgICAgcmV0dXJuICc8ZGl2IHN0eWxlPVwiZGlzcGxheTogZmxleDtqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWFyb3VuZDttYXgtd2lkdGg6IDEwMHB4O1wiPicrXG4gICAgICAgICAgICAnPGRpdj4nICsgXG4gICAgICAgICAgICAnPGltZyBzcmM9XCJpY29ucy9lZGl0LnN2Z1wiICBhbHQ9XCJlZGl0XCIgdWliLXRvb2x0aXA9XCJFZGl0IEdsb2JhbFwiIHRvb2x0aXAtcGxhY2VtZW50PVwidG9wXCInICsgXG4gICAgICAgICAgICAnbmctY2xpY2s9XCJ0YXNrR2xvYmFscy5lZGl0R2xvYmFsKHRhc2tHbG9iYWxzLmdsb2JhbHNbJyArIG1ldGEucm93ICsgJ10pXCI+JyArXG4gICAgICAgICAgICAnPC9kaXY+JyArIFxuICAgICAgICAgICAgJzxkaXY+PGltZyAgc3JjPVwiaWNvbnMvZGVsZXRlLWljb24uc3ZnXCIgYWx0PVwiZWRpdFwiIHVpYi10b29sdGlwPVwiRGVsZXRlIEdsb2JhbFwiIHRvb2x0aXAtcGxhY2VtZW50PVwidG9wXCIgJyArIFxuICAgICAgICAgICAgJ25nLWNsaWNrPVwidGFza0dsb2JhbHMucmVtb3ZlR2xvYmFsKFxcJycgKyBmdWxsLmdsb2JhbF9uYW1lICsnXFwnKVwiPicgK1xuICAgICAgICAgICAgJzwvZGl2PidcbiAgICAgICAgICAgICsgJzwvZGl2Pic7IFxuICAgICAgICAgICAgXG4gICAgICAgIH07XG5cbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAgdGFza0dsb2JhbHMuaGVhZGVycy5sZW5ndGggOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0YXNrR2xvYmFscy5oZWFkZXJzW2ldLmNvbHVtbiA9PSAnYWN0aW9ucycpe1xuICAgICAgICAgICAgICAgIHRhc2tHbG9iYWxzLmR0Q29sdW1ucy5wdXNoKERUQ29sdW1uQnVpbGRlci5uZXdDb2x1bW4odGFza0dsb2JhbHMuaGVhZGVyc1tpXS5jb2x1bW4pLndpdGhUaXRsZSh0YXNrR2xvYmFscy5oZWFkZXJzW2ldLm5hbWUpLnJlbmRlcldpdGgocmVuZGVyU2VsZWN0aW9uQ29sdW1uKS53aXRoT3B0aW9uKCd3aWR0aCcsICcyMDAnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNle1xuICAgICAgICAgICAgICAgIHRhc2tHbG9iYWxzLmR0Q29sdW1ucy5wdXNoKERUQ29sdW1uQnVpbGRlci5uZXdDb2x1bW4odGFza0dsb2JhbHMuaGVhZGVyc1tpXS5jb2x1bW4pLndpdGhUaXRsZSh0YXNrR2xvYmFscy5oZWFkZXJzW2ldLm5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBnZXRUYWJsZURhdGEgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh0YXNrR2xvYmFscy5nbG9iYWxzKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRhc2tHbG9iYWxzLmdsb2JhbHMpO1xuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGFza0dsb2JhbHMuZHRPcHRpb25zID0gRFRPcHRpb25zQnVpbGRlci5mcm9tRm5Qcm9taXNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VGFibGVEYXRhKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndpdGhET00oJzxcImh0bWw1YnV0dG9uc1wiQj5sVGZnaXRwJylcbiAgICAgICAgICAgIC53aXRoT3B0aW9uKCdjcmVhdGVkUm93JywgZnVuY3Rpb24gKHJvdykge1xuICAgICAgICAgICAgICAgIC8vIFJlY29tcGlsaW5nIHNvIHdlIGNhbiBiaW5kIEFuZ3VsYXIgZGlyZWN0aXZlIHRvIHRoZSBEVFxuICAgICAgICAgICAgICAgICRjb21waWxlKGFuZ3VsYXIuZWxlbWVudChyb3cpLmNvbnRlbnRzKCkpKCRzY29wZSk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLndpdGhPcHRpb24oJ3Njcm9sbFgnLCBmYWxzZSlcbiAgICAgICAgICAgIC53aXRoT3B0aW9uKCdsZW5ndGhDaGFuZ2UnLCBmYWxzZSlcbiAgICAgICAgICAgIC53aXRoT3B0aW9uKCdwYWdpbmcnLCBmYWxzZSlcbiAgICAgICAgICAgIC53aXRoQnV0dG9ucyhbXSlcbiAgICAgICAgICAgIC53aXRoT3B0aW9uKFwiY2FzZUluc2Vuc2l0aXZlXCIsIHRydWUpXG4gICAgICAgICAgICAud2l0aE9wdGlvbignc2VhcmNoJyx7XG4gICAgICAgICAgICAgICAgXCJjYXNlSW5zZW5zaXRpdmVcIjogZmFsc2VcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0YXNrR2xvYmFscy5kdE9wdGlvbnMud2l0aExpZ2h0Q29sdW1uRmlsdGVyKHtcbiAgICAgICAgICAgICAgICAxOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0J1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgMjoge1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAndGV4dCdcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgdGFza0dsb2JhbHMucmVtb3ZlR2xvYmFsID0gZnVuY3Rpb24oZ2xvYmFsTmFtZSl7XG4gICAgICAgICAgICAgICAgdmFyIGluZGV4ID0gXy5maW5kSW5kZXgodGFza0dsb2JhbHMuZ2xvYmFscyx7Z2xvYmFsX25hbWUgOiBnbG9iYWxOYW1lfSk7XG4gICAgICAgICAgICAgICAgaWYgKGluZGV4ID49IDApe1xuICAgICAgICAgICAgICAgICAgICB0YXNrR2xvYmFscy5nbG9iYWxzLnNwbGljZShpbmRleCwxKTtcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXNrR2xvYmFscy5kdEluc3RhbmNlICYmIHRhc2tHbG9iYWxzLmR0SW5zdGFuY2UucmVsb2FkRGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza0dsb2JhbHMuZHRJbnN0YW5jZS5yZWxvYWREYXRhKGZ1bmN0aW9uKCl7XG4gICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0sMTAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICB0YXNrR2xvYmFscy5lZGl0R2xvYmFsID0gZnVuY3Rpb24oZ2xvYmFsTmFtZSl7XG4gICAgICAgICAgICAgICAgdGFza0dsb2JhbHMuYWRkR2xvYmFscyh0cnVlLGdsb2JhbE5hbWUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0YXNrR2xvYmFscy5hZGRHbG9iYWxzID0gZnVuY3Rpb24oZWRpdCxnbG9iYWwpe1xuICAgICAgICAgICAgICAgICR1aWJNb2RhbC5vcGVuKHtcblxuICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogJ3ZpZXdzL3Rhc2tzL2FkZEdsb2JhbC5odG1sJyxcbiAgICAgICAgICAgICAgICAgICAgd2luZG93VG9wQ2xhc3MgOiBcInRhc2tHbG9iYWxzXCIsXG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFza0dsb2JhbHMuZ2xvYmFscztcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBsb2dpY2FsVW5pdHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gJHNjb3BlLmxvZ2ljYWxVbml0cztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24gKCRzY29wZSwgJHVpYk1vZGFsSW5zdGFuY2UsIFRETVNlcnZpY2UsIGdsb2JhbHMsIGxvZ2ljYWxVbml0cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGFkZEdsb2JhbEN0cmwgPSB0aGlzO1xuICAgICAgICAgICAgICAgICAgICAgICAgYWRkR2xvYmFsQ3RybC5lZGl0ID0gZWRpdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEdsb2JhbEN0cmwuZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVkaXQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBURE1TZXJ2aWNlLmdldEFsbEdsb2JhbHMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsdXM6IF8ubWFwKGxvZ2ljYWxVbml0cywnbHVfbmFtZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZEdsb2JhbEN0cmwuZ2xvYmFscyA9IF8uZmlsdGVyKHJlc3BvbnNlLnJlc3VsdCwgZnVuY3Rpb24oZ2xvYmFsKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfLmZpbmRJbmRleChnbG9iYWxzLHtnbG9iYWxfbmFtZSA6IGdsb2JhbH0pIDwgMDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRHbG9iYWxDdHJsLmRhdGEgPSBnbG9iYWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWRkR2xvYmFsQ3RybC5nbG9iYWxzID0gW3tcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2xvYmFsTmFtZSA6IGdsb2JhbC5nbG9iYWxfbmFtZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1dO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBhZGRHbG9iYWxDdHJsLmFkZE5ld0dsb2JhbCA9IGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoYWRkR2xvYmFsQ3RybC5kYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGFkZEdsb2JhbEN0cmwuY2xvc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsSW5zdGFuY2UuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ2FkZEdsb2JhbEN0cmwnXG4gICAgICAgICAgICAgICAgfSkucmVzdWx0LnRoZW4oZnVuY3Rpb24gKGdsb2JhbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZ2xvYmFsICYmIGdsb2JhbC5nbG9iYWxfbmFtZSAmJiBnbG9iYWwuZ2xvYmFsX3ZhbHVlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcmlnR2xvYmFsID0gXy5maW5kKHRhc2tHbG9iYWxzLmdsb2JhbHMse2dsb2JhbF9uYW1lIDogZ2xvYmFsLmdsb2JhbF9uYW1lfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3JpZ0dsb2JhbCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3JpZ0dsb2JhbC5nbG9iYWxfdmFsdWUgPSBnbG9iYWwuZ2xvYmFsX3ZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrR2xvYmFscy5nbG9iYWxzLnB1c2goZ2xvYmFsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2tHbG9iYWxzLmR0SW5zdGFuY2UgJiYgdGFza0dsb2JhbHMuZHRJbnN0YW5jZS5yZWxvYWREYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza0dsb2JhbHMuZHRJbnN0YW5jZS5yZWxvYWREYXRhKGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSwxMDApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAgIHJlc3RyaWN0OiBcIkVcIixcbiAgICAgICAgdGVtcGxhdGVVcmw6IHRlbXBsYXRlLFxuICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgZGF0YTogJz0nLFxuICAgICAgICAgICAgbG9naWNhbFVuaXRzOiAnPScsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRyb2xsZXI6IGNvbnRyb2xsZXIsXG4gICAgICAgIGNvbnRyb2xsZXJBczogJ3Rhc2tHbG9iYWxzJ1xuICAgIH07XG59XG5cblxuYW5ndWxhclxuICAgIC5tb2R1bGUoJ1RETS1GRScpXG4gICAgLmRpcmVjdGl2ZSgndGFza0dsb2JhbHMnLCB0YXNrR2xvYmFscykiXX0=
