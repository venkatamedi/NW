function taskStatsModalDirective(TDMService,$filter,DTColumnBuilder,DTOptionsBuilder,$q,$compile){return{templateUrl:"views/tasks/taskStatsModal.html",controllerAs:"taskStatsModalCtrl",controller:function($scope){let taskStatsModalCtrl=this;taskStatsModalCtrl.openTab=function(tabId){taskStatsModalCtrl.tab=tabId},taskStatsModalCtrl.updatePopup=function(targetId){$scope.updatePopup(targetId,taskStatsModalCtrl.selectedLU.lu_name)},taskStatsModalCtrl.refreshTable=node=>{var targetId=node.targetId,parentTargetId=node.parentTargetId,luName=node.lu_name,isRoot=node.isRoot,hasBrothers=node.brothers&&node.brothers.length>1||!1;let body={taskExecutionId:$scope.taskExecutionId,parentTargetId:isRoot||!hasBrothers?void 0:parentTargetId,targetId:isRoot||!hasBrothers?targetId:void 0,lu_name:luName};taskStatsModalCtrl.errorFailedReason=null,taskStatsModalCtrl.loadingTables=!0,TDMService.getTDMStats(body).then(res=>{let tableData=res.result.data;node.hasBrothers||(taskStatsModalCtrl.errorFailedReason=tableData&&tableData["Failed entities per execution"]&&tableData["Failed entities per execution"].entitiesList&&tableData["Failed entities per execution"].entitiesList.length>0&&tableData["Failed entities per execution"].entitiesList[0].errorMsg||void 0),taskStatsModalCtrl.makeTables=isRoot=>{taskStatsModalCtrl.makeCopiedEntitiesTable(isRoot),taskStatsModalCtrl.makeFailedEntitiesTable(isRoot)},taskStatsModalCtrl.makeCopiedEntitiesTable=function(isRoot){taskStatsModalCtrl.dtInstancecEntities={},taskStatsModalCtrl.dtColumnscEntities=[],taskStatsModalCtrl.dtColumnDefscEntities=[],taskStatsModalCtrl.headerscEntities=isRoot?[{column:"sourceId",name:"Source id",clickAble:!0},{column:"targetId",name:"Target id",clickAble:!1},{column:"copyEntityStatus",name:"Entity Status",clickAble:!1},{column:"copyHierarchyStatus",name:"Hierarchy Data Status",clickAble:!1}]:[{column:"sourceId",name:"Source id",clickAble:!0},{column:"targetId",name:"Target id",clickAble:!1},{column:"parentLuName",name:"Parent LU Name",clickAble:!1},{column:"parentSourceId",name:"Parent Source ID",clickAble:!1},{column:"parentTargetId",name:"Parent Target ID",clickAble:!1}];let clickableCol=(data,type,full)=>`<a ng-click="taskStatsModalCtrl.updatePopup('${full.targetId}')">  ${data} </a>`;for(var i=0;i<taskStatsModalCtrl.headerscEntities.length;i++)taskStatsModalCtrl.headerscEntities[i].clickAble?taskStatsModalCtrl.dtColumnscEntities.push(DTColumnBuilder.newColumn(taskStatsModalCtrl.headerscEntities[i].column).withTitle(taskStatsModalCtrl.headerscEntities[i].name).renderWith(clickableCol)):taskStatsModalCtrl.dtColumnscEntities.push(DTColumnBuilder.newColumn(taskStatsModalCtrl.headerscEntities[i].column).withTitle(taskStatsModalCtrl.headerscEntities[i].name));var getTableData=function(){var deferred=$q.defer();return deferred.resolve(taskStatsModalCtrl.cEntities),deferred.promise};taskStatsModalCtrl.dtOptionscEntities=DTOptionsBuilder.fromFnPromise((function(){return getTableData()})).withDOM("lTfgitp").withOption("createdRow",(function(row){$compile(angular.element(row).contents())($scope)})).withOption("scrollX",!1).withOption("lengthChange",!0).withOption("paging",!0).withOption("searching",!0).withOption("info",!0).withOption("caseInsensitive",!0).withOption("search",{caseInsensitive:!1}),taskStatsModalCtrl.dtInstanceCallbackcEntities=function(dtInstance){angular.isFunction(taskStatsModalCtrl.dtInstancecEntities)?taskStatsModalCtrl.dtInstancecEntities(dtInstance):angular.isDefined(taskStatsModalCtrl.dtInstancecEntities)&&(taskStatsModalCtrl.dtInstancecEntities=dtInstance)},null!=taskStatsModalCtrl.dtInstancecEntities.changeData&&taskStatsModalCtrl.dtInstancecEntities.changeData(getTableData()),taskStatsModalCtrl.loadingTableCopiedEntities=!1,taskStatsModalCtrl.dtInstancecEntities&&taskStatsModalCtrl.dtInstancecEntities.reloadData&&taskStatsModalCtrl.dtInstancecEntities.reloadData((function(data){}),!1)},taskStatsModalCtrl.makeFailedEntitiesTable=function(isRoot){taskStatsModalCtrl.dtInstancefEntities={},taskStatsModalCtrl.dtColumnsfEntities=[],taskStatsModalCtrl.dtColumnDefsfEntities=[],taskStatsModalCtrl.headersfEntities=isRoot?[{column:"sourceId",name:"Source id",clickAble:!0},{column:"targetId",name:"Target id",clickAble:!1},{column:"copyEntityStatus",name:"Entity Status",clickAble:!1},{column:"copyHierarchyStatus",name:"Hierarchy Data Status",clickAble:!1}]:[{column:"sourceId",name:"Source id",clickAble:!0},{column:"targetId",name:"Target id",clickAble:!1},{column:"parentLuName",name:"Parent LU Name",clickAble:!1},{column:"parentSourceId",name:"Parent Source ID",clickAble:!1},{column:"parentTargetId",name:"Parent Target ID",clickAble:!1},{column:"copyEntityStatus",name:"Entity Status",clickAble:!1},{column:"copyHierarchyStatus",name:"Hierarchy Data Status",clickAble:!1}];let clickableCol=(data,type,full)=>`<a ng-click="taskStatsModalCtrl.updatePopup('${full.targetId}')">  ${data} </a>`;for(var i=0;i<taskStatsModalCtrl.headersfEntities.length;i++)taskStatsModalCtrl.headersfEntities[i].clickAble?taskStatsModalCtrl.dtColumnsfEntities.push(DTColumnBuilder.newColumn(taskStatsModalCtrl.headersfEntities[i].column).withTitle(taskStatsModalCtrl.headersfEntities[i].name).renderWith(clickableCol)):taskStatsModalCtrl.dtColumnsfEntities.push(DTColumnBuilder.newColumn(taskStatsModalCtrl.headersfEntities[i].column).withTitle(taskStatsModalCtrl.headersfEntities[i].name));var getTableData=function(){var deferred=$q.defer();return deferred.resolve(taskStatsModalCtrl.fEntities),deferred.promise};taskStatsModalCtrl.dtOptionsfEntities=DTOptionsBuilder.fromFnPromise((function(){return getTableData()})).withDOM("lTfgitp").withOption("createdRow",(function(row){$compile(angular.element(row).contents())($scope)})).withOption("scrollX",!1).withOption("lengthChange",!0).withOption("paging",!0).withOption("searching",!0).withOption("info",!0).withOption("caseInsensitive",!0).withOption("search",{caseInsensitive:!1}),taskStatsModalCtrl.dtInstanceCallbackfEntities=function(dtInstance){angular.isFunction(taskStatsModalCtrl.dtInstancefEntities)?taskStatsModalCtrl.dtInstancefEntities(dtInstance):angular.isDefined(taskStatsModalCtrl.dtInstancefEntities)&&(taskStatsModalCtrl.dtInstancefEntities=dtInstance)},null!=taskStatsModalCtrl.dtInstancefEntities.changeData&&taskStatsModalCtrl.dtInstancefEntities.changeData(getTableData()),taskStatsModalCtrl.loadingTableFailedEntities=!1},tableData?(tableData["Copied entities per execution"]&&(taskStatsModalCtrl.totalCopiedEntities=tableData["Copied entities per execution"].NoOfEntities,taskStatsModalCtrl.cEntities=tableData["Copied entities per execution"].entitiesList,taskStatsModalCtrl.cEntitiesTitle=`${$filter("translate")("COPIED")} ${$filter("translate")("LIST")}`),tableData["Failed entities per execution"]&&(taskStatsModalCtrl.totalFailedEntities=tableData["Failed entities per execution"].NoOfEntities,taskStatsModalCtrl.fEntities=tableData["Failed entities per execution"].entitiesList,taskStatsModalCtrl.fEntities=taskStatsModalCtrl.fEntities,taskStatsModalCtrl.fEntitiesTitle=`${$filter("translate")("FAILED")} ${$filter("translate")("LIST")}`)):(taskStatsModalCtrl.totalCopiedEntities=0,taskStatsModalCtrl.totalFailedEntities=0,taskStatsModalCtrl.fEntities=[],taskStatsModalCtrl.cEntities=[]),taskStatsModalCtrl.makeTables(isRoot),taskStatsModalCtrl.loadingTables=!1,taskStatsModalCtrl.tab||(taskStatsModalCtrl.tab=1)})},taskStatsModalCtrl.updateTDMStats=function(item){for(i of(taskStatsModalCtrl.selectedLU=item,item.collapsed=!1,$scope.luTreeMenu.forEach((function(root){item.isRoot?root.collapsed=!1:item.parentRootLuName!==root.lu_name&&(root.collapsed=!0)})),$scope.luTreeMenu))if(i.selected=!1,i.children)for(child of i.children)child.selected=!1;taskStatsModalCtrl.refreshTable(item)};var updateTree=function(element){if(element.children&&0!=element.children.length){var i;for(i=0;i<element.children.length;i++)updateTree(element.children[i]);if(element.children&&element.children.length>1){var newChildren=[],groupByLU=_.groupBy(element.children,"lu_name");for(var key in groupByLU){var newChild=groupByLU[key][0];newChild.brothers=groupByLU[key],newChildren.push(newChild)}element.children=newChildren}}},searchTree=function(element,lu_name,target_id){if(element.lu_name==lu_name&&element.targetId==target_id)return element.selected=!0,element;if(null!=element.children){var i,result=null;for(i=0;null==result&&i<element.children.length;i++)(result=searchTree(element.children[i],lu_name,target_id))&&(element.collapsed=!1);return result}return!1};TDMService.getLuTree({targetId:$scope.targetId,luName:$scope.luName,taskExecutionId:$scope.taskExecutionId}).then(response=>{for(var result=null,i=0;i<response.result.length;i++)result=searchTree(response.result[i],$scope.luName,$scope.targetId),updateTree(response.result[i]);$scope.luTreeMenu=response.result,result&&taskStatsModalCtrl.updateTDMStats(result)})},scope:{taskExecutionId:"=",targetId:"=",luName:"=",updatePopup:"=",close:"="}}}angular.module("TDM-FE").directive("taskStatsModalDirective",taskStatsModalDirective);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpcmVjdGl2ZXMvdGFza3MvdGFza1N0YXRzTW9kYWwuanMiXSwibmFtZXMiOlsidGFza1N0YXRzTW9kYWxEaXJlY3RpdmUiLCJURE1TZXJ2aWNlIiwiJGZpbHRlciIsIkRUQ29sdW1uQnVpbGRlciIsIkRUT3B0aW9uc0J1aWxkZXIiLCIkcSIsIiRjb21waWxlIiwidGVtcGxhdGVVcmwiLCJjb250cm9sbGVyQXMiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwidGFza1N0YXRzTW9kYWxDdHJsIiwidGhpcyIsIm9wZW5UYWIiLCJ0YWJJZCIsInRhYiIsInVwZGF0ZVBvcHVwIiwidGFyZ2V0SWQiLCJzZWxlY3RlZExVIiwibHVfbmFtZSIsInJlZnJlc2hUYWJsZSIsIm5vZGUiLCJwYXJlbnRUYXJnZXRJZCIsImx1TmFtZSIsImlzUm9vdCIsImhhc0Jyb3RoZXJzIiwiYnJvdGhlcnMiLCJsZW5ndGgiLCJib2R5IiwidGFza0V4ZWN1dGlvbklkIiwidW5kZWZpbmVkIiwiZXJyb3JGYWlsZWRSZWFzb24iLCJsb2FkaW5nVGFibGVzIiwiZ2V0VERNU3RhdHMiLCJ0aGVuIiwicmVzIiwidGFibGVEYXRhIiwicmVzdWx0IiwiZGF0YSIsImVudGl0aWVzTGlzdCIsImVycm9yTXNnIiwibWFrZVRhYmxlcyIsIm1ha2VDb3BpZWRFbnRpdGllc1RhYmxlIiwibWFrZUZhaWxlZEVudGl0aWVzVGFibGUiLCJkdEluc3RhbmNlY0VudGl0aWVzIiwiZHRDb2x1bW5zY0VudGl0aWVzIiwiZHRDb2x1bW5EZWZzY0VudGl0aWVzIiwiaGVhZGVyc2NFbnRpdGllcyIsImNvbHVtbiIsIm5hbWUiLCJjbGlja0FibGUiLCJjbGlja2FibGVDb2wiLCJ0eXBlIiwiZnVsbCIsImkiLCJwdXNoIiwibmV3Q29sdW1uIiwid2l0aFRpdGxlIiwicmVuZGVyV2l0aCIsImdldFRhYmxlRGF0YSIsImRlZmVycmVkIiwiZGVmZXIiLCJyZXNvbHZlIiwiY0VudGl0aWVzIiwicHJvbWlzZSIsImR0T3B0aW9uc2NFbnRpdGllcyIsImZyb21GblByb21pc2UiLCJ3aXRoRE9NIiwid2l0aE9wdGlvbiIsInJvdyIsImFuZ3VsYXIiLCJlbGVtZW50IiwiY29udGVudHMiLCJjYXNlSW5zZW5zaXRpdmUiLCJkdEluc3RhbmNlQ2FsbGJhY2tjRW50aXRpZXMiLCJkdEluc3RhbmNlIiwiaXNGdW5jdGlvbiIsImlzRGVmaW5lZCIsImNoYW5nZURhdGEiLCJsb2FkaW5nVGFibGVDb3BpZWRFbnRpdGllcyIsInJlbG9hZERhdGEiLCJkdEluc3RhbmNlZkVudGl0aWVzIiwiZHRDb2x1bW5zZkVudGl0aWVzIiwiZHRDb2x1bW5EZWZzZkVudGl0aWVzIiwiaGVhZGVyc2ZFbnRpdGllcyIsImZFbnRpdGllcyIsImR0T3B0aW9uc2ZFbnRpdGllcyIsImR0SW5zdGFuY2VDYWxsYmFja2ZFbnRpdGllcyIsImxvYWRpbmdUYWJsZUZhaWxlZEVudGl0aWVzIiwidG90YWxDb3BpZWRFbnRpdGllcyIsIk5vT2ZFbnRpdGllcyIsImNFbnRpdGllc1RpdGxlIiwidG90YWxGYWlsZWRFbnRpdGllcyIsImZFbnRpdGllc1RpdGxlIiwidXBkYXRlVERNU3RhdHMiLCJpdGVtIiwiY29sbGFwc2VkIiwibHVUcmVlTWVudSIsImZvckVhY2giLCJyb290IiwicGFyZW50Um9vdEx1TmFtZSIsInNlbGVjdGVkIiwiY2hpbGRyZW4iLCJjaGlsZCIsInVwZGF0ZVRyZWUiLCJuZXdDaGlsZHJlbiIsImdyb3VwQnlMVSIsIl8iLCJncm91cEJ5Iiwia2V5IiwibmV3Q2hpbGQiLCJzZWFyY2hUcmVlIiwidGFyZ2V0X2lkIiwiZ2V0THVUcmVlIiwicmVzcG9uc2UiLCJzY29wZSIsImNsb3NlIiwibW9kdWxlIiwiZGlyZWN0aXZlIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSx3QkFBd0JDLFdBQVlDLFFBQVNDLGdCQUFpQkMsaUJBQWtCQyxHQUFJQyxVQUN6RixNQUFPLENBQ0hDLFlBQWEsa0NBQ2JDLGFBQWMscUJBQ2RDLFdBQVksU0FBVUMsUUFDbEIsSUFBSUMsbUJBQXFCQyxLQUV6QkQsbUJBQW1CRSxRQUFVLFNBQVVDLE9BQ25DSCxtQkFBbUJJLElBQU1ELE9BRzdCSCxtQkFBbUJLLFlBQWMsU0FBVUMsVUFDdkNQLE9BQU9NLFlBQVlDLFNBQVVOLG1CQUFtQk8sV0FBV0MsVUFHL0RSLG1CQUFtQlMsYUFBZ0JDLE9BQy9CLElBQUlKLFNBQVdJLEtBQUtKLFNBQ2hCSyxlQUFpQkQsS0FBS0MsZUFDdEJDLE9BQVNGLEtBQUtGLFFBQ2RLLE9BQVNILEtBQUtHLE9BQ2RDLFlBQWNKLEtBQUtLLFVBQVlMLEtBQUtLLFNBQVNDLE9BQVMsSUFBSyxFQUMvRCxJQUFJQyxLQUFPLENBQ1BDLGdCQUFpQm5CLE9BQU9tQixnQkFDeEJQLGVBQWdCRSxTQUFXQyxpQkFBY0ssRUFBWVIsZUFDckRMLFNBQVVPLFNBQVdDLFlBQWNSLGNBQVdhLEVBQzlDWCxRQUFTSSxRQUViWixtQkFBbUJvQixrQkFBb0IsS0FDdkNwQixtQkFBbUJxQixlQUFnQixFQUNuQy9CLFdBQVdnQyxZQUFZTCxNQUFNTSxLQUFLQyxNQUU5QixJQUFJQyxVQUFZRCxJQUFJRSxPQUFPQyxLQUN0QmpCLEtBQUtJLGNBQ05kLG1CQUFtQm9CLGtCQUFvQkssV0FBYUEsVUFBVSxrQ0FDOURBLFVBQVUsaUNBQWlDRyxjQUMzQ0gsVUFBVSxpQ0FBaUNHLGFBQWFaLE9BQVMsR0FDakVTLFVBQVUsaUNBQWlDRyxhQUFhLEdBQUdDLGVBQVlWLEdBRTNFbkIsbUJBQW1COEIsV0FBY2pCLFNBQzdCYixtQkFBbUIrQix3QkFBd0JsQixRQUMzQ2IsbUJBQW1CZ0Msd0JBQXdCbkIsU0FHL0NiLG1CQUFtQitCLHdCQUEwQixTQUFVbEIsUUFDbkRiLG1CQUFtQmlDLG9CQUFzQixHQUN6Q2pDLG1CQUFtQmtDLG1CQUFxQixHQUN4Q2xDLG1CQUFtQm1DLHNCQUF3QixHQUV2Q25DLG1CQUFtQm9DLGlCQURuQnZCLE9BQ3NDLENBQ2xDLENBQ0l3QixPQUFRLFdBQ1JDLEtBQU0sWUFDTkMsV0FBVyxHQUVmLENBQ0lGLE9BQVEsV0FDUkMsS0FBTSxZQUNOQyxXQUFXLEdBRWYsQ0FDSUYsT0FBUSxtQkFDUkMsS0FBTSxnQkFDTkMsV0FBVyxHQUVmLENBQ0lGLE9BQVEsc0JBQ1JDLEtBQU0sd0JBQ05DLFdBQVcsSUFJbUIsQ0FDbEMsQ0FDSUYsT0FBUSxXQUNSQyxLQUFNLFlBQ05DLFdBQVcsR0FFZixDQUNJRixPQUFRLFdBQ1JDLEtBQU0sWUFDTkMsV0FBVyxHQUVmLENBQ0lGLE9BQVEsZUFDUkMsS0FBTSxpQkFDTkMsV0FBVyxHQUVmLENBQ0lGLE9BQVEsaUJBQ1JDLEtBQU0sbUJBQ05DLFdBQVcsR0FFZixDQUNJRixPQUFRLGlCQUNSQyxLQUFNLG1CQUNOQyxXQUFXLElBS3ZCLElBQUlDLGFBQWUsQ0FBQ2IsS0FBTWMsS0FBTUMsT0FDckIsZ0RBQWdEQSxLQUFLcEMsaUJBQWlCcUIsWUFFakYsSUFBSyxJQUFJZ0IsRUFBSSxFQUFHQSxFQUFJM0MsbUJBQW1Cb0MsaUJBQWlCcEIsT0FBUTJCLElBQ3hEM0MsbUJBQW1Cb0MsaUJBQWlCTyxHQUFHSixVQUN2Q3ZDLG1CQUFtQmtDLG1CQUFtQlUsS0FBS3BELGdCQUFnQnFELFVBQVU3QyxtQkFBbUJvQyxpQkFBaUJPLEdBQUdOLFFBQVFTLFVBQVU5QyxtQkFBbUJvQyxpQkFBaUJPLEdBQUdMLE1BQU1TLFdBQVdQLGVBRXRMeEMsbUJBQW1Ca0MsbUJBQW1CVSxLQUFLcEQsZ0JBQWdCcUQsVUFBVTdDLG1CQUFtQm9DLGlCQUFpQk8sR0FBR04sUUFBUVMsVUFBVTlDLG1CQUFtQm9DLGlCQUFpQk8sR0FBR0wsT0FJN0ssSUFBSVUsYUFBZSxXQUNmLElBQUlDLFNBQVd2RCxHQUFHd0QsUUFFbEIsT0FEQUQsU0FBU0UsUUFBUW5ELG1CQUFtQm9ELFdBQzdCSCxTQUFTSSxTQUdwQnJELG1CQUFtQnNELG1CQUFxQjdELGlCQUFpQjhELGVBQWMsV0FDbkUsT0FBT1Asa0JBRU5RLFFBQVEsV0FDUkMsV0FBVyxjQUFjLFNBQVVDLEtBRWhDL0QsU0FBU2dFLFFBQVFDLFFBQVFGLEtBQUtHLFdBQTlCbEUsQ0FBMENJLFdBRTdDMEQsV0FBVyxXQUFXLEdBQ3RCQSxXQUFXLGdCQUFnQixHQUMzQkEsV0FBVyxVQUFVLEdBQ3JCQSxXQUFXLGFBQWEsR0FDeEJBLFdBQVcsUUFBUSxHQUNuQkEsV0FBVyxtQkFBbUIsR0FDOUJBLFdBQVcsU0FBVSxDQUNsQkssaUJBQW1CLElBRzNCOUQsbUJBQW1CK0QsNEJBQThCLFNBQVVDLFlBQ25ETCxRQUFRTSxXQUFXakUsbUJBQW1CaUMscUJBQ3RDakMsbUJBQW1CaUMsb0JBQW9CK0IsWUFDaENMLFFBQVFPLFVBQVVsRSxtQkFBbUJpQyx1QkFDNUNqQyxtQkFBbUJpQyxvQkFBc0IrQixhQUdRLE1BQXJEaEUsbUJBQW1CaUMsb0JBQW9Ca0MsWUFDdkNuRSxtQkFBbUJpQyxvQkFBb0JrQyxXQUFXbkIsZ0JBRXREaEQsbUJBQW1Cb0UsNEJBQTZCLEVBRTVDcEUsbUJBQW1CaUMscUJBQXVCakMsbUJBQW1CaUMsb0JBQW9Cb0MsWUFDakZyRSxtQkFBbUJpQyxvQkFBb0JvQyxZQUFXLFNBQVUxQyxVQUN6RCxJQUlYM0IsbUJBQW1CZ0Msd0JBQTBCLFNBQVVuQixRQUNuRGIsbUJBQW1Cc0Usb0JBQXNCLEdBQ3pDdEUsbUJBQW1CdUUsbUJBQXFCLEdBQ3hDdkUsbUJBQW1Cd0Usc0JBQXdCLEdBRXZDeEUsbUJBQW1CeUUsaUJBRG5CNUQsT0FDc0MsQ0FDbEMsQ0FDSXdCLE9BQVEsV0FDUkMsS0FBTSxZQUNOQyxXQUFXLEdBRWYsQ0FDSUYsT0FBUSxXQUNSQyxLQUFNLFlBQ05DLFdBQVcsR0FFZixDQUNJRixPQUFRLG1CQUNSQyxLQUFNLGdCQUNOQyxXQUFXLEdBRWYsQ0FDSUYsT0FBUSxzQkFDUkMsS0FBTSx3QkFDTkMsV0FBVyxJQUltQixDQUNsQyxDQUNJRixPQUFRLFdBQ1JDLEtBQU0sWUFDTkMsV0FBVyxHQUVmLENBQ0lGLE9BQVEsV0FDUkMsS0FBTSxZQUNOQyxXQUFXLEdBRWYsQ0FDSUYsT0FBUSxlQUNSQyxLQUFNLGlCQUNOQyxXQUFXLEdBRWYsQ0FDSUYsT0FBUSxpQkFDUkMsS0FBTSxtQkFDTkMsV0FBVyxHQUVmLENBQ0lGLE9BQVEsaUJBQ1JDLEtBQU0sbUJBQ05DLFdBQVcsR0FFZixDQUNJRixPQUFRLG1CQUNSQyxLQUFNLGdCQUNOQyxXQUFXLEdBRWYsQ0FDSUYsT0FBUSxzQkFDUkMsS0FBTSx3QkFDTkMsV0FBVyxJQUt2QixJQUFJQyxhQUFlLENBQUNiLEtBQU1jLEtBQU1DLE9BQ3JCLGdEQUFnREEsS0FBS3BDLGlCQUFpQnFCLFlBR2pGLElBQUssSUFBSWdCLEVBQUksRUFBR0EsRUFBSTNDLG1CQUFtQnlFLGlCQUFpQnpELE9BQVEyQixJQUN4RDNDLG1CQUFtQnlFLGlCQUFpQjlCLEdBQUdKLFVBQ3ZDdkMsbUJBQW1CdUUsbUJBQW1CM0IsS0FBS3BELGdCQUFnQnFELFVBQVU3QyxtQkFBbUJ5RSxpQkFBaUI5QixHQUFHTixRQUFRUyxVQUFVOUMsbUJBQW1CeUUsaUJBQWlCOUIsR0FBR0wsTUFBTVMsV0FBV1AsZUFFdEx4QyxtQkFBbUJ1RSxtQkFBbUIzQixLQUFLcEQsZ0JBQWdCcUQsVUFBVTdDLG1CQUFtQnlFLGlCQUFpQjlCLEdBQUdOLFFBQVFTLFVBQVU5QyxtQkFBbUJ5RSxpQkFBaUI5QixHQUFHTCxPQUk3SyxJQUFJVSxhQUFlLFdBQ2YsSUFBSUMsU0FBV3ZELEdBQUd3RCxRQUVsQixPQURBRCxTQUFTRSxRQUFRbkQsbUJBQW1CMEUsV0FDN0J6QixTQUFTSSxTQUdwQnJELG1CQUFtQjJFLG1CQUFxQmxGLGlCQUFpQjhELGVBQWMsV0FDbkUsT0FBT1Asa0JBRU5RLFFBQVEsV0FDUkMsV0FBVyxjQUFjLFNBQVVDLEtBRWhDL0QsU0FBU2dFLFFBQVFDLFFBQVFGLEtBQUtHLFdBQTlCbEUsQ0FBMENJLFdBRTdDMEQsV0FBVyxXQUFXLEdBQ3RCQSxXQUFXLGdCQUFnQixHQUMzQkEsV0FBVyxVQUFVLEdBQ3JCQSxXQUFXLGFBQWEsR0FDeEJBLFdBQVcsUUFBUSxHQUNuQkEsV0FBVyxtQkFBbUIsR0FDOUJBLFdBQVcsU0FBVSxDQUNsQkssaUJBQW1CLElBRzNCOUQsbUJBQW1CNEUsNEJBQThCLFNBQVVaLFlBQ25ETCxRQUFRTSxXQUFXakUsbUJBQW1Cc0UscUJBQ3RDdEUsbUJBQW1Cc0Usb0JBQW9CTixZQUNoQ0wsUUFBUU8sVUFBVWxFLG1CQUFtQnNFLHVCQUM1Q3RFLG1CQUFtQnNFLG9CQUFzQk4sYUFHUSxNQUFyRGhFLG1CQUFtQnNFLG9CQUFvQkgsWUFDdkNuRSxtQkFBbUJzRSxvQkFBb0JILFdBQVduQixnQkFFdERoRCxtQkFBbUI2RSw0QkFBNkIsR0FJaERwRCxXQUNJQSxVQUFVLG1DQUNWekIsbUJBQW1COEUsb0JBQXNCckQsVUFBVSxpQ0FBaUNzRCxhQUNwRi9FLG1CQUFtQm9ELFVBQVkzQixVQUFVLGlDQUFpQ0csYUFDMUU1QixtQkFBbUJnRixlQUFpQixHQUFHekYsUUFBUSxZQUFSQSxDQUFxQixhQUFhQSxRQUFRLFlBQVJBLENBQXFCLFdBRTlGa0MsVUFBVSxtQ0FDVnpCLG1CQUFtQmlGLG9CQUFzQnhELFVBQVUsaUNBQWlDc0QsYUFDcEYvRSxtQkFBbUIwRSxVQUFZakQsVUFBVSxpQ0FBaUNHLGFBQzFFNUIsbUJBQW1CMEUsVUFBWTFFLG1CQUFtQjBFLFVBQ2xEMUUsbUJBQW1Ca0YsZUFBaUIsR0FBRzNGLFFBQVEsWUFBUkEsQ0FBcUIsYUFBYUEsUUFBUSxZQUFSQSxDQUFxQixhQUlsR1MsbUJBQW1COEUsb0JBQXNCLEVBQ3pDOUUsbUJBQW1CaUYsb0JBQXNCLEVBRXpDakYsbUJBQW1CMEUsVUFBWSxHQUMvQjFFLG1CQUFtQm9ELFVBQVksSUFHbkNwRCxtQkFBbUI4QixXQUFXakIsUUFDOUJiLG1CQUFtQnFCLGVBQWdCLEVBQzlCckIsbUJBQW1CSSxNQUNwQkosbUJBQW1CSSxJQUFNLE1BSXJDSixtQkFBbUJtRixlQUFpQixTQUFVQyxNQWMxQyxJQUFLekMsS0FiTDNDLG1CQUFtQk8sV0FBYTZFLEtBQ2hDQSxLQUFLQyxXQUFZLEVBQ2pCdEYsT0FBT3VGLFdBQVdDLFNBQVEsU0FBVUMsTUFDNUJKLEtBQUt2RSxPQUNMMkUsS0FBS0gsV0FBWSxFQUViRCxLQUFLSyxtQkFBcUJELEtBQUtoRixVQUMvQmdGLEtBQUtILFdBQVksTUFNbkJ0RixPQUFPdUYsWUFFYixHQURBM0MsRUFBRStDLFVBQVcsRUFDVC9DLEVBQUVnRCxTQUNGLElBQUtDLFNBQVNqRCxFQUFFZ0QsU0FDWkMsTUFBTUYsVUFBVyxFQUs3QjFGLG1CQUFtQlMsYUFBYTJFLE9BR3BDLElBQUlTLFdBQWEsU0FBU2pDLFNBQ3RCLEdBQUlBLFFBQVErQixVQUF1QyxHQUEzQi9CLFFBQVErQixTQUFTM0UsT0FBekMsQ0FHQSxJQUFJMkIsRUFDSixJQUFJQSxFQUFJLEVBQUVBLEVBQUlpQixRQUFRK0IsU0FBUzNFLE9BQVEyQixJQUNuQ2tELFdBQVdqQyxRQUFRK0IsU0FBU2hELElBRWpDLEdBQUlpQixRQUFRK0IsVUFBWS9CLFFBQVErQixTQUFTM0UsT0FBUyxFQUFFLENBQ2hELElBQUk4RSxZQUFjLEdBQ2RDLFVBQVlDLEVBQUVDLFFBQVFyQyxRQUFRK0IsU0FBUyxXQUMzQyxJQUFJLElBQUlPLE9BQU9ILFVBQVcsQ0FDckIsSUFBSUksU0FBV0osVUFBVUcsS0FBSyxHQUM5QkMsU0FBU3BGLFNBQVdnRixVQUFVRyxLQUM5QkosWUFBWWxELEtBQUt1RCxVQUV0QnZDLFFBQVErQixTQUFXRyxlQUl0Qk0sV0FBYSxTQUFVeEMsUUFBU3BELFFBQVM2RixXQUN6QyxHQUFHekMsUUFBUXBELFNBQVdBLFNBQVdvRCxRQUFRdEQsVUFBWStGLFVBRWpELE9BREF6QyxRQUFROEIsVUFBVyxFQUNaOUIsUUFDTCxHQUF3QixNQUFwQkEsUUFBUStCLFNBQWlCLENBQzlCLElBQUloRCxFQUNBakIsT0FBUyxLQUNiLElBQUlpQixFQUFJLEVBQWEsTUFBVmpCLFFBQWtCaUIsRUFBSWlCLFFBQVErQixTQUFTM0UsT0FBUTJCLEtBQ3ZEakIsT0FBUzBFLFdBQVd4QyxRQUFRK0IsU0FBU2hELEdBQUluQyxRQUFTNkYsY0FFOUN6QyxRQUFReUIsV0FBWSxHQUc1QixPQUFPM0QsT0FFWCxPQUFPLEdBR1hwQyxXQUFXZ0gsVUFBVSxDQUNqQmhHLFNBQVVQLE9BQU9PLFNBQ2pCTSxPQUFRYixPQUFPYSxPQUNmTSxnQkFBaUJuQixPQUFPbUIsa0JBQ3pCSyxLQUFLZ0YsV0FFSixJQURBLElBQUk3RSxPQUFTLEtBQ0xpQixFQUFJLEVBQUVBLEVBQUk0RCxTQUFTN0UsT0FBT1YsT0FBUTJCLElBQ3RDakIsT0FBUzBFLFdBQVdHLFNBQVM3RSxPQUFPaUIsR0FBSTVDLE9BQU9hLE9BQVFiLE9BQU9PLFVBQzlEdUYsV0FBV1UsU0FBUzdFLE9BQU9pQixJQUcvQjVDLE9BQU91RixXQUFhaUIsU0FBUzdFLE9BQ3pCQSxRQUNBMUIsbUJBQW1CbUYsZUFBZXpELFdBSTlDOEUsTUFBTyxDQUNIdEYsZ0JBQWlCLElBQ2pCWixTQUFVLElBQ1ZNLE9BQVEsSUFDUlAsWUFBYSxJQUNib0csTUFBTyxNQUtuQjlDLFFBQ0srQyxPQUFPLFVBQ1BDLFVBQVUsMEJBQTJCdEgiLCJmaWxlIjoiZGlyZWN0aXZlcy90YXNrcy90YXNrU3RhdHNNb2RhbC5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHRhc2tTdGF0c01vZGFsRGlyZWN0aXZlKFRETVNlcnZpY2UsICRmaWx0ZXIsIERUQ29sdW1uQnVpbGRlciwgRFRPcHRpb25zQnVpbGRlciwgJHEsICRjb21waWxlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdGVtcGxhdGVVcmw6ICd2aWV3cy90YXNrcy90YXNrU3RhdHNNb2RhbC5odG1sJyxcbiAgICAgICAgY29udHJvbGxlckFzOiAndGFza1N0YXRzTW9kYWxDdHJsJyxcbiAgICAgICAgY29udHJvbGxlcjogZnVuY3Rpb24gKCRzY29wZSkge1xuICAgICAgICAgICAgbGV0IHRhc2tTdGF0c01vZGFsQ3RybCA9IHRoaXM7XG5cbiAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5vcGVuVGFiID0gZnVuY3Rpb24gKHRhYklkKSB7XG4gICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLnRhYiA9IHRhYklkO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLnVwZGF0ZVBvcHVwID0gZnVuY3Rpb24gKHRhcmdldElkKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnVwZGF0ZVBvcHVwKHRhcmdldElkLCB0YXNrU3RhdHNNb2RhbEN0cmwuc2VsZWN0ZWRMVS5sdV9uYW1lKTtcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5yZWZyZXNoVGFibGUgPSAobm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIHZhciB0YXJnZXRJZCA9IG5vZGUudGFyZ2V0SWQ7XG4gICAgICAgICAgICAgICAgdmFyIHBhcmVudFRhcmdldElkID0gbm9kZS5wYXJlbnRUYXJnZXRJZDtcbiAgICAgICAgICAgICAgICB2YXIgbHVOYW1lID0gbm9kZS5sdV9uYW1lO1xuICAgICAgICAgICAgICAgIHZhciBpc1Jvb3QgPSBub2RlLmlzUm9vdDtcbiAgICAgICAgICAgICAgICB2YXIgaGFzQnJvdGhlcnMgPSBub2RlLmJyb3RoZXJzICYmIG5vZGUuYnJvdGhlcnMubGVuZ3RoID4gMSB8fCBmYWxzZTtcbiAgICAgICAgICAgICAgICBsZXQgYm9keSA9IHtcbiAgICAgICAgICAgICAgICAgICAgdGFza0V4ZWN1dGlvbklkOiAkc2NvcGUudGFza0V4ZWN1dGlvbklkLFxuICAgICAgICAgICAgICAgICAgICBwYXJlbnRUYXJnZXRJZDogaXNSb290IHx8ICFoYXNCcm90aGVycyA/IHVuZGVmaW5lZCA6IHBhcmVudFRhcmdldElkLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRJZDogaXNSb290IHx8ICFoYXNCcm90aGVycyA/IHRhcmdldElkIDogdW5kZWZpbmVkLFxuICAgICAgICAgICAgICAgICAgICBsdV9uYW1lOiBsdU5hbWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLmVycm9yRmFpbGVkUmVhc29uID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwubG9hZGluZ1RhYmxlcyA9IHRydWU7XG4gICAgICAgICAgICAgICAgVERNU2VydmljZS5nZXRURE1TdGF0cyhib2R5KS50aGVuKHJlcyA9PiB7XG5cbiAgICAgICAgICAgICAgICAgICAgbGV0IHRhYmxlRGF0YSA9IHJlcy5yZXN1bHQuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFub2RlLmhhc0Jyb3RoZXJzKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5lcnJvckZhaWxlZFJlYXNvbiA9IHRhYmxlRGF0YSAmJiB0YWJsZURhdGFbXCJGYWlsZWQgZW50aXRpZXMgcGVyIGV4ZWN1dGlvblwiXSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVEYXRhW1wiRmFpbGVkIGVudGl0aWVzIHBlciBleGVjdXRpb25cIl0uZW50aXRpZXNMaXN0ICYmIFxuICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVEYXRhW1wiRmFpbGVkIGVudGl0aWVzIHBlciBleGVjdXRpb25cIl0uZW50aXRpZXNMaXN0Lmxlbmd0aCA+IDAgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlRGF0YVtcIkZhaWxlZCBlbnRpdGllcyBwZXIgZXhlY3V0aW9uXCJdLmVudGl0aWVzTGlzdFswXS5lcnJvck1zZyB8fCB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLm1ha2VUYWJsZXMgPSAoaXNSb290KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwubWFrZUNvcGllZEVudGl0aWVzVGFibGUoaXNSb290KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5tYWtlRmFpbGVkRW50aXRpZXNUYWJsZShpc1Jvb3QpO1xuICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5tYWtlQ29waWVkRW50aXRpZXNUYWJsZSA9IGZ1bmN0aW9uIChpc1Jvb3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5kdEluc3RhbmNlY0VudGl0aWVzID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuZHRDb2x1bW5zY0VudGl0aWVzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuZHRDb2x1bW5EZWZzY0VudGl0aWVzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNSb290KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLmhlYWRlcnNjRW50aXRpZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3NvdXJjZUlkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdTb3VyY2UgaWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3RhcmdldElkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdUYXJnZXQgaWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46ICdjb3B5RW50aXR5U3RhdHVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdFbnRpdHkgU3RhdHVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrQWJsZTogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiAnY29weUhpZXJhcmNoeVN0YXR1cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnSGllcmFyY2h5IERhdGEgU3RhdHVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrQWJsZTogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuaGVhZGVyc2NFbnRpdGllcyA9IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiAnc291cmNlSWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1NvdXJjZSBpZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiAndGFyZ2V0SWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1RhcmdldCBpZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3BhcmVudEx1TmFtZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnUGFyZW50IExVIE5hbWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46ICdwYXJlbnRTb3VyY2VJZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnUGFyZW50IFNvdXJjZSBJRCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3BhcmVudFRhcmdldElkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdQYXJlbnQgVGFyZ2V0IElEJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrQWJsZTogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjbGlja2FibGVDb2wgPSAoZGF0YSwgdHlwZSwgZnVsbCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBgPGEgbmctY2xpY2s9XCJ0YXNrU3RhdHNNb2RhbEN0cmwudXBkYXRlUG9wdXAoJyR7ZnVsbC50YXJnZXRJZH0nKVwiPiAgJHtkYXRhfSA8L2E+YDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFza1N0YXRzTW9kYWxDdHJsLmhlYWRlcnNjRW50aXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFza1N0YXRzTW9kYWxDdHJsLmhlYWRlcnNjRW50aXRpZXNbaV0uY2xpY2tBYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5kdENvbHVtbnNjRW50aXRpZXMucHVzaChEVENvbHVtbkJ1aWxkZXIubmV3Q29sdW1uKHRhc2tTdGF0c01vZGFsQ3RybC5oZWFkZXJzY0VudGl0aWVzW2ldLmNvbHVtbikud2l0aFRpdGxlKHRhc2tTdGF0c01vZGFsQ3RybC5oZWFkZXJzY0VudGl0aWVzW2ldLm5hbWUpLnJlbmRlcldpdGgoY2xpY2thYmxlQ29sKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLmR0Q29sdW1uc2NFbnRpdGllcy5wdXNoKERUQ29sdW1uQnVpbGRlci5uZXdDb2x1bW4odGFza1N0YXRzTW9kYWxDdHJsLmhlYWRlcnNjRW50aXRpZXNbaV0uY29sdW1uKS53aXRoVGl0bGUodGFza1N0YXRzTW9kYWxDdHJsLmhlYWRlcnNjRW50aXRpZXNbaV0ubmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdldFRhYmxlRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUodGFza1N0YXRzTW9kYWxDdHJsLmNFbnRpdGllcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuZHRPcHRpb25zY0VudGl0aWVzID0gRFRPcHRpb25zQnVpbGRlci5mcm9tRm5Qcm9taXNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VGFibGVEYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoRE9NKCdsVGZnaXRwJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAud2l0aE9wdGlvbignY3JlYXRlZFJvdycsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVjb21waWxpbmcgc28gd2UgY2FuIGJpbmQgQW5ndWxhciBkaXJlY3RpdmUgdG8gdGhlIERUXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21waWxlKGFuZ3VsYXIuZWxlbWVudChyb3cpLmNvbnRlbnRzKCkpKCRzY29wZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAud2l0aE9wdGlvbignc2Nyb2xsWCcsIGZhbHNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdsZW5ndGhDaGFuZ2UnLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdwYWdpbmcnLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdzZWFyY2hpbmcnLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdpbmZvJywgdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAud2l0aE9wdGlvbihcImNhc2VJbnNlbnNpdGl2ZVwiLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdzZWFyY2gnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2FzZUluc2Vuc2l0aXZlXCI6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5kdEluc3RhbmNlQ2FsbGJhY2tjRW50aXRpZXMgPSBmdW5jdGlvbiAoZHRJbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odGFza1N0YXRzTW9kYWxDdHJsLmR0SW5zdGFuY2VjRW50aXRpZXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5kdEluc3RhbmNlY0VudGl0aWVzKGR0SW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYW5ndWxhci5pc0RlZmluZWQodGFza1N0YXRzTW9kYWxDdHJsLmR0SW5zdGFuY2VjRW50aXRpZXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5kdEluc3RhbmNlY0VudGl0aWVzID0gZHRJbnN0YW5jZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2tTdGF0c01vZGFsQ3RybC5kdEluc3RhbmNlY0VudGl0aWVzLmNoYW5nZURhdGEgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuZHRJbnN0YW5jZWNFbnRpdGllcy5jaGFuZ2VEYXRhKGdldFRhYmxlRGF0YSgpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLmxvYWRpbmdUYWJsZUNvcGllZEVudGl0aWVzID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YXNrU3RhdHNNb2RhbEN0cmwuZHRJbnN0YW5jZWNFbnRpdGllcyAmJiB0YXNrU3RhdHNNb2RhbEN0cmwuZHRJbnN0YW5jZWNFbnRpdGllcy5yZWxvYWREYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLmR0SW5zdGFuY2VjRW50aXRpZXMucmVsb2FkRGF0YShmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5tYWtlRmFpbGVkRW50aXRpZXNUYWJsZSA9IGZ1bmN0aW9uIChpc1Jvb3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5kdEluc3RhbmNlZkVudGl0aWVzID0ge307XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuZHRDb2x1bW5zZkVudGl0aWVzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuZHRDb2x1bW5EZWZzZkVudGl0aWVzID0gW107XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNSb290KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLmhlYWRlcnNmRW50aXRpZXMgPSBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3NvdXJjZUlkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdTb3VyY2UgaWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3RhcmdldElkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdUYXJnZXQgaWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46ICdjb3B5RW50aXR5U3RhdHVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdFbnRpdHkgU3RhdHVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrQWJsZTogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiAnY29weUhpZXJhcmNoeVN0YXR1cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnSGllcmFyY2h5IERhdGEgU3RhdHVzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrQWJsZTogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuaGVhZGVyc2ZFbnRpdGllcyA9IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiAnc291cmNlSWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1NvdXJjZSBpZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiAndGFyZ2V0SWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ1RhcmdldCBpZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3BhcmVudEx1TmFtZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnUGFyZW50IExVIE5hbWUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpY2tBYmxlOiBmYWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW46ICdwYXJlbnRTb3VyY2VJZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnUGFyZW50IFNvdXJjZSBJRCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ3BhcmVudFRhcmdldElkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6ICdQYXJlbnQgVGFyZ2V0IElEJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrQWJsZTogZmFsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1uOiAnY29weUVudGl0eVN0YXR1cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiAnRW50aXR5IFN0YXR1cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbjogJ2NvcHlIaWVyYXJjaHlTdGF0dXMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogJ0hpZXJhcmNoeSBEYXRhIFN0YXR1cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlja0FibGU6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2xpY2thYmxlQ29sID0gKGRhdGEsIHR5cGUsIGZ1bGwpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYDxhIG5nLWNsaWNrPVwidGFza1N0YXRzTW9kYWxDdHJsLnVwZGF0ZVBvcHVwKCcke2Z1bGwudGFyZ2V0SWR9JylcIj4gICR7ZGF0YX0gPC9hPmA7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGFza1N0YXRzTW9kYWxDdHJsLmhlYWRlcnNmRW50aXRpZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFza1N0YXRzTW9kYWxDdHJsLmhlYWRlcnNmRW50aXRpZXNbaV0uY2xpY2tBYmxlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5kdENvbHVtbnNmRW50aXRpZXMucHVzaChEVENvbHVtbkJ1aWxkZXIubmV3Q29sdW1uKHRhc2tTdGF0c01vZGFsQ3RybC5oZWFkZXJzZkVudGl0aWVzW2ldLmNvbHVtbikud2l0aFRpdGxlKHRhc2tTdGF0c01vZGFsQ3RybC5oZWFkZXJzZkVudGl0aWVzW2ldLm5hbWUpLnJlbmRlcldpdGgoY2xpY2thYmxlQ29sKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLmR0Q29sdW1uc2ZFbnRpdGllcy5wdXNoKERUQ29sdW1uQnVpbGRlci5uZXdDb2x1bW4odGFza1N0YXRzTW9kYWxDdHJsLmhlYWRlcnNmRW50aXRpZXNbaV0uY29sdW1uKS53aXRoVGl0bGUodGFza1N0YXRzTW9kYWxDdHJsLmhlYWRlcnNmRW50aXRpZXNbaV0ubmFtZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGdldFRhYmxlRGF0YSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUodGFza1N0YXRzTW9kYWxDdHJsLmZFbnRpdGllcyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuZHRPcHRpb25zZkVudGl0aWVzID0gRFRPcHRpb25zQnVpbGRlci5mcm9tRm5Qcm9taXNlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0VGFibGVEYXRhKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoRE9NKCdsVGZnaXRwJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAud2l0aE9wdGlvbignY3JlYXRlZFJvdycsIGZ1bmN0aW9uIChyb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVjb21waWxpbmcgc28gd2UgY2FuIGJpbmQgQW5ndWxhciBkaXJlY3RpdmUgdG8gdGhlIERUXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRjb21waWxlKGFuZ3VsYXIuZWxlbWVudChyb3cpLmNvbnRlbnRzKCkpKCRzY29wZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAud2l0aE9wdGlvbignc2Nyb2xsWCcsIGZhbHNlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdsZW5ndGhDaGFuZ2UnLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdwYWdpbmcnLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdzZWFyY2hpbmcnLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdpbmZvJywgdHJ1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAud2l0aE9wdGlvbihcImNhc2VJbnNlbnNpdGl2ZVwiLCB0cnVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC53aXRoT3B0aW9uKCdzZWFyY2gnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiY2FzZUluc2Vuc2l0aXZlXCI6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5kdEluc3RhbmNlQ2FsbGJhY2tmRW50aXRpZXMgPSBmdW5jdGlvbiAoZHRJbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24odGFza1N0YXRzTW9kYWxDdHJsLmR0SW5zdGFuY2VmRW50aXRpZXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5kdEluc3RhbmNlZkVudGl0aWVzKGR0SW5zdGFuY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoYW5ndWxhci5pc0RlZmluZWQodGFza1N0YXRzTW9kYWxDdHJsLmR0SW5zdGFuY2VmRW50aXRpZXMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5kdEluc3RhbmNlZkVudGl0aWVzID0gZHRJbnN0YW5jZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2tTdGF0c01vZGFsQ3RybC5kdEluc3RhbmNlZkVudGl0aWVzLmNoYW5nZURhdGEgIT0gbnVsbClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuZHRJbnN0YW5jZWZFbnRpdGllcy5jaGFuZ2VEYXRhKGdldFRhYmxlRGF0YSgpKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLmxvYWRpbmdUYWJsZUZhaWxlZEVudGl0aWVzID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFibGVEYXRhW1wiQ29waWVkIGVudGl0aWVzIHBlciBleGVjdXRpb25cIl0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwudG90YWxDb3BpZWRFbnRpdGllcyA9IHRhYmxlRGF0YVtcIkNvcGllZCBlbnRpdGllcyBwZXIgZXhlY3V0aW9uXCJdLk5vT2ZFbnRpdGllcztcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwuY0VudGl0aWVzID0gdGFibGVEYXRhW1wiQ29waWVkIGVudGl0aWVzIHBlciBleGVjdXRpb25cIl0uZW50aXRpZXNMaXN0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5jRW50aXRpZXNUaXRsZSA9IGAkeyRmaWx0ZXIoJ3RyYW5zbGF0ZScpKCdDT1BJRUQnKX0gJHskZmlsdGVyKCd0cmFuc2xhdGUnKSgnTElTVCcpfWBcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0YWJsZURhdGFbXCJGYWlsZWQgZW50aXRpZXMgcGVyIGV4ZWN1dGlvblwiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC50b3RhbEZhaWxlZEVudGl0aWVzID0gdGFibGVEYXRhW1wiRmFpbGVkIGVudGl0aWVzIHBlciBleGVjdXRpb25cIl0uTm9PZkVudGl0aWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5mRW50aXRpZXMgPSB0YWJsZURhdGFbXCJGYWlsZWQgZW50aXRpZXMgcGVyIGV4ZWN1dGlvblwiXS5lbnRpdGllc0xpc3Q7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLmZFbnRpdGllcyA9IHRhc2tTdGF0c01vZGFsQ3RybC5mRW50aXRpZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLmZFbnRpdGllc1RpdGxlID0gYCR7JGZpbHRlcigndHJhbnNsYXRlJykoJ0ZBSUxFRCcpfSAkeyRmaWx0ZXIoJ3RyYW5zbGF0ZScpKCdMSVNUJyl9YFxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwudG90YWxDb3BpZWRFbnRpdGllcyA9IDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwudG90YWxGYWlsZWRFbnRpdGllcyA9IDA7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5mRW50aXRpZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5jRW50aXRpZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5tYWtlVGFibGVzKGlzUm9vdCk7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC5sb2FkaW5nVGFibGVzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGFza1N0YXRzTW9kYWxDdHJsLnRhYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLnRhYiA9IDE7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRhc2tTdGF0c01vZGFsQ3RybC51cGRhdGVURE1TdGF0cyA9IGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLnNlbGVjdGVkTFUgPSBpdGVtO1xuICAgICAgICAgICAgICAgIGl0ZW0uY29sbGFwc2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmx1VHJlZU1lbnUuZm9yRWFjaChmdW5jdGlvbiAocm9vdCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5pc1Jvb3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvb3QuY29sbGFwc2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXRlbS5wYXJlbnRSb290THVOYW1lICE9PSByb290Lmx1X25hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb290LmNvbGxhcHNlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIHVubWFyayBhbGwgaXRlbXMgaW4gbHV0cmVlIG1lbnUgdG8gc2VsZWN0IG9ubHkgc2VsZWN0ZWQgaXRlbVxuICAgICAgICAgICAgICAgIGZvciAoaSBvZiAkc2NvcGUubHVUcmVlTWVudSkge1xuICAgICAgICAgICAgICAgICAgICBpLnNlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNoaWxkIG9mIGkuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGlsZC5zZWxlY3RlZCA9IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB0YXNrU3RhdHNNb2RhbEN0cmwucmVmcmVzaFRhYmxlKGl0ZW0pO1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgdmFyIHVwZGF0ZVRyZWUgPSBmdW5jdGlvbihlbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgaWYoIWVsZW1lbnQuY2hpbGRyZW4gfHwgZWxlbWVudC5jaGlsZHJlbi5sZW5ndGggPT0gMCl7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgICAgIHZhciBpO1xuICAgICAgICAgICAgICAgIGZvcihpID0gMDtpIDwgZWxlbWVudC5jaGlsZHJlbi5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgICAgIHVwZGF0ZVRyZWUoZWxlbWVudC5jaGlsZHJlbltpXSk7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBpZiAoZWxlbWVudC5jaGlsZHJlbiAmJiBlbGVtZW50LmNoaWxkcmVuLmxlbmd0aCA+IDEpe1xuICAgICAgICAgICAgICAgICAgIHZhciBuZXdDaGlsZHJlbiA9IFtdO1xuICAgICAgICAgICAgICAgICAgIHZhciBncm91cEJ5TFUgPSBfLmdyb3VwQnkoZWxlbWVudC5jaGlsZHJlbiwnbHVfbmFtZScpO1xuICAgICAgICAgICAgICAgICAgIGZvcih2YXIga2V5IGluIGdyb3VwQnlMVSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld0NoaWxkID0gZ3JvdXBCeUxVW2tleV1bMF07XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdDaGlsZC5icm90aGVycyA9IGdyb3VwQnlMVVtrZXldO1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGRyZW4ucHVzaChuZXdDaGlsZCk7XG4gICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuY2hpbGRyZW4gPSBuZXdDaGlsZHJlbjtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIHZhciBzZWFyY2hUcmVlID0gZnVuY3Rpb24gKGVsZW1lbnQsIGx1X25hbWUsIHRhcmdldF9pZCkge1xuICAgICAgICAgICAgICAgIGlmKGVsZW1lbnQubHVfbmFtZSA9PSBsdV9uYW1lICYmIGVsZW1lbnQudGFyZ2V0SWQgPT0gdGFyZ2V0X2lkKXtcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlbGVtZW50O1xuICAgICAgICAgICAgICAgIH1lbHNlIGlmIChlbGVtZW50LmNoaWxkcmVuICE9IG51bGwpe1xuICAgICAgICAgICAgICAgICAgICAgdmFyIGk7XG4gICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgIGZvcihpID0gMDsgcmVzdWx0ID09IG51bGwgJiYgaSA8IGVsZW1lbnQuY2hpbGRyZW4ubGVuZ3RoOyBpKyspe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gc2VhcmNoVHJlZShlbGVtZW50LmNoaWxkcmVuW2ldLCBsdV9uYW1lLCB0YXJnZXRfaWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxlbWVudC5jb2xsYXBzZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIFRETVNlcnZpY2UuZ2V0THVUcmVlKHtcbiAgICAgICAgICAgICAgICB0YXJnZXRJZDogJHNjb3BlLnRhcmdldElkLFxuICAgICAgICAgICAgICAgIGx1TmFtZTogJHNjb3BlLmx1TmFtZSxcbiAgICAgICAgICAgICAgICB0YXNrRXhlY3V0aW9uSWQ6ICRzY29wZS50YXNrRXhlY3V0aW9uSWRcbiAgICAgICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBudWxsO1xuICAgICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7aSA8IHJlc3BvbnNlLnJlc3VsdC5sZW5ndGg7IGkrKyl7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHNlYXJjaFRyZWUocmVzcG9uc2UucmVzdWx0W2ldLCAkc2NvcGUubHVOYW1lLCAkc2NvcGUudGFyZ2V0SWQpO1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVUcmVlKHJlc3BvbnNlLnJlc3VsdFtpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICRzY29wZS5sdVRyZWVNZW51ID0gcmVzcG9uc2UucmVzdWx0O1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFza1N0YXRzTW9kYWxDdHJsLnVwZGF0ZVRETVN0YXRzKHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICB0YXNrRXhlY3V0aW9uSWQ6ICc9JyxcbiAgICAgICAgICAgIHRhcmdldElkOiAnPScsXG4gICAgICAgICAgICBsdU5hbWU6ICc9JyxcbiAgICAgICAgICAgIHVwZGF0ZVBvcHVwOiAnPScsXG4gICAgICAgICAgICBjbG9zZTogJz0nXG4gICAgICAgIH1cbiAgICB9XG59XG5cbmFuZ3VsYXJcbiAgICAubW9kdWxlKCdURE0tRkUnKVxuICAgIC5kaXJlY3RpdmUoJ3Rhc2tTdGF0c01vZGFsRGlyZWN0aXZlJywgdGFza1N0YXRzTW9kYWxEaXJlY3RpdmUpOyJdfQ==
