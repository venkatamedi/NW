function referenceTask(){return{restrict:"E",templateUrl:"views/tasks/referenceTask.html",scope:{taskData:"=",logicalUnits:"=",logicalUnit:"="},controller:function($scope,TDMService,$timeout){var referenceTaskCtrl=this;console.log($scope.taskData);const init=()=>{var prevRefs=[];$scope.taskData&&$scope.taskData.refList&&(prevRefs=_.filter($scope.taskData.refList,{selected:!0})),referenceTaskCtrl.toDate=new Date,referenceTaskCtrl.fromDate=new Date,referenceTaskCtrl.fromDate.setDate(referenceTaskCtrl.fromDate.getDate()-30),referenceTaskCtrl.timeRange={fromDate:referenceTaskCtrl.fromDate,toDate:referenceTaskCtrl.toDate},referenceTaskCtrl.reloadVersionsTable={},$scope.taskData.refList=null,TDMService.postGenericAPI("task/getReferenceTaskTable",{task_type:["ON","FORCE"].indexOf($scope.taskData.sync_mode)>=0?"EXTRACT":$scope.taskData.task_type,version_ind:$scope.taskData.version_ind,logicalUnits:_.map($scope.logicalUnits,"lu_name")}).then((function(response){$scope.taskData.refList=_.map(response.result,(function(refTable){return refTable.lu_name=refTable.logical_unit_name||refTable.lu_name,refTable.logical_unit_name=refTable.lu_name,refTable.ref_table_name=refTable.reference_table_name||refTable.ref_table_name,refTable.reference_table_name=refTable.ref_table_name,_.find(prevRefs,{lu_name:refTable.logical_unit_name,interface_name:refTable.interface_name,schema_name:refTable.schema_name,ref_table_name:refTable.reference_table_name})&&(refTable.selected=!0),refTable})),referenceTaskCtrl.getVersionsData()}))};init(),$scope.$watch("logicalUnits",(newValue,oldValue)=>{newValue&&oldValue&&newValue.length!==oldValue.length&&init()}),referenceTaskCtrl.getVersionsData=function(){"LOAD"==$scope.taskData.task_type&&$scope.taskData.version_ind&&_.filter($scope.taskData.refList,{selected:!0}).length>0&&(referenceTaskCtrl.versionsTimeout&&$timeout.cancel(referenceTaskCtrl.versionsTimeout),referenceTaskCtrl.versionsTimeout=$timeout((function(){referenceTaskCtrl.loadingVersions=!0;var from=new Date(referenceTaskCtrl.timeRange.fromDate);from.setHours(0),from.setMinutes(0),from.setSeconds(0);var to=new Date(referenceTaskCtrl.timeRange.toDate);to.setHours(23),to.setMinutes(59),to.setSeconds(59),TDMService.postGenericAPI("task/getVersionReferenceTaskTable",{source_env_name:$scope.taskData.source_env_name,fromDate:from,toDate:to,lu_list:_.map($scope.logicalUnits,"lu_name"),refList:_.map(_.filter($scope.taskData.refList,{selected:!0}),"reference_table_name")}).then((function(response){if($scope.taskData.refLoadVersions=response.result,referenceTaskCtrl.refVersions=_.sortBy(response.result,(function(version){return-1*new Date(version.version_datetime)})),$timeout((function(){referenceTaskCtrl.reloadVersionsTable.dtInstanceVersions&&referenceTaskCtrl.reloadVersionsTable.dtInstanceVersions.reloadData&&referenceTaskCtrl.reloadVersionsTable.dtInstanceVersions.reloadData((function(){}))}),100),$scope.taskData.selected_ref_version_task_exe_id){var selectedRefVersion=_.find(referenceTaskCtrl.refVersions,{task_execution_id:$scope.taskData.selected_ref_version_task_exe_id});selectedRefVersion&&($scope.taskData.selectedRefVersionToLoad=selectedRefVersion.task_execution_id),$scope.taskData.selected_ref_version_task_exe_id=null}referenceTaskCtrl.loadingVersions=!1}))}),300))}},controllerAs:"referenceTaskCtrl"}}angular.module("TDM-FE").directive("referenceTask",referenceTask);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRpcmVjdGl2ZXMvdGFza3MvcmVmZXJlbmNlVGFza0RpcmVjdGl2ZS5qcyJdLCJuYW1lcyI6WyJyZWZlcmVuY2VUYXNrIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZVVybCIsInNjb3BlIiwidGFza0RhdGEiLCJsb2dpY2FsVW5pdHMiLCJsb2dpY2FsVW5pdCIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCJURE1TZXJ2aWNlIiwiJHRpbWVvdXQiLCJyZWZlcmVuY2VUYXNrQ3RybCIsInRoaXMiLCJjb25zb2xlIiwibG9nIiwiaW5pdCIsInByZXZSZWZzIiwicmVmTGlzdCIsIl8iLCJmaWx0ZXIiLCJzZWxlY3RlZCIsInRvRGF0ZSIsIkRhdGUiLCJmcm9tRGF0ZSIsInNldERhdGUiLCJnZXREYXRlIiwidGltZVJhbmdlIiwicmVsb2FkVmVyc2lvbnNUYWJsZSIsInBvc3RHZW5lcmljQVBJIiwidGFza190eXBlIiwiaW5kZXhPZiIsInN5bmNfbW9kZSIsInZlcnNpb25faW5kIiwibWFwIiwidGhlbiIsInJlc3BvbnNlIiwicmVzdWx0IiwicmVmVGFibGUiLCJsdV9uYW1lIiwibG9naWNhbF91bml0X25hbWUiLCJyZWZfdGFibGVfbmFtZSIsInJlZmVyZW5jZV90YWJsZV9uYW1lIiwiZmluZCIsImludGVyZmFjZV9uYW1lIiwic2NoZW1hX25hbWUiLCJnZXRWZXJzaW9uc0RhdGEiLCIkd2F0Y2giLCJuZXdWYWx1ZSIsIm9sZFZhbHVlIiwibGVuZ3RoIiwidmVyc2lvbnNUaW1lb3V0IiwiY2FuY2VsIiwibG9hZGluZ1ZlcnNpb25zIiwiZnJvbSIsInNldEhvdXJzIiwic2V0TWludXRlcyIsInNldFNlY29uZHMiLCJ0byIsInNvdXJjZV9lbnZfbmFtZSIsImx1X2xpc3QiLCJyZWZMb2FkVmVyc2lvbnMiLCJyZWZWZXJzaW9ucyIsInNvcnRCeSIsInZlcnNpb24iLCJ2ZXJzaW9uX2RhdGV0aW1lIiwiZHRJbnN0YW5jZVZlcnNpb25zIiwicmVsb2FkRGF0YSIsInNlbGVjdGVkX3JlZl92ZXJzaW9uX3Rhc2tfZXhlX2lkIiwic2VsZWN0ZWRSZWZWZXJzaW9uIiwidGFza19leGVjdXRpb25faWQiLCJzZWxlY3RlZFJlZlZlcnNpb25Ub0xvYWQiLCJjb250cm9sbGVyQXMiLCJhbmd1bGFyIiwibW9kdWxlIiwiZGlyZWN0aXZlIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxnQkE0R0wsTUFBTyxDQUNIQyxTQUFVLElBQ1ZDLFlBNUdXLGlDQTZHWEMsTUFBTyxDQUNIQyxTQUFVLElBQ1ZDLGFBQWMsSUFDZEMsWUFBYSxLQUVqQkMsV0FoSGEsU0FBVUMsT0FBT0MsV0FBV0MsVUFDekMsSUFBSUMsa0JBQW9CQyxLQUN4QkMsUUFBUUMsSUFBSU4sT0FBT0osVUFNbkIsTUFBTVcsS0FBTyxLQUNULElBQUlDLFNBQVcsR0FDWFIsT0FBT0osVUFBWUksT0FBT0osU0FBU2EsVUFDbkNELFNBQVdFLEVBQUVDLE9BQU9YLE9BQU9KLFNBQVNhLFFBQVEsQ0FBQ0csVUFBVyxLQUU1RFQsa0JBQWtCVSxPQUFTLElBQUlDLEtBQy9CWCxrQkFBa0JZLFNBQVcsSUFBSUQsS0FDakNYLGtCQUFrQlksU0FBU0MsUUFBUWIsa0JBQWtCWSxTQUFTRSxVQUFZLElBQzFFZCxrQkFBa0JlLFVBQVksQ0FDMUJILFNBQVdaLGtCQUFrQlksU0FDN0JGLE9BQVNWLGtCQUFrQlUsUUFFL0JWLGtCQUFrQmdCLG9CQUFzQixHQUN4Q25CLE9BQU9KLFNBQVNhLFFBQVUsS0FFMUJSLFdBQVdtQixlQUFlLDZCQUE2QixDQUNuREMsVUFBWSxDQUFDLEtBQU0sU0FBU0MsUUFBUXRCLE9BQU9KLFNBQVMyQixZQUFjLEVBQUksVUFBWXZCLE9BQU9KLFNBQVN5QixVQUNsR0csWUFBY3hCLE9BQU9KLFNBQVM0QixZQUM5QjNCLGFBQWVhLEVBQUVlLElBQUl6QixPQUFPSCxhQUFhLGFBQzFDNkIsTUFBSyxTQUFTQyxVQUNiM0IsT0FBT0osU0FBU2EsUUFBVUMsRUFBRWUsSUFBSUUsU0FBU0MsUUFBTyxTQUFTQyxVQWFyRCxPQVpBQSxTQUFTQyxRQUFVRCxTQUFTRSxtQkFBcUJGLFNBQVNDLFFBQzFERCxTQUFTRSxrQkFBb0JGLFNBQVNDLFFBQ3RDRCxTQUFTRyxlQUFpQkgsU0FBU0ksc0JBQXdCSixTQUFTRyxlQUNwRUgsU0FBU0kscUJBQXVCSixTQUFTRyxlQUN0Q3RCLEVBQUV3QixLQUFLMUIsU0FBUyxDQUNmc0IsUUFBVUQsU0FBU0Usa0JBQ25CSSxlQUFnQk4sU0FBU00sZUFDekJDLFlBQWNQLFNBQVNPLFlBQ3ZCSixlQUFpQkgsU0FBU0kseUJBRTFCSixTQUFTakIsVUFBVyxHQUVqQmlCLFlBRVgxQixrQkFBa0JrQyxzQkFJMUI5QixPQUVBUCxPQUFPc0MsT0FBTyxlQUFlLENBQUNDLFNBQVNDLFlBQy9CRCxVQUFZQyxVQUFZRCxTQUFTRSxTQUFXRCxTQUFTQyxRQUNyRGxDLFNBSVJKLGtCQUFrQmtDLGdCQUFrQixXQUNDLFFBQTdCckMsT0FBT0osU0FBU3lCLFdBQXVCckIsT0FBT0osU0FBUzRCLGFBQ25EZCxFQUFFQyxPQUFPWCxPQUFPSixTQUFTYSxRQUFRLENBQUNHLFVBQVUsSUFBTzZCLE9BQVMsSUFDekR0QyxrQkFBa0J1QyxpQkFDakJ4QyxTQUFTeUMsT0FBT3hDLGtCQUFrQnVDLGlCQUV0Q3ZDLGtCQUFrQnVDLGdCQUFrQnhDLFVBQVMsV0FDekNDLGtCQUFrQnlDLGlCQUFrQixFQUNwQyxJQUFJQyxLQUFPLElBQUkvQixLQUFLWCxrQkFBa0JlLFVBQVVILFVBQ2hEOEIsS0FBS0MsU0FBUyxHQUNkRCxLQUFLRSxXQUFXLEdBQ2hCRixLQUFLRyxXQUFXLEdBQ2hCLElBQUlDLEdBQUssSUFBSW5DLEtBQUtYLGtCQUFrQmUsVUFBVUwsUUFDOUNvQyxHQUFHSCxTQUFTLElBQ1pHLEdBQUdGLFdBQVcsSUFDZEUsR0FBR0QsV0FBVyxJQUNkL0MsV0FBV21CLGVBQWUsb0NBQW9DLENBQzFEOEIsZ0JBQWtCbEQsT0FBT0osU0FBU3NELGdCQUNsQ25DLFNBQVc4QixLQUNYaEMsT0FBU29DLEdBQ1RFLFFBQVV6QyxFQUFFZSxJQUFJekIsT0FBT0gsYUFBYyxXQUNyQ1ksUUFBVUMsRUFBRWUsSUFBSWYsRUFBRUMsT0FBT1gsT0FBT0osU0FBU2EsUUFBUSxDQUFDRyxVQUFVLElBQU8sMEJBQ3BFYyxNQUFLLFNBQVNDLFVBWWIsR0FYQTNCLE9BQU9KLFNBQVN3RCxnQkFBa0J6QixTQUFTQyxPQUMzQ3pCLGtCQUFrQmtELFlBQWMzQyxFQUFFNEMsT0FBTzNCLFNBQVNDLFFBQVEsU0FBUzJCLFNBQy9ELE9BQVEsRUFBSSxJQUFJekMsS0FBS3lDLFFBQVFDLHFCQUVqQ3RELFVBQVMsV0FDREMsa0JBQWtCZ0Isb0JBQW9Cc0Msb0JBQXNCdEQsa0JBQWtCZ0Isb0JBQW9Cc0MsbUJBQW1CQyxZQUNySHZELGtCQUFrQmdCLG9CQUFvQnNDLG1CQUFtQkMsWUFBVyxpQkFJMUUsS0FDRTFELE9BQU9KLFNBQVMrRCxpQ0FBaUMsQ0FDakQsSUFBSUMsbUJBQXFCbEQsRUFBRXdCLEtBQUsvQixrQkFBa0JrRCxZQUFZLENBQUNRLGtCQUFvQjdELE9BQU9KLFNBQVMrRCxtQ0FDL0ZDLHFCQUNBNUQsT0FBT0osU0FBU2tFLHlCQUEyQkYsbUJBQW1CQyxtQkFFbEU3RCxPQUFPSixTQUFTK0QsaUNBQW1DLEtBRXZEeEQsa0JBQWtCeUMsaUJBQWtCLE9BRTFDLFFBZWRtQixhQUFjLHFCQUt0QkMsUUFDS0MsT0FBTyxVQUNQQyxVQUFVLGdCQUFpQjFFIiwiZmlsZSI6ImRpcmVjdGl2ZXMvdGFza3MvcmVmZXJlbmNlVGFza0RpcmVjdGl2ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHJlZmVyZW5jZVRhc2sgKCl7XG5cbiAgICB2YXIgdGVtcGxhdGUgPSBcInZpZXdzL3Rhc2tzL3JlZmVyZW5jZVRhc2suaHRtbFwiO1xuXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLFRETVNlcnZpY2UsJHRpbWVvdXQpIHtcbiAgICAgICAgdmFyIHJlZmVyZW5jZVRhc2tDdHJsID0gdGhpcztcbiAgICAgICAgY29uc29sZS5sb2coJHNjb3BlLnRhc2tEYXRhKTtcbiAgICAgICAgLy92YXIgbG9naWNhbFVuaXRzID0gJHNjb3BlLmxvZ2ljYWxVbml0cztcbiAgICAgICAgLy8gaWYgKCEoJHNjb3BlLnRhc2tEYXRhLnRhc2tfdHlwZSA9PSAnTE9BRCcgJiYgISRzY29wZS50YXNrRGF0YS52ZXJzaW9uX2luZCkpe1xuICAgICAgICAvLyAgICAgbG9naWNhbFVuaXRzID0gWyRzY29wZS5sb2dpY2FsVW5pdF07XG4gICAgICAgIC8vIH1cblxuICAgICAgICBjb25zdCBpbml0ID0gKCkgPT4ge1xuICAgICAgICAgICAgdmFyIHByZXZSZWZzID0gW107XG4gICAgICAgICAgICBpZiAoJHNjb3BlLnRhc2tEYXRhICYmICRzY29wZS50YXNrRGF0YS5yZWZMaXN0KXtcbiAgICAgICAgICAgICAgICBwcmV2UmVmcyA9IF8uZmlsdGVyKCRzY29wZS50YXNrRGF0YS5yZWZMaXN0LHtzZWxlY3RlZCA6IHRydWV9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlZmVyZW5jZVRhc2tDdHJsLnRvRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICByZWZlcmVuY2VUYXNrQ3RybC5mcm9tRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgICAgICAgICByZWZlcmVuY2VUYXNrQ3RybC5mcm9tRGF0ZS5zZXREYXRlKHJlZmVyZW5jZVRhc2tDdHJsLmZyb21EYXRlLmdldERhdGUoKSAtIDMwKTtcbiAgICAgICAgICAgIHJlZmVyZW5jZVRhc2tDdHJsLnRpbWVSYW5nZSA9IHtcbiAgICAgICAgICAgICAgICBmcm9tRGF0ZSA6IHJlZmVyZW5jZVRhc2tDdHJsLmZyb21EYXRlLFxuICAgICAgICAgICAgICAgIHRvRGF0ZSA6IHJlZmVyZW5jZVRhc2tDdHJsLnRvRGF0ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlZmVyZW5jZVRhc2tDdHJsLnJlbG9hZFZlcnNpb25zVGFibGUgPSB7fTtcbiAgICAgICAgICAgICRzY29wZS50YXNrRGF0YS5yZWZMaXN0ID0gbnVsbDtcbiAgICBcbiAgICAgICAgICAgIFRETVNlcnZpY2UucG9zdEdlbmVyaWNBUEkoJ3Rhc2svZ2V0UmVmZXJlbmNlVGFza1RhYmxlJyx7XG4gICAgICAgICAgICAgICAgdGFza190eXBlIDogWydPTicsICdGT1JDRSddLmluZGV4T2YoJHNjb3BlLnRhc2tEYXRhLnN5bmNfbW9kZSkgPj0gMCA/ICdFWFRSQUNUJyA6ICRzY29wZS50YXNrRGF0YS50YXNrX3R5cGUsXG4gICAgICAgICAgICAgICAgdmVyc2lvbl9pbmQgOiAkc2NvcGUudGFza0RhdGEudmVyc2lvbl9pbmQsXG4gICAgICAgICAgICAgICAgbG9naWNhbFVuaXRzIDogXy5tYXAoJHNjb3BlLmxvZ2ljYWxVbml0cywnbHVfbmFtZScpXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICAkc2NvcGUudGFza0RhdGEucmVmTGlzdCA9IF8ubWFwKHJlc3BvbnNlLnJlc3VsdCxmdW5jdGlvbihyZWZUYWJsZSl7XG4gICAgICAgICAgICAgICAgICAgIHJlZlRhYmxlLmx1X25hbWUgPSByZWZUYWJsZS5sb2dpY2FsX3VuaXRfbmFtZSB8fCByZWZUYWJsZS5sdV9uYW1lO1xuICAgICAgICAgICAgICAgICAgICByZWZUYWJsZS5sb2dpY2FsX3VuaXRfbmFtZSA9IHJlZlRhYmxlLmx1X25hbWU7XG4gICAgICAgICAgICAgICAgICAgIHJlZlRhYmxlLnJlZl90YWJsZV9uYW1lID0gcmVmVGFibGUucmVmZXJlbmNlX3RhYmxlX25hbWUgfHwgcmVmVGFibGUucmVmX3RhYmxlX25hbWU7XG4gICAgICAgICAgICAgICAgICAgIHJlZlRhYmxlLnJlZmVyZW5jZV90YWJsZV9uYW1lID0gcmVmVGFibGUucmVmX3RhYmxlX25hbWU7XG4gICAgICAgICAgICAgICAgICAgIGlmKF8uZmluZChwcmV2UmVmcyx7XG4gICAgICAgICAgICAgICAgICAgICAgICBsdV9uYW1lIDogcmVmVGFibGUubG9naWNhbF91bml0X25hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnRlcmZhY2VfbmFtZTogcmVmVGFibGUuaW50ZXJmYWNlX25hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2hlbWFfbmFtZSA6IHJlZlRhYmxlLnNjaGVtYV9uYW1lLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZl90YWJsZV9uYW1lIDogcmVmVGFibGUucmVmZXJlbmNlX3RhYmxlX25hbWVcbiAgICAgICAgICAgICAgICAgICAgfSkpe1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVmVGFibGUuc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWZUYWJsZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VUYXNrQ3RybC5nZXRWZXJzaW9uc0RhdGEoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGluaXQoKTtcblxuICAgICAgICAkc2NvcGUuJHdhdGNoKCdsb2dpY2FsVW5pdHMnLChuZXdWYWx1ZSxvbGRWYWx1ZSkgPT4ge1xuICAgICAgICAgICAgaWYgKG5ld1ZhbHVlICYmIG9sZFZhbHVlICYmIG5ld1ZhbHVlLmxlbmd0aCAhPT0gb2xkVmFsdWUubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgaW5pdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICByZWZlcmVuY2VUYXNrQ3RybC5nZXRWZXJzaW9uc0RhdGEgPSBmdW5jdGlvbigpe1xuICAgICAgICAgICAgaWYgKCRzY29wZS50YXNrRGF0YS50YXNrX3R5cGUgPT0gJ0xPQUQnICYmICRzY29wZS50YXNrRGF0YS52ZXJzaW9uX2luZCl7XG4gICAgICAgICAgICAgICAgaWYgKF8uZmlsdGVyKCRzY29wZS50YXNrRGF0YS5yZWZMaXN0LHtzZWxlY3RlZDogdHJ1ZX0pLmxlbmd0aCA+IDApe1xuICAgICAgICAgICAgICAgICAgICBpZihyZWZlcmVuY2VUYXNrQ3RybC52ZXJzaW9uc1RpbWVvdXQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHJlZmVyZW5jZVRhc2tDdHJsLnZlcnNpb25zVGltZW91dCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlVGFza0N0cmwudmVyc2lvbnNUaW1lb3V0ID0gJHRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVRhc2tDdHJsLmxvYWRpbmdWZXJzaW9ucyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZnJvbSA9IG5ldyBEYXRlKHJlZmVyZW5jZVRhc2tDdHJsLnRpbWVSYW5nZS5mcm9tRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBmcm9tLnNldEhvdXJzKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbS5zZXRNaW51dGVzKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbS5zZXRTZWNvbmRzKDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRvID0gbmV3IERhdGUocmVmZXJlbmNlVGFza0N0cmwudGltZVJhbmdlLnRvRGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0by5zZXRIb3VycygyMyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0by5zZXRNaW51dGVzKDU5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvLnNldFNlY29uZHMoNTkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgVERNU2VydmljZS5wb3N0R2VuZXJpY0FQSSgndGFzay9nZXRWZXJzaW9uUmVmZXJlbmNlVGFza1RhYmxlJyx7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlX2Vudl9uYW1lIDogJHNjb3BlLnRhc2tEYXRhLnNvdXJjZV9lbnZfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tRGF0ZSA6IGZyb20sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9EYXRlIDogdG8sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbHVfbGlzdCA6IF8ubWFwKCRzY29wZS5sb2dpY2FsVW5pdHMsICdsdV9uYW1lJyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmTGlzdCA6IF8ubWFwKF8uZmlsdGVyKCRzY29wZS50YXNrRGF0YS5yZWZMaXN0LHtzZWxlY3RlZDogdHJ1ZX0pLCdyZWZlcmVuY2VfdGFibGVfbmFtZScpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUudGFza0RhdGEucmVmTG9hZFZlcnNpb25zID0gcmVzcG9uc2UucmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZmVyZW5jZVRhc2tDdHJsLnJlZlZlcnNpb25zID0gXy5zb3J0QnkocmVzcG9uc2UucmVzdWx0LCBmdW5jdGlvbih2ZXJzaW9uKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIC0xICogbmV3IERhdGUodmVyc2lvbi52ZXJzaW9uX2RhdGV0aW1lKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVmZXJlbmNlVGFza0N0cmwucmVsb2FkVmVyc2lvbnNUYWJsZS5kdEluc3RhbmNlVmVyc2lvbnMgJiYgcmVmZXJlbmNlVGFza0N0cmwucmVsb2FkVmVyc2lvbnNUYWJsZS5kdEluc3RhbmNlVmVyc2lvbnMucmVsb2FkRGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWZlcmVuY2VUYXNrQ3RybC5yZWxvYWRWZXJzaW9uc1RhYmxlLmR0SW5zdGFuY2VWZXJzaW9ucy5yZWxvYWREYXRhKGZ1bmN0aW9uKCl7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LDEwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRzY29wZS50YXNrRGF0YS5zZWxlY3RlZF9yZWZfdmVyc2lvbl90YXNrX2V4ZV9pZCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFJlZlZlcnNpb24gPSBfLmZpbmQocmVmZXJlbmNlVGFza0N0cmwucmVmVmVyc2lvbnMse3Rhc2tfZXhlY3V0aW9uX2lkIDogJHNjb3BlLnRhc2tEYXRhLnNlbGVjdGVkX3JlZl92ZXJzaW9uX3Rhc2tfZXhlX2lkfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZFJlZlZlcnNpb24peyAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS50YXNrRGF0YS5zZWxlY3RlZFJlZlZlcnNpb25Ub0xvYWQgPSBzZWxlY3RlZFJlZlZlcnNpb24udGFza19leGVjdXRpb25faWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnRhc2tEYXRhLnNlbGVjdGVkX3JlZl92ZXJzaW9uX3Rhc2tfZXhlX2lkID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmZXJlbmNlVGFza0N0cmwubG9hZGluZ1ZlcnNpb25zID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSwzMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4ge1xuICAgICAgICByZXN0cmljdDogXCJFXCIsXG4gICAgICAgIHRlbXBsYXRlVXJsOiB0ZW1wbGF0ZSxcbiAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgIHRhc2tEYXRhOiAnPScsXG4gICAgICAgICAgICBsb2dpY2FsVW5pdHM6ICc9JyxcbiAgICAgICAgICAgIGxvZ2ljYWxVbml0OiAnPScsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRyb2xsZXI6IGNvbnRyb2xsZXIsXG4gICAgICAgIGNvbnRyb2xsZXJBcyA6J3JlZmVyZW5jZVRhc2tDdHJsJ1xuICAgIH07XG59XG5cblxuYW5ndWxhclxuICAgIC5tb2R1bGUoJ1RETS1GRScpXG4gICAgLmRpcmVjdGl2ZSgncmVmZXJlbmNlVGFzaycsIHJlZmVyZW5jZVRhc2spOyJdfQ==
