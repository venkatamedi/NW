function taskMain(){return{restrict:"E",templateUrl:"js/components/task/taskMain/taskMain.html",scope:{content:"="},controller:function($scope,TDMService,BreadCrumbsService,SweetAlert,$uibModal,toastr,$timeout,AuthService,$state,DTOptionsBuilder,DTColumnBuilder,$q,$compile){var taskMainCtrl=this;taskMainCtrl.editTask="create"!==$scope.content.mode,taskMainCtrl.tasks=$scope.content.tasks,taskMainCtrl.minDate=new Date,taskMainCtrl.minDate=moment(taskMainCtrl.minDate),taskMainCtrl.minDate.milliseconds(0),taskMainCtrl.minDate.seconds(0),taskMainCtrl.minDate.minutes(0),taskMainCtrl.minDate.hours(0),taskMainCtrl.minDate.add(1,"days"),taskMainCtrl.schedulerOptions={formInputClass:"form-control1 cron-gen-input",formSelectClass:"form-control1 cron-gen-select",formRadioClass:"cron-gen-radio",formCheckboxClass:"cron-gen-checkbox",hideMinutesTab:!1,hideHourlyTab:!1,hideDailyTab:!1,hideWeeklyTab:!1,hideMonthlyTab:!1,hideYearlyTab:!1,hideAdvancedTab:!1,use24HourTime:!0,hideSeconds:!1},taskMainCtrl.timeZoneOffset=AuthService.getTimeZone(),taskMainCtrl.getStepsArray=function(){var stepsArray=[];return stepsArray.push(1),stepsArray.push(2),"refernceOnly"!==taskMainCtrl.taskData.reference&&stepsArray.push(3),taskMainCtrl.taskData.task_globals&&stepsArray.push(4),null!=taskMainCtrl.taskData.reference&&stepsArray.push(5),stepsArray.push(6),stepsArray},taskMainCtrl.nextStep=()=>{const steps=taskMainCtrl.getStepsArray(),currentStepIndex=steps.indexOf(taskMainCtrl.step);return currentStepIndex>=0&&currentStepIndex<steps.length-1?steps[currentStepIndex+1]:(console.error("There is no next step"),taskMainCtrl.step)},taskMainCtrl.back=()=>{const steps=taskMainCtrl.getStepsArray(),currentStepIndex=steps.indexOf(taskMainCtrl.step);if(currentStepIndex>0){if(3===taskMainCtrl.step&&currentStepIndex<taskMainCtrl.step&&"C"===taskMainCtrl.taskData.selection_method){const params={inputs:(taskMainCtrl.taskData.CustomLogicParams||[]).map(it=>({name:it.name,type:it.type,value:it.value}))};taskMainCtrl.taskData.parameters=JSON.stringify(params)}taskMainCtrl.step=steps[currentStepIndex-1]}else console.error("This is the First Step cannot go back")},taskMainCtrl.getTabSubtitle=()=>{let text="";return"EXTRACT"===taskMainCtrl.taskData.task_type?text="For an Extract Task":"RESERVE"===taskMainCtrl.taskData.task_type?text="For a Reserve Task":"LOAD"===taskMainCtrl.taskData.task_type&&(text=!taskMainCtrl.taskData.load_entity&&taskMainCtrl.taskData.delete_before_load?"For a Delete Task":"For a Load Task"),text},taskMainCtrl.generalNext=function(form,nextStep){taskMainCtrl.editTask&&!taskMainCtrl.copyTask||(_.find(taskMainCtrl.tasks,{task_title:taskMainCtrl.taskData.task_title,task_status:"Active"})?$scope.generalForm.taskTitle.$setValidity("alreadyExist",!1):$scope.generalForm.taskTitle.$setValidity("alreadyExist",!0)),$scope.generalForm.taskLogicalUnit.$setValidity("gap",!0),$scope.generalForm.taskLogicalUnit.$setValidity("missingParent",!0);let isSelectedLU=lu_name=>_.find(taskMainCtrl.taskData.selectedLogicalUnits,{lu_name:lu_name}),checkIfRootIsMissing=()=>{for(lu of($scope.generalForm.taskLogicalUnit.$setValidity("missingParent",!0),taskMainCtrl.taskData.missingRootLU=[],taskMainCtrl.taskData.selectedLogicalUnits))if(lu.lu_parent_name){const luParent=_.find(taskMainCtrl.taskData.allLogicalUnits,{lu_name:lu.lu_parent_name});luParent&&(luParent.lu_parent_name||isSelectedLU(luParent.lu_name)||($scope.generalForm.taskLogicalUnit.$setValidity("missingParent",!1),taskMainCtrl.taskData.missingRootLU.push(luParent.lu_name)))}};taskMainCtrl.taskData.selectedLogicalUnits&&taskMainCtrl.taskData.selectedLogicalUnits.length>0&&taskMainCtrl.taskData.selectedLogicalUnits.forEach(lu=>{(lu=>{if(lu.lu_parent_name&&!isSelectedLU(lu.lu_parent_name)){const luParent=_.find(taskMainCtrl.taskData.allLogicalUnits,{lu_name:lu.lu_parent_name});luParent&&luParent.lu_parent_name&&isSelectedLU(luParent.lu_parent_name)&&($scope.generalForm.taskLogicalUnit.$setValidity("gap",!1),taskMainCtrl.missingUnitInGap=luParent.lu_name)}})(lu),checkIfRootIsMissing()}),form.submitted=!0,form.$valid&&(taskMainCtrl.step=nextStep||taskMainCtrl.nextStep(),getRoleData()),taskMainCtrl.generalForm=form},taskMainCtrl.additionalExecutionParametersNext=function(form,nextStep){form.submitted=!0,form.$valid&&(taskMainCtrl.taskData.replace_sequences&&(taskMainCtrl.taskData.filterout_reserved=!1),taskMainCtrl.step=nextStep||taskMainCtrl.nextStep()),taskMainCtrl.additionalExecutionParametersForm=form},taskMainCtrl.validateData=()=>{let validateReserveEntites=!1,validateVerions=!1;const promises=[];if("EXTRACT"===taskMainCtrl.taskData.task_type||"L"!==taskMainCtrl.taskData.selection_method||taskMainCtrl.taskData.replace_sequences||(validateReserveEntites=!0,promises.push(TDMService.postGenericAPI("validateReservedEntitiesList",{beID:taskMainCtrl.taskData.be_id,envID:taskMainCtrl.taskData.environment_id,listOfEntities:taskMainCtrl.taskData.selection_param_value.split(",").map(it=>({target_entity_id:it}))}))),"LOAD"===taskMainCtrl.taskData.task_type&&taskMainCtrl.taskData.load_entity&&taskMainCtrl.taskData.version_ind&&"ALL"!==taskMainCtrl.taskData.selection_method){if(!taskMainCtrl.taskData.selectedVersionToLoad)return taskMainCtrl.requestedEntitiesForm=$scope.requestedEntitiesForm,void($scope.requestedEntitiesForm.submitted=!0);var selectedVersionToLoad=_.find(taskMainCtrl.taskData.versionsForLoad,{fabric_execution_id:taskMainCtrl.taskData.selectedVersionToLoad}),taskExecutionId="",luNames="";selectedVersionToLoad&&(taskExecutionId=selectedVersionToLoad.task_execution_id,luNames=taskMainCtrl.taskData.versionsForLoad.filter(version=>version.task_execution_id===selectedVersionToLoad.task_execution_id).map(version=>({lu_name:version.lu_name}))),validateVerions=!0,promises.push(TDMService.postGenericAPI("tasks/validateVersionForLoad",{entitiesList:taskMainCtrl.taskData.selection_param_value,taskExecId:taskExecutionId,lu_list:luNames}))}return new Promise((resolve,reject)=>{0!==promises.length?Promise.all(promises).then(results=>{validateVerions&&"FAILED"===results[1].errorCode?SweetAlert.swal({title:`The hierarchy of entities ${results[1].message} has not been created properly in the selected version. Are you sure that you want to select this version?`,text:results[0].message,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"No",cancelButtonText:"Yes",closeOnConfirm:!0,closeOnCancel:!0,animation:"false",customClass:"animated fadeInUp"},(function(isConfirm){isConfirm?reject():resolve()})):validateReserveEntites&&results[0].message?SweetAlert.swal({title:"The following entities are already reserved by other users. Are you sure that you want to save the task?",text:results[0].message,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"No",cancelButtonText:"Yes",closeOnConfirm:!0,closeOnCancel:!0,animation:"false",customClass:"animated fadeInUp"},(function(isConfirm){isConfirm?reject():resolve()})):resolve()}):resolve(!0)})},taskMainCtrl.requestedEntitiesNext=function(form,nextStep){if(form.submitted=!0,form.$valid){if("C"===taskMainCtrl.taskData.selection_method){const params={inputs:(taskMainCtrl.taskData.CustomLogicParams||[]).map(it=>({name:it.name,type:it.type,value:it.value}))};taskMainCtrl.taskData.parameters=JSON.stringify(params)}taskMainCtrl.validateData().then(()=>{$timeout(()=>{taskMainCtrl.step=nextStep||taskMainCtrl.nextStep()})}).catch(err=>{})}taskMainCtrl.requestedEntitiesForm=form},taskMainCtrl.referenceNext=function(form,nextStep){form.submitted=!0,form.$setValidity("emptyList",!0),0!=_.filter(taskMainCtrl.taskData.refList,{selected:!0}).length?(taskMainCtrl.ReferenceForm=form,taskMainCtrl.step=nextStep||taskMainCtrl.nextStep()):form.$setValidity("emptyList",!1)},taskMainCtrl.globalsNext=function(form,nextStep){taskMainCtrl.step=nextStep||taskMainCtrl.nextStep(),taskMainCtrl.AddGlobalForm=form},taskMainCtrl.TaskSchedulingNext=(form,nextStep)=>{if(form.$valid||1==taskMainCtrl.disableChange){if(!$scope.generalForm.$valid)return void(taskMainCtrl.step=nextStep||1);if(taskMainCtrl.taskData.reference&&0==_.filter(taskMainCtrl.taskData.refList,{selected:!0}).length)return void(taskMainCtrl.step=nextStep||5);if(!$scope.requestedEntitiesForm.$valid)return void(taskMainCtrl.step=nextStep||3);if(!$scope.additionalExecutionParametersForm.$valid)return void(taskMainCtrl.step=nextStep||2);taskMainCtrl.saveTask()}else form.submitted=!0;taskMainCtrl.TaskSchedulingForm=form},taskMainCtrl.editTask?taskMainCtrl.taskData=angular.copy($scope.content.task):taskMainCtrl.taskData={filterout_reserved:!0},taskMainCtrl.submitForm=function(step,nextStep){if(!taskMainCtrl.taskData.allLogicalUnits)return;const steps=taskMainCtrl.getStepsArray();if(step!==nextStep)if(steps.indexOf(step)>steps.indexOf(nextStep))taskMainCtrl.openStep(nextStep,"back");else switch(step){case 1:$scope.generalForm.$setSubmitted(),taskMainCtrl.generalNext($scope.generalForm,nextStep);break;case 2:$scope.additionalExecutionParametersForm.$setSubmitted(),taskMainCtrl.additionalExecutionParametersNext($scope.additionalExecutionParametersForm,nextStep);break;case 3:$scope.requestedEntitiesForm.$setSubmitted(),taskMainCtrl.requestedEntitiesNext($scope.requestedEntitiesForm,nextStep);break;case 4:$scope.AddGlobalForm.$setSubmitted(),taskMainCtrl.globalsNext($scope.AddGlobalForm,nextStep);break;case 5:$scope.ReferenceForm.$setSubmitted(),taskMainCtrl.referenceNext(ReferenceForm,nextStep);break;case 6:$scope.TaskSchedulingForm.$setSubmitted(),taskMainCtrl.TaskSchedulingNext($scope.TaskSchedulingForm,nextStep)}},taskMainCtrl.step=1;var userRole=AuthService.getRole(),username=AuthService.getUsername();taskMainCtrl.copyTask=$scope.content.copy,taskMainCtrl.copyTask&&(taskMainCtrl.taskData.task_title=taskMainCtrl.taskData.task_title+" Copy"),taskMainCtrl.editTask&&("EXTRACT"!==taskMainCtrl.taskData.task_type||taskMainCtrl.taskData.version_ind||taskMainCtrl.taskData.retention_period_value||(taskMainCtrl.taskData.retention_period_value=0),"REF"==taskMainCtrl.taskData.selection_method?taskMainCtrl.taskData.reference="refernceOnly":taskMainCtrl.taskData.refcount>0&&(taskMainCtrl.taskData.reference="both"),taskMainCtrl.taskData.reference&&TDMService.getGenericAPI("task/refsTable/"+taskMainCtrl.taskData.task_id).then((function(response){taskMainCtrl.taskData.refList=_.map(response.result,(function(ref){return ref.selected=!0,ref}))})),taskMainCtrl.disableChange="Inactive"==taskMainCtrl.taskData.task_status||username!=taskMainCtrl.taskData.task_created_by,"Active"==taskMainCtrl.taskData.task_status&&(taskMainCtrl.taskData.owners.indexOf(username)>=0||"admin"==userRole.type)&&(taskMainCtrl.disableChange=!1),taskMainCtrl.copyTask&&(taskMainCtrl.disableChange&&(taskMainCtrl.taskData.environment_id=null,taskMainCtrl.taskData.source_environment_id=null),taskMainCtrl.disableChange=!1),TDMService.getGenericAPI("task/"+taskMainCtrl.taskData.task_id+"/globals").then((function(response){taskMainCtrl.taskData.globals=_.map(response.result,(global,index)=>(global.index=index,global))})),TDMService.getTaskPostExecutionProcesses(taskMainCtrl.taskData.task_id).then((function(response){"SUCCESS"==response.errorCode?taskMainCtrl.taskData.postExecutionProcesses=_.map(response.result,v=>parseInt(v.process_id)):toastr.error("Task # "+taskMainCtrl.taskData.task_id,"Failed to get Task Post Execution Processes")}))),taskMainCtrl.referenceChange=function(){"refernceOnly"==taskMainCtrl.taskData.reference&&(taskMainCtrl.taskData.selectAllEntites=!1)},taskMainCtrl.taskData.delete_before_load&&taskMainCtrl.taskData.load_entity?taskMainCtrl.taskData.operationMode="delete_and_load_entity":!taskMainCtrl.taskData.delete_before_load&&taskMainCtrl.taskData.load_entity?taskMainCtrl.taskData.operationMode="insert_entity_without_delete":taskMainCtrl.taskData.delete_before_load&&!taskMainCtrl.taskData.load_entity?taskMainCtrl.taskData.operationMode="delete_without_load_entity":taskMainCtrl.taskData.operationMode="insert_entity_without_delete",TDMService.getFabricRolesforUser(AuthService.getUserId()).then(response=>{taskMainCtrl.userFabricRoles=response.result||[]}),taskMainCtrl.userRoleType=userRole.type,taskMainCtrl.entitiesListChange=function(){taskMainCtrl.entitiesListChangeTimeout&&$timeout.cancel(taskMainCtrl.entitiesListChangeTimeout),"LOAD"==taskMainCtrl.taskData.task_type&&taskMainCtrl.taskData.version_ind&&!taskMainCtrl.taskData.selectAllEntites&&(taskMainCtrl.entitiesListChangeTimeout=$timeout((function(){taskMainCtrl.getVersionsForLoad()}),1e3))},taskMainCtrl.saveTask=function(){if(!("P"!==taskMainCtrl.taskData.selection_method&&"PR"!==taskMainCtrl.taskData.selection_method||taskMainCtrl.taskData.parameters&&"()"!=taskMainCtrl.taskData.selection_param_value))return taskMainCtrl.parametersError=!0,void(taskMainCtrl.step=3);if(taskMainCtrl.taskData.scheduling_end_date&&taskMainCtrl.taskData.scheduling_end_date.hours(12),"LOAD"==taskMainCtrl.taskData.task_type&&taskMainCtrl.taskData.version_ind&&"refernceOnly"!==taskMainCtrl.taskData.reference&&taskMainCtrl.taskData.selectedVersionToLoad){if(!(selectedVersionToLoad=_.find(taskMainCtrl.taskData.versionsForLoad,{fabric_execution_id:taskMainCtrl.taskData.selectedVersionToLoad})))return taskMainCtrl.step=2,void(taskMainCtrl.createTaskInProgress=!1);taskMainCtrl.taskData.selected_version_task_name=selectedVersionToLoad.version_name;var localTimeZone=(version_datetime=new Date(selectedVersionToLoad.version_datetime)).getTimezoneOffset();version_datetime=version_datetime.getTime(),taskMainCtrl.taskData.selected_version_datetime=moment(version_datetime).format("YYYYMMDDHHmmss"),taskMainCtrl.taskData.selected_version_task_exe_id=selectedVersionToLoad.task_execution_id}if("LOAD"==taskMainCtrl.taskData.task_type&&taskMainCtrl.taskData.version_ind&&("refernceOnly"==taskMainCtrl.taskData.reference||"both"==taskMainCtrl.taskData.reference)){if(!taskMainCtrl.taskData.refLoadVersions)return taskMainCtrl.step=6,void(taskMainCtrl.createTaskInProgress=!1);var selectedVersionToLoad;if(selectedVersionToLoad=_.find(taskMainCtrl.taskData.refLoadVersions,{task_execution_id:parseInt(taskMainCtrl.taskData.selectedRefVersionToLoad)})){taskMainCtrl.taskData.selected_ref_version_task_name=selectedVersionToLoad.version_name;var version_datetime;localTimeZone=(version_datetime=new Date(selectedVersionToLoad.version_datetime)).getTimezoneOffset();version_datetime=version_datetime.getTime()+6e4*localTimeZone,taskMainCtrl.taskData.selected_ref_version_datetime=moment(version_datetime-6e4*taskMainCtrl.timeZoneOffset).format("YYYYMMDDHHmmss"),taskMainCtrl.taskData.selected_ref_version_task_exe_id=selectedVersionToLoad.task_execution_id}}"EXTRACT"===taskMainCtrl.taskData.task_type&&taskMainCtrl.taskData.version_ind||taskMainCtrl.taskData.retention_period_value||(delete taskMainCtrl.taskData.retention_period_type,delete taskMainCtrl.taskData.retention_period_value),taskMainCtrl.taskData.selectAllEntites&&(taskMainCtrl.taskData.selection_param_value=null),"L"!==taskMainCtrl.taskData.selection_method||"LOAD"===taskMainCtrl.taskData.task_type&&!taskMainCtrl.taskData.version_ind||"refernceOnly"===taskMainCtrl.taskData.reference||(taskMainCtrl.taskData.num_of_entities=taskMainCtrl.taskData.selection_param_value.split(",").length),taskMainCtrl.taskData.globals&&0==taskMainCtrl.taskData.globals.length&&(taskMainCtrl.taskData.task_globals=!1),taskMainCtrl.taskData.reference||(taskMainCtrl.taskData.refList=[]),taskMainCtrl.taskData.refList&&taskMainCtrl.taskData.refList.length>0&&(taskMainCtrl.taskData.refresh_reference_data=!1),taskMainCtrl.copyTask&&(taskMainCtrl.taskData.copy=!0),taskMainCtrl.taskData.version_ind?"EXTRACT"===taskMainCtrl.taskData.task_type&&(taskMainCtrl.taskData.sync_mode=null):(taskMainCtrl.taskData.selected_version_task_name=null,taskMainCtrl.taskData.selected_version_datetime=null,taskMainCtrl.taskData.selected_version_task_exe_id=null,taskMainCtrl.taskData.selected_ref_version_task_name=null,taskMainCtrl.taskData.selected_ref_version_datetime=null,taskMainCtrl.taskData.selected_ref_version_task_exe_id=null),"EXTRACT"===taskMainCtrl.taskData.task_type&&(taskMainCtrl.taskData.filterout_reserved=!1),taskMainCtrl.taskData.scheduler||(taskMainCtrl.taskData.scheduler="immediate"),"refernceOnly"==taskMainCtrl.taskData.reference&&"LOAD"===taskMainCtrl.taskData.task_type&&(taskMainCtrl.taskData.sync_mode="FORCE");let apiCall=null;apiCall=taskMainCtrl.editTask?TDMService.updateTask(taskMainCtrl.taskData):TDMService.createTask(taskMainCtrl.taskData),apiCall.then((function(response){taskMainCtrl.taskData.copy=!1,"SUCCESS"==response.errorCode?(TDMService.postTaskLogicalUnits(response.result.id,taskMainCtrl.taskData.task_title,{logicalUnits:taskMainCtrl.taskData.selectedLogicalUnits}).then((function(response){"SUCCESS"==response.errorCode?(toastr.success("Task # "+taskMainCtrl.taskData.task_title," Is Updated Successfully"),$timeout((function(){$state.go("tasks",{},{reload:!0})}),300)):toastr.error("Task # "+taskMainCtrl.taskData.task_id," Failed to Update : "+response.message)})),taskMainCtrl.taskData.postExecutionProcesses.length>0&&TDMService.postTaskPostExecutionProcess(response.result.id,taskMainCtrl.taskData.task_title,{postexecutionprocesses:_.filter(taskMainCtrl.taskData.allPostExecutionProcess,v=>taskMainCtrl.taskData.postExecutionProcesses.indexOf(v.process_id)>=0)}).then((function(response){"SUCCESS"!==response.errorCode&&toastr.error("Task # "+createTaskResult.id," Failed to Update Post Execution Processes: "+response.message)}))):toastr.error("Task # "+taskMainCtrl.taskData.task_id," Failed to Update : "+response.message)}))},taskMainCtrl.deleteTask=function(){TDMService.deleteTask(taskMainCtrl.taskData).then((function(response){"SUCCESS"==response.errorCode?(toastr.success("Task # "+taskMainCtrl.taskData.task_id,"deleted Successfully"),$timeout((function(){$scope.content.openTasks(!0)}),400)):toastr.error("Task # "+taskMainCtrl.taskData.task_id,"failed to delete")}))},taskMainCtrl.checkMigrateStatus=function(){if(!taskMainCtrl.requestedEntities.entities_list||!taskMainCtrl.selectedVersionToLoad)return taskMainCtrl.requestedEntitiesForm=$scope.requestedEntitiesForm,void($scope.requestedEntitiesForm.submitted=!0);var selectedVersionToLoad=_.find(taskMainCtrl.taskData.versionsForLoad,{fabric_execution_id:taskMainCtrl.selectedVersionToLoad}),taskExecutionId="",luNames="";selectedVersionToLoad&&(taskExecutionId=selectedVersionToLoad.task_execution_id,luNames=selectedVersionToLoad.lu_name);var version_datetime=new Date(selectedVersionToLoad.version_datetime),localTimeZone=version_datetime.getTimezoneOffset();version_datetime=version_datetime.getTime()+6e4*localTimeZone,TDMService.postGenericAPI("checkMigrateStatusForEntitiesList",{entitlesList:taskMainCtrl.requestedEntities.entities_list,taskExecutionId:taskExecutionId,luList:luNames}).then((function(response){if("SUCCESS"==response.errorCode){var failedEntities=[];for(var key in response.result)"false"==response.result[key]&&failedEntities.push(key);failedEntities.length>0?toastr.error("Entities "+failedEntities+" were not migrated successfully into the TDM storage by the selected version. Please remove them from the Entities List or select another version "):taskMainCtrl.requestedEntitiesNext($scope.requestedEntitiesForm,!0)}else toastr.error("Failed to check Migrate Status For Entites List")}))},taskMainCtrl.openStep=function(step,type){if("admin"==taskMainCtrl.userRoleType||taskMainCtrl.sourceEnvOwner&&taskMainCtrl.targetEnvOwner||(taskMainCtrl.taskData.selectAllEntites=!1),2==taskMainCtrl.step&&"LOAD"==taskMainCtrl.taskData.task_type&&taskMainCtrl.taskData.version_ind&&!taskMainCtrl.taskData.selectAllEntites)return"back"==type&&null!=taskMainCtrl.taskData.reference?taskMainCtrl.step=6:1==step?taskMainCtrl.step=1:void taskMainCtrl.checkMigrateStatus();var arraySteps=taskMainCtrl.getStepsArray(),nextStep=step,currentIndex=arraySteps.indexOf(taskMainCtrl.step),nextIndex=arraySteps.indexOf(step);if(nextIndex<currentIndex&&nextIndex>=0)return nextStep=arraySteps[nextIndex],void(taskMainCtrl.step=nextStep);if("next"==type){if(currentIndex==arraySteps.length-1)return void console.log("there is no next");nextStep=arraySteps[currentIndex+1]}else if("back"==type)return 0==currentIndex?void console.log("there is no back"):(nextStep=arraySteps[currentIndex-1],void(taskMainCtrl.step=nextStep));return 1==taskMainCtrl.step?$scope.generalForm.$valid?void taskMainCtrl.generalNext($scope.generalForm,nextStep):(taskMainCtrl.generalForm=$scope.generalForm,void($scope.generalForm.submitted=!0)):2==taskMainCtrl.step?$scope.requestedEntitiesForm.$valid?(taskMainCtrl.requestedEntitiesNext($scope.requestedEntitiesForm,!1,nextStep),void($scope.requestedEntitiesForm.submitted=!0)):(taskMainCtrl.requestedEntitiesForm=$scope.requestedEntitiesForm,void($scope.requestedEntitiesForm.submitted=!0)):3!=taskMainCtrl.step||$scope.requestParametersForm.$valid?4!=taskMainCtrl.step||$scope.executionTimingForm.$valid?6!=taskMainCtrl.step||$scope.ReferenceForm.$valid?void(5!=taskMainCtrl.step?(taskMainCtrl.step=nextStep,1==taskMainCtrl.step?$scope.generalForm.submitted=!0:2==taskMainCtrl.step?($scope.getEntitesCount(),taskMainCtrl.updateParams(()=>{console.log("parameters loaded")}),$scope.requestedEntitiesForm.submitted=!0):3==taskMainCtrl.step?$scope.requestParametersForm.submitted=!0:4==taskMainCtrl.step&&($scope.executionTimingForm.submitted=!0)):taskMainCtrl.globalsNext(nextStep)):($scope.ReferenceForm.submitted=!0,void taskMainCtrl.referenceNext(nextStep)):(taskMainCtrl.executionTimingForm=$scope.executionTimingForm,void($scope.executionTimingForm.submitted=!0)):(taskMainCtrl.requestParametersForm=$scope.requestParametersForm,void($scope.requestParametersForm.submitted=!0))};const getRoleForUserInEnv=(environment_id,source)=>new Promise((resolve,reject)=>{TDMService.getRoleForUserInEnv(environment_id).then((function(response){if("SUCCESS"==response.errorCode){source?taskMainCtrl.sourceUserRole=response.result.userRole:taskMainCtrl.userRole=response.result.userRole,"LOAD"==taskMainCtrl.taskData.task_type&&taskMainCtrl.userRole.allowed_entity_versioning&&taskMainCtrl.sourceUserRole.allowed_entity_versioning||"EXTRACT"==taskMainCtrl.taskData.task_type&&taskMainCtrl.sourceUserRole.allowed_entity_versioning?taskMainCtrl.allowed_entity_versioning=!0:(taskMainCtrl.allowed_entity_versioning=!1,taskMainCtrl.taskData.version_ind=!1);var minRead=response.result.minRead,minWrite=response.result.minWrite;"RESERVE"===taskMainCtrl.taskData.task_type&&taskMainCtrl.userRole.allowed_number_of_reserved_entities<minWrite&&(minWrite=taskMainCtrl.userRole.allowed_number_of_reserved_entities),(minRead>-1||minWrite>-1)&&(minWrite=parseInt(minWrite||"0"),minRead=parseInt(minRead||"0"),source?(taskMainCtrl.sourceMaxToCopy=minRead,taskMainCtrl.maxToCopy>minRead?taskMainCtrl.maxToCopy=minRead:taskMainCtrl.maxToCopy||(taskMainCtrl.maxToCopy=minRead)):(taskMainCtrl.targetMaxToCopy=minWrite,taskMainCtrl.maxToCopy>minWrite?taskMainCtrl.maxToCopy=minWrite:taskMainCtrl.maxToCopy||(taskMainCtrl.maxToCopy=minWrite))),resolve(!0)}else toastr.error("Task # "+taskMainCtrl.taskData.task_id,"Faild to get Role for user "),reject()}))}),getEnvironmentOwners=(environment_id,source)=>new Promise((resolve,reject)=>{TDMService.getEnvironmentOwners(environment_id).then(response=>{if("SUCCESS"==response.errorCode){var ownerFound=_.find(response.result,{user_id:AuthService.getUserId()});if(!ownerFound)for(let i=0;i<taskMainCtrl.userFabricRoles.length&&!(ownerFound=_.find(response.result,{user_type:"GROUP",user_id:taskMainCtrl.userFabricRoles[i]}));i++);let userRoleField="userRole";source&&(userRoleField="sourceUserRole"),ownerFound?(taskMainCtrl[userRoleField]={},taskMainCtrl[userRoleField].allowed_random_entity_selection=!0,taskMainCtrl[userRoleField].allowed_creation_of_synthetic_data=!0,taskMainCtrl[userRoleField].allowed_refresh_reference_data=!0,taskMainCtrl[userRoleField].allowed_request_of_fresh_data=!0,taskMainCtrl[userRoleField].allowed_delete_before_load=!0,taskMainCtrl[userRoleField].allowed_task_scheduling=!0,taskMainCtrl[userRoleField].allowed_replace_sequences=!0,taskMainCtrl.taskData.num_of_entities=parseInt(taskMainCtrl.taskData.num_of_entities),source?taskMainCtrl.sourceEnvOwner=!0:taskMainCtrl.targetEnvOwner=!0,resolve(!0)):(source?taskMainCtrl.sourceEnvOwner=!1:taskMainCtrl.targetEnvOwner=!1,resolve(!1))}else toastr.error("Environment # "+environment_id||taskMainCtrl.taskData.environment_id,"failed to get owners : "+response.message),reject()})}),getRoleData=()=>{if("admin"==userRole.type)taskMainCtrl.userRole={},taskMainCtrl.userRole.allowed_random_entity_selection=!0,taskMainCtrl.userRole.allowed_creation_of_synthetic_data=!0,taskMainCtrl.userRole.allowed_refresh_reference_data=!0,taskMainCtrl.userRole.allowed_request_of_fresh_data=!0,taskMainCtrl.userRole.allowed_delete_before_load=!0,taskMainCtrl.userRole.allowed_task_scheduling=!0,taskMainCtrl.userRole.allowed_replace_sequences=!0,taskMainCtrl.maxToCopy=null,taskMainCtrl.taskData.num_of_entities=parseInt(taskMainCtrl.taskData.num_of_entities);else{const promises=[];("EXTRACT"===taskMainCtrl.taskData.task_type||"LOAD"===taskMainCtrl.taskData.task_type&&taskMainCtrl.taskData.load_entity)&&promises.push(getEnvironmentOwners(taskMainCtrl.taskData.source_environment_id,!0)),"EXTRACT"!==taskMainCtrl.taskData.task_type&&promises.push(getEnvironmentOwners(taskMainCtrl.taskData.environment_id,!1)),Promise.all(promises).then(result=>{const rolePromises=[];("EXTRACT"===taskMainCtrl.taskData.task_type||"LOAD"===taskMainCtrl.taskData.task_type&&taskMainCtrl.taskData.load_entity)&&!taskMainCtrl.sourceEnvOwner&&rolePromises.push(getRoleForUserInEnv(taskMainCtrl.taskData.source_environment_id,!0)),"EXTRACT"===taskMainCtrl.taskData.task_type||taskMainCtrl.targetEnvOwner||rolePromises.push(getRoleForUserInEnv(taskMainCtrl.taskData.environment_id,!1)),Promise.all(rolePromises).then(roleResult=>{console.log("got Role results")})})}};BreadCrumbsService.push({task_id:taskMainCtrl.taskData.task_title},"TASK_BREADCRUMB",(function(){}))},controllerAs:"taskMainCtrl"}}angular.module("TDM-FE").directive("taskMain",taskMain);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvdGFzay90YXNrTWFpbi90YXNrTWFpbi5qcyJdLCJuYW1lcyI6WyJ0YXNrTWFpbiIsInJlc3RyaWN0IiwidGVtcGxhdGVVcmwiLCJzY29wZSIsImNvbnRlbnQiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiVERNU2VydmljZSIsIkJyZWFkQ3J1bWJzU2VydmljZSIsIlN3ZWV0QWxlcnQiLCIkdWliTW9kYWwiLCJ0b2FzdHIiLCIkdGltZW91dCIsIkF1dGhTZXJ2aWNlIiwiJHN0YXRlIiwiRFRPcHRpb25zQnVpbGRlciIsIkRUQ29sdW1uQnVpbGRlciIsIiRxIiwiJGNvbXBpbGUiLCJ0YXNrTWFpbkN0cmwiLCJ0aGlzIiwiZWRpdFRhc2siLCJtb2RlIiwidGFza3MiLCJtaW5EYXRlIiwiRGF0ZSIsIm1vbWVudCIsIm1pbGxpc2Vjb25kcyIsInNlY29uZHMiLCJtaW51dGVzIiwiaG91cnMiLCJhZGQiLCJzY2hlZHVsZXJPcHRpb25zIiwiZm9ybUlucHV0Q2xhc3MiLCJmb3JtU2VsZWN0Q2xhc3MiLCJmb3JtUmFkaW9DbGFzcyIsImZvcm1DaGVja2JveENsYXNzIiwiaGlkZU1pbnV0ZXNUYWIiLCJoaWRlSG91cmx5VGFiIiwiaGlkZURhaWx5VGFiIiwiaGlkZVdlZWtseVRhYiIsImhpZGVNb250aGx5VGFiIiwiaGlkZVllYXJseVRhYiIsImhpZGVBZHZhbmNlZFRhYiIsInVzZTI0SG91clRpbWUiLCJoaWRlU2Vjb25kcyIsInRpbWVab25lT2Zmc2V0IiwiZ2V0VGltZVpvbmUiLCJnZXRTdGVwc0FycmF5Iiwic3RlcHNBcnJheSIsInB1c2giLCJ0YXNrRGF0YSIsInJlZmVyZW5jZSIsInRhc2tfZ2xvYmFscyIsIm5leHRTdGVwIiwic3RlcHMiLCJjdXJyZW50U3RlcEluZGV4IiwiaW5kZXhPZiIsInN0ZXAiLCJsZW5ndGgiLCJjb25zb2xlIiwiZXJyb3IiLCJiYWNrIiwic2VsZWN0aW9uX21ldGhvZCIsInBhcmFtcyIsImlucHV0cyIsIkN1c3RvbUxvZ2ljUGFyYW1zIiwibWFwIiwiaXQiLCJuYW1lIiwidHlwZSIsInZhbHVlIiwicGFyYW1ldGVycyIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXRUYWJTdWJ0aXRsZSIsInRleHQiLCJ0YXNrX3R5cGUiLCJsb2FkX2VudGl0eSIsImRlbGV0ZV9iZWZvcmVfbG9hZCIsImdlbmVyYWxOZXh0IiwiZm9ybSIsImNvcHlUYXNrIiwiXyIsImZpbmQiLCJ0YXNrX3RpdGxlIiwidGFza19zdGF0dXMiLCJnZW5lcmFsRm9ybSIsInRhc2tUaXRsZSIsIiRzZXRWYWxpZGl0eSIsInRhc2tMb2dpY2FsVW5pdCIsImlzU2VsZWN0ZWRMVSIsImx1X25hbWUiLCJzZWxlY3RlZExvZ2ljYWxVbml0cyIsImNoZWNrSWZSb290SXNNaXNzaW5nIiwibHUiLCJtaXNzaW5nUm9vdExVIiwibHVfcGFyZW50X25hbWUiLCJsdVBhcmVudCIsImFsbExvZ2ljYWxVbml0cyIsImZvckVhY2giLCJtaXNzaW5nVW5pdEluR2FwIiwiY2hlY2tHYXAiLCJzdWJtaXR0ZWQiLCIkdmFsaWQiLCJnZXRSb2xlRGF0YSIsImFkZGl0aW9uYWxFeGVjdXRpb25QYXJhbWV0ZXJzTmV4dCIsInJlcGxhY2Vfc2VxdWVuY2VzIiwiZmlsdGVyb3V0X3Jlc2VydmVkIiwiYWRkaXRpb25hbEV4ZWN1dGlvblBhcmFtZXRlcnNGb3JtIiwidmFsaWRhdGVEYXRhIiwidmFsaWRhdGVSZXNlcnZlRW50aXRlcyIsInZhbGlkYXRlVmVyaW9ucyIsInByb21pc2VzIiwicG9zdEdlbmVyaWNBUEkiLCJiZUlEIiwiYmVfaWQiLCJlbnZJRCIsImVudmlyb25tZW50X2lkIiwibGlzdE9mRW50aXRpZXMiLCJzZWxlY3Rpb25fcGFyYW1fdmFsdWUiLCJzcGxpdCIsInRhcmdldF9lbnRpdHlfaWQiLCJ2ZXJzaW9uX2luZCIsInNlbGVjdGVkVmVyc2lvblRvTG9hZCIsInJlcXVlc3RlZEVudGl0aWVzRm9ybSIsInZlcnNpb25zRm9yTG9hZCIsImZhYnJpY19leGVjdXRpb25faWQiLCJ0YXNrRXhlY3V0aW9uSWQiLCJsdU5hbWVzIiwidGFza19leGVjdXRpb25faWQiLCJmaWx0ZXIiLCJ2ZXJzaW9uIiwiZW50aXRpZXNMaXN0IiwidGFza0V4ZWNJZCIsImx1X2xpc3QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImFsbCIsInRoZW4iLCJyZXN1bHRzIiwiZXJyb3JDb2RlIiwic3dhbCIsInRpdGxlIiwibWVzc2FnZSIsInNob3dDYW5jZWxCdXR0b24iLCJjb25maXJtQnV0dG9uQ29sb3IiLCJjb25maXJtQnV0dG9uVGV4dCIsImNhbmNlbEJ1dHRvblRleHQiLCJjbG9zZU9uQ29uZmlybSIsImNsb3NlT25DYW5jZWwiLCJhbmltYXRpb24iLCJjdXN0b21DbGFzcyIsImlzQ29uZmlybSIsInJlcXVlc3RlZEVudGl0aWVzTmV4dCIsImNhdGNoIiwiZXJyIiwicmVmZXJlbmNlTmV4dCIsInJlZkxpc3QiLCJzZWxlY3RlZCIsIlJlZmVyZW5jZUZvcm0iLCJnbG9iYWxzTmV4dCIsIkFkZEdsb2JhbEZvcm0iLCJUYXNrU2NoZWR1bGluZ05leHQiLCJkaXNhYmxlQ2hhbmdlIiwic2F2ZVRhc2siLCJUYXNrU2NoZWR1bGluZ0Zvcm0iLCJhbmd1bGFyIiwiY29weSIsInRhc2siLCJzdWJtaXRGb3JtIiwib3BlblN0ZXAiLCIkc2V0U3VibWl0dGVkIiwidXNlclJvbGUiLCJnZXRSb2xlIiwidXNlcm5hbWUiLCJnZXRVc2VybmFtZSIsInJldGVudGlvbl9wZXJpb2RfdmFsdWUiLCJyZWZjb3VudCIsImdldEdlbmVyaWNBUEkiLCJ0YXNrX2lkIiwicmVzcG9uc2UiLCJyZXN1bHQiLCJyZWYiLCJ0YXNrX2NyZWF0ZWRfYnkiLCJvd25lcnMiLCJzb3VyY2VfZW52aXJvbm1lbnRfaWQiLCJnbG9iYWxzIiwiZ2xvYmFsIiwiaW5kZXgiLCJnZXRUYXNrUG9zdEV4ZWN1dGlvblByb2Nlc3NlcyIsInBvc3RFeGVjdXRpb25Qcm9jZXNzZXMiLCJ2IiwicGFyc2VJbnQiLCJwcm9jZXNzX2lkIiwicmVmZXJlbmNlQ2hhbmdlIiwic2VsZWN0QWxsRW50aXRlcyIsIm9wZXJhdGlvbk1vZGUiLCJnZXRGYWJyaWNSb2xlc2ZvclVzZXIiLCJnZXRVc2VySWQiLCJ1c2VyRmFicmljUm9sZXMiLCJ1c2VyUm9sZVR5cGUiLCJlbnRpdGllc0xpc3RDaGFuZ2UiLCJlbnRpdGllc0xpc3RDaGFuZ2VUaW1lb3V0IiwiY2FuY2VsIiwiZ2V0VmVyc2lvbnNGb3JMb2FkIiwicGFyYW1ldGVyc0Vycm9yIiwic2NoZWR1bGluZ19lbmRfZGF0ZSIsImNyZWF0ZVRhc2tJblByb2dyZXNzIiwic2VsZWN0ZWRfdmVyc2lvbl90YXNrX25hbWUiLCJ2ZXJzaW9uX25hbWUiLCJsb2NhbFRpbWVab25lIiwidmVyc2lvbl9kYXRldGltZSIsImdldFRpbWV6b25lT2Zmc2V0IiwiZ2V0VGltZSIsInNlbGVjdGVkX3ZlcnNpb25fZGF0ZXRpbWUiLCJmb3JtYXQiLCJzZWxlY3RlZF92ZXJzaW9uX3Rhc2tfZXhlX2lkIiwicmVmTG9hZFZlcnNpb25zIiwic2VsZWN0ZWRSZWZWZXJzaW9uVG9Mb2FkIiwic2VsZWN0ZWRfcmVmX3ZlcnNpb25fdGFza19uYW1lIiwic2VsZWN0ZWRfcmVmX3ZlcnNpb25fZGF0ZXRpbWUiLCJzZWxlY3RlZF9yZWZfdmVyc2lvbl90YXNrX2V4ZV9pZCIsInJldGVudGlvbl9wZXJpb2RfdHlwZSIsIm51bV9vZl9lbnRpdGllcyIsInJlZnJlc2hfcmVmZXJlbmNlX2RhdGEiLCJzeW5jX21vZGUiLCJzY2hlZHVsZXIiLCJhcGlDYWxsIiwidXBkYXRlVGFzayIsImNyZWF0ZVRhc2siLCJwb3N0VGFza0xvZ2ljYWxVbml0cyIsImlkIiwibG9naWNhbFVuaXRzIiwic3VjY2VzcyIsImdvIiwicmVsb2FkIiwicG9zdFRhc2tQb3N0RXhlY3V0aW9uUHJvY2VzcyIsInBvc3RleGVjdXRpb25wcm9jZXNzZXMiLCJhbGxQb3N0RXhlY3V0aW9uUHJvY2VzcyIsImNyZWF0ZVRhc2tSZXN1bHQiLCJkZWxldGVUYXNrIiwib3BlblRhc2tzIiwiY2hlY2tNaWdyYXRlU3RhdHVzIiwicmVxdWVzdGVkRW50aXRpZXMiLCJlbnRpdGllc19saXN0IiwiZW50aXRsZXNMaXN0IiwibHVMaXN0IiwiZmFpbGVkRW50aXRpZXMiLCJrZXkiLCJzb3VyY2VFbnZPd25lciIsInRhcmdldEVudk93bmVyIiwiYXJyYXlTdGVwcyIsImN1cnJlbnRJbmRleCIsIm5leHRJbmRleCIsImxvZyIsInJlcXVlc3RQYXJhbWV0ZXJzRm9ybSIsImV4ZWN1dGlvblRpbWluZ0Zvcm0iLCJnZXRFbnRpdGVzQ291bnQiLCJ1cGRhdGVQYXJhbXMiLCJnZXRSb2xlRm9yVXNlckluRW52Iiwic291cmNlIiwic291cmNlVXNlclJvbGUiLCJhbGxvd2VkX2VudGl0eV92ZXJzaW9uaW5nIiwibWluUmVhZCIsIm1pbldyaXRlIiwiYWxsb3dlZF9udW1iZXJfb2ZfcmVzZXJ2ZWRfZW50aXRpZXMiLCJzb3VyY2VNYXhUb0NvcHkiLCJtYXhUb0NvcHkiLCJ0YXJnZXRNYXhUb0NvcHkiLCJnZXRFbnZpcm9ubWVudE93bmVycyIsIm93bmVyRm91bmQiLCJ1c2VyX2lkIiwiaSIsInVzZXJfdHlwZSIsInVzZXJSb2xlRmllbGQiLCJhbGxvd2VkX3JhbmRvbV9lbnRpdHlfc2VsZWN0aW9uIiwiYWxsb3dlZF9jcmVhdGlvbl9vZl9zeW50aGV0aWNfZGF0YSIsImFsbG93ZWRfcmVmcmVzaF9yZWZlcmVuY2VfZGF0YSIsImFsbG93ZWRfcmVxdWVzdF9vZl9mcmVzaF9kYXRhIiwiYWxsb3dlZF9kZWxldGVfYmVmb3JlX2xvYWQiLCJhbGxvd2VkX3Rhc2tfc2NoZWR1bGluZyIsImFsbG93ZWRfcmVwbGFjZV9zZXF1ZW5jZXMiLCJyb2xlUHJvbWlzZXMiLCJyb2xlUmVzdWx0IiwiY29udHJvbGxlckFzIiwibW9kdWxlIiwiZGlyZWN0aXZlIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxXQTY2QkwsTUFBTyxDQUNIQyxTQUFVLElBQ1ZDLFlBNzZCVyw0Q0E4NkJYQyxNQUFPLENBQ0hDLFFBQVMsS0FFYkMs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Z0JBQWdCLElBRzdFa0IsUUFBUUcsSUFBSTFCLFVBQVUyQixLQUFLMkMsU0FDdkIsTUFBTXFHLGFBQWUsSUFFb0IsWUFBcEN6USxhQUFhZ0MsU0FBUzBCLFdBQ2EsU0FBcEMxRCxhQUFhZ0MsU0FBUzBCLFdBQXdCMUQsYUFBYWdDLFNBQVMyQixlQUFpQjNELGFBQWF3TyxnQkFDOUZpQyxhQUFhMU8sS0FBS21OLG9CQUFvQmxQLGFBQWFnQyxTQUFTd0ksdUJBQXVCLElBRW5ELFlBQXBDeEssYUFBYWdDLFNBQVMwQixXQUE0QjFELGFBQWF5TyxnQkFDL0RnQyxhQUFhMU8sS0FBS21OLG9CQUFvQmxQLGFBQWFnQyxTQUFTbUUsZ0JBQWdCLElBRWhGa0IsUUFBUUcsSUFBSWlKLGNBQWNoSixLQUFLaUosYUFDM0JqTyxRQUFRb00sSUFBSSwwQkFNNUJ4UCxtQkFBbUIwQyxLQUFLLENBQUNtSSxRQUFTbEssYUFBYWdDLFNBQVNrQyxZQUFhLG1CQUFtQixnQkFZeEZ5TSxhQUFjLGdCQUt0QnRILFFBQ0t1SCxPQUFPLFVBQ1BDLFVBQVUsV0FBWWhTIiwiZmlsZSI6ImNvbXBvbmVudHMvdGFzay90YXNrTWFpbi90YXNrTWFpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbImZ1bmN0aW9uIHRhc2tNYWluKCkge1xuXG4gICAgdmFyIHRlbXBsYXRlID0gXCJqcy9jb21wb25lbnRzL3Rhc2svdGFza01haW4vdGFza01haW4uaHRtbFwiO1xuXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCBURE1TZXJ2aWNlLCBCcmVhZENydW1ic1NlcnZpY2UsIFN3ZWV0QWxlcnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHVpYk1vZGFsLCB0b2FzdHIsICR0aW1lb3V0LCBBdXRoU2VydmljZSwgJHN0YXRlLCBEVE9wdGlvbnNCdWlsZGVyLCBEVENvbHVtbkJ1aWxkZXIsICRxLCAkY29tcGlsZSkge1xuICAgICAgICB2YXIgdGFza01haW5DdHJsID0gdGhpcztcblxuICAgICAgICB0YXNrTWFpbkN0cmwuZWRpdFRhc2sgPSAkc2NvcGUuY29udGVudC5tb2RlICE9PSAnY3JlYXRlJztcbiAgICAgICAgdGFza01haW5DdHJsLnRhc2tzID0gJHNjb3BlLmNvbnRlbnQudGFza3M7XG4gICAgICAgIHRhc2tNYWluQ3RybC5taW5EYXRlID0gbmV3IERhdGUoKTtcbiAgICAgICAgdGFza01haW5DdHJsLm1pbkRhdGUgPSBtb21lbnQodGFza01haW5DdHJsLm1pbkRhdGUpO1xuICAgICAgICB0YXNrTWFpbkN0cmwubWluRGF0ZS5taWxsaXNlY29uZHMoMCk7XG4gICAgICAgIHRhc2tNYWluQ3RybC5taW5EYXRlLnNlY29uZHMoMCk7XG4gICAgICAgIHRhc2tNYWluQ3RybC5taW5EYXRlLm1pbnV0ZXMoMCk7XG4gICAgICAgIHRhc2tNYWluQ3RybC5taW5EYXRlLmhvdXJzKDApO1xuICAgICAgICB0YXNrTWFpbkN0cmwubWluRGF0ZS5hZGQoMSwgJ2RheXMnKTtcbiAgICAgICAgdGFza01haW5DdHJsLnNjaGVkdWxlck9wdGlvbnMgPSB7XG4gICAgICAgICAgICBmb3JtSW5wdXRDbGFzczogJ2Zvcm0tY29udHJvbDEgY3Jvbi1nZW4taW5wdXQnLCAvLyBGb3JtIGlucHV0IGNsYXNzIG92ZXJyaWRlXG4gICAgICAgICAgICBmb3JtU2VsZWN0Q2xhc3M6ICdmb3JtLWNvbnRyb2wxIGNyb24tZ2VuLXNlbGVjdCcsIC8vIFNlbGVjdCBjbGFzcyBvdmVycmlkZVxuICAgICAgICAgICAgZm9ybVJhZGlvQ2xhc3M6ICdjcm9uLWdlbi1yYWRpbycsIC8vIFJhZGlvIGNsYXNzIG92ZXJyaWRlXG4gICAgICAgICAgICBmb3JtQ2hlY2tib3hDbGFzczogJ2Nyb24tZ2VuLWNoZWNrYm94JywgLy8gUmFkaW8gY2xhc3Mgb3ZlcnJpZGVcbiAgICAgICAgICAgIGhpZGVNaW51dGVzVGFiOiBmYWxzZSwgLy8gV2hldGhlciB0byBoaWRlIHRoZSBtaW51dGVzIHRhYlxuICAgICAgICAgICAgaGlkZUhvdXJseVRhYjogZmFsc2UsIC8vIFdoZXRoZXIgdG8gaGlkZSB0aGUgaG91cmx5IHRhYlxuICAgICAgICAgICAgaGlkZURhaWx5VGFiOiBmYWxzZSwgLy8gV2hldGhlciB0byBoaWRlIHRoZSBkYWlseSB0YWJcbiAgICAgICAgICAgIGhpZGVXZWVrbHlUYWI6IGZhbHNlLCAvLyBXaGV0aGVyIHRvIGhpZGUgdGhlIHdlZWtseSB0YWJcbiAgICAgICAgICAgIGhpZGVNb250aGx5VGFiOiBmYWxzZSwgLy8gV2hldGhlciB0byBoaWRlIHRoZSBtb250aGx5IHRhYlxuICAgICAgICAgICAgaGlkZVllYXJseVRhYjogZmFsc2UsIC8vIFdoZXRoZXIgdG8gaGlkZSB0aGUgeWVhcmx5IHRhYlxuICAgICAgICAgICAgaGlkZUFkdmFuY2VkVGFiOiBmYWxzZSwgLy8gV2hldGhlciB0byBoaWRlIHRoZSBhZHZhbmNlZCB0YWJcbiAgICAgICAgICAgIHVzZTI0SG91clRpbWU6IHRydWUsIC8vIFdoZXRoZXIgdG8gc2hvdyBBTS9QTSBvbiB0aGUgdGltZSBzZWxlY3RvcnNcbiAgICAgICAgICAgIGhpZGVTZWNvbmRzOiBmYWxzZSAvLyBXaGV0aGVyIHRvIHNob3cvaGlkZSB0aGUgc2Vjb25kcyB0aW1lIHBpY2tlclxuICAgICAgICB9O1xuXG4gICAgICAgIHRhc2tNYWluQ3RybC50aW1lWm9uZU9mZnNldCA9IEF1dGhTZXJ2aWNlLmdldFRpbWVab25lKCk7XG4gICAgICAgIFxuICAgICAgICB0YXNrTWFpbkN0cmwuZ2V0U3RlcHNBcnJheSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBzdGVwc0FycmF5ID0gW107XG4gICAgICAgICAgICBzdGVwc0FycmF5LnB1c2goMSk7XG4gICAgICAgICAgICBzdGVwc0FycmF5LnB1c2goMik7XG4gICAgICAgICAgICBpZiAodGFza01haW5DdHJsLnRhc2tEYXRhLnJlZmVyZW5jZSAhPT0gJ3JlZmVybmNlT25seScpe1xuICAgICAgICAgICAgICAgIHN0ZXBzQXJyYXkucHVzaCgzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza19nbG9iYWxzKSB7XG4gICAgICAgICAgICAgICAgc3RlcHNBcnJheS5wdXNoKDQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS5yZWZlcmVuY2UgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHN0ZXBzQXJyYXkucHVzaCg1KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN0ZXBzQXJyYXkucHVzaCg2KTtcbiAgICAgICAgICAgIHJldHVybiBzdGVwc0FycmF5O1xuICAgICAgICB9XG5cbiAgICAgICAgdGFza01haW5DdHJsLm5leHRTdGVwID0gKCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3RlcHMgPSB0YXNrTWFpbkN0cmwuZ2V0U3RlcHNBcnJheSgpO1xuICAgICAgICAgICAgY29uc3QgY3VycmVudFN0ZXBJbmRleCA9IHN0ZXBzLmluZGV4T2YodGFza01haW5DdHJsLnN0ZXApO1xuICAgICAgICAgICAgaWYgKGN1cnJlbnRTdGVwSW5kZXggPj0gMCAmJiBjdXJyZW50U3RlcEluZGV4IDwgc3RlcHMubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBzdGVwc1tjdXJyZW50U3RlcEluZGV4ICsgMV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdUaGVyZSBpcyBubyBuZXh0IHN0ZXAnKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFza01haW5DdHJsLnN0ZXA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0YXNrTWFpbkN0cmwuYmFjayA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN0ZXBzID0gdGFza01haW5DdHJsLmdldFN0ZXBzQXJyYXkoKTtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTdGVwSW5kZXggPSBzdGVwcy5pbmRleE9mKHRhc2tNYWluQ3RybC5zdGVwKTtcbiAgICAgICAgICAgIGlmIChjdXJyZW50U3RlcEluZGV4ID4gMCl7XG4gICAgICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC5zdGVwID09PSAzICYmIGN1cnJlbnRTdGVwSW5kZXggPCB0YXNrTWFpbkN0cmwuc3RlcCl7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0aW9uX21ldGhvZCA9PT0gJ0MnKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnB1dHMgOiAodGFza01haW5DdHJsLnRhc2tEYXRhLkN1c3RvbUxvZ2ljUGFyYW1zIHx8IFtdKS5tYXAoaXQgPT4gKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogaXQubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogaXQudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGl0LnZhbHVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5wYXJhbWV0ZXJzID0gSlNPTi5zdHJpbmdpZnkocGFyYW1zKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuc3RlcCA9IHN0ZXBzW2N1cnJlbnRTdGVwSW5kZXggLSAxXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RoaXMgaXMgdGhlIEZpcnN0IFN0ZXAgY2Fubm90IGdvIGJhY2snKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB0YXNrTWFpbkN0cmwuZ2V0VGFiU3VidGl0bGUgPSAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgdGV4dCA9ICcnO1xuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdFWFRSQUNUJyl7XG4gICAgICAgICAgICAgICAgdGV4dCA9ICdGb3IgYW4gRXh0cmFjdCBUYXNrJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdSRVNFUlZFJykge1xuICAgICAgICAgICAgICAgIHRleHQgPSAnRm9yIGEgUmVzZXJ2ZSBUYXNrJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdMT0FEJykge1xuICAgICAgICAgICAgICAgIGlmICghdGFza01haW5DdHJsLnRhc2tEYXRhLmxvYWRfZW50aXR5ICYmIFxuICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuZGVsZXRlX2JlZm9yZV9sb2FkKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQgPSAnRm9yIGEgRGVsZXRlIFRhc2snO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9ICdGb3IgYSBMb2FkIFRhc2snO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0ZXh0O1xuICAgICAgICB9XG5cbiAgICAgICAgdGFza01haW5DdHJsLmdlbmVyYWxOZXh0ID0gZnVuY3Rpb24gKGZvcm0sIG5leHRTdGVwKSB7IFxuICAgICAgICAgICAgaWYgKCF0YXNrTWFpbkN0cmwuZWRpdFRhc2sgfHwgdGFza01haW5DdHJsLmNvcHlUYXNrKXtcbiAgICAgICAgICAgICAgICBpZiAoXy5maW5kKHRhc2tNYWluQ3RybC50YXNrcywge3Rhc2tfdGl0bGU6IHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3RpdGxlLCB0YXNrX3N0YXR1czogJ0FjdGl2ZSd9KSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ2VuZXJhbEZvcm0udGFza1RpdGxlLiRzZXRWYWxpZGl0eSgnYWxyZWFkeUV4aXN0JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdlbmVyYWxGb3JtLnRhc2tUaXRsZS4kc2V0VmFsaWRpdHkoJ2FscmVhZHlFeGlzdCcsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGdhcCBjYW4gaGFwcGVuIGluIGF0IGxlYXN0IDIgTFVzXG4gICAgICAgICAgICAkc2NvcGUuZ2VuZXJhbEZvcm0udGFza0xvZ2ljYWxVbml0LiRzZXRWYWxpZGl0eSgnZ2FwJywgdHJ1ZSk7XG4gICAgICAgICAgICAkc2NvcGUuZ2VuZXJhbEZvcm0udGFza0xvZ2ljYWxVbml0LiRzZXRWYWxpZGl0eSgnbWlzc2luZ1BhcmVudCcsIHRydWUpO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIENoZWNrcyBpZiB0aGUgZ2l2ZW4gbG9naWNhbCB1bml0IG5hbWUgaGFzIGJlZW4gc2VsZWN0ZWRcbiAgICAgICAgICAgICAqIEBwYXJhbSBsdV9uYW1lXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7Kn1cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgbGV0IGlzU2VsZWN0ZWRMVSA9IChsdV9uYW1lKSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF8uZmluZCh0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0ZWRMb2dpY2FsVW5pdHMsIHtsdV9uYW1lOiBsdV9uYW1lfSlcbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIGxldCBjaGVja0dhcCA9IGx1ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobHUubHVfcGFyZW50X25hbWUgJiYgIWlzU2VsZWN0ZWRMVShsdS5sdV9wYXJlbnRfbmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgICAgICAgICAqIElmIGEgbG9naWNhbCB1bml0IGhhcyBhIHBhcmVudCBhbmQgaXQgaGFzIG5vdCBiZWluZyBzZWxlY3RlZFxuICAgICAgICAgICAgICAgICAgICAgKiB0aGVuIHRoaXMgaXMgdGhlIG9ubHkgY2hhbmNlIHRoYXQgd2UgbWlnaHQgaGF2ZSBhIGdhcC5cbiAgICAgICAgICAgICAgICAgICAgICogVGhlIGdhcCB3aWxsIG9jY3VyIGlmIHRoZSBsdSBwYXJlbnQgbmFtZSB0aGF0IGlzIG1pc3NpbmdcbiAgICAgICAgICAgICAgICAgICAgICogaGFzIGEgcGFyZW50IHdoaWNoIGlzIG5vdCBtaXNzaW5nLiBUaGlzIHdpbGwgZ2VuZXJhdGUgYSBnYXAuXG4gICAgICAgICAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGx1UGFyZW50ID0gXy5maW5kKHRhc2tNYWluQ3RybC50YXNrRGF0YS5hbGxMb2dpY2FsVW5pdHMsIHtsdV9uYW1lOiBsdS5sdV9wYXJlbnRfbmFtZX0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAobHVQYXJlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChsdVBhcmVudC5sdV9wYXJlbnRfbmFtZSAmJiBpc1NlbGVjdGVkTFUobHVQYXJlbnQubHVfcGFyZW50X25hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdlbmVyYWxGb3JtLnRhc2tMb2dpY2FsVW5pdC4kc2V0VmFsaWRpdHkoJ2dhcCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwubWlzc2luZ1VuaXRJbkdhcCA9IGx1UGFyZW50Lmx1X25hbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBsZXQgY2hlY2tJZlJvb3RJc01pc3NpbmcgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmdlbmVyYWxGb3JtLnRhc2tMb2dpY2FsVW5pdC4kc2V0VmFsaWRpdHkoJ21pc3NpbmdQYXJlbnQnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEubWlzc2luZ1Jvb3RMVSA9IFtdO1xuXG4gICAgICAgICAgICAgICAgLy8gY2hlY2sgaWYgdGhlcmUgaXMgbHUgd2hpY2ggaGFzIGEgcGFyZW50IHRoYXQgZG9lcyBub3QgaGF2ZSBhIHBhcmVudCAocm9vdClcbiAgICAgICAgICAgICAgICBmb3IgKGx1IG9mIHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3RlZExvZ2ljYWxVbml0cykge1xuICAgICAgICAgICAgICAgICAgICBpZiAobHUubHVfcGFyZW50X25hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGx1UGFyZW50ID0gXy5maW5kKHRhc2tNYWluQ3RybC50YXNrRGF0YS5hbGxMb2dpY2FsVW5pdHMsIHtsdV9uYW1lOiBsdS5sdV9wYXJlbnRfbmFtZX0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGx1UGFyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgbHUgaGFzIGEgcGFyZW50IHRoYXQgZG9lcyBub3QgaGF2ZSBhIHBhcmVudCB3aGljaCBpcyBtaXNzaW5nIHRoZW4gcm9vdCBpcyBtaXNzaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFsdVBhcmVudC5sdV9wYXJlbnRfbmFtZSAmJiAhaXNTZWxlY3RlZExVKGx1UGFyZW50Lmx1X25hbWUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRzY29wZS5nZW5lcmFsRm9ybS50YXNrTG9naWNhbFVuaXQuJHNldFZhbGlkaXR5KCdtaXNzaW5nUGFyZW50JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEubWlzc2luZ1Jvb3RMVS5wdXNoKGx1UGFyZW50Lmx1X25hbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAodGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGVkTG9naWNhbFVuaXRzICYmIHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3RlZExvZ2ljYWxVbml0cy5sZW5ndGggPiAwKXtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0ZWRMb2dpY2FsVW5pdHMuZm9yRWFjaChsdSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja0dhcChsdSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja0lmUm9vdElzTWlzc2luZyhsdSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3JtLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgICBpZiAoZm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuc3RlcCA9IG5leHRTdGVwIHx8IHRhc2tNYWluQ3RybC5uZXh0U3RlcCgpO1xuICAgICAgICAgICAgICAgIGdldFJvbGVEYXRhKCk7XG4gICAgICAgICAgICB9IFxuICAgICAgICAgICAgdGFza01haW5DdHJsLmdlbmVyYWxGb3JtID0gZm9ybTtcbiAgICAgICAgfTtcblxuICAgICAgICB0YXNrTWFpbkN0cmwuYWRkaXRpb25hbEV4ZWN1dGlvblBhcmFtZXRlcnNOZXh0ID0gZnVuY3Rpb24gKGZvcm0sIG5leHRTdGVwKSB7IFxuICAgICAgICAgICAgZm9ybS5zdWJtaXR0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKGZvcm0uJHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS5yZXBsYWNlX3NlcXVlbmNlcykge1xuICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuZmlsdGVyb3V0X3Jlc2VydmVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5zdGVwID0gbmV4dFN0ZXAgfHwgdGFza01haW5DdHJsLm5leHRTdGVwKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YXNrTWFpbkN0cmwuYWRkaXRpb25hbEV4ZWN1dGlvblBhcmFtZXRlcnNGb3JtID0gZm9ybTtcbiAgICAgICAgfTtcblxuXG4gICAgICAgIHRhc2tNYWluQ3RybC52YWxpZGF0ZURhdGEgPSAoKSA9PiB7XG4gICAgICAgICAgICBsZXQgdmFsaWRhdGVSZXNlcnZlRW50aXRlcyA9IGZhbHNlO1xuICAgICAgICAgICAgbGV0IHZhbGlkYXRlVmVyaW9ucyA9IGZhbHNlO1xuICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza190eXBlICE9PSAnRVhUUkFDVCcgJiYgdGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGlvbl9tZXRob2QgPT09ICdMJyAmJiAhdGFza01haW5DdHJsLnRhc2tEYXRhLnJlcGxhY2Vfc2VxdWVuY2VzKXtcbiAgICAgICAgICAgICAgICB2YWxpZGF0ZVJlc2VydmVFbnRpdGVzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKFRETVNlcnZpY2UucG9zdEdlbmVyaWNBUEkoJ3ZhbGlkYXRlUmVzZXJ2ZWRFbnRpdGllc0xpc3QnLCB7XG4gICAgICAgICAgICAgICAgICAgIGJlSUQ6IHRhc2tNYWluQ3RybC50YXNrRGF0YS5iZV9pZCxcbiAgICAgICAgICAgICAgICAgICAgZW52SUQ6IHRhc2tNYWluQ3RybC50YXNrRGF0YS5lbnZpcm9ubWVudF9pZCxcbiAgICAgICAgICAgICAgICAgICAgbGlzdE9mRW50aXRpZXM6IHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3Rpb25fcGFyYW1fdmFsdWUuc3BsaXQoJywnKS5tYXAoaXQgPT4gKHt0YXJnZXRfZW50aXR5X2lkIDogaXR9KSksXG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdMT0FEJyAmJiB0YXNrTWFpbkN0cmwudGFza0RhdGEubG9hZF9lbnRpdHkgJiYgXG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnZlcnNpb25faW5kICYmIHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3Rpb25fbWV0aG9kICE9PSAnQUxMJyl7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGVkVmVyc2lvblRvTG9hZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnJlcXVlc3RlZEVudGl0aWVzRm9ybSA9ICRzY29wZS5yZXF1ZXN0ZWRFbnRpdGllc0Zvcm07XG4gICAgICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVxdWVzdGVkRW50aXRpZXNGb3JtLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkVmVyc2lvblRvTG9hZCA9IF8uZmluZCh0YXNrTWFpbkN0cmwudGFza0RhdGEudmVyc2lvbnNGb3JMb2FkLCB7ZmFicmljX2V4ZWN1dGlvbl9pZDogdGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGVkVmVyc2lvblRvTG9hZH0pO1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGFza0V4ZWN1dGlvbklkID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGx1TmFtZXMgPSBcIlwiO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRWZXJzaW9uVG9Mb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrRXhlY3V0aW9uSWQgPSBzZWxlY3RlZFZlcnNpb25Ub0xvYWQudGFza19leGVjdXRpb25faWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICBsdU5hbWVzID0gdGFza01haW5DdHJsLnRhc2tEYXRhLnZlcnNpb25zRm9yTG9hZFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIodmVyc2lvbiA9PiB2ZXJzaW9uLnRhc2tfZXhlY3V0aW9uX2lkID09PSBzZWxlY3RlZFZlcnNpb25Ub0xvYWQudGFza19leGVjdXRpb25faWQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcCh2ZXJzaW9uID0+ICh7bHVfbmFtZSA6IHZlcnNpb24ubHVfbmFtZX0pKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YWxpZGF0ZVZlcmlvbnMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKFRETVNlcnZpY2UucG9zdEdlbmVyaWNBUEkoJ3Rhc2tzL3ZhbGlkYXRlVmVyc2lvbkZvckxvYWQnLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlbnRpdGllc0xpc3Q6IHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3Rpb25fcGFyYW1fdmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrRXhlY0lkOiB0YXNrRXhlY3V0aW9uSWQsXG4gICAgICAgICAgICAgICAgICAgICAgICBsdV9saXN0OiBsdU5hbWVzLFxuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChwcm9taXNlcy5sZW5ndGggPT09IDApe1xuICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKHByb21pc2VzKS50aGVuKHJlc3VsdHMgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsaWRhdGVWZXJpb25zKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0c1sxXS5lcnJvckNvZGUgPT09ICdGQUlMRUQnKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBTd2VldEFsZXJ0LnN3YWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aXRsZTogYFRoZSBoaWVyYXJjaHkgb2YgZW50aXRpZXMgJHtyZXN1bHRzWzFdLm1lc3NhZ2V9IGhhcyBub3QgYmVlbiBjcmVhdGVkIHByb3Blcmx5IGluIHRoZSBzZWxlY3RlZCB2ZXJzaW9uLiBBcmUgeW91IHN1cmUgdGhhdCB5b3Ugd2FudCB0byBzZWxlY3QgdGhpcyB2ZXJzaW9uP2AsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3VsdHNbMF0ubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJ3YXJuaW5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3dDYW5jZWxCdXR0b246IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogXCIjREQ2QjU1XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiBcIk5vXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNhbmNlbEJ1dHRvblRleHQ6IFwiWWVzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25Db25maXJtOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZU9uQ2FuY2VsOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbmltYXRpb246IFwiZmFsc2VcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tQ2xhc3M6IFwiYW5pbWF0ZWQgZmFkZUluVXBcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGlzQ29uZmlybSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQ29uZmlybSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbGlkYXRlUmVzZXJ2ZUVudGl0ZXMgJiYgcmVzdWx0c1swXS5tZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBTd2VldEFsZXJ0LnN3YWwoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRpdGxlOiAnVGhlIGZvbGxvd2luZyBlbnRpdGllcyBhcmUgYWxyZWFkeSByZXNlcnZlZCBieSBvdGhlciB1c2Vycy4gQXJlIHlvdSBzdXJlIHRoYXQgeW91IHdhbnQgdG8gc2F2ZSB0aGUgdGFzaz8nLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IHJlc3VsdHNbMF0ubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcIndhcm5pbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG93Q2FuY2VsQnV0dG9uOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpcm1CdXR0b25Db2xvcjogXCIjREQ2QjU1XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlybUJ1dHRvblRleHQ6IFwiTm9cIixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiBcIlllc1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25Db25maXJtOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlT25DYW5jZWw6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBcImZhbHNlXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzdG9tQ2xhc3M6IFwiYW5pbWF0ZWQgZmFkZUluVXBcIlxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChpc0NvbmZpcm0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQ29uZmlybSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB0YXNrTWFpbkN0cmwucmVxdWVzdGVkRW50aXRpZXNOZXh0ID0gZnVuY3Rpb24gKGZvcm0sIG5leHRTdGVwKSB7XG4gICAgICAgICAgICBmb3JtLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgICBpZiAoZm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGlvbl9tZXRob2QgPT09ICdDJyl7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0cyA6ICh0YXNrTWFpbkN0cmwudGFza0RhdGEuQ3VzdG9tTG9naWNQYXJhbXMgfHwgW10pLm1hcChpdCA9PiAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGl0Lm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogaXQudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZTogaXQudmFsdWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB9KSksXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnBhcmFtZXRlcnMgPSBKU09OLnN0cmluZ2lmeShwYXJhbXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudmFsaWRhdGVEYXRhKCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5zdGVwID0gbmV4dFN0ZXAgfHwgdGFza01haW5DdHJsLm5leHRTdGVwKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2ggKGVyciA9PiB7XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhc2tNYWluQ3RybC5yZXF1ZXN0ZWRFbnRpdGllc0Zvcm0gPSBmb3JtO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH07XG5cbiAgICAgICAgdGFza01haW5DdHJsLnJlZmVyZW5jZU5leHQgPSBmdW5jdGlvbiAoZm9ybSwgbmV4dFN0ZXApIHtcbiAgICAgICAgICAgIGZvcm0uc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGZvcm0uJHNldFZhbGlkaXR5KCdlbXB0eUxpc3QnLCB0cnVlKTtcbiAgICAgICAgICAgIGlmIChfLmZpbHRlcih0YXNrTWFpbkN0cmwudGFza0RhdGEucmVmTGlzdCwge3NlbGVjdGVkOiB0cnVlfSkubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICBmb3JtLiRzZXRWYWxpZGl0eSgnZW1wdHlMaXN0JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhc2tNYWluQ3RybC5SZWZlcmVuY2VGb3JtID0gZm9ybTtcbiAgICAgICAgICAgIHRhc2tNYWluQ3RybC5zdGVwID0gbmV4dFN0ZXAgfHwgdGFza01haW5DdHJsLm5leHRTdGVwKCk7XG4gICAgICAgIH1cblxuICAgICAgICBcbiAgICAgICAgdGFza01haW5DdHJsLmdsb2JhbHNOZXh0ID0gZnVuY3Rpb24gKGZvcm0sIG5leHRTdGVwKSB7XG4gICAgICAgICAgICB0YXNrTWFpbkN0cmwuc3RlcCA9IG5leHRTdGVwIHx8IHRhc2tNYWluQ3RybC5uZXh0U3RlcCgpO1xuICAgICAgICAgICAgdGFza01haW5DdHJsLkFkZEdsb2JhbEZvcm0gPSBmb3JtO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRhc2tNYWluQ3RybC5UYXNrU2NoZWR1bGluZ05leHQgPSAoZm9ybSwgbmV4dFN0ZXApID0+IHtcbiAgICAgICAgICAgIGlmIChmb3JtLiR2YWxpZCB8fCB0YXNrTWFpbkN0cmwuZGlzYWJsZUNoYW5nZSA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUuZ2VuZXJhbEZvcm0uJHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5zdGVwID0gbmV4dFN0ZXAgfHwgMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGFza01haW5DdHJsLnRhc2tEYXRhLnJlZmVyZW5jZSAmJiBfLmZpbHRlcih0YXNrTWFpbkN0cmwudGFza0RhdGEucmVmTGlzdCwge3NlbGVjdGVkOiB0cnVlfSkubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnN0ZXAgPSBuZXh0U3RlcCB8fCA1O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghJHNjb3BlLnJlcXVlc3RlZEVudGl0aWVzRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnN0ZXAgPSBuZXh0U3RlcCB8fCAzO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmICghJHNjb3BlLmFkZGl0aW9uYWxFeGVjdXRpb25QYXJhbWV0ZXJzRm9ybS4kdmFsaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnN0ZXAgPSBuZXh0U3RlcCB8fCAyO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5zYXZlVGFzaygpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBmb3JtLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0YXNrTWFpbkN0cmwuVGFza1NjaGVkdWxpbmdGb3JtID0gZm9ybTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0YXNrTWFpbkN0cmwuZWRpdFRhc2spIHtcbiAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YSA9IGFuZ3VsYXIuY29weSgkc2NvcGUuY29udGVudC50YXNrKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YSA9IHtcbiAgICAgICAgICAgICAgICBmaWx0ZXJvdXRfcmVzZXJ2ZWQgOiB0cnVlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIFxuICAgICAgICB0YXNrTWFpbkN0cmwuc3VibWl0Rm9ybSA9IGZ1bmN0aW9uKHN0ZXAsbmV4dFN0ZXApe1xuICAgICAgICAgICAgaWYgKCF0YXNrTWFpbkN0cmwudGFza0RhdGEuYWxsTG9naWNhbFVuaXRzKXtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBzdGVwcyA9IHRhc2tNYWluQ3RybC5nZXRTdGVwc0FycmF5KCk7XG4gICAgICAgICAgICBpZiAoc3RlcCA9PT0gbmV4dFN0ZXApe1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChzdGVwcy5pbmRleE9mKHN0ZXApID4gc3RlcHMuaW5kZXhPZihuZXh0U3RlcCkpe1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5vcGVuU3RlcChuZXh0U3RlcCwnYmFjaycpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHN3aXRjaChzdGVwKXtcbiAgICAgICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5nZW5lcmFsRm9ybS4kc2V0U3VibWl0dGVkKCk7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5nZW5lcmFsTmV4dCgkc2NvcGUuZ2VuZXJhbEZvcm0sbmV4dFN0ZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmFkZGl0aW9uYWxFeGVjdXRpb25QYXJhbWV0ZXJzRm9ybS4kc2V0U3VibWl0dGVkKCk7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5hZGRpdGlvbmFsRXhlY3V0aW9uUGFyYW1ldGVyc05leHQoJHNjb3BlLmFkZGl0aW9uYWxFeGVjdXRpb25QYXJhbWV0ZXJzRm9ybSwgbmV4dFN0ZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3RlZEVudGl0aWVzRm9ybS4kc2V0U3VibWl0dGVkKCk7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5yZXF1ZXN0ZWRFbnRpdGllc05leHQoJHNjb3BlLnJlcXVlc3RlZEVudGl0aWVzRm9ybSwgbmV4dFN0ZXApO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNDpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLkFkZEdsb2JhbEZvcm0uJHNldFN1Ym1pdHRlZCgpO1xuICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuZ2xvYmFsc05leHQoJHNjb3BlLkFkZEdsb2JhbEZvcm0sIG5leHRTdGVwKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgNTpcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLlJlZmVyZW5jZUZvcm0uJHNldFN1Ym1pdHRlZCgpO1xuICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwucmVmZXJlbmNlTmV4dChSZWZlcmVuY2VGb3JtLCBuZXh0U3RlcClcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIDY6XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5UYXNrU2NoZWR1bGluZ0Zvcm0uJHNldFN1Ym1pdHRlZCgpO1xuICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuVGFza1NjaGVkdWxpbmdOZXh0KCRzY29wZS5UYXNrU2NoZWR1bGluZ0Zvcm0sIG5leHRTdGVwKVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cblxuICAgICAgICB0YXNrTWFpbkN0cmwuc3RlcCA9IDE7XG5cbiAgICAgICAgdmFyIHVzZXJSb2xlID0gQXV0aFNlcnZpY2UuZ2V0Um9sZSgpO1xuICAgICAgICB2YXIgdXNlcm5hbWUgPSBBdXRoU2VydmljZS5nZXRVc2VybmFtZSgpO1xuXG4gICAgICAgIHRhc2tNYWluQ3RybC5jb3B5VGFzayA9ICRzY29wZS5jb250ZW50LmNvcHk7XG5cbiAgICAgICAgaWYgKHRhc2tNYWluQ3RybC5jb3B5VGFzaykge1xuICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnRhc2tfdGl0bGUgPSB0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza190aXRsZSArIFwiIENvcHlcIjtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0YXNrTWFpbkN0cmwuZWRpdFRhc2spIHtcbiAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza190eXBlID09PSAnRVhUUkFDVCcgJiYgIXRhc2tNYWluQ3RybC50YXNrRGF0YS52ZXJzaW9uX2luZCAmJiAhdGFza01haW5DdHJsLnRhc2tEYXRhLnJldGVudGlvbl9wZXJpb2RfdmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEucmV0ZW50aW9uX3BlcmlvZF92YWx1ZSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGlvbl9tZXRob2QgPT0gXCJSRUZcIikge1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5yZWZlcmVuY2UgPSBcInJlZmVybmNlT25seVwiO1xuICAgIFxuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEucmVmY291bnQgPiAwKSB7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnJlZmVyZW5jZSA9IFwiYm90aFwiO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS5yZWZlcmVuY2UpIHtcbiAgICAgICAgICAgICAgICBURE1TZXJ2aWNlLmdldEdlbmVyaWNBUEkoXCJ0YXNrL3JlZnNUYWJsZS9cIiArIHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEucmVmTGlzdCA9IF8ubWFwKHJlc3BvbnNlLnJlc3VsdCwgZnVuY3Rpb24gKHJlZikge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVmLnNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiByZWY7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0YXNrTWFpbkN0cmwuZGlzYWJsZUNoYW5nZSA9ICh0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza19zdGF0dXMgPT0gJ0luYWN0aXZlJyB8fCB1c2VybmFtZSAhPSB0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza19jcmVhdGVkX2J5KTtcblxuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3N0YXR1cyA9PSAnQWN0aXZlJyAmJiAodGFza01haW5DdHJsLnRhc2tEYXRhLm93bmVycy5pbmRleE9mKHVzZXJuYW1lKSA+PSAwIHx8IHVzZXJSb2xlLnR5cGUgPT0gJ2FkbWluJykpIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuZGlzYWJsZUNoYW5nZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGFza01haW5DdHJsLmNvcHlUYXNrKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC5kaXNhYmxlQ2hhbmdlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5lbnZpcm9ubWVudF9pZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5zb3VyY2VfZW52aXJvbm1lbnRfaWQgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuZGlzYWJsZUNoYW5nZSA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgVERNU2VydmljZS5nZXRHZW5lcmljQVBJKFwidGFzay9cIiArIHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX2lkICsgXCIvZ2xvYmFsc1wiKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5nbG9iYWxzID0gXy5tYXAocmVzcG9uc2UucmVzdWx0LChnbG9iYWwsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGdsb2JhbC5pbmRleCA9IGluZGV4O1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2xvYmFsO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgVERNU2VydmljZS5nZXRUYXNrUG9zdEV4ZWN1dGlvblByb2Nlc3Nlcyh0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza19pZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvckNvZGUgPT0gXCJTVUNDRVNTXCIpIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEucG9zdEV4ZWN1dGlvblByb2Nlc3NlcyA9IF8ubWFwKHJlc3BvbnNlLnJlc3VsdCx2ID0+IHBhcnNlSW50KHYucHJvY2Vzc19pZCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoXCJUYXNrICMgXCIgKyB0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza19pZCwgXCJGYWlsZWQgdG8gZ2V0IFRhc2sgUG9zdCBFeGVjdXRpb24gUHJvY2Vzc2VzXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgfVxuXG5cblxuICAgICAgICB0YXNrTWFpbkN0cmwucmVmZXJlbmNlQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS5yZWZlcmVuY2UgPT0gJ3JlZmVybmNlT25seScpIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0QWxsRW50aXRlcyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEuZGVsZXRlX2JlZm9yZV9sb2FkICYmIHRhc2tNYWluQ3RybC50YXNrRGF0YS5sb2FkX2VudGl0eSkge1xuICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLm9wZXJhdGlvbk1vZGUgPSAnZGVsZXRlX2FuZF9sb2FkX2VudGl0eSc7XG4gICAgICAgIH0gZWxzZSBpZiAoIXRhc2tNYWluQ3RybC50YXNrRGF0YS5kZWxldGVfYmVmb3JlX2xvYWQgJiYgdGFza01haW5DdHJsLnRhc2tEYXRhLmxvYWRfZW50aXR5KSB7XG4gICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEub3BlcmF0aW9uTW9kZSA9ICdpbnNlcnRfZW50aXR5X3dpdGhvdXRfZGVsZXRlJztcbiAgICAgICAgfSBlbHNlIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEuZGVsZXRlX2JlZm9yZV9sb2FkICYmICF0YXNrTWFpbkN0cmwudGFza0RhdGEubG9hZF9lbnRpdHkpIHtcbiAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5vcGVyYXRpb25Nb2RlID0gJ2RlbGV0ZV93aXRob3V0X2xvYWRfZW50aXR5JztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5vcGVyYXRpb25Nb2RlID0gJ2luc2VydF9lbnRpdHlfd2l0aG91dF9kZWxldGUnO1xuICAgICAgICB9XG5cbiAgICAgICAgVERNU2VydmljZS5nZXRGYWJyaWNSb2xlc2ZvclVzZXIoQXV0aFNlcnZpY2UuZ2V0VXNlcklkKCkpLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICB0YXNrTWFpbkN0cmwudXNlckZhYnJpY1JvbGVzID0gcmVzcG9uc2UucmVzdWx0IHx8IFtdO1xuICAgICAgICB9KTtcblxuICAgICAgICB0YXNrTWFpbkN0cmwudXNlclJvbGVUeXBlID0gdXNlclJvbGUudHlwZVxuXG4gICAgICAgIHRhc2tNYWluQ3RybC5lbnRpdGllc0xpc3RDaGFuZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAodGFza01haW5DdHJsLmVudGl0aWVzTGlzdENoYW5nZVRpbWVvdXQpIHtcbiAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGFza01haW5DdHJsLmVudGl0aWVzTGlzdENoYW5nZVRpbWVvdXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT0gJ0xPQUQnICYmIHRhc2tNYWluQ3RybC50YXNrRGF0YS52ZXJzaW9uX2luZCAmJiAhdGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdEFsbEVudGl0ZXMpIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuZW50aXRpZXNMaXN0Q2hhbmdlVGltZW91dCA9ICR0aW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLmdldFZlcnNpb25zRm9yTG9hZCgpO1xuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG5cbiAgICAgICAgdGFza01haW5DdHJsLnNhdmVUYXNrID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3Rpb25fbWV0aG9kID09PSAnUCcgfHwgXG4gICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3Rpb25fbWV0aG9kID09PSAnUFInKSB7XG4gICAgICAgICAgICAgICAgaWYgKCF0YXNrTWFpbkN0cmwudGFza0RhdGEucGFyYW1ldGVycyB8fCB0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0aW9uX3BhcmFtX3ZhbHVlID09ICcoKScpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnBhcmFtZXRlcnNFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5zdGVwID0gMztcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS5zY2hlZHVsaW5nX2VuZF9kYXRlKSB7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnNjaGVkdWxpbmdfZW5kX2RhdGUuaG91cnMoMTIpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza190eXBlID09ICdMT0FEJyAmJiB0YXNrTWFpbkN0cmwudGFza0RhdGEudmVyc2lvbl9pbmQgJiYgdGFza01haW5DdHJsLnRhc2tEYXRhLnJlZmVyZW5jZSAhPT0gXCJyZWZlcm5jZU9ubHlcIikge1xuXG4gICAgICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3RlZFZlcnNpb25Ub0xvYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbGVjdGVkVmVyc2lvblRvTG9hZCA9IF8uZmluZCh0YXNrTWFpbkN0cmwudGFza0RhdGEudmVyc2lvbnNGb3JMb2FkLCB7ZmFicmljX2V4ZWN1dGlvbl9pZDogdGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGVkVmVyc2lvblRvTG9hZH0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRWZXJzaW9uVG9Mb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0ZWRfdmVyc2lvbl90YXNrX25hbWUgPSBzZWxlY3RlZFZlcnNpb25Ub0xvYWQudmVyc2lvbl9uYW1lO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHZlcnNpb25fZGF0ZXRpbWUgPSBuZXcgRGF0ZShzZWxlY3RlZFZlcnNpb25Ub0xvYWQudmVyc2lvbl9kYXRldGltZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbG9jYWxUaW1lWm9uZSA9IHZlcnNpb25fZGF0ZXRpbWUuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZlcnNpb25fZGF0ZXRpbWUgPSB2ZXJzaW9uX2RhdGV0aW1lLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3RlZF92ZXJzaW9uX2RhdGV0aW1lID0gbW9tZW50KHZlcnNpb25fZGF0ZXRpbWUpLmZvcm1hdChcIllZWVlNTURESEhtbXNzXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGVkX3ZlcnNpb25fdGFza19leGVfaWQgPSBzZWxlY3RlZFZlcnNpb25Ub0xvYWQudGFza19leGVjdXRpb25faWQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuc3RlcCA9IDI7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuY3JlYXRlVGFza0luUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT0gJ0xPQUQnICYmIHRhc2tNYWluQ3RybC50YXNrRGF0YS52ZXJzaW9uX2luZCAmJlxuICAgICAgICAgICAgICAgICh0YXNrTWFpbkN0cmwudGFza0RhdGEucmVmZXJlbmNlID09IFwicmVmZXJuY2VPbmx5XCIgfHwgdGFza01haW5DdHJsLnRhc2tEYXRhLnJlZmVyZW5jZSA9PSBcImJvdGhcIikpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXRhc2tNYWluQ3RybC50YXNrRGF0YS5yZWZMb2FkVmVyc2lvbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnN0ZXAgPSA2O1xuICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuY3JlYXRlVGFza0luUHJvZ3Jlc3MgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBzZWxlY3RlZFZlcnNpb25Ub0xvYWQgPSBfLmZpbmQodGFza01haW5DdHJsLnRhc2tEYXRhLnJlZkxvYWRWZXJzaW9ucywge3Rhc2tfZXhlY3V0aW9uX2lkOiBwYXJzZUludCh0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0ZWRSZWZWZXJzaW9uVG9Mb2FkKX0pO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRWZXJzaW9uVG9Mb2FkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0ZWRfcmVmX3ZlcnNpb25fdGFza19uYW1lID0gc2VsZWN0ZWRWZXJzaW9uVG9Mb2FkLnZlcnNpb25fbmFtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2ZXJzaW9uX2RhdGV0aW1lID0gbmV3IERhdGUoc2VsZWN0ZWRWZXJzaW9uVG9Mb2FkLnZlcnNpb25fZGF0ZXRpbWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxvY2FsVGltZVpvbmUgPSB2ZXJzaW9uX2RhdGV0aW1lLmdldFRpbWV6b25lT2Zmc2V0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uX2RhdGV0aW1lID0gdmVyc2lvbl9kYXRldGltZS5nZXRUaW1lKCkgKyBsb2NhbFRpbWVab25lICogNjAwMDA7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0ZWRfcmVmX3ZlcnNpb25fZGF0ZXRpbWUgPSBtb21lbnQodmVyc2lvbl9kYXRldGltZSAtIHRhc2tNYWluQ3RybC50aW1lWm9uZU9mZnNldCAqIDYwMDAwKS5mb3JtYXQoXCJZWVlZTU1EREhIbW1zc1wiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3RlZF9yZWZfdmVyc2lvbl90YXNrX2V4ZV9pZCA9IHNlbGVjdGVkVmVyc2lvblRvTG9hZC50YXNrX2V4ZWN1dGlvbl9pZDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCEodGFza01haW5DdHJsLnRhc2tEYXRhLnRhc2tfdHlwZSA9PT0gJ0VYVFJBQ1QnICYmIHRhc2tNYWluQ3RybC50YXNrRGF0YS52ZXJzaW9uX2luZCkgJiYgIXRhc2tNYWluQ3RybC50YXNrRGF0YS5yZXRlbnRpb25fcGVyaW9kX3ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRhc2tNYWluQ3RybC50YXNrRGF0YS5yZXRlbnRpb25fcGVyaW9kX3R5cGU7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRhc2tNYWluQ3RybC50YXNrRGF0YS5yZXRlbnRpb25fcGVyaW9kX3ZhbHVlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBpZiAoISh0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza190eXBlID09ICdMT0FEJyAmJiAhdGFza01haW5DdHJsLnRhc2tEYXRhLnZlcnNpb25faW5kKSkge1xuICAgICAgICAgICAgLy8gICAgIHRhc2tNYWluQ3RybC5sb2dpY2FsVW5pdHMgPSB0YXNrTWFpbkN0cmwubG9naWNhbFVuaXQ7XG4gICAgICAgICAgICAvLyB9XG5cbiAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0QWxsRW50aXRlcykge1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3Rpb25fcGFyYW1fdmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0aW9uX21ldGhvZCA9PT0gJ0wnICYmICEodGFza01haW5DdHJsLnRhc2tEYXRhLnRhc2tfdHlwZSA9PT0gJ0xPQUQnICYmICF0YXNrTWFpbkN0cmwudGFza0RhdGEudmVyc2lvbl9pbmQpXG4gICAgICAgICAgICAgICAgJiYgdGFza01haW5DdHJsLnRhc2tEYXRhLnJlZmVyZW5jZSAhPT0gJ3JlZmVybmNlT25seScpIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEubnVtX29mX2VudGl0aWVzID0gdGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGlvbl9wYXJhbV92YWx1ZS5zcGxpdChcIixcIikubGVuZ3RoO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGFza01haW5DdHJsLnRhc2tEYXRhLmdsb2JhbHMgJiYgdGFza01haW5DdHJsLnRhc2tEYXRhLmdsb2JhbHMubGVuZ3RoID09IDApIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza19nbG9iYWxzID0gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdGFza01haW5DdHJsLnRhc2tEYXRhLnJlZmVyZW5jZSkge1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5yZWZMaXN0ID0gW107XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEucmVmTGlzdCAmJiB0YXNrTWFpbkN0cmwudGFza0RhdGEucmVmTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnJlZnJlc2hfcmVmZXJlbmNlX2RhdGEgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwuY29weVRhc2spIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuY29weSA9IHRydWU7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICghdGFza01haW5DdHJsLnRhc2tEYXRhLnZlcnNpb25faW5kKXtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0ZWRfdmVyc2lvbl90YXNrX25hbWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3RlZF92ZXJzaW9uX2RhdGV0aW1lID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0ZWRfdmVyc2lvbl90YXNrX2V4ZV9pZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGVkX3JlZl92ZXJzaW9uX3Rhc2tfbmFtZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdGVkX3JlZl92ZXJzaW9uX2RhdGV0aW1lID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0ZWRfcmVmX3ZlcnNpb25fdGFza19leGVfaWQgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdFWFRSQUNUJykge1xuICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuc3luY19tb2RlID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza190eXBlID09PSAnRVhUUkFDVCcpIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEuZmlsdGVyb3V0X3Jlc2VydmVkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghdGFza01haW5DdHJsLnRhc2tEYXRhLnNjaGVkdWxlcikge1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5zY2hlZHVsZXIgPSAnaW1tZWRpYXRlJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKCB0YXNrTWFpbkN0cmwudGFza0RhdGEucmVmZXJlbmNlID09IFwicmVmZXJuY2VPbmx5XCIgJiYgdGFza01haW5DdHJsLnRhc2tEYXRhLnRhc2tfdHlwZSA9PT0gJ0xPQUQnKSB7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnN5bmNfbW9kZSA9ICdGT1JDRSc7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGxldCBhcGlDYWxsID0gbnVsbDtcblxuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC5lZGl0VGFzaykge1xuICAgICAgICAgICAgICAgIGFwaUNhbGwgPSBURE1TZXJ2aWNlLnVwZGF0ZVRhc2sodGFza01haW5DdHJsLnRhc2tEYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGFwaUNhbGwgPSBURE1TZXJ2aWNlLmNyZWF0ZVRhc2sodGFza01haW5DdHJsLnRhc2tEYXRhKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgYXBpQ2FsbC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5jb3B5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yQ29kZSA9PSBcIlNVQ0NFU1NcIikge1xuICAgICAgICAgICAgICAgICAgICBURE1TZXJ2aWNlLnBvc3RUYXNrTG9naWNhbFVuaXRzKHJlc3BvbnNlLnJlc3VsdC5pZCwgdGFza01haW5DdHJsLnRhc2tEYXRhLnRhc2tfdGl0bGUsIHtsb2dpY2FsVW5pdHM6IHRhc2tNYWluQ3RybC50YXNrRGF0YS5zZWxlY3RlZExvZ2ljYWxVbml0c30pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JDb2RlID09IFwiU1VDQ0VTU1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoXCJUYXNrICMgXCIgKyB0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza190aXRsZSwgXCIgSXMgVXBkYXRlZCBTdWNjZXNzZnVsbHlcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3Rhc2tzJywge30sIHtyZWxvYWQ6IHRydWV9KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDMwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihcIlRhc2sgIyBcIiArIHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX2lkLCBcIiBGYWlsZWQgdG8gVXBkYXRlIDogXCIgKyByZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwudGFza0RhdGEucG9zdEV4ZWN1dGlvblByb2Nlc3Nlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBURE1TZXJ2aWNlLnBvc3RUYXNrUG9zdEV4ZWN1dGlvblByb2Nlc3MoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UucmVzdWx0LmlkLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza190aXRsZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge3Bvc3RleGVjdXRpb25wcm9jZXNzZXMgOl8uZmlsdGVyKHRhc2tNYWluQ3RybC50YXNrRGF0YS5hbGxQb3N0RXhlY3V0aW9uUHJvY2VzcywgdiA9PiB0YXNrTWFpbkN0cmwudGFza0RhdGEucG9zdEV4ZWN1dGlvblByb2Nlc3Nlcy5pbmRleE9mKHYucHJvY2Vzc19pZCkgPj0gMCl9KS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvckNvZGUgIT09IFwiU1VDQ0VTU1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ci5lcnJvcihcIlRhc2sgIyBcIiArIGNyZWF0ZVRhc2tSZXN1bHQuaWQsIFwiIEZhaWxlZCB0byBVcGRhdGUgUG9zdCBFeGVjdXRpb24gUHJvY2Vzc2VzOiBcIiArIHJlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoXCJUYXNrICMgXCIgKyB0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza19pZCwgXCIgRmFpbGVkIHRvIFVwZGF0ZSA6IFwiICsgcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGFza01haW5DdHJsLmRlbGV0ZVRhc2sgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBURE1TZXJ2aWNlLmRlbGV0ZVRhc2sodGFza01haW5DdHJsLnRhc2tEYXRhKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvckNvZGUgPT0gXCJTVUNDRVNTXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MoXCJUYXNrICMgXCIgKyB0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza19pZCwgXCJkZWxldGVkIFN1Y2Nlc3NmdWxseVwiKTtcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmNvbnRlbnQub3BlblRhc2tzKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9LCA0MDApXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKFwiVGFzayAjIFwiICsgdGFza01haW5DdHJsLnRhc2tEYXRhLnRhc2tfaWQsIFwiZmFpbGVkIHRvIGRlbGV0ZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB0YXNrTWFpbkN0cmwuY2hlY2tNaWdyYXRlU3RhdHVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCF0YXNrTWFpbkN0cmwucmVxdWVzdGVkRW50aXRpZXMuZW50aXRpZXNfbGlzdCB8fCAhdGFza01haW5DdHJsLnNlbGVjdGVkVmVyc2lvblRvTG9hZCkge1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5yZXF1ZXN0ZWRFbnRpdGllc0Zvcm0gPSAkc2NvcGUucmVxdWVzdGVkRW50aXRpZXNGb3JtO1xuICAgICAgICAgICAgICAgICRzY29wZS5yZXF1ZXN0ZWRFbnRpdGllc0Zvcm0uc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgc2VsZWN0ZWRWZXJzaW9uVG9Mb2FkID0gXy5maW5kKHRhc2tNYWluQ3RybC50YXNrRGF0YS52ZXJzaW9uc0ZvckxvYWQsIHtmYWJyaWNfZXhlY3V0aW9uX2lkOiB0YXNrTWFpbkN0cmwuc2VsZWN0ZWRWZXJzaW9uVG9Mb2FkfSk7XG4gICAgICAgICAgICB2YXIgdGFza0V4ZWN1dGlvbklkID0gXCJcIjtcbiAgICAgICAgICAgIHZhciBsdU5hbWVzID0gXCJcIjtcbiAgICAgICAgICAgIGlmIChzZWxlY3RlZFZlcnNpb25Ub0xvYWQpIHtcbiAgICAgICAgICAgICAgICB0YXNrRXhlY3V0aW9uSWQgPSBzZWxlY3RlZFZlcnNpb25Ub0xvYWQudGFza19leGVjdXRpb25faWQ7XG4gICAgICAgICAgICAgICAgbHVOYW1lcyA9IHNlbGVjdGVkVmVyc2lvblRvTG9hZC5sdV9uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHZlcnNpb25fZGF0ZXRpbWUgPSBuZXcgRGF0ZShzZWxlY3RlZFZlcnNpb25Ub0xvYWQudmVyc2lvbl9kYXRldGltZSk7XG4gICAgICAgICAgICB2YXIgbG9jYWxUaW1lWm9uZSA9IHZlcnNpb25fZGF0ZXRpbWUuZ2V0VGltZXpvbmVPZmZzZXQoKTtcbiAgICAgICAgICAgIHZlcnNpb25fZGF0ZXRpbWUgPSB2ZXJzaW9uX2RhdGV0aW1lLmdldFRpbWUoKSArIGxvY2FsVGltZVpvbmUgKiA2MDAwMDtcbiAgICAgICAgICAgIFRETVNlcnZpY2UucG9zdEdlbmVyaWNBUEkoJ2NoZWNrTWlncmF0ZVN0YXR1c0ZvckVudGl0aWVzTGlzdCcsIHtcbiAgICAgICAgICAgICAgICBlbnRpdGxlc0xpc3Q6IHRhc2tNYWluQ3RybC5yZXF1ZXN0ZWRFbnRpdGllcy5lbnRpdGllc19saXN0LFxuICAgICAgICAgICAgICAgIHRhc2tFeGVjdXRpb25JZDogdGFza0V4ZWN1dGlvbklkLFxuICAgICAgICAgICAgICAgIGx1TGlzdDogbHVOYW1lcyxcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yQ29kZSA9PSBcIlNVQ0NFU1NcIikge1xuICAgICAgICAgICAgICAgICAgICB2YXIgZmFpbGVkRW50aXRpZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIga2V5IGluIHJlc3BvbnNlLnJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnJlc3VsdFtrZXldID09IFwiZmFsc2VcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZhaWxlZEVudGl0aWVzLnB1c2goa2V5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAoZmFpbGVkRW50aXRpZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKFwiRW50aXRpZXMgXCIgKyBmYWlsZWRFbnRpdGllcyArIFwiIHdlcmUgbm90IG1pZ3JhdGVkIHN1Y2Nlc3NmdWxseSBpbnRvIHRoZSBURE0gc3RvcmFnZSBieSB0aGUgc2VsZWN0ZWQgdmVyc2lvbi4gUGxlYXNlIHJlbW92ZSB0aGVtIGZyb20gdGhlIEVudGl0aWVzIExpc3Qgb3Igc2VsZWN0IGFub3RoZXIgdmVyc2lvbiBcIik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwucmVxdWVzdGVkRW50aXRpZXNOZXh0KCRzY29wZS5yZXF1ZXN0ZWRFbnRpdGllc0Zvcm0sIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKFwiRmFpbGVkIHRvIGNoZWNrIE1pZ3JhdGUgU3RhdHVzIEZvciBFbnRpdGVzIExpc3RcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICB0YXNrTWFpbkN0cmwub3BlblN0ZXAgPSBmdW5jdGlvbiAoc3RlcCwgdHlwZSkge1xuICAgICAgICAgICAgaWYgKCEodGFza01haW5DdHJsLnVzZXJSb2xlVHlwZSA9PSAnYWRtaW4nIHx8IHRhc2tNYWluQ3RybC5zb3VyY2VFbnZPd25lciAmJiB0YXNrTWFpbkN0cmwudGFyZ2V0RW52T3duZXIpKSB7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnNlbGVjdEFsbEVudGl0ZXMgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0YXNrTWFpbkN0cmwuc3RlcCA9PSAyICYmIHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT0gJ0xPQUQnXG4gICAgICAgICAgICAgICAgJiYgdGFza01haW5DdHJsLnRhc2tEYXRhLnZlcnNpb25faW5kICYmICF0YXNrTWFpbkN0cmwudGFza0RhdGEuc2VsZWN0QWxsRW50aXRlcykge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlID09ICdiYWNrJyAmJiB0YXNrTWFpbkN0cmwudGFza0RhdGEucmVmZXJlbmNlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRhc2tNYWluQ3RybC5zdGVwID0gNjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHN0ZXAgPT0gMSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdGFza01haW5DdHJsLnN0ZXAgPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuY2hlY2tNaWdyYXRlU3RhdHVzKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGFycmF5U3RlcHMgPSB0YXNrTWFpbkN0cmwuZ2V0U3RlcHNBcnJheSgpO1xuICAgICAgICAgICAgdmFyIG5leHRTdGVwID0gc3RlcDtcbiAgICAgICAgICAgIHZhciBjdXJyZW50SW5kZXggPSBhcnJheVN0ZXBzLmluZGV4T2YodGFza01haW5DdHJsLnN0ZXApO1xuICAgICAgICAgICAgdmFyIG5leHRJbmRleCA9IGFycmF5U3RlcHMuaW5kZXhPZihzdGVwKTtcbiAgICAgICAgICAgIGlmIChuZXh0SW5kZXggPCBjdXJyZW50SW5kZXggJiYgbmV4dEluZGV4ID49IDApIHtcbiAgICAgICAgICAgICAgICBuZXh0U3RlcCA9IGFycmF5U3RlcHNbbmV4dEluZGV4XTtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuc3RlcCA9IG5leHRTdGVwO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0eXBlID09ICduZXh0Jykge1xuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50SW5kZXggPT0gYXJyYXlTdGVwcy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwidGhlcmUgaXMgbm8gbmV4dFwiKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIG5leHRTdGVwID0gYXJyYXlTdGVwc1tjdXJyZW50SW5kZXggKyAxXTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PSAnYmFjaycpIHtcbiAgICAgICAgICAgICAgICBpZiAoY3VycmVudEluZGV4ID09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ0aGVyZSBpcyBubyBiYWNrXCIpXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbmV4dFN0ZXAgPSBhcnJheVN0ZXBzW2N1cnJlbnRJbmRleCAtIDFdO1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5zdGVwID0gbmV4dFN0ZXA7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAodGFza01haW5DdHJsLnN0ZXAgPT0gMSkge1xuICAgICAgICAgICAgICAgIGlmICghJHNjb3BlLmdlbmVyYWxGb3JtLiR2YWxpZCl7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5nZW5lcmFsRm9ybSA9ICRzY29wZS5nZW5lcmFsRm9ybTtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLmdlbmVyYWxGb3JtLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLmdlbmVyYWxOZXh0KCRzY29wZS5nZW5lcmFsRm9ybSxuZXh0U3RlcCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXNrTWFpbkN0cmwuc3RlcCA9PSAyKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEkc2NvcGUucmVxdWVzdGVkRW50aXRpZXNGb3JtLiR2YWxpZCl7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5yZXF1ZXN0ZWRFbnRpdGllc0Zvcm0gPSAkc2NvcGUucmVxdWVzdGVkRW50aXRpZXNGb3JtO1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucmVxdWVzdGVkRW50aXRpZXNGb3JtLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnJlcXVlc3RlZEVudGl0aWVzTmV4dCgkc2NvcGUucmVxdWVzdGVkRW50aXRpZXNGb3JtLCBmYWxzZSwgbmV4dFN0ZXApO1xuICAgICAgICAgICAgICAgICRzY29wZS5yZXF1ZXN0ZWRFbnRpdGllc0Zvcm0uc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRhc2tNYWluQ3RybC5zdGVwID09IDMgJiYgISRzY29wZS5yZXF1ZXN0UGFyYW1ldGVyc0Zvcm0uJHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnJlcXVlc3RQYXJhbWV0ZXJzRm9ybSA9ICRzY29wZS5yZXF1ZXN0UGFyYW1ldGVyc0Zvcm07XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3RQYXJhbWV0ZXJzRm9ybS5zdWJtaXR0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFza01haW5DdHJsLnN0ZXAgPT0gNCAmJiAhJHNjb3BlLmV4ZWN1dGlvblRpbWluZ0Zvcm0uJHZhbGlkKSB7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLmV4ZWN1dGlvblRpbWluZ0Zvcm0gPSAkc2NvcGUuZXhlY3V0aW9uVGltaW5nRm9ybTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXhlY3V0aW9uVGltaW5nRm9ybS5zdWJtaXR0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFza01haW5DdHJsLnN0ZXAgPT0gNiAmJiAgISRzY29wZS5SZWZlcmVuY2VGb3JtLiR2YWxpZCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5SZWZlcmVuY2VGb3JtLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnJlZmVyZW5jZU5leHQobmV4dFN0ZXApO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFza01haW5DdHJsLnN0ZXAgPT0gNSkge1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5nbG9iYWxzTmV4dChuZXh0U3RlcCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGFza01haW5DdHJsLnN0ZXAgPSBuZXh0U3RlcDtcblxuICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC5zdGVwID09IDEpIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuZ2VuZXJhbEZvcm0uc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAodGFza01haW5DdHJsLnN0ZXAgPT0gMikge1xuICAgICAgICAgICAgICAgICRzY29wZS5nZXRFbnRpdGVzQ291bnQoKTtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudXBkYXRlUGFyYW1zKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3BhcmFtZXRlcnMgbG9hZGVkJyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3RlZEVudGl0aWVzRm9ybS5zdWJtaXR0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXNrTWFpbkN0cmwuc3RlcCA9PSAzKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLnJlcXVlc3RQYXJhbWV0ZXJzRm9ybS5zdWJtaXR0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0YXNrTWFpbkN0cmwuc3RlcCA9PSA0KSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmV4ZWN1dGlvblRpbWluZ0Zvcm0uc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBnZXRSb2xlRm9yVXNlckluRW52ID0gKGVudmlyb25tZW50X2lkLCBzb3VyY2UpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgVERNU2VydmljZS5nZXRSb2xlRm9yVXNlckluRW52KGVudmlyb25tZW50X2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JDb2RlID09IFwiU1VDQ0VTU1wiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXNvdXJjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC51c2VyUm9sZSA9IHJlc3BvbnNlLnJlc3VsdC51c2VyUm9sZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnNvdXJjZVVzZXJSb2xlID0gcmVzcG9uc2UucmVzdWx0LnVzZXJSb2xlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCh0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza190eXBlID09ICdMT0FEJyAmJiB0YXNrTWFpbkN0cmwudXNlclJvbGUuYWxsb3dlZF9lbnRpdHlfdmVyc2lvbmluZyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5zb3VyY2VVc2VyUm9sZS5hbGxvd2VkX2VudGl0eV92ZXJzaW9uaW5nKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0YXNrTWFpbkN0cmwudGFza0RhdGEudGFza190eXBlID09ICdFWFRSQUNUJyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuc291cmNlVXNlclJvbGUuYWxsb3dlZF9lbnRpdHlfdmVyc2lvbmluZykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuYWxsb3dlZF9lbnRpdHlfdmVyc2lvbmluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5hbGxvd2VkX2VudGl0eV92ZXJzaW9uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnZlcnNpb25faW5kID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbWluUmVhZCA9IHJlc3BvbnNlLnJlc3VsdC5taW5SZWFkO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1pbldyaXRlID0gcmVzcG9uc2UucmVzdWx0Lm1pbldyaXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdSRVNFUlZFJyAmJiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudXNlclJvbGUuYWxsb3dlZF9udW1iZXJfb2ZfcmVzZXJ2ZWRfZW50aXRpZXMgPCBtaW5Xcml0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaW5Xcml0ZSA9IHRhc2tNYWluQ3RybC51c2VyUm9sZS5hbGxvd2VkX251bWJlcl9vZl9yZXNlcnZlZF9lbnRpdGllcztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtaW5SZWFkID4gLTEgfHwgbWluV3JpdGUgPiAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pbldyaXRlID0gcGFyc2VJbnQobWluV3JpdGUgfHwgXCIwXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1pblJlYWQgPSBwYXJzZUludChtaW5SZWFkIHx8IFwiMFwiKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5zb3VyY2VNYXhUb0NvcHkgPSBtaW5SZWFkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodGFza01haW5DdHJsLm1heFRvQ29weSA+IG1pblJlYWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5tYXhUb0NvcHkgPSBtaW5SZWFkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0YXNrTWFpbkN0cmwubWF4VG9Db3B5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwubWF4VG9Db3B5ID0gbWluUmVhZDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXJnZXRNYXhUb0NvcHkgPSBtaW5Xcml0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC5tYXhUb0NvcHkgPiBtaW5Xcml0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLm1heFRvQ29weSA9IG1pbldyaXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKCF0YXNrTWFpbkN0cmwubWF4VG9Db3B5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwubWF4VG9Db3B5ID0gbWluV3JpdGU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKFwiVGFzayAjIFwiICsgdGFza01haW5DdHJsLnRhc2tEYXRhLnRhc2tfaWQsIFwiRmFpbGQgdG8gZ2V0IFJvbGUgZm9yIHVzZXIgXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBnZXRFbnZpcm9ubWVudE93bmVycyA9IChlbnZpcm9ubWVudF9pZCwgc291cmNlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgIFRETVNlcnZpY2UuZ2V0RW52aXJvbm1lbnRPd25lcnMoZW52aXJvbm1lbnRfaWQpLnRoZW4oKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5lcnJvckNvZGUgPT0gXCJTVUNDRVNTXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvd25lckZvdW5kID0gXy5maW5kKHJlc3BvbnNlLnJlc3VsdCwge3VzZXJfaWQ6IEF1dGhTZXJ2aWNlLmdldFVzZXJJZCgpfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW93bmVyRm91bmQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAwO2kgPCB0YXNrTWFpbkN0cmwudXNlckZhYnJpY1JvbGVzLmxlbmd0aCA7aSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG93bmVyRm91bmQgPSBfLmZpbmQocmVzcG9uc2UucmVzdWx0LHt1c2VyX3R5cGU6ICdHUk9VUCcsIHVzZXJfaWQ6IHRhc2tNYWluQ3RybC51c2VyRmFicmljUm9sZXNbaV19KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG93bmVyRm91bmQpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgdXNlclJvbGVGaWVsZCA9ICd1c2VyUm9sZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlclJvbGVGaWVsZCA9ICdzb3VyY2VVc2VyUm9sZSc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAob3duZXJGb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybFt1c2VyUm9sZUZpZWxkXSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybFt1c2VyUm9sZUZpZWxkXS5hbGxvd2VkX3JhbmRvbV9lbnRpdHlfc2VsZWN0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmxbdXNlclJvbGVGaWVsZF0uYWxsb3dlZF9jcmVhdGlvbl9vZl9zeW50aGV0aWNfZGF0YSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsW3VzZXJSb2xlRmllbGRdLmFsbG93ZWRfcmVmcmVzaF9yZWZlcmVuY2VfZGF0YSA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsW3VzZXJSb2xlRmllbGRdLmFsbG93ZWRfcmVxdWVzdF9vZl9mcmVzaF9kYXRhID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmxbdXNlclJvbGVGaWVsZF0uYWxsb3dlZF9kZWxldGVfYmVmb3JlX2xvYWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybFt1c2VyUm9sZUZpZWxkXS5hbGxvd2VkX3Rhc2tfc2NoZWR1bGluZyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsW3VzZXJSb2xlRmllbGRdLmFsbG93ZWRfcmVwbGFjZV9zZXF1ZW5jZXMgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS5udW1fb2ZfZW50aXRpZXMgPSBwYXJzZUludCh0YXNrTWFpbkN0cmwudGFza0RhdGEubnVtX29mX2VudGl0aWVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc291cmNlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC5zb3VyY2VFbnZPd25lciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhcmdldEVudk93bmVyID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNvdXJjZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwuc291cmNlRW52T3duZXIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFyZ2V0RW52T3duZXIgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShmYWxzZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKFwiRW52aXJvbm1lbnQgIyBcIiArIGVudmlyb25tZW50X2lkIHx8IHRhc2tNYWluQ3RybC50YXNrRGF0YS5lbnZpcm9ubWVudF9pZCwgXCJmYWlsZWQgdG8gZ2V0IG93bmVycyA6IFwiICsgcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBnZXRSb2xlRGF0YSA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmICh1c2VyUm9sZS50eXBlID09ICdhZG1pbicpIHtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudXNlclJvbGUgPSB7fTtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudXNlclJvbGUuYWxsb3dlZF9yYW5kb21fZW50aXR5X3NlbGVjdGlvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnVzZXJSb2xlLmFsbG93ZWRfY3JlYXRpb25fb2Zfc3ludGhldGljX2RhdGEgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC51c2VyUm9sZS5hbGxvd2VkX3JlZnJlc2hfcmVmZXJlbmNlX2RhdGEgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC51c2VyUm9sZS5hbGxvd2VkX3JlcXVlc3Rfb2ZfZnJlc2hfZGF0YSA9IHRydWU7XG4gICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnVzZXJSb2xlLmFsbG93ZWRfZGVsZXRlX2JlZm9yZV9sb2FkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudXNlclJvbGUuYWxsb3dlZF90YXNrX3NjaGVkdWxpbmcgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC51c2VyUm9sZS5hbGxvd2VkX3JlcGxhY2Vfc2VxdWVuY2VzID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwubWF4VG9Db3B5ID0gbnVsbDtcbiAgICAgICAgICAgICAgICB0YXNrTWFpbkN0cmwudGFza0RhdGEubnVtX29mX2VudGl0aWVzID0gcGFyc2VJbnQodGFza01haW5DdHJsLnRhc2tEYXRhLm51bV9vZl9lbnRpdGllcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb21pc2VzID0gW107XG4gICAgICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdFWFRSQUNUJyB8fCBcbiAgICAgICAgICAgICAgICAgICAgdGFza01haW5DdHJsLnRhc2tEYXRhLnRhc2tfdHlwZSA9PT0gJ0xPQUQnICYmIHRhc2tNYWluQ3RybC50YXNrRGF0YS5sb2FkX2VudGl0eSkge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKGdldEVudmlyb25tZW50T3duZXJzKHRhc2tNYWluQ3RybC50YXNrRGF0YS5zb3VyY2VfZW52aXJvbm1lbnRfaWQsIHRydWUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgIT09ICdFWFRSQUNUJykge1xuICAgICAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKGdldEVudmlyb25tZW50T3duZXJzKHRhc2tNYWluQ3RybC50YXNrRGF0YS5lbnZpcm9ubWVudF9pZCwgZmFsc2UpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm9sZVByb21pc2VzID0gW107XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAoKHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdFWFRSQUNUJyB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdMT0FEJyAmJiB0YXNrTWFpbkN0cmwudGFza0RhdGEubG9hZF9lbnRpdHkpICYmICF0YXNrTWFpbkN0cmwuc291cmNlRW52T3duZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb2xlUHJvbWlzZXMucHVzaChnZXRSb2xlRm9yVXNlckluRW52KHRhc2tNYWluQ3RybC50YXNrRGF0YS5zb3VyY2VfZW52aXJvbm1lbnRfaWQsIHRydWUpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodGFza01haW5DdHJsLnRhc2tEYXRhLnRhc2tfdHlwZSAhPT0gJ0VYVFJBQ1QnICYmICF0YXNrTWFpbkN0cmwudGFyZ2V0RW52T3duZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJvbGVQcm9taXNlcy5wdXNoKGdldFJvbGVGb3JVc2VySW5FbnYodGFza01haW5DdHJsLnRhc2tEYXRhLmVudmlyb25tZW50X2lkLCBmYWxzZSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFByb21pc2UuYWxsKHJvbGVQcm9taXNlcykudGhlbihyb2xlUmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdnb3QgUm9sZSByZXN1bHRzJyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgQnJlYWRDcnVtYnNTZXJ2aWNlLnB1c2goe3Rhc2tfaWQ6IHRhc2tNYWluQ3RybC50YXNrRGF0YS50YXNrX3RpdGxlfSwgJ1RBU0tfQlJFQURDUlVNQicsIGZ1bmN0aW9uICgpIHtcblxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiRVwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogdGVtcGxhdGUsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBjb250ZW50OiAnPSdcbiAgICAgICAgfSxcbiAgICAgICAgY29udHJvbGxlcjogY29udHJvbGxlcixcbiAgICAgICAgY29udHJvbGxlckFzOiAndGFza01haW5DdHJsJ1xuICAgIH07XG59XG5cblxuYW5ndWxhclxuICAgIC5tb2R1bGUoJ1RETS1GRScpXG4gICAgLmRpcmVjdGl2ZSgndGFza01haW4nLCB0YXNrTWFpbik7XG4iXX0=
