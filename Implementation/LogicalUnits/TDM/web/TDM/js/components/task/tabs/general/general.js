function generalTab(){return{restrict:"E",templateUrl:"js/components/task/tabs/general/general.html",scope:{content:"=",generalForm:"=",disabled:"=",copyTask:"="},controller:function($scope,TDMService,toastr,$timeout,AuthService,$state,DTOptionsBuilder,DTColumnBuilder,$q,$compile){var generalTabCtrl=this;generalTabCtrl.disabled=$scope.disabled,generalTabCtrl.taskData=$scope.content,generalTabCtrl.extract=!1,generalTabCtrl.load=!1,generalTabCtrl.delete=!1,generalTabCtrl.reserve=!1,generalTabCtrl.sourceEnvType="",generalTabCtrl.taskTitlePattern="^((?!_).)*$",generalTabCtrl.TaskTypeHints={1e3:["Extract the data from source environment into the TDM warehouse"],1100:["Refresh data from source and load (provision) it to target environment"],1101:["Extract the data from source environment","Provision (load) the data to the target environment and mark the entities as reserved"],1110:["Extract the data from source environment","Delete and reprovision (reload) the data to the target environment"],1111:["Extract data from source environment","Delete and reload (reprovision) data to target environment","Mark entities as reserved"],"0100":["Provision data to the target environment"],"0101":["Get data from TDM warehouse and load (provision) it to target environment","Mark entities as reserved"],"0110":["Get the data from the TDM warehouse","Delete and reprovision (reload) it to the target environment"],"0111":["Get data from TDM warehouse","Delete and reload (reprovision) data to target environment","Mark entities as reserved"],"0010":["Delete (clean) entities from target environment"],"0001":["Reserve entities in the target environment."]},TDMService.getActiveBusinessentitiesAPI().then(response=>{"SUCCESS"===response.errorCode?generalTabCtrl.businessEnttites=response.result:generalTabCtrl.businessEnttites=[],generalTabCtrl.taskData.be_id&&generalTabCtrl.businessEntityChange(!0)}),generalTabCtrl.taskTitleChange=()=>{$scope.generalForm.taskTitle.$setValidity("alreadyExist",!0)},generalTabCtrl.environmentChange=(init,type)=>{if(!generalTabCtrl.taskData.be_id||"EXTRACT"===generalTabCtrl.taskData.task_type&&!generalTabCtrl.taskData.source_environment_id||"RESERVE"===generalTabCtrl.taskData.task_type&&!generalTabCtrl.taskData.environment_id||"LOAD"===generalTabCtrl.taskData.task_type&&generalTabCtrl.taskData.delete_before_load&&generalTabCtrl.load&&!generalTabCtrl.taskData.environment_id||"LOAD"===generalTabCtrl.taskData.task_type&&generalTabCtrl.load&&(!generalTabCtrl.taskData.environment_id||!generalTabCtrl.taskData.source_environment_id))return;if(init||("src"===type&&generalTabCtrl.taskData.source_env_name&&(generalTabCtrl.srcEnvChanged=!0),"target"===type&&generalTabCtrl.taskData.environment_name&&(generalTabCtrl.targetEnvChanged=!0),generalTabCtrl.taskData.source_environment_id||(generalTabCtrl.srcEnvChanged=!1),generalTabCtrl.taskData.environment_id||(generalTabCtrl.targetEnvChanged=!1)),generalTabCtrl.taskData.source_environment_id){const source_env=_.find(generalTabCtrl.sourceEnvironments,{environment_id:generalTabCtrl.taskData.source_environment_id});source_env&&(generalTabCtrl.taskData.source_env_name=source_env.environment_name)}if(generalTabCtrl.taskData.environment_id){const target_env=_.find(generalTabCtrl.targetEnvironments,{environment_id:generalTabCtrl.taskData.environment_id});target_env&&(generalTabCtrl.taskData.environment_name=target_env.environment_name)}const promises=[];generalTabCtrl.taskData.source_environment_id&&promises.push(TDMService.getLogicalUnitsForBusinessEntityAndEnv(generalTabCtrl.taskData.be_id,generalTabCtrl.taskData.source_environment_id)),generalTabCtrl.taskData.environment_id&&promises.push(TDMService.getLogicalUnitsForBusinessEntityAndEnv(generalTabCtrl.taskData.be_id,generalTabCtrl.taskData.environment_id)),Promise.all(promises).then(responses=>{"SUCCESS"==responses[0].errorCode?(generalTabCtrl.taskData.allLogicalUnits=responses[0].result,responses[1]&&"SUCCESS"==responses[1].errorCode&&(generalTabCtrl.taskData.allLogicalUnits=generalTabCtrl.taskData.allLogicalUnits.concat(responses[1].result)),generalTabCtrl.taskData.allLogicalUnits=_.unique(generalTabCtrl.taskData.allLogicalUnits,"lu_name"),init||(generalTabCtrl.taskData.selectedLogicalUnits=generalTabCtrl.taskData.allLogicalUnits)):toastr.error("Business entity # "+generalTabCtrl.taskData.be_id,"Failed to get Logical units")})},generalTabCtrl.businessEntityChange=init=>{const foundBE=generalTabCtrl.businessEnttites.find(it=>it.be_id===generalTabCtrl.taskData.be_id);foundBE?TDMService.getEnvironmentsByUserandBe(foundBE.be_name).then(response=>{"FAILURE"!==response.errorCode?(generalTabCtrl.sourceEnvironments=_.filter(angular.copy(response.result),(function(env){return"SOURCE"===env.environment_type||"BOTH"===env.environment_type})),generalTabCtrl.targetEnvironments=_.filter(angular.copy(response.result),(function(env){return"TARGET"===env.environment_type||"BOTH"===env.environment_type}))):(generalTabCtrl.sourceEnvironments=[],generalTabCtrl.targetEnvironments=[]),init?generalTabCtrl.environmentChange(!0):(generalTabCtrl.taskData.source_environment_id=null,generalTabCtrl.taskData.environment_id=null)}):console.error("cannot find be name")},generalTabCtrl.taskTypeChange=()=>{if(!(generalTabCtrl.extract||generalTabCtrl.load||generalTabCtrl.reserve||generalTabCtrl.delete))return generalTabCtrl.taskData.task_type="",void(generalTabCtrl.sourceEnvType="Extract from");generalTabCtrl.taskData.extractSelected=!1,generalTabCtrl.extract&&(generalTabCtrl.taskData.extractSelected=!0),generalTabCtrl.extract&&!generalTabCtrl.load?(generalTabCtrl.taskData.task_type="EXTRACT",generalTabCtrl.taskData.load_entity=!1,generalTabCtrl.taskData.delete_before_load=!1,generalTabCtrl.taskData.reserve_ind=!1,generalTabCtrl.sourceEnvType="Extract from"):generalTabCtrl.reserve&&!generalTabCtrl.load?(generalTabCtrl.taskData.task_type="RESERVE",generalTabCtrl.taskData.load_entity=!1,generalTabCtrl.taskData.delete_before_load=!1,generalTabCtrl.taskData.reserve_ind=!0,generalTabCtrl.sourceEnvType="Reseve in"):generalTabCtrl.delete&&!generalTabCtrl.load?(generalTabCtrl.taskData.task_type="LOAD",generalTabCtrl.taskData.load_entity=!1,generalTabCtrl.taskData.delete_before_load=!0,generalTabCtrl.taskData.reserve_ind=!1,generalTabCtrl.sourceEnvType="Delete from"):(generalTabCtrl.sourceEnvType="Load (provision) to",generalTabCtrl.taskData.task_type="LOAD",generalTabCtrl.taskData.load_entity=!0,generalTabCtrl.delete?generalTabCtrl.taskData.delete_before_load=!0:generalTabCtrl.taskData.delete_before_load=!1,generalTabCtrl.reserve?generalTabCtrl.taskData.reserve_ind=!0:generalTabCtrl.taskData.reserve_ind=!1)},generalTabCtrl.closeAdvanedOptions=()=>{generalTabCtrl.advancedOptionsToggle=!1},generalTabCtrl.toggleAdvanedOptions=()=>{!generalTabCtrl.disableChange&&(generalTabCtrl.extract||generalTabCtrl.load||generalTabCtrl.delete||generalTabCtrl.reserve)?generalTabCtrl.advancedOptionsToggle=!generalTabCtrl.advancedOptionsToggle:generalTabCtrl.advancedOptionsToggle=!1},generalTabCtrl.updateLogicalUnits=selectedLUs=>{generalTabCtrl.taskData.selectedLogicalUnits=angular.copy(selectedLUs)},"EXTRACT"===generalTabCtrl.taskData.task_type?(generalTabCtrl.extract=!0,generalTabCtrl.taskData.extractSelected=!0):"RESERVE"===generalTabCtrl.taskData.task_type?generalTabCtrl.reserve=!0:"LOAD"===generalTabCtrl.taskData.task_type&&(generalTabCtrl.load=!0,generalTabCtrl.taskData.load_entity||"refernceOnly"===generalTabCtrl.taskData.reference?("refernceOnly"===generalTabCtrl.taskData.reference||"FORCE"!==generalTabCtrl.taskData.sync_mode&&generalTabCtrl.taskData.sync_mode)&&("refernceOnly"!==generalTabCtrl.taskData.reference||generalTabCtrl.taskData.version_ind)||(generalTabCtrl.extract=!0,generalTabCtrl.taskData.extractSelected=!0):generalTabCtrl.load=!1,generalTabCtrl.taskData.delete_before_load&&(generalTabCtrl.delete=!0),generalTabCtrl.taskData.reserve_ind&&(generalTabCtrl.reserve=!0)),generalTabCtrl.envChangeNoteDisplay=()=>{},generalTabCtrl.taskTypeChange(),generalTabCtrl.taskData.task_id&&(generalTabCtrl.editMode=!0,generalTabCtrl.taskData.selectedLogicalUnits||TDMService.getTaskLogicalUnits(generalTabCtrl.taskData.task_id).then((function(response){"SUCCESS"==response.errorCode?generalTabCtrl.taskData.selectedLogicalUnits=response.result:toastr.error("Systems # "+generalTabCtrl.taskData.task_id,"Failed to get Task Systems")})))},controllerAs:"generalTabCtrl"}}angular.module("TDM-FE").directive("generalTab",generalTab);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvdGFzay90YWJzL2dlbmVyYWwvZ2VuZXJhbC5qcyJdLCJuYW1lcyI6WyJnZW5lcmFsVGFiIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZVVybCIsInNjb3BlIiwiY29udGVudCIsImdlbmVyYWxGb3JtIiwiZGlzYWJsZWQiLCJjb3B5VGFzayIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCJURE1TZXJ2aWNlIiwidG9hc3RyIiwiJHRpbWVvdXQiLCJBdXRoU2VydmljZSIsIiRzdGF0ZSIsIkRUT3B0aW9uc0J1aWxkZXIiLCJEVENvbHVtbkJ1aWxkZXIiLCIkcSIsIiRjb21waWxlIiwiZ2VuZXJhbFRhYkN0cmwiLCJ0aGlzIiwidGFza0RhdGEiLCJleHRyYWN0IiwibG9hZCIsImRlbGV0ZSIsInJlc2VydmUiLCJzb3VyY2VFbnZUeXBlIiwidGFza1RpdGxlUGF0dGVybiIsIlRhc2tUeXBlSGludHMiLCIxMDAwIiwiMTEwMCIsIjExMDEiLCIxMTEwIiwiMTExMSIsIjAxMDAiLCIwMTAxIiwiMDExMCIsIjAxMTEiLCIwMDEwIiwiMDAwMSIsImdldEFjdGl2ZUJ1c2luZXNzZW50aXRpZXNBUEkiLCJ0aGVuIiwicmVzcG9uc2UiLCJlcnJvckNvZGUiLCJidXNpbmVzc0VudHRpdGVzIiwicmVzdWx0IiwiYmVfaWQiLCJidXNpbmVzc0VudGl0eUNoYW5nZSIsInRhc2tUaXRsZUNoYW5nZSIsInRhc2tUaXRsZSIsIiRzZXRWYWxpZGl0eSIsImVudmlyb25tZW50Q2hhbmdlIiwiaW5pdCIsInR5cGUiLCJ0YXNrX3R5cGUiLCJzb3VyY2VfZW52aXJvbm1lbnRfaWQiLCJlbnZpcm9ubWVudF9pZCIsImRlbGV0ZV9iZWZvcmVfbG9hZCIsInNvdXJjZV9lbnZfbmFtZSIsInNyY0VudkNoYW5nZWQiLCJlbnZpcm9ubWVudF9uYW1lIiwidGFyZ2V0RW52Q2hhbmdlZCIsInNvdXJjZV9lbnYiLCJfIiwiZmluZCIsInNvdXJjZUVudmlyb25tZW50cyIsInRhcmdldF9lbnYiLCJ0YXJnZXRFbnZpcm9ubWVudHMiLCJwcm9taXNlcyIsInB1c2giLCJnZXRMb2dpY2FsVW5pdHNGb3JCdXNpbmVzc0VudGl0eUFuZEVudiIsIlByb21pc2UiLCJhbGwiLCJyZXNwb25zZXMiLCJhbGxMb2dpY2FsVW5pdHMiLCJjb25jYXQiLCJ1bmlxdWUiLCJzZWxlY3RlZExvZ2ljYWxVbml0cyIsImVycm9yIiwiZm91bmRCRSIsIml0IiwiZ2V0RW52aXJvbm1lbnRzQnlVc2VyYW5kQmUiLCJiZV9uYW1lIiwiZmlsdGVyIiwiYW5ndWxhciIsImNvcHkiLCJlbnYiLCJlbnZpcm9ubWVudF90eXBlIiwiY29uc29sZSIsInRhc2tUeXBlQ2hhbmdlIiwiZXh0cmFjdFNlbGVjdGVkIiwibG9hZF9lbnRpdHkiLCJyZXNlcnZlX2luZCIsImNsb3NlQWR2YW5lZE9wdGlvbnMiLCJhZHZhbmNlZE9wdGlvbnNUb2dnbGUiLCJ0b2dnbGVBZHZhbmVkT3B0aW9ucyIsImRpc2FibGVDaGFuZ2UiLCJ1cGRhdGVMb2dpY2FsVW5pdHMiLCJzZWxlY3RlZExVcyIsInJlZmVyZW5jZSIsInN5bmNfbW9kZSIsInZlcnNpb25faW5kIiwiZW52Q2hhbmdlTm90ZURpc3BsYXkiLCJ0YXNrX2lkIiwiZWRpdE1vZGUiLCJnZXRUYXNrTG9naWNhbFVuaXRzIiwiY29udHJvbGxlckFzIiwibW9kdWxlIiwiZGlyZWN0aXZlIl0sIm1hcHBpbmdzIjoiQUFBQSxTQUFTQSxhQTZSTCxNQUFPLENBQ0hDLFNBQVUsSUFDVkMsWUE3UlcsK0NBOFJYQyxNQUFPLENBQ0hDLFFBQVMsSUFDVEMsWUFBYSxJQUNiQyxTQUFVLElBQ1ZDLFNBQVUsS0FFZEMsV0FsU2EsU0FBVUMsT0FBUUMsV0FBWUMsT0FBUUMsU0FBVUMsWUFBYUMsT0FBUUMsaUJBQWtCQyxnQkFBaUJDLEdBQUlDLFVBQ3pILElBQUlDLGVBQWlCQyxLQUNyQkQsZUFBZWIsU0FBV0csT0FBT0gsU0FDakNhLGVBQWVFLFNBQVdaLE9BQU9MLFFBQ2pDZSxlQUFlRyxTQUFVLEVBQ3pCSCxlQUFlSSxNQUFPLEVBQ3RCSixlQUFlSyxRQUFTLEVBQ3hCTCxlQUFlTSxTQUFVLEVBQ3pCTixlQUFlTyxjQUFnQixHQUMvQlAsZUFBZVEsaUJBQW1CLGNBRWxDUixlQUFlUyxjQUFnQixDQUMzQkMsSUFBUyxDQUFDLG1FQUNWQyxLQUFTLENBQUMsMEVBQ1ZDLEtBQVMsQ0FDTCwyQ0FDQSx5RkFFSkMsS0FBUyxDQUNMLDJDQUNBLHNFQUVKQyxLQUFTLENBQ0wsdUNBQ0EsNkRBQ0EsNkJBRUpDLE9BQVMsQ0FDTCw0Q0FFSkMsT0FBUyxDQUNMLDRFQUNBLDZCQUVKQyxPQUFTLENBQ0wsc0NBQ0EsZ0VBRUpDLE9BQVMsQ0FDTCw4QkFDQSw2REFDQSw2QkFFSkMsT0FBUyxDQUNMLG1EQUVKQyxPQUFTLENBQ0wsZ0RBSVI3QixXQUFXOEIsK0JBQStCQyxLQUFNQyxXQUNqQixZQUF2QkEsU0FBU0MsVUFDVHhCLGVBQWV5QixpQkFBbUJGLFNBQVNHLE9BRzNDMUIsZUFBZXlCLGlCQUFtQixHQUdsQ3pCLGVBQWVFLFNBQVN5QixPQUN4QjNCLGVBQWU0QixzQkFBcUIsS0FJNUM1QixlQUFlNkIsZ0JBQWtCLEtBQzdCdkMsT0FBT0osWUFBWTRDLFVBQVVDLGFBQWEsZ0JBQWdCLElBRzlEL0IsZUFBZWdDLGtCQUFvQixDQUFDQyxLQUFNQyxRQUN0QyxJQUFLbEMsZUFBZUUsU0FBU3lCLE9BQ2MsWUFBdEMzQixlQUFlRSxTQUFTaUMsWUFBNEJuQyxlQUFlRSxTQUFTa0MsdUJBQ3RDLFlBQXRDcEMsZUFBZUUsU0FBU2lDLFlBQTRCbkMsZUFBZUUsU0FBU21DLGdCQUN0QyxTQUF0Q3JDLGVBQWVFLFNBQVNpQyxXQUF3Qm5DLGVBQWVFLFNBQVNvQyxvQkFBc0J0QyxlQUFlSSxPQUFTSixlQUFlRSxTQUFTbUMsZ0JBQ3hHLFNBQXRDckMsZUFBZUUsU0FBU2lDLFdBQXdCbkMsZUFBZUksUUFBVUosZUFBZUUsU0FBU21DLGlCQUFtQnJDLGVBQWVFLFNBQVNrQyx1QkFDN0ksT0FnQkosR0FkS0gsT0FDWSxRQUFUQyxNQUFrQmxDLGVBQWVFLFNBQVNxQyxrQkFDMUN2QyxlQUFld0MsZUFBZ0IsR0FFdEIsV0FBVE4sTUFBcUJsQyxlQUFlRSxTQUFTdUMsbUJBQzdDekMsZUFBZTBDLGtCQUFtQixHQUVqQzFDLGVBQWVFLFNBQVNrQyx3QkFDekJwQyxlQUFld0MsZUFBZ0IsR0FFOUJ4QyxlQUFlRSxTQUFTbUMsaUJBQ3pCckMsZUFBZTBDLGtCQUFtQixJQUd0QzFDLGVBQWVFLFNBQVNrQyxzQkFBc0IsQ0FDOUMsTUFBTU8sV0FBYUMsRUFBRUMsS0FBSzdDLGVBQWU4QyxtQkFBbUIsQ0FBQ1QsZUFBZ0JyQyxlQUFlRSxTQUFTa0Msd0JBQ2pHTyxhQUNBM0MsZUFBZUUsU0FBU3FDLGdCQUFrQkksV0FBV0Ysa0JBRzdELEdBQUl6QyxlQUFlRSxTQUFTbUMsZUFBZSxDQUN2QyxNQUFNVSxXQUFhSCxFQUFFQyxLQUFLN0MsZUFBZWdELG1CQUFtQixDQUFDWCxlQUFnQnJDLGVBQWVFLFNBQVNtQyxpQkFDakdVLGFBQ0EvQyxlQUFlRSxTQUFTdUMsaUJBQW1CTSxXQUFXTixrQkFHOUQsTUFBTVEsU0FBVyxHQUNiakQsZUFBZUUsU0FBU2tDLHVCQUN4QmEsU0FBU0MsS0FBSzNELFdBQVc0RCx1Q0FBdUNuRCxlQUFlRSxTQUFTeUIsTUFBTzNCLGVBQWVFLFNBQVNrQyx3QkFFdkhwQyxlQUFlRSxTQUFTbUMsZ0JBQ3hCWSxTQUFTQyxLQUFLM0QsV0FBVzRELHVDQUF1Q25ELGVBQWVFLFNBQVN5QixNQUFPM0IsZUFBZUUsU0FBU21DLGlCQUUzSGUsUUFBUUMsSUFBSUosVUFBVTNCLEtBQUtnQyxZQUNPLFdBQTFCQSxVQUFVLEdBQUc5QixXQUNieEIsZUFBZUUsU0FBU3FELGdCQUFrQkQsVUFBVSxHQUFHNUIsT0FDbkQ0QixVQUFVLElBQWdDLFdBQTFCQSxVQUFVLEdBQUc5QixZQUM3QnhCLGVBQWVFLFNBQVNxRCxnQkFBa0J2RCxlQUFlRSxTQUFTcUQsZ0JBQWdCQyxPQUFPRixVQUFVLEdBQUc1QixTQUUxRzFCLGVBQWVFLFNBQVNxRCxnQkFBa0JYLEVBQUVhLE9BQU96RCxlQUFlRSxTQUFTcUQsZ0JBQWlCLFdBQ3ZGdEIsT0FDRGpDLGVBQWVFLFNBQVN3RCxxQkFBdUIxRCxlQUFlRSxTQUFTcUQsa0JBRzNFL0QsT0FBT21FLE1BQU0scUJBQXVCM0QsZUFBZUUsU0FBU3lCLE1BQU8sa0NBSS9FM0IsZUFBZTRCLHFCQUF3QkssT0FDbkMsTUFBTTJCLFFBQVU1RCxlQUFleUIsaUJBQWlCb0IsS0FBS2dCLElBQU1BLEdBQUdsQyxRQUFVM0IsZUFBZUUsU0FBU3lCLE9BQzNGaUMsUUFJTHJFLFdBQVd1RSwyQkFBMkJGLFFBQVFHLFNBQVN6QyxLQUFLQyxXQUM3QixZQUF2QkEsU0FBU0MsV0FDVHhCLGVBQWU4QyxtQkFBcUJGLEVBQUVvQixPQUFPQyxRQUFRQyxLQUFLM0MsU0FBU0csU0FBUyxTQUFVeUMsS0FDbEYsTUFBNkIsV0FBekJBLElBQUlDLGtCQUEwRCxTQUF6QkQsSUFBSUMsb0JBS2pEcEUsZUFBZWdELG1CQUFxQkosRUFBRW9CLE9BQU9DLFFBQVFDLEtBQUszQyxTQUFTRyxTQUFTLFNBQVV5QyxLQUNsRixNQUE2QixXQUF6QkEsSUFBSUMsa0JBQTBELFNBQXpCRCxJQUFJQyxzQkFPakRwRSxlQUFlOEMsbUJBQXFCLEdBQ3BDOUMsZUFBZWdELG1CQUFxQixJQUVuQ2YsS0FLRGpDLGVBQWVnQyxtQkFBa0IsSUFKakNoQyxlQUFlRSxTQUFTa0Msc0JBQXdCLEtBQ2hEcEMsZUFBZUUsU0FBU21DLGVBQWlCLFFBeEI3Q2dDLFFBQVFWLE1BQU0sd0JBZ0N0QjNELGVBQWVzRSxlQUFpQixLQUM1QixLQUFLdEUsZUFBZUcsU0FDZkgsZUFBZUksTUFDZkosZUFBZU0sU0FDZk4sZUFBZUssUUFHWixPQUZBTCxlQUFlRSxTQUFTaUMsVUFBWSxRQUNwQ25DLGVBQWVPLGNBQWdCLGdCQUd2Q1AsZUFBZUUsU0FBU3FFLGlCQUFrQixFQUN0Q3ZFLGVBQWVHLFVBQ2ZILGVBQWVFLFNBQVNxRSxpQkFBa0IsR0FFMUN2RSxlQUFlRyxVQUFZSCxlQUFlSSxNQUMxQ0osZUFBZUUsU0FBU2lDLFVBQVksVUFDcENuQyxlQUFlRSxTQUFTc0UsYUFBYyxFQUN0Q3hFLGVBQWVFLFNBQVNvQyxvQkFBcUIsRUFDN0N0QyxlQUFlRSxTQUFTdUUsYUFBZSxFQUN2Q3pFLGVBQWVPLGNBQWdCLGdCQUUxQlAsZUFBZU0sVUFBWU4sZUFBZUksTUFDL0NKLGVBQWVFLFNBQVNpQyxVQUFZLFVBQ3BDbkMsZUFBZUUsU0FBU3NFLGFBQWMsRUFDdEN4RSxlQUFlRSxTQUFTb0Msb0JBQXFCLEVBQzdDdEMsZUFBZUUsU0FBU3VFLGFBQWUsRUFDdkN6RSxlQUFlTyxjQUFnQixhQUUxQlAsZUFBZUssU0FBV0wsZUFBZUksTUFDOUNKLGVBQWVFLFNBQVNpQyxVQUFZLE9BQ3BDbkMsZUFBZUUsU0FBU3NFLGFBQWMsRUFDdEN4RSxlQUFlRSxTQUFTb0Msb0JBQXFCLEVBQzdDdEMsZUFBZUUsU0FBU3VFLGFBQWUsRUFDdkN6RSxlQUFlTyxjQUFnQixnQkFHL0JQLGVBQWVPLGNBQWdCLHNCQUMvQlAsZUFBZUUsU0FBU2lDLFVBQVksT0FDcENuQyxlQUFlRSxTQUFTc0UsYUFBYyxFQUlsQ3hFLGVBQWVLLE9BQ2ZMLGVBQWVFLFNBQVNvQyxvQkFBcUIsRUFHN0N0QyxlQUFlRSxTQUFTb0Msb0JBQXFCLEVBRTdDdEMsZUFBZU0sUUFDZk4sZUFBZUUsU0FBU3VFLGFBQWUsRUFHdkN6RSxlQUFlRSxTQUFTdUUsYUFBZSxJQUtuRHpFLGVBQWUwRSxvQkFBc0IsS0FDakMxRSxlQUFlMkUsdUJBQXdCLEdBRzNDM0UsZUFBZTRFLHFCQUF1QixNQUM5QjVFLGVBQWU2RSxnQkFDZDdFLGVBQWVHLFNBQ2ZILGVBQWVJLE1BQ2ZKLGVBQWVLLFFBQ2ZMLGVBQWVNLFNBSXBCTixlQUFlMkUsdUJBQXlCM0UsZUFBZTJFLHNCQUgvQzNFLGVBQWUyRSx1QkFBd0IsR0FNbkQzRSxlQUFlOEUsbUJBQXNCQyxjQUNqQy9FLGVBQWVFLFNBQVN3RCxxQkFBdUJPLFFBQVFDLEtBQUthLGNBR3RCLFlBQXRDL0UsZUFBZUUsU0FBU2lDLFdBQ3hCbkMsZUFBZUcsU0FBVSxFQUN6QkgsZUFBZUUsU0FBU3FFLGlCQUFrQixHQUVDLFlBQXRDdkUsZUFBZUUsU0FBU2lDLFVBQzdCbkMsZUFBZU0sU0FBVSxFQUVrQixTQUF0Q04sZUFBZUUsU0FBU2lDLFlBQzdCbkMsZUFBZUksTUFBTyxFQUNqQkosZUFBZUUsU0FBU3NFLGFBQXFELGlCQUF0Q3hFLGVBQWVFLFNBQVM4RSxXQUkxQixpQkFBdENoRixlQUFlRSxTQUFTOEUsV0FDZSxVQUF0Q2hGLGVBQWVFLFNBQVMrRSxXQUEwQmpGLGVBQWVFLFNBQVMrRSxhQUNwQyxpQkFBdENqRixlQUFlRSxTQUFTOEUsV0FBaUNoRixlQUFlRSxTQUFTZ0YsZUFDbEZsRixlQUFlRyxTQUFVLEVBQ3pCSCxlQUFlRSxTQUFTcUUsaUJBQWtCLEdBUDFDdkUsZUFBZUksTUFBTyxFQVN0QkosZUFBZUUsU0FBU29DLHFCQUNwQnRDLGVBQWVLLFFBQVMsR0FFNUJMLGVBQWVFLFNBQVN1RSxjQUNwQnpFLGVBQWVNLFNBQVUsSUFJckNOLGVBQWVtRixxQkFBdUIsT0FJdENuRixlQUFlc0UsaUJBQ1h0RSxlQUFlRSxTQUFTa0YsVUFDeEJwRixlQUFlcUYsVUFBVyxFQUNyQnJGLGVBQWVFLFNBQVN3RCxzQkFDekJuRSxXQUFXK0Ysb0JBQW9CdEYsZUFBZUUsU0FBU2tGLFNBQVM5RCxNQUFLLFNBQVVDLFVBQ2pELFdBQXRCQSxTQUFTQyxVQUNUeEIsZUFBZUUsU0FBU3dELHFCQUF1Qm5DLFNBQVNHLE9BRXhEbEMsT0FBT21FLE1BQU0sYUFBZTNELGVBQWVFLFNBQVNrRixRQUFTLG1DQWlCN0VHLGFBQWMsa0JBS3RCdEIsUUFDS3VCLE9BQU8sVUFDUEMsVUFBVSxhQUFjNUciLCJmaWxlIjoiY29tcG9uZW50cy90YXNrL3RhYnMvZ2VuZXJhbC9nZW5lcmFsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gZ2VuZXJhbFRhYigpIHtcblxuICAgIHZhciB0ZW1wbGF0ZSA9IFwianMvY29tcG9uZW50cy90YXNrL3RhYnMvZ2VuZXJhbC9nZW5lcmFsLmh0bWxcIjtcblxuICAgIHZhciBjb250cm9sbGVyID0gZnVuY3Rpb24gKCRzY29wZSwgVERNU2VydmljZSwgdG9hc3RyLCAkdGltZW91dCwgQXV0aFNlcnZpY2UsICRzdGF0ZSwgRFRPcHRpb25zQnVpbGRlciwgRFRDb2x1bW5CdWlsZGVyLCAkcSwgJGNvbXBpbGUpIHtcbiAgICAgICAgdmFyIGdlbmVyYWxUYWJDdHJsID0gdGhpcztcbiAgICAgICAgZ2VuZXJhbFRhYkN0cmwuZGlzYWJsZWQgPSAkc2NvcGUuZGlzYWJsZWQ7XG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhID0gJHNjb3BlLmNvbnRlbnQ7XG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLmV4dHJhY3QgPSBmYWxzZTtcbiAgICAgICAgZ2VuZXJhbFRhYkN0cmwubG9hZCA9IGZhbHNlO1xuICAgICAgICBnZW5lcmFsVGFiQ3RybC5kZWxldGUgPSBmYWxzZTtcbiAgICAgICAgZ2VuZXJhbFRhYkN0cmwucmVzZXJ2ZSA9IGZhbHNlO1xuICAgICAgICBnZW5lcmFsVGFiQ3RybC5zb3VyY2VFbnZUeXBlID0gJyc7XG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tUaXRsZVBhdHRlcm4gPSBcIl4oKD8hXykuKSokXCI7XG4gICAgICAgIFxuICAgICAgICBnZW5lcmFsVGFiQ3RybC5UYXNrVHlwZUhpbnRzID0ge1xuICAgICAgICAgICAgJzEwMDAnIDogWydFeHRyYWN0IHRoZSBkYXRhIGZyb20gc291cmNlIGVudmlyb25tZW50IGludG8gdGhlIFRETSB3YXJlaG91c2UnXSxcbiAgICAgICAgICAgICcxMTAwJyA6IFsnUmVmcmVzaCBkYXRhIGZyb20gc291cmNlIGFuZCBsb2FkIChwcm92aXNpb24pIGl0IHRvIHRhcmdldCBlbnZpcm9ubWVudCddLFxuICAgICAgICAgICAgJzExMDEnIDogW1xuICAgICAgICAgICAgICAgICdFeHRyYWN0IHRoZSBkYXRhIGZyb20gc291cmNlIGVudmlyb25tZW50JyxcbiAgICAgICAgICAgICAgICAnUHJvdmlzaW9uIChsb2FkKSB0aGUgZGF0YSB0byB0aGUgdGFyZ2V0IGVudmlyb25tZW50IGFuZCBtYXJrIHRoZSBlbnRpdGllcyBhcyByZXNlcnZlZCcsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgJzExMTAnIDogW1xuICAgICAgICAgICAgICAgICdFeHRyYWN0IHRoZSBkYXRhIGZyb20gc291cmNlIGVudmlyb25tZW50JyxcbiAgICAgICAgICAgICAgICAnRGVsZXRlIGFuZCByZXByb3Zpc2lvbiAocmVsb2FkKSB0aGUgZGF0YSB0byB0aGUgdGFyZ2V0IGVudmlyb25tZW50JyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAnMTExMScgOiBbXG4gICAgICAgICAgICAgICAgJ0V4dHJhY3QgZGF0YSBmcm9tIHNvdXJjZSBlbnZpcm9ubWVudCcsXG4gICAgICAgICAgICAgICAgJ0RlbGV0ZSBhbmQgcmVsb2FkIChyZXByb3Zpc2lvbikgZGF0YSB0byB0YXJnZXQgZW52aXJvbm1lbnQnLFxuICAgICAgICAgICAgICAgICdNYXJrIGVudGl0aWVzIGFzIHJlc2VydmVkJyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAnMDEwMCcgOiBbXG4gICAgICAgICAgICAgICAgJ1Byb3Zpc2lvbiBkYXRhIHRvIHRoZSB0YXJnZXQgZW52aXJvbm1lbnQnXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgJzAxMDEnIDogW1xuICAgICAgICAgICAgICAgICdHZXQgZGF0YSBmcm9tIFRETSB3YXJlaG91c2UgYW5kIGxvYWQgKHByb3Zpc2lvbikgaXQgdG8gdGFyZ2V0IGVudmlyb25tZW50JyxcbiAgICAgICAgICAgICAgICAnTWFyayBlbnRpdGllcyBhcyByZXNlcnZlZCcsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgJzAxMTAnIDogW1xuICAgICAgICAgICAgICAgICdHZXQgdGhlIGRhdGEgZnJvbSB0aGUgVERNIHdhcmVob3VzZScsXG4gICAgICAgICAgICAgICAgJ0RlbGV0ZSBhbmQgcmVwcm92aXNpb24gKHJlbG9hZCkgaXQgdG8gdGhlIHRhcmdldCBlbnZpcm9ubWVudCcsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgJzAxMTEnIDogW1xuICAgICAgICAgICAgICAgICdHZXQgZGF0YSBmcm9tIFRETSB3YXJlaG91c2UnLFxuICAgICAgICAgICAgICAgICdEZWxldGUgYW5kIHJlbG9hZCAocmVwcm92aXNpb24pIGRhdGEgdG8gdGFyZ2V0IGVudmlyb25tZW50JyxcbiAgICAgICAgICAgICAgICAnTWFyayBlbnRpdGllcyBhcyByZXNlcnZlZCcsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgJzAwMTAnIDogW1xuICAgICAgICAgICAgICAgICdEZWxldGUgKGNsZWFuKSBlbnRpdGllcyBmcm9tIHRhcmdldCBlbnZpcm9ubWVudCcsXG4gICAgICAgICAgICBdLFxuICAgICAgICAgICAgJzAwMDEnIDogW1xuICAgICAgICAgICAgICAgICdSZXNlcnZlIGVudGl0aWVzIGluIHRoZSB0YXJnZXQgZW52aXJvbm1lbnQuJyxcbiAgICAgICAgICAgIF0sXG4gICAgICAgIH1cblxuICAgICAgICBURE1TZXJ2aWNlLmdldEFjdGl2ZUJ1c2luZXNzZW50aXRpZXNBUEkoKS50aGVuKChyZXNwb25zZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yQ29kZSA9PT0gJ1NVQ0NFU1MnKSB7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwuYnVzaW5lc3NFbnR0aXRlcyA9IHJlc3BvbnNlLnJlc3VsdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLmJ1c2luZXNzRW50dGl0ZXMgPSBbXTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmJlX2lkKSB7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwuYnVzaW5lc3NFbnRpdHlDaGFuZ2UodHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tUaXRsZUNoYW5nZSA9ICgpID0+IHtcbiAgICAgICAgICAgICRzY29wZS5nZW5lcmFsRm9ybS50YXNrVGl0bGUuJHNldFZhbGlkaXR5KCdhbHJlYWR5RXhpc3QnLCB0cnVlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLmVudmlyb25tZW50Q2hhbmdlID0gKGluaXQsIHR5cGUpID0+IHtcbiAgICAgICAgICAgIGlmICghZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuYmVfaWQgfHwgXG4gICAgICAgICAgICAgICAgKGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnRhc2tfdHlwZSA9PT0gJ0VYVFJBQ1QnICYmICFnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5zb3VyY2VfZW52aXJvbm1lbnRfaWQpIHx8IFxuICAgICAgICAgICAgICAgIChnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdSRVNFUlZFJyAmJiAhZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuZW52aXJvbm1lbnRfaWQpIHx8IFxuICAgICAgICAgICAgICAgIChnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdMT0FEJyAmJiBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5kZWxldGVfYmVmb3JlX2xvYWQgJiYgZ2VuZXJhbFRhYkN0cmwubG9hZCAmJiAhZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuZW52aXJvbm1lbnRfaWQpIHx8IFxuICAgICAgICAgICAgICAgIChnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPT09ICdMT0FEJyAmJiBnZW5lcmFsVGFiQ3RybC5sb2FkICYmICghZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuZW52aXJvbm1lbnRfaWQgfHwgIWdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnNvdXJjZV9lbnZpcm9ubWVudF9pZCkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCFpbml0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdzcmMnICYmIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnNvdXJjZV9lbnZfbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC5zcmNFbnZDaGFuZ2VkID0gdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ3RhcmdldCcgJiYgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuZW52aXJvbm1lbnRfbmFtZSkge1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC50YXJnZXRFbnZDaGFuZ2VkID0gdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnNvdXJjZV9lbnZpcm9ubWVudF9pZCkge1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC5zcmNFbnZDaGFuZ2VkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuZW52aXJvbm1lbnRfaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFyZ2V0RW52Q2hhbmdlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5zb3VyY2VfZW52aXJvbm1lbnRfaWQpe1xuICAgICAgICAgICAgICAgIGNvbnN0IHNvdXJjZV9lbnYgPSBfLmZpbmQoZ2VuZXJhbFRhYkN0cmwuc291cmNlRW52aXJvbm1lbnRzLHtlbnZpcm9ubWVudF9pZDogZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuc291cmNlX2Vudmlyb25tZW50X2lkfSk7XG4gICAgICAgICAgICAgICAgaWYgKHNvdXJjZV9lbnYpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuc291cmNlX2Vudl9uYW1lID0gc291cmNlX2Vudi5lbnZpcm9ubWVudF9uYW1lO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5lbnZpcm9ubWVudF9pZCl7XG4gICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0X2VudiA9IF8uZmluZChnZW5lcmFsVGFiQ3RybC50YXJnZXRFbnZpcm9ubWVudHMse2Vudmlyb25tZW50X2lkOiBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5lbnZpcm9ubWVudF9pZH0pO1xuICAgICAgICAgICAgICAgIGlmICh0YXJnZXRfZW52KSB7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmVudmlyb25tZW50X25hbWUgPSB0YXJnZXRfZW52LmVudmlyb25tZW50X25hbWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBbXTtcbiAgICAgICAgICAgIGlmIChnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5zb3VyY2VfZW52aXJvbm1lbnRfaWQpIHtcbiAgICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKFRETVNlcnZpY2UuZ2V0TG9naWNhbFVuaXRzRm9yQnVzaW5lc3NFbnRpdHlBbmRFbnYoZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuYmVfaWQsIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnNvdXJjZV9lbnZpcm9ubWVudF9pZCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmVudmlyb25tZW50X2lkKSB7XG4gICAgICAgICAgICAgICAgcHJvbWlzZXMucHVzaChURE1TZXJ2aWNlLmdldExvZ2ljYWxVbml0c0ZvckJ1c2luZXNzRW50aXR5QW5kRW52KGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmJlX2lkLCBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5lbnZpcm9ubWVudF9pZCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4ocmVzcG9uc2VzID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VzWzBdLmVycm9yQ29kZSA9PSBcIlNVQ0NFU1NcIikge1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5hbGxMb2dpY2FsVW5pdHMgPSByZXNwb25zZXNbMF0ucmVzdWx0O1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2VzWzFdICYmIHJlc3BvbnNlc1sxXS5lcnJvckNvZGUgPT0gXCJTVUNDRVNTXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmFsbExvZ2ljYWxVbml0cyA9IGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmFsbExvZ2ljYWxVbml0cy5jb25jYXQocmVzcG9uc2VzWzFdLnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuYWxsTG9naWNhbFVuaXRzID0gXy51bmlxdWUoZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuYWxsTG9naWNhbFVuaXRzLCAnbHVfbmFtZScpOyBcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbml0KXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnNlbGVjdGVkTG9naWNhbFVuaXRzID0gZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuYWxsTG9naWNhbFVuaXRzO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKFwiQnVzaW5lc3MgZW50aXR5ICMgXCIgKyBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5iZV9pZCwgXCJGYWlsZWQgdG8gZ2V0IExvZ2ljYWwgdW5pdHNcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH07XG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLmJ1c2luZXNzRW50aXR5Q2hhbmdlID0gKGluaXQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZvdW5kQkUgPSBnZW5lcmFsVGFiQ3RybC5idXNpbmVzc0VudHRpdGVzLmZpbmQoaXQgPT4gaXQuYmVfaWQgPT09IGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmJlX2lkKTtcbiAgICAgICAgICAgIGlmICghZm91bmRCRSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignY2Fubm90IGZpbmQgYmUgbmFtZScpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFRETVNlcnZpY2UuZ2V0RW52aXJvbm1lbnRzQnlVc2VyYW5kQmUoZm91bmRCRS5iZV9uYW1lKS50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UuZXJyb3JDb2RlICE9PSAnRkFJTFVSRScpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwuc291cmNlRW52aXJvbm1lbnRzID0gXy5maWx0ZXIoYW5ndWxhci5jb3B5KHJlc3BvbnNlLnJlc3VsdCksIGZ1bmN0aW9uIChlbnYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnYuZW52aXJvbm1lbnRfdHlwZSA9PT0gJ1NPVVJDRScgfHwgZW52LmVudmlyb25tZW50X3R5cGUgPT09ICdCT1RIJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFyZ2V0RW52aXJvbm1lbnRzID0gXy5maWx0ZXIoYW5ndWxhci5jb3B5KHJlc3BvbnNlLnJlc3VsdCksIGZ1bmN0aW9uIChlbnYpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlbnYuZW52aXJvbm1lbnRfdHlwZSA9PT0gJ1RBUkdFVCcgfHwgZW52LmVudmlyb25tZW50X3R5cGUgPT09ICdCT1RIJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnNvdXJjZUVudmlyb25tZW50cyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC50YXJnZXRFbnZpcm9ubWVudHMgPSBbXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFpbml0KSB7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnNvdXJjZV9lbnZpcm9ubWVudF9pZCA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmVudmlyb25tZW50X2lkID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLmVudmlyb25tZW50Q2hhbmdlKHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tUeXBlQ2hhbmdlID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCFnZW5lcmFsVGFiQ3RybC5leHRyYWN0ICYmXG4gICAgICAgICAgICAgICAgIWdlbmVyYWxUYWJDdHJsLmxvYWQgJiZcbiAgICAgICAgICAgICAgICAhZ2VuZXJhbFRhYkN0cmwucmVzZXJ2ZSAmJlxuICAgICAgICAgICAgICAgICFnZW5lcmFsVGFiQ3RybC5kZWxldGUpe1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS50YXNrX3R5cGUgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwuc291cmNlRW52VHlwZSA9ICdFeHRyYWN0IGZyb20nO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5leHRyYWN0U2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChnZW5lcmFsVGFiQ3RybC5leHRyYWN0KSB7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuZXh0cmFjdFNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChnZW5lcmFsVGFiQ3RybC5leHRyYWN0ICYmICFnZW5lcmFsVGFiQ3RybC5sb2FkICkge1xuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnRhc2tfdHlwZSA9ICdFWFRSQUNUJztcbiAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5sb2FkX2VudGl0eSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmRlbGV0ZV9iZWZvcmVfbG9hZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnJlc2VydmVfaW5kICA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnNvdXJjZUVudlR5cGUgPSAnRXh0cmFjdCBmcm9tJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGdlbmVyYWxUYWJDdHJsLnJlc2VydmUgJiYgIWdlbmVyYWxUYWJDdHJsLmxvYWQgKSB7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEudGFza190eXBlID0gJ1JFU0VSVkUnO1xuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmxvYWRfZW50aXR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuZGVsZXRlX2JlZm9yZV9sb2FkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEucmVzZXJ2ZV9pbmQgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC5zb3VyY2VFbnZUeXBlID0gJ1Jlc2V2ZSBpbic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChnZW5lcmFsVGFiQ3RybC5kZWxldGUgJiYgIWdlbmVyYWxUYWJDdHJsLmxvYWQgKSB7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEudGFza190eXBlID0gJ0xPQUQnO1xuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmxvYWRfZW50aXR5ID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuZGVsZXRlX2JlZm9yZV9sb2FkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5yZXNlcnZlX2luZCAgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC5zb3VyY2VFbnZUeXBlID0gJ0RlbGV0ZSBmcm9tJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnNvdXJjZUVudlR5cGUgPSAnTG9hZCAocHJvdmlzaW9uKSB0byc7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEudGFza190eXBlID0gJ0xPQUQnO1xuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmxvYWRfZW50aXR5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAvLyBpZiAoZ2VuZXJhbFRhYkN0cmwuZXh0cmFjdCkge1xuICAgICAgICAgICAgICAgIC8vICAgICBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5zeW5jX21vZGUgPSBudWxsO1xuICAgICAgICAgICAgICAgIC8vIH1cbiAgICAgICAgICAgICAgICBpZiAoZ2VuZXJhbFRhYkN0cmwuZGVsZXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmRlbGV0ZV9iZWZvcmVfbG9hZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5kZWxldGVfYmVmb3JlX2xvYWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGdlbmVyYWxUYWJDdHJsLnJlc2VydmUpIHtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEucmVzZXJ2ZV9pbmQgID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnJlc2VydmVfaW5kICA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLmNsb3NlQWR2YW5lZE9wdGlvbnMgPSAoKSA9PiB7XG4gICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC5hZHZhbmNlZE9wdGlvbnNUb2dnbGUgPSBmYWxzZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLnRvZ2dsZUFkdmFuZWRPcHRpb25zID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKGdlbmVyYWxUYWJDdHJsLmRpc2FibGVDaGFuZ2UgfHwgXG4gICAgICAgICAgICAgICAgIWdlbmVyYWxUYWJDdHJsLmV4dHJhY3QgJiZcbiAgICAgICAgICAgICAgICAhZ2VuZXJhbFRhYkN0cmwubG9hZCAmJlxuICAgICAgICAgICAgICAgICFnZW5lcmFsVGFiQ3RybC5kZWxldGUgJiZcbiAgICAgICAgICAgICAgICAhZ2VuZXJhbFRhYkN0cmwucmVzZXJ2ZSl7XG4gICAgICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLmFkdmFuY2VkT3B0aW9uc1RvZ2dsZSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwuYWR2YW5jZWRPcHRpb25zVG9nZ2xlID0gIWdlbmVyYWxUYWJDdHJsLmFkdmFuY2VkT3B0aW9uc1RvZ2dsZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLnVwZGF0ZUxvZ2ljYWxVbml0cyA9IChzZWxlY3RlZExVcykgPT4ge1xuICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuc2VsZWN0ZWRMb2dpY2FsVW5pdHMgPSBhbmd1bGFyLmNvcHkoc2VsZWN0ZWRMVXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnRhc2tfdHlwZSA9PT0gJ0VYVFJBQ1QnKSB7XG4gICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC5leHRyYWN0ID0gdHJ1ZTtcbiAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLmV4dHJhY3RTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEudGFza190eXBlID09PSAnUkVTRVJWRScpIHtcbiAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnJlc2VydmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnRhc2tfdHlwZSA9PT0gJ0xPQUQnKSB7XG4gICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC5sb2FkID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICghZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEubG9hZF9lbnRpdHkgJiYgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEucmVmZXJlbmNlICE9PSAncmVmZXJuY2VPbmx5Jykge1xuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLmxvYWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKFxuICAgICAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnJlZmVyZW5jZSAhPT0gJ3JlZmVybmNlT25seScgJiZcbiAgICAgICAgICAgICAgICAoZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuc3luY19tb2RlID09PSAnRk9SQ0UnIHx8ICFnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5zeW5jX21vZGUpIHx8XG4gICAgICAgICAgICAgICAgKGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnJlZmVyZW5jZSA9PT0gJ3JlZmVybmNlT25seScgJiYgIWdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnZlcnNpb25faW5kKSl7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwuZXh0cmFjdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuZXh0cmFjdFNlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS5kZWxldGVfYmVmb3JlX2xvYWQpe1xuICAgICAgICAgICAgICAgICAgICBnZW5lcmFsVGFiQ3RybC5kZWxldGUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGdlbmVyYWxUYWJDdHJsLnRhc2tEYXRhLnJlc2VydmVfaW5kKXtcbiAgICAgICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwucmVzZXJ2ZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBnZW5lcmFsVGFiQ3RybC5lbnZDaGFuZ2VOb3RlRGlzcGxheSA9ICgpID0+IHtcblxuICAgICAgICB9O1xuXG4gICAgICAgIGdlbmVyYWxUYWJDdHJsLnRhc2tUeXBlQ2hhbmdlKCk7XG4gICAgICAgIGlmIChnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS50YXNrX2lkKXtcbiAgICAgICAgICAgIGdlbmVyYWxUYWJDdHJsLmVkaXRNb2RlID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmICghZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuc2VsZWN0ZWRMb2dpY2FsVW5pdHMpIHtcbiAgICAgICAgICAgICAgICBURE1TZXJ2aWNlLmdldFRhc2tMb2dpY2FsVW5pdHMoZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEudGFza19pZCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmVycm9yQ29kZSA9PSBcIlNVQ0NFU1NcIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2VuZXJhbFRhYkN0cmwudGFza0RhdGEuc2VsZWN0ZWRMb2dpY2FsVW5pdHMgPSByZXNwb25zZS5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoXCJTeXN0ZW1zICMgXCIgKyBnZW5lcmFsVGFiQ3RybC50YXNrRGF0YS50YXNrX2lkLCBcIkZhaWxlZCB0byBnZXQgVGFzayBTeXN0ZW1zXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiRVwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogdGVtcGxhdGUsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBjb250ZW50OiAnPScsXG4gICAgICAgICAgICBnZW5lcmFsRm9ybTogJz0nLFxuICAgICAgICAgICAgZGlzYWJsZWQ6ICc9JyxcbiAgICAgICAgICAgIGNvcHlUYXNrOiAnPScsXG4gICAgICAgIH0sXG4gICAgICAgIGNvbnRyb2xsZXI6IGNvbnRyb2xsZXIsXG4gICAgICAgIGNvbnRyb2xsZXJBczogJ2dlbmVyYWxUYWJDdHJsJ1xuICAgIH07XG59XG5cblxuYW5ndWxhclxuICAgIC5tb2R1bGUoJ1RETS1GRScpXG4gICAgLmRpcmVjdGl2ZSgnZ2VuZXJhbFRhYicsIGdlbmVyYWxUYWIpO1xuIl19
