function taskVariables(){return{restrict:"E",templateUrl:"js/components/task/tabs/taskVariables/taskVariables.html",scope:{content:"=",disableChange:"=",form:"=",disabled:"=",back:"="},controller:function($scope,TDMService,toastr,$timeout,AuthService,$state,DTOptionsBuilder,DTColumnBuilder,$q,$compile){var taskVariablesCtrl=this;taskVariablesCtrl.taskData=$scope.content,taskVariablesCtrl.dtInstance={},taskVariablesCtrl.dtColumns=[],taskVariablesCtrl.dtColumnDefs=[],taskVariablesCtrl.closeSetVariableModal=global=>{if(taskVariablesCtrl.SetVariableModalToggle=!1,global&&global.global_name&&global.global_value){var origGlobal=_.find(taskVariablesCtrl.taskData.globals,{global_name:global.global_name,index:global.index});origGlobal?(origGlobal.lu_name=global.lu_name,origGlobal.global_value=global.global_value):(global.index=taskVariablesCtrl.taskData.globals.length,taskVariablesCtrl.taskData.globals.push(global)),$timeout((function(){taskVariablesCtrl.dtInstance&&taskVariablesCtrl.dtInstance.reloadData&&taskVariablesCtrl.dtInstance.reloadData((function(){}))}),100)}taskVariablesCtrl.globalForEdit=null},taskVariablesCtrl.editGlobal=(global,index)=>{taskVariablesCtrl.SetVariableModalToggle=!0,taskVariablesCtrl.globalForEdit=global},taskVariablesCtrl.headers=[{column:"actions",name:""},{column:"global_name",name:"Variable Name"},{column:"global_value",name:"Variable Value"},{column:"lu_name",name:"Logical Unit"}];for(var renderSelectionColumn=function(data,type,full,meta){return'<div style="display: flex;justify-content: space-around;max-width: 100px;"><div><img src="icons/edit.svg"  alt="edit" uib-tooltip="Edit Global" tooltip-placement="top"ng-click="taskVariablesCtrl.editGlobal(taskVariablesCtrl.taskData.globals['+meta.row+"], "+meta.row+')"></div><div><img  src="icons/delete-icon.svg" alt="edit" uib-tooltip="Delete Global" tooltip-placement="top" ng-click="taskVariablesCtrl.removeGlobal(\''+full.global_name+"')\"></div></div>"},i=0;i<taskVariablesCtrl.headers.length;i++)"actions"==taskVariablesCtrl.headers[i].column?taskVariablesCtrl.dtColumns.push(DTColumnBuilder.newColumn(taskVariablesCtrl.headers[i].column).withTitle(taskVariablesCtrl.headers[i].name).renderWith(renderSelectionColumn).withOption("width","200")):taskVariablesCtrl.dtColumns.push(DTColumnBuilder.newColumn(taskVariablesCtrl.headers[i].column).withTitle(taskVariablesCtrl.headers[i].name));taskVariablesCtrl.dtOptions=DTOptionsBuilder.fromFnPromise((function(){return(deferred=$q.defer()).resolve(taskVariablesCtrl.taskData.globals||[]),deferred.promise;var deferred})).withDOM('<"html5buttons"B>lTfgitp').withOption("createdRow",(function(row){$compile(angular.element(row).contents())($scope)})).withOption("scrollX",!1).withOption("lengthChange",!1).withOption("paging",!1).withButtons([]).withOption("caseInsensitive",!0).withOption("search",{caseInsensitive:!1}),taskVariablesCtrl.dtOptions.withLightColumnFilter({1:{type:"text"},2:{type:"text"}}),taskVariablesCtrl.removeGlobal=function(globalName){var index=_.findIndex(taskVariablesCtrl.taskData.globals,{global_name:globalName});index>=0&&(taskVariablesCtrl.taskData.globals.splice(index,1),$timeout((function(){taskVariablesCtrl.dtInstance&&taskVariablesCtrl.dtInstance.reloadData&&taskVariablesCtrl.dtInstance.reloadData((function(){}))}),100))},taskVariablesCtrl.taskData.globals||(taskVariablesCtrl.taskData.task_id?TDMService.getGenericAPI("task/"+taskVariablesCtrl.taskData.task_id+"/globals").then((function(response){taskVariablesCtrl.taskData.globals=response.result,taskVariablesCtrl.dtInstance&&taskVariablesCtrl.dtInstance.reloadData&&taskVariablesCtrl.dtInstance.reloadData((function(){}))})):taskVariablesCtrl.taskData.globals=[])},controllerAs:"taskVariablesCtrl"}}angular.module("TDM-FE").directive("taskVariables",taskVariables);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbXBvbmVudHMvdGFzay90YWJzL3Rhc2tWYXJpYWJsZXMvdGFza1ZhcmlhYmxlcy5qcyJdLCJuYW1lcyI6WyJ0YXNrVmFyaWFibGVzIiwicmVzdHJpY3QiLCJ0ZW1wbGF0ZVVybCIsInNjb3BlIiwiY29udGVudCIsImRpc2FibGVDaGFuZ2UiLCJmb3JtIiwiZGlzYWJsZWQiLCJiYWNrIiwiY29udHJvbGxlciIsIiRzY29wZSIsIlRETVNlcnZpY2UiLCJ0b2FzdHIiLCIkdGltZW91dCIsIkF1dGhTZXJ2aWNlIiwiJHN0YXRlIiwiRFRPcHRpb25zQnVpbGRlciIsIkRUQ29sdW1uQnVpbGRlciIsIiRxIiwiJGNvbXBpbGUiLCJ0YXNrVmFyaWFibGVzQ3RybCIsInRoaXMiLCJ0YXNrRGF0YSIsImR0SW5zdGFuY2UiLCJkdENvbHVtbnMiLCJkdENvbHVtbkRlZnMiLCJjbG9zZVNldFZhcmlhYmxlTW9kYWwiLCJnbG9iYWwiLCJTZXRWYXJpYWJsZU1vZGFsVG9nZ2xlIiwiZ2xvYmFsX25hbWUiLCJnbG9iYWxfdmFsdWUiLCJvcmlnR2xvYmFsIiwiXyIsImZpbmQiLCJnbG9iYWxzIiwiaW5kZXgiLCJsdV9uYW1lIiwibGVuZ3RoIiwicHVzaCIsInJlbG9hZERhdGEiLCJnbG9iYWxGb3JFZGl0IiwiZWRpdEdsb2JhbCIsImhlYWRlcnMiLCJjb2x1bW4iLCJuYW1lIiwicmVuZGVyU2VsZWN0aW9uQ29sdW1uIiwiZGF0YSIsInR5cGUiLCJmdWxsIiwibWV0YSIsInJvdyIsImkiLCJuZXdDb2x1bW4iLCJ3aXRoVGl0bGUiLCJyZW5kZXJXaXRoIiwid2l0aE9wdGlvbiIsImR0T3B0aW9ucyIsImZyb21GblByb21pc2UiLCJkZWZlcnJlZCIsImRlZmVyIiwicmVzb2x2ZSIsInByb21pc2UiLCJ3aXRoRE9NIiwiYW5ndWxhciIsImVsZW1lbnQiLCJjb250ZW50cyIsIndpdGhCdXR0b25zIiwiY2FzZUluc2Vuc2l0aXZlIiwid2l0aExpZ2h0Q29sdW1uRmlsdGVyIiwiMSIsIjIiLCJyZW1vdmVHbG9iYWwiLCJnbG9iYWxOYW1lIiwiZmluZEluZGV4Iiwic3BsaWNlIiwidGFza19pZCIsImdldEdlbmVyaWNBUEkiLCJ0aGVuIiwicmVzcG9uc2UiLCJyZXN1bHQiLCJjb250cm9sbGVyQXMiLCJtb2R1bGUiLCJkaXJlY3RpdmUiXSwibWFwcGluZ3MiOiJBQUFBLFNBQVNBLGdCQXNKTCxNQUFPLENBQ0hDLFNBQVUsSUFDVkMsWUF0SlcsMkRBdUpYQyxNQUFPLENBQ0hDLFFBQVMsSUFDVEMsY0FBZSxJQUNmQyxLQUFNLElBQ05DLFNBQVUsSUFDVkMsS0FBTSxLQUVWQyxXQTVKYSxTQUFVQyxPQUFRQyxXQUFZQyxPQUFRQyxTQUFVQyxZQUFhQyxPQUFRQyxpQkFBa0JDLGdCQUFpQkMsR0FBSUMsVUFDekgsSUFBSUMsa0JBQW9CQyxLQUN4QkQsa0JBQWtCRSxTQUFXWixPQUFPTixRQUVwQ2dCLGtCQUFrQkcsV0FBYSxHQUMvQkgsa0JBQWtCSSxVQUFZLEdBQzlCSixrQkFBa0JLLGFBQWUsR0FFakNMLGtCQUFrQk0sc0JBQXlCQyxTQUV2QyxHQURBUCxrQkFBa0JRLHdCQUF5QixFQUN2Q0QsUUFBVUEsT0FBT0UsYUFBZUYsT0FBT0csYUFBYSxDQUNwRCxJQUFJQyxXQUFhQyxFQUFFQyxLQUFLYixrQkFBa0JFLFNBQVNZLFFBQVEsQ0FDdkRMLFlBQWNGLE9BQU9FLFlBQ3JCTSxNQUFPUixPQUFPUSxRQUVkSixZQUNBQSxXQUFXSyxRQUFVVCxPQUFPUyxRQUM1QkwsV0FBV0QsYUFBZUgsT0FBT0csZUFHakNILE9BQU9RLE1BQVFmLGtCQUFrQkUsU0FBU1ksUUFBUUcsT0FDbERqQixrQkFBa0JFLFNBQVNZLFFBQVFJLEtBQUtYLFNBRTVDZCxVQUFTLFdBQ0RPLGtCQUFrQkcsWUFBY0gsa0JBQWtCRyxXQUFXZ0IsWUFDN0RuQixrQkFBa0JHLFdBQVdnQixZQUFXLGlCQUk5QyxLQUVObkIsa0JBQWtCb0IsY0FBZ0IsTUFJdENwQixrQkFBa0JxQixXQUFhLENBQUNkLE9BQVFRLFNBQ3BDZixrQkFBa0JRLHdCQUF5QixFQUMzQ1Isa0JBQWtCb0IsY0FBZ0JiLFFBR3RDUCxrQkFBa0JzQixRQUFVLENBQ3hCLENBQ0lDLE9BQVMsVUFDVEMsS0FBTyxJQUVYLENBQ0lELE9BQVMsY0FDVEMsS0FBTyxpQkFFWCxDQUNJRCxPQUFTLGVBQ1RDLEtBQU8sa0JBRVgsQ0FDSUQsT0FBUyxVQUNUQyxLQUFPLGlCQWlCZixJQWJBLElBQUlDLHNCQUF3QixTQUFTQyxLQUFNQyxLQUFNQyxLQUFNQyxNQUNuRCxNQUFPLG9QQUd3RUEsS0FBS0MsSUFBTSxNQUFRRCxLQUFLQyxJQUhoRyw2SkFNeUNGLEtBQUtuQixZQU45QyxxQkFZRnNCLEVBQUksRUFBR0EsRUFBSy9CLGtCQUFrQnNCLFFBQVFMLE9BQVNjLElBQ1QsV0FBdkMvQixrQkFBa0JzQixRQUFRUyxHQUFHUixPQUM3QnZCLGtCQUFrQkksVUFBVWMsS0FBS3JCLGdCQUFnQm1DLFVBQVVoQyxrQkFBa0JzQixRQUFRUyxHQUFHUixRQUFRVSxVQUFVakMsa0JBQWtCc0IsUUFBUVMsR0FBR1AsTUFBTVUsV0FBV1QsdUJBQXVCVSxXQUFXLFFBQVMsUUFHbk1uQyxrQkFBa0JJLFVBQVVjLEtBQUtyQixnQkFBZ0JtQyxVQUFVaEMsa0JBQWtCc0IsUUFBUVMsR0FBR1IsUUFBUVUsVUFBVWpDLGtCQUFrQnNCLFFBQVFTLEdBQUdQLE9BVS9JeEIsa0JBQWtCb0MsVUFBWXhDLGlCQUFpQnlDLGVBQWMsV0FDckQsT0FOQUMsU0FBV3hDLEdBQUd5QyxTQUNUQyxRQUFReEMsa0JBQWtCRSxTQUFTWSxTQUFXLElBQ2hEd0IsU0FBU0csUUFIRCxJQUNYSCxZQVFISSxRQUFRLDRCQUNSUCxXQUFXLGNBQWMsU0FBVUwsS0FFaEMvQixTQUFTNEMsUUFBUUMsUUFBUWQsS0FBS2UsV0FBOUI5QyxDQUEwQ1QsV0FFN0M2QyxXQUFXLFdBQVcsR0FDdEJBLFdBQVcsZ0JBQWdCLEdBQzNCQSxXQUFXLFVBQVUsR0FDckJXLFlBQVksSUFDWlgsV0FBVyxtQkFBbUIsR0FDOUJBLFdBQVcsU0FBUyxDQUNqQlksaUJBQW1CLElBR3ZCL0Msa0JBQWtCb0MsVUFBVVksc0JBQXNCLENBQzlDQyxFQUFHLENBQ0N0QixLQUFNLFFBRVZ1QixFQUFHLENBQ0N2QixLQUFNLFVBSWQzQixrQkFBa0JtRCxhQUFlLFNBQVNDLFlBQ3RDLElBQUlyQyxNQUFRSCxFQUFFeUMsVUFBVXJELGtCQUFrQkUsU0FBU1ksUUFBUSxDQUFDTCxZQUFjMkMsYUFDdEVyQyxPQUFTLElBQ1RmLGtCQUFrQkUsU0FBU1ksUUFBUXdDLE9BQU92QyxNQUFNLEdBQ2hEdEIsVUFBUyxXQUNETyxrQkFBa0JHLFlBQWNILGtCQUFrQkcsV0FBV2dCLFlBQzdEbkIsa0JBQWtCRyxXQUFXZ0IsWUFBVyxpQkFJOUMsT0FJVG5CLGtCQUFrQkUsU0FBU1ksVUFDeEJkLGtCQUFrQkUsU0FBU3FELFFBQzNCaEUsV0FBV2lFLGNBQWMsUUFBVXhELGtCQUFrQkUsU0FBU3FELFFBQVUsWUFBWUUsTUFBSyxTQUFVQyxVQUMvRjFELGtCQUFrQkUsU0FBU1ksUUFBVTRDLFNBQVNDLE9BQzFDM0Qsa0JBQWtCRyxZQUFjSCxrQkFBa0JHLFdBQVdnQixZQUM3RG5CLGtCQUFrQkcsV0FBV2dCLFlBQVcsa0JBT2hEbkIsa0JBQWtCRSxTQUFTWSxRQUFVLEtBa0I3QzhDLGFBQWMscUJBS3RCakIsUUFDS2tCLE9BQU8sVUFDUEMsVUFBVSxnQkFBaUJsRiIsImZpbGUiOiJjb21wb25lbnRzL3Rhc2svdGFicy90YXNrVmFyaWFibGVzL3Rhc2tWYXJpYWJsZXMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiB0YXNrVmFyaWFibGVzKCkge1xuXG4gICAgdmFyIHRlbXBsYXRlID0gXCJqcy9jb21wb25lbnRzL3Rhc2svdGFicy90YXNrVmFyaWFibGVzL3Rhc2tWYXJpYWJsZXMuaHRtbFwiO1xuXG4gICAgdmFyIGNvbnRyb2xsZXIgPSBmdW5jdGlvbiAoJHNjb3BlLCBURE1TZXJ2aWNlLCB0b2FzdHIsICR0aW1lb3V0LCBBdXRoU2VydmljZSwgJHN0YXRlLCBEVE9wdGlvbnNCdWlsZGVyLCBEVENvbHVtbkJ1aWxkZXIsICRxLCAkY29tcGlsZSkge1xuICAgICAgICB2YXIgdGFza1ZhcmlhYmxlc0N0cmwgPSB0aGlzO1xuICAgICAgICB0YXNrVmFyaWFibGVzQ3RybC50YXNrRGF0YSA9ICRzY29wZS5jb250ZW50O1xuXG4gICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLmR0SW5zdGFuY2UgPSB7fTtcbiAgICAgICAgdGFza1ZhcmlhYmxlc0N0cmwuZHRDb2x1bW5zID0gW107XG4gICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLmR0Q29sdW1uRGVmcyA9IFtdO1xuXG4gICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLmNsb3NlU2V0VmFyaWFibGVNb2RhbCA9IChnbG9iYWwpID0+IHtcbiAgICAgICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLlNldFZhcmlhYmxlTW9kYWxUb2dnbGUgPSBmYWxzZTtcbiAgICAgICAgICAgIGlmIChnbG9iYWwgJiYgZ2xvYmFsLmdsb2JhbF9uYW1lICYmIGdsb2JhbC5nbG9iYWxfdmFsdWUpe1xuICAgICAgICAgICAgICAgIHZhciBvcmlnR2xvYmFsID0gXy5maW5kKHRhc2tWYXJpYWJsZXNDdHJsLnRhc2tEYXRhLmdsb2JhbHMse1xuICAgICAgICAgICAgICAgICAgICBnbG9iYWxfbmFtZSA6IGdsb2JhbC5nbG9iYWxfbmFtZSxcbiAgICAgICAgICAgICAgICAgICAgaW5kZXg6IGdsb2JhbC5pbmRleCxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpZiAob3JpZ0dsb2JhbCl7XG4gICAgICAgICAgICAgICAgICAgIG9yaWdHbG9iYWwubHVfbmFtZSA9IGdsb2JhbC5sdV9uYW1lO1xuICAgICAgICAgICAgICAgICAgICBvcmlnR2xvYmFsLmdsb2JhbF92YWx1ZSA9IGdsb2JhbC5nbG9iYWxfdmFsdWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2V7XG4gICAgICAgICAgICAgICAgICAgIGdsb2JhbC5pbmRleCA9IHRhc2tWYXJpYWJsZXNDdHJsLnRhc2tEYXRhLmdsb2JhbHMubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICB0YXNrVmFyaWFibGVzQ3RybC50YXNrRGF0YS5nbG9iYWxzLnB1c2goZ2xvYmFsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2tWYXJpYWJsZXNDdHJsLmR0SW5zdGFuY2UgJiYgdGFza1ZhcmlhYmxlc0N0cmwuZHRJbnN0YW5jZS5yZWxvYWREYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLmR0SW5zdGFuY2UucmVsb2FkRGF0YShmdW5jdGlvbigpe1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sMTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLmdsb2JhbEZvckVkaXQgPSBudWxsO1xuXG4gICAgICAgIH07XG5cbiAgICAgICAgdGFza1ZhcmlhYmxlc0N0cmwuZWRpdEdsb2JhbCA9IChnbG9iYWwsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICB0YXNrVmFyaWFibGVzQ3RybC5TZXRWYXJpYWJsZU1vZGFsVG9nZ2xlID0gdHJ1ZTtcbiAgICAgICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLmdsb2JhbEZvckVkaXQgPSBnbG9iYWw7XG4gICAgICAgIH1cblxuICAgICAgICB0YXNrVmFyaWFibGVzQ3RybC5oZWFkZXJzID0gW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvbHVtbiA6ICdhY3Rpb25zJyxcbiAgICAgICAgICAgICAgICBuYW1lIDogJydcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29sdW1uIDogJ2dsb2JhbF9uYW1lJyxcbiAgICAgICAgICAgICAgICBuYW1lIDogJ1ZhcmlhYmxlIE5hbWUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvbHVtbiA6ICdnbG9iYWxfdmFsdWUnLFxuICAgICAgICAgICAgICAgIG5hbWUgOiAnVmFyaWFibGUgVmFsdWUnXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvbHVtbiA6ICdsdV9uYW1lJyxcbiAgICAgICAgICAgICAgICBuYW1lIDogJ0xvZ2ljYWwgVW5pdCdcbiAgICAgICAgICAgIH0sXG4gICAgICAgIF07XG5cbiAgICAgICAgdmFyIHJlbmRlclNlbGVjdGlvbkNvbHVtbiA9IGZ1bmN0aW9uKGRhdGEsIHR5cGUsIGZ1bGwsIG1ldGEpe1xuICAgICAgICAgICAgcmV0dXJuICc8ZGl2IHN0eWxlPVwiZGlzcGxheTogZmxleDtqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWFyb3VuZDttYXgtd2lkdGg6IDEwMHB4O1wiPicrXG4gICAgICAgICAgICAnPGRpdj4nICsgXG4gICAgICAgICAgICAnPGltZyBzcmM9XCJpY29ucy9lZGl0LnN2Z1wiICBhbHQ9XCJlZGl0XCIgdWliLXRvb2x0aXA9XCJFZGl0IEdsb2JhbFwiIHRvb2x0aXAtcGxhY2VtZW50PVwidG9wXCInICsgXG4gICAgICAgICAgICAnbmctY2xpY2s9XCJ0YXNrVmFyaWFibGVzQ3RybC5lZGl0R2xvYmFsKHRhc2tWYXJpYWJsZXNDdHJsLnRhc2tEYXRhLmdsb2JhbHNbJyArIG1ldGEucm93ICsgJ10sICcgKyBtZXRhLnJvdyAgKyAnKVwiPicgK1xuICAgICAgICAgICAgJzwvZGl2PicgKyBcbiAgICAgICAgICAgICc8ZGl2PjxpbWcgIHNyYz1cImljb25zL2RlbGV0ZS1pY29uLnN2Z1wiIGFsdD1cImVkaXRcIiB1aWItdG9vbHRpcD1cIkRlbGV0ZSBHbG9iYWxcIiB0b29sdGlwLXBsYWNlbWVudD1cInRvcFwiICcgKyBcbiAgICAgICAgICAgICduZy1jbGljaz1cInRhc2tWYXJpYWJsZXNDdHJsLnJlbW92ZUdsb2JhbChcXCcnICsgZnVsbC5nbG9iYWxfbmFtZSArJ1xcJylcIj4nICtcbiAgICAgICAgICAgICc8L2Rpdj4nXG4gICAgICAgICAgICArICc8L2Rpdj4nOyBcbiAgICAgICAgICAgIFxuICAgICAgICB9O1xuXG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgIHRhc2tWYXJpYWJsZXNDdHJsLmhlYWRlcnMubGVuZ3RoIDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAodGFza1ZhcmlhYmxlc0N0cmwuaGVhZGVyc1tpXS5jb2x1bW4gPT0gJ2FjdGlvbnMnKXtcbiAgICAgICAgICAgICAgICB0YXNrVmFyaWFibGVzQ3RybC5kdENvbHVtbnMucHVzaChEVENvbHVtbkJ1aWxkZXIubmV3Q29sdW1uKHRhc2tWYXJpYWJsZXNDdHJsLmhlYWRlcnNbaV0uY29sdW1uKS53aXRoVGl0bGUodGFza1ZhcmlhYmxlc0N0cmwuaGVhZGVyc1tpXS5uYW1lKS5yZW5kZXJXaXRoKHJlbmRlclNlbGVjdGlvbkNvbHVtbikud2l0aE9wdGlvbignd2lkdGgnLCAnMjAwJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZXtcbiAgICAgICAgICAgICAgICB0YXNrVmFyaWFibGVzQ3RybC5kdENvbHVtbnMucHVzaChEVENvbHVtbkJ1aWxkZXIubmV3Q29sdW1uKHRhc2tWYXJpYWJsZXNDdHJsLmhlYWRlcnNbaV0uY29sdW1uKS53aXRoVGl0bGUodGFza1ZhcmlhYmxlc0N0cmwuaGVhZGVyc1tpXS5uYW1lKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZ2V0VGFibGVEYXRhID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUodGFza1ZhcmlhYmxlc0N0cmwudGFza0RhdGEuZ2xvYmFscyB8fCBbXSk7XG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgfTtcblxuICAgICAgICB0YXNrVmFyaWFibGVzQ3RybC5kdE9wdGlvbnMgPSBEVE9wdGlvbnNCdWlsZGVyLmZyb21GblByb21pc2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBnZXRUYWJsZURhdGEoKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2l0aERPTSgnPFwiaHRtbDVidXR0b25zXCJCPmxUZmdpdHAnKVxuICAgICAgICAgICAgLndpdGhPcHRpb24oJ2NyZWF0ZWRSb3cnLCBmdW5jdGlvbiAocm93KSB7XG4gICAgICAgICAgICAgICAgLy8gUmVjb21waWxpbmcgc28gd2UgY2FuIGJpbmQgQW5ndWxhciBkaXJlY3RpdmUgdG8gdGhlIERUXG4gICAgICAgICAgICAgICAgJGNvbXBpbGUoYW5ndWxhci5lbGVtZW50KHJvdykuY29udGVudHMoKSkoJHNjb3BlKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAud2l0aE9wdGlvbignc2Nyb2xsWCcsIGZhbHNlKVxuICAgICAgICAgICAgLndpdGhPcHRpb24oJ2xlbmd0aENoYW5nZScsIGZhbHNlKVxuICAgICAgICAgICAgLndpdGhPcHRpb24oJ3BhZ2luZycsIGZhbHNlKVxuICAgICAgICAgICAgLndpdGhCdXR0b25zKFtdKVxuICAgICAgICAgICAgLndpdGhPcHRpb24oXCJjYXNlSW5zZW5zaXRpdmVcIiwgdHJ1ZSlcbiAgICAgICAgICAgIC53aXRoT3B0aW9uKCdzZWFyY2gnLHtcbiAgICAgICAgICAgICAgICBcImNhc2VJbnNlbnNpdGl2ZVwiOiBmYWxzZVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLmR0T3B0aW9ucy53aXRoTGlnaHRDb2x1bW5GaWx0ZXIoe1xuICAgICAgICAgICAgICAgIDE6IHtcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3RleHQnXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAyOiB7XG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0J1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB0YXNrVmFyaWFibGVzQ3RybC5yZW1vdmVHbG9iYWwgPSBmdW5jdGlvbihnbG9iYWxOYW1lKXtcbiAgICAgICAgICAgICAgICB2YXIgaW5kZXggPSBfLmZpbmRJbmRleCh0YXNrVmFyaWFibGVzQ3RybC50YXNrRGF0YS5nbG9iYWxzLHtnbG9iYWxfbmFtZSA6IGdsb2JhbE5hbWV9KTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggPj0gMCl7XG4gICAgICAgICAgICAgICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLnRhc2tEYXRhLmdsb2JhbHMuc3BsaWNlKGluZGV4LDEpO1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2tWYXJpYWJsZXNDdHJsLmR0SW5zdGFuY2UgJiYgdGFza1ZhcmlhYmxlc0N0cmwuZHRJbnN0YW5jZS5yZWxvYWREYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YXNrVmFyaWFibGVzQ3RybC5kdEluc3RhbmNlLnJlbG9hZERhdGEoZnVuY3Rpb24oKXtcbiAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSwxMDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBpZiAoIXRhc2tWYXJpYWJsZXNDdHJsLnRhc2tEYXRhLmdsb2JhbHMpe1xuICAgICAgICAgICAgaWYgKHRhc2tWYXJpYWJsZXNDdHJsLnRhc2tEYXRhLnRhc2tfaWQpIHtcbiAgICAgICAgICAgICAgICBURE1TZXJ2aWNlLmdldEdlbmVyaWNBUEkoXCJ0YXNrL1wiICsgdGFza1ZhcmlhYmxlc0N0cmwudGFza0RhdGEudGFza19pZCArIFwiL2dsb2JhbHNcIikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgdGFza1ZhcmlhYmxlc0N0cmwudGFza0RhdGEuZ2xvYmFscyA9IHJlc3BvbnNlLnJlc3VsdDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRhc2tWYXJpYWJsZXNDdHJsLmR0SW5zdGFuY2UgJiYgdGFza1ZhcmlhYmxlc0N0cmwuZHRJbnN0YW5jZS5yZWxvYWREYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLmR0SW5zdGFuY2UucmVsb2FkRGF0YShmdW5jdGlvbigpe1xuICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRhc2tWYXJpYWJsZXNDdHJsLnRhc2tEYXRhLmdsb2JhbHMgPSBbXTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG5cbiAgICB9O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgcmVzdHJpY3Q6IFwiRVwiLFxuICAgICAgICB0ZW1wbGF0ZVVybDogdGVtcGxhdGUsXG4gICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBjb250ZW50OiAnPScsXG4gICAgICAgICAgICBkaXNhYmxlQ2hhbmdlOiAnPScsXG4gICAgICAgICAgICBmb3JtOiAnPScsXG4gICAgICAgICAgICBkaXNhYmxlZDogJz0nLFxuICAgICAgICAgICAgYmFjazogJz0nLFxuICAgICAgICB9LFxuICAgICAgICBjb250cm9sbGVyOiBjb250cm9sbGVyLFxuICAgICAgICBjb250cm9sbGVyQXM6ICd0YXNrVmFyaWFibGVzQ3RybCdcbiAgICB9O1xufVxuXG5cbmFuZ3VsYXJcbiAgICAubW9kdWxlKCdURE0tRkUnKVxuICAgIC5kaXJlY3RpdmUoJ3Rhc2tWYXJpYWJsZXMnLCB0YXNrVmFyaWFibGVzKTtcbiJdfQ==
