/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.3.6
 *
 */
!function($){$.fn.extend({slimScroll:function(options){var o=$.extend({width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:.4,alwaysVisible:!1,disableFadeOut:!1,railVisible:!1,railColor:"#333",railOpacity:.2,railDraggable:!0,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:!1,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"},options);return this.each((function(){var isOverPanel,isOverBar,isDragg,queueHide,touchDif,barHeight,percentScroll,lastScroll,divS="<div></div>",releaseScroll=!1,me=$(this);if(me.parent().hasClass(o.wrapperClass)){var offset=me.scrollTop();if(bar=me.closest("."+o.barClass),rail=me.closest("."+o.railClass),getBarHeight(),$.isPlainObject(options)){if("height"in options&&"auto"==options.height){me.parent().css("height","auto"),me.css("height","auto");var height=me.parent().parent().height();me.parent().css("height",height),me.css("height",height)}if("scrollTo"in options)offset=parseInt(o.scrollTo);else if("scrollBy"in options)offset+=parseInt(o.scrollBy);else if("destroy"in options)return bar.remove(),rail.remove(),void me.unwrap();scrollContent(offset,!1,!0)}}else if(!$.isPlainObject(options)||!("destroy"in options)){o.height="auto"==o.height?me.parent().height():o.height;var wrapper=$(divS).addClass(o.wrapperClass).css({position:"relative",overflow:"hidden",width:o.width,height:o.height});me.css({overflow:"hidden",width:o.width,height:o.height});var target,rail=$(divS).addClass(o.railClass).css({width:o.size,height:"100%",position:"absolute",top:0,display:o.alwaysVisible&&o.railVisible?"block":"none","border-radius":o.railBorderRadius,background:o.railColor,opacity:o.railOpacity,zIndex:90}),bar=$(divS).addClass(o.barClass).css({background:o.color,width:o.size,position:"absolute",top:0,opacity:o.opacity,display:o.alwaysVisible?"block":"none","border-radius":o.borderRadius,BorderRadius:o.borderRadius,MozBorderRadius:o.borderRadius,WebkitBorderRadius:o.borderRadius,zIndex:99}),posCss="right"==o.position?{right:o.distance}:{left:o.distance};rail.css(posCss),bar.css(posCss),me.wrap(wrapper),me.parent().append(bar),me.parent().append(rail),o.railDraggable&&bar.bind("mousedown",(function(e){var $doc=$(document);return isDragg=!0,t=parseFloat(bar.css("top")),pageY=e.pageY,$doc.bind("mousemove.slimscroll",(function(e){currTop=t+e.pageY-pageY,bar.css("top",currTop),scrollContent(0,bar.position().top,!1)})),$doc.bind("mouseup.slimscroll",(function(e){isDragg=!1,hideBar(),$doc.unbind(".slimscroll")})),!1})).bind("selectstart.slimscroll",(function(e){return e.stopPropagation(),e.preventDefault(),!1})),rail.hover((function(){showBar()}),(function(){hideBar()})),bar.hover((function(){isOverBar=!0}),(function(){isOverBar=!1})),me.hover((function(){isOverPanel=!0,showBar(),hideBar()}),(function(){isOverPanel=!1,hideBar()})),me.bind("touchstart",(function(e,b){e.originalEvent.touches.length&&(touchDif=e.originalEvent.touches[0].pageY)})),me.bind("touchmove",(function(e){(releaseScroll||e.originalEvent.preventDefault(),e.originalEvent.touches.length)&&(scrollContent((touchDif-e.originalEvent.touches[0].pageY)/o.touchScrollStep,!0),touchDif=e.originalEvent.touches[0].pageY)})),getBarHeight(),"bottom"===o.start?(bar.css({top:me.outerHeight()-bar.outerHeight()}),scrollContent(0,!0)):"top"!==o.start&&(scrollContent($(o.start).position().top,null,!0),o.alwaysVisible||bar.hide()),target=this,window.addEventListener?(target.addEventListener("DOMMouseScroll",_onWheel,!1),target.addEventListener("mousewheel",_onWheel,!1)):document.attachEvent("onmousewheel",_onWheel)}function _onWheel(e){if(isOverPanel){var delta=0;(e=e||window.event).wheelDelta&&(delta=-e.wheelDelta/120),e.detail&&(delta=e.detail/3);var target=e.target||e.srcTarget||e.srcElement;$(target).closest("."+o.wrapperClass).is(me.parent())&&scrollContent(delta,!0),e.preventDefault&&!releaseScroll&&e.preventDefault(),releaseScroll||(e.returnValue=!1)}}function scrollContent(y,isWheel,isJump){releaseScroll=!1;var delta=y,maxTop=me.outerHeight()-bar.outerHeight();if(isWheel&&(delta=parseInt(bar.css("top"))+y*parseInt(o.wheelStep)/100*bar.outerHeight(),delta=Math.min(Math.max(delta,0),maxTop),delta=y>0?Math.ceil(delta):Math.floor(delta),bar.css({top:delta+"px"})),delta=(percentScroll=parseInt(bar.css("top"))/(me.outerHeight()-bar.outerHeight()))*(me[0].scrollHeight-me.outerHeight()),isJump){var offsetTop=(delta=y)/me[0].scrollHeight*me.outerHeight();offsetTop=Math.min(Math.max(offsetTop,0),maxTop),bar.css({top:offsetTop+"px"})}me.scrollTop(delta),me.trigger("slimscrolling",~~delta),showBar(),hideBar()}function getBarHeight(){barHeight=Math.max(me.outerHeight()/me[0].scrollHeight*me.outerHeight(),30),bar.css({height:barHeight+"px"});var display=barHeight==me.outerHeight()?"none":"block";bar.css({display:display})}function showBar(){if(getBarHeight(),clearTimeout(queueHide),percentScroll==~~percentScroll){if(releaseScroll=o.allowPageScroll,lastScroll!=percentScroll){var msg=0==~~percentScroll?"top":"bottom";me.trigger("slimscroll",msg)}}else releaseScroll=!1;lastScroll=percentScroll,barHeight>=me.outerHeight()?releaseScroll=!0:(bar.stop(!0,!0).fadeIn("fast"),o.railVisible&&rail.stop(!0,!0).fadeIn("fast"))}function hideBar(){o.alwaysVisible||(queueHide=setTimeout((function(){o.disableFadeOut&&isOverPanel||isOverBar||isDragg||(bar.fadeOut("slow"),rail.fadeOut("slow"))}),1e3))}})),this}}),$.fn.extend({slimscroll:$.fn.slimScroll})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsdWdpbnMvc2xpbXNjcm9sbC9qcXVlcnkuc2xpbXNjcm9sbC5qcyJdLCJuYW1lcyI6WyIkIiwiZm4iLCJleHRlbmQiLCJzbGltU2Nyb2xsIiwib3B0aW9ucyIsIm8iLCJ3aWR0aCIsImhlaWdodCIsInNpemUiLCJjb2xvciIsInBvc2l0aW9uIiwiZGlzdGFuY2UiLCJzdGFydCIsIm9wYWNpdHkiLCJhbHdheXNWaXNpYmxlIiwiZGlzYWJsZUZhZGVPdXQiLCJyYWlsVmlzaWJsZSIsInJhaWxDb2xvciIsInJhaWxPcGFjaXR5IiwicmFpbERyYWdnYWJsZSIsInJhaWxDbGFzcyIsImJhckNsYXNzIiwid3JhcHBlckNsYXNzIiwiYWxsb3dQYWdlU2Nyb2xsIiwid2hlZWxTdGVwIiwidG91Y2hTY3JvbGxTdGVwIiwiYm9yZGVyUmFkaXVzIiwicmFpbEJvcmRlclJhZGl1cyIsInRoaXMiLCJlYWNoIiwiaXNPdmVyUGFuZWwiLCJpc092ZXJCYXIiLCJpc0RyYWdnIiwicXVldWVIaWRlIiwidG91Y2hEaWYiLCJiYXJIZWlnaHQiLCJwZXJjZW50U2Nyb2xsIiwibGFzdFNjcm9sbCIsImRpdlMiLCJyZWxlYXNlU2Nyb2xsIiwibWUiLCJwYXJlbnQiLCJoYXNDbGFzcyIsIm9mZnNldCIsInNjcm9sbFRvcCIsImJhciIsImNsb3Nlc3QiLCJyYWlsIiwiZ2V0QmFySGVpZ2h0IiwiaXNQbGFpbk9iamVjdCIsImNzcyIsInBhcnNlSW50Iiwic2Nyb2xsVG8iLCJzY3JvbGxCeSIsInJlbW92ZSIsInVud3JhcCIsInNjcm9sbENvbnRlbnQiLCJ3cmFwcGVyIiwiYWRkQ2xhc3MiLCJvdmVyZmxvdyIsInRhcmdldCIsInRvcCIsImRpc3BsYXkiLCJib3JkZXItcmFkaXVzIiwiYmFja2dyb3VuZCIsInpJbmRleCIsIkJvcmRlclJhZGl1cyIsIk1vekJvcmRlclJhZGl1cyIsIldlYmtpdEJvcmRlclJhZGl1cyIsInBvc0NzcyIsInJpZ2h0IiwibGVmdCIsIndyYXAiLCJhcHBlbmQiLCJiaW5kIiwiZSIsIiRkb2MiLCJkb2N1bWVudCIsInQiLCJwYXJzZUZsb2F0IiwicGFnZVkiLCJjdXJyVG9wIiwiaGlkZUJhciIsInVuYmluZCIsInN0b3BQcm9wYWdhdGlvbiIsInByZXZlbnREZWZhdWx0IiwiaG92ZXIiLCJzaG93QmFyIiwiYiIsIm9yaWdpbmFsRXZlbnQiLCJ0b3VjaGVzIiwibGVuZ3RoIiwib3V0ZXJIZWlnaHQiLCJoaWRlIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9vbldoZWVsIiwiYXR0YWNoRXZlbnQiLCJkZWx0YSIsImV2ZW50Iiwid2hlZWxEZWx0YSIsImRldGFpbCIsInNyY1RhcmdldCIsInNyY0VsZW1lbnQiLCJpcyIsInJldHVyblZhbHVlIiwieSIsImlzV2hlZWwiLCJpc0p1bXAiLCJtYXhUb3AiLCJNYXRoIiwibWluIiwibWF4IiwiY2VpbCIsImZsb29yIiwic2Nyb2xsSGVpZ2h0Iiwib2Zmc2V0VG9wIiwidHJpZ2dlciIsImNsZWFyVGltZW91dCIsIm1zZyIsInN0b3AiLCJmYWRlSW4iLCJzZXRUaW1lb3V0IiwiZmFkZU91dCIsInNsaW1zY3JvbGwiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Q0FPQSxTQUFVQSxHQUVSQSxFQUFFQyxHQUFHQyxPQUFPLENBQ1ZDLFdBQVksU0FBU0MsU0FFbkIsSUFxRUlDLEVBQUlMLEVBQUVFLE9BckVLLENBR2JJLE1BQVEsT0FHUkMsT0FBUyxRQUdUQyxLQUFPLE1BR1BDLE1BQU8sT0FHUEMsU0FBVyxRQUdYQyxTQUFXLE1BR1hDLE1BQVEsTUFHUkMsUUFBVSxHQUdWQyxlQUFnQixFQUdoQkMsZ0JBQWlCLEVBR2pCQyxhQUFjLEVBR2RDLFVBQVksT0FHWkMsWUFBYyxHQUdkQyxlQUFnQixFQUdoQkMsVUFBWSxpQkFHWkMsU0FBVyxnQkFHWEMsYUFBZSxnQkFHZkMsaUJBQWtCLEVBR2xCQyxVQUFZLEdBR1pDLGdCQUFrQixJQUdsQkMsYUFBYyxNQUdkQyxpQkFBbUIsT0FHTXZCLFNBNFgzQixPQXpYQXdCLEtBQUtDLE1BQUssV0FFUixJQUFJQyxZQUFhQyxVQUFXQyxRQUFTQyxVQUFXQyxTQUM1Q0MsVUFBV0MsY0FBZUMsV0FDMUJDLEtBQU8sY0FFUEMsZUFBZ0IsRUFHaEJDLEdBQUt4QyxFQUFFNEIsTUFHWCxHQUFJWSxHQUFHQyxTQUFTQyxTQUFTckMsRUFBRWlCLGNBQTNCLENBR0UsSUFBSXFCLE9BQVNILEdBQUdJLFlBU2hCLEdBTkFDLElBQU1MLEdBQUdNLFFBQVEsSUFBTXpDLEVBQUVnQixVQUN6QjBCLEtBQU9QLEdBQUdNLFFBQVEsSUFBTXpDLEVBQUVlLFdBRTFCNEIsZUFHSWhELEVBQUVpRCxjQUFjN0MsU0FDcEIsQ0FFRSxHQUFLLFdBQVlBLFNBQTZCLFFBQWxCQSxRQUFRRyxPQUFtQixDQUNyRGlDLEdBQUdDLFNBQVNTLElBQUksU0FBVSxRQUMxQlYsR0FBR1UsSUFBSSxTQUFVLFFBQ2pCLElBQUkzQyxPQUFTaUMsR0FBR0MsU0FBU0EsU0FBU2xDLFNBQ2xDaUMsR0FBR0MsU0FBU1MsSUFBSSxTQUFVM0MsUUFDMUJpQyxHQUFHVSxJQUFJLFNBQVUzQyxRQUduQixHQUFJLGFBQWNILFFBR2hCdUMsT0FBU1EsU0FBUzlDLEVBQUUrQyxlQUVqQixHQUFJLGFBQWNoRCxRQUdyQnVDLFFBQVVRLFNBQVM5QyxFQUFFZ0QsZUFFbEIsR0FBSSxZQUFhakQsUUFNcEIsT0FIQXlDLElBQUlTLFNBQ0pQLEtBQUtPLGNBQ0xkLEdBQUdlLFNBS0xDLGNBQWNiLFFBQVEsR0FBTyxTQUs1QixJQUFJM0MsRUFBRWlELGNBQWM3QyxZQUVuQixZQUFhQSxTQUZkLENBU0xDLEVBQUVFLE9BQXNCLFFBQVpGLEVBQUVFLE9BQW9CaUMsR0FBR0MsU0FBU2xDLFNBQVdGLEVBQUVFLE9BRzNELElBQUlrRCxRQUFVekQsRUFBRXNDLE1BQ1hvQixTQUFTckQsRUFBRWlCLGNBQ1g0QixJQUFJLENBQ0h4QyxTQUFVLFdBQ1ZpRCxTQUFVLFNBQ1ZyRCxNQUFPRCxFQUFFQyxNQUNUQyxPQUFRRixFQUFFRSxTQUloQmlDLEdBQUdVLElBQUksQ0FDTFMsU0FBVSxTQUNWckQsTUFBT0QsRUFBRUMsTUFDVEMsT0FBUUYsRUFBRUUsU0FJWixJQW1OcUJxRCxPQW5OakJiLEtBQU8vQyxFQUFFc0MsTUFDUm9CLFNBQVNyRCxFQUFFZSxXQUNYOEIsSUFBSSxDQUNINUMsTUFBT0QsRUFBRUcsS0FDVEQsT0FBUSxPQUNSRyxTQUFVLFdBQ1ZtRCxJQUFLLEVBQ0xDLFFBQVV6RCxFQUFFUyxlQUFpQlQsRUFBRVcsWUFBZSxRQUFVLE9BQ3hEK0MsZ0JBQWlCMUQsRUFBRXNCLGlCQUNuQnFDLFdBQVkzRCxFQUFFWSxVQUNkSixRQUFTUixFQUFFYSxZQUNYK0MsT0FBUSxLQUlWcEIsSUFBTTdDLEVBQUVzQyxNQUNQb0IsU0FBU3JELEVBQUVnQixVQUNYNkIsSUFBSSxDQUNIYyxXQUFZM0QsRUFBRUksTUFDZEgsTUFBT0QsRUFBRUcsS0FDVEUsU0FBVSxXQUNWbUQsSUFBSyxFQUNMaEQsUUFBU1IsRUFBRVEsUUFDWGlELFFBQVN6RCxFQUFFUyxjQUFnQixRQUFVLE9BQ3JDaUQsZ0JBQWtCMUQsRUFBRXFCLGFBQ3BCd0MsYUFBYzdELEVBQUVxQixhQUNoQnlDLGdCQUFpQjlELEVBQUVxQixhQUNuQjBDLG1CQUFvQi9ELEVBQUVxQixhQUN0QnVDLE9BQVEsS0FJVkksT0FBd0IsU0FBZGhFLEVBQUVLLFNBQXVCLENBQUU0RCxNQUFPakUsRUFBRU0sVUFBYSxDQUFFNEQsS0FBTWxFLEVBQUVNLFVBQ3pFb0MsS0FBS0csSUFBSW1CLFFBQ1R4QixJQUFJSyxJQUFJbUIsUUFHUjdCLEdBQUdnQyxLQUFLZixTQUdSakIsR0FBR0MsU0FBU2dDLE9BQU81QixLQUNuQkwsR0FBR0MsU0FBU2dDLE9BQU8xQixNQUdmMUMsRUFBRWMsZUFDSjBCLElBQUk2QixLQUFLLGFBQWEsU0FBU0MsR0FDN0IsSUFBSUMsS0FBTzVFLEVBQUU2RSxVQWViLE9BZEE3QyxTQUFVLEVBQ1Y4QyxFQUFJQyxXQUFXbEMsSUFBSUssSUFBSSxRQUN2QjhCLE1BQVFMLEVBQUVLLE1BRVZKLEtBQUtGLEtBQUssd0JBQXdCLFNBQVNDLEdBQ3pDTSxRQUFVSCxFQUFJSCxFQUFFSyxNQUFRQSxNQUN4Qm5DLElBQUlLLElBQUksTUFBTytCLFNBQ2Z6QixjQUFjLEVBQUdYLElBQUluQyxXQUFXbUQsS0FBSyxNQUd2Q2UsS0FBS0YsS0FBSyxzQkFBc0IsU0FBU0MsR0FDdkMzQyxTQUFVLEVBQU1rRCxVQUNoQk4sS0FBS08sT0FBTyxtQkFFUCxLQUNOVCxLQUFLLDBCQUEwQixTQUFTQyxHQUd6QyxPQUZBQSxFQUFFUyxrQkFDRlQsRUFBRVUsa0JBQ0ssS0FLWHRDLEtBQUt1QyxPQUFNLFdBQ1RDLGFBQ0MsV0FDREwsYUFJRnJDLElBQUl5QyxPQUFNLFdBQ1J2RCxXQUFZLEtBQ1gsV0FDREEsV0FBWSxLQUlkUyxHQUFHOEMsT0FBTSxXQUNQeEQsYUFBYyxFQUNkeUQsVUFDQUwsYUFDQyxXQUNEcEQsYUFBYyxFQUNkb0QsYUFJRjFDLEdBQUdrQyxLQUFLLGNBQWMsU0FBU0MsRUFBRWEsR0FDM0JiLEVBQUVjLGNBQWNDLFFBQVFDLFNBRzFCekQsU0FBV3lDLEVBQUVjLGNBQWNDLFFBQVEsR0FBR1YsVUFJMUN4QyxHQUFHa0MsS0FBSyxhQUFhLFNBQVNDLElBRXhCcEMsZUFFRm9DLEVBQUVjLGNBQWNKLGlCQUVkVixFQUFFYyxjQUFjQyxRQUFRQyxVQUsxQm5DLGVBRll0QixTQUFXeUMsRUFBRWMsY0FBY0MsUUFBUSxHQUFHVixPQUFTM0UsRUFBRW9CLGlCQUV6QyxHQUNwQlMsU0FBV3lDLEVBQUVjLGNBQWNDLFFBQVEsR0FBR1YsVUFLMUNoQyxlQUdnQixXQUFaM0MsRUFBRU8sT0FHSmlDLElBQUlLLElBQUksQ0FBRVcsSUFBS3JCLEdBQUdvRCxjQUFnQi9DLElBQUkrQyxnQkFDdENwQyxjQUFjLEdBQUcsSUFFRSxRQUFabkQsRUFBRU8sUUFHVDRDLGNBQWN4RCxFQUFFSyxFQUFFTyxPQUFPRixXQUFXbUQsSUFBSyxNQUFNLEdBRzFDeEQsRUFBRVMsZUFBaUIrQixJQUFJZ0QsUUE2RVRqQyxPQXpFVGhDLEtBMkVOa0UsT0FBT0Msa0JBRVRuQyxPQUFPbUMsaUJBQWlCLGlCQUFrQkMsVUFBVSxHQUNwRHBDLE9BQU9tQyxpQkFBaUIsYUFBY0MsVUFBVSxJQUloRG5CLFNBQVNvQixZQUFZLGVBQWdCRCxVQWhGekMsU0FBU0EsU0FBU3JCLEdBR2hCLEdBQUs3QyxZQUFMLENBRUEsSUFFSW9FLE1BQVEsR0FGUnZCLEVBQUlBLEdBQUttQixPQUFPSyxPQUdkQyxhQUFjRixPQUFTdkIsRUFBRXlCLFdBQVcsS0FDdEN6QixFQUFFMEIsU0FBVUgsTUFBUXZCLEVBQUUwQixPQUFTLEdBRW5DLElBQUl6QyxPQUFTZSxFQUFFZixRQUFVZSxFQUFFMkIsV0FBYTNCLEVBQUU0QixXQUN0Q3ZHLEVBQUU0RCxRQUFRZCxRQUFRLElBQU16QyxFQUFFaUIsY0FBY2tGLEdBQUdoRSxHQUFHQyxXQUVoRGUsY0FBYzBDLE9BQU8sR0FJbkJ2QixFQUFFVSxpQkFBbUI5QyxlQUFpQm9DLEVBQUVVLGlCQUN2QzlDLGdCQUFpQm9DLEVBQUU4QixhQUFjLElBR3hDLFNBQVNqRCxjQUFja0QsRUFBR0MsUUFBU0MsUUFFakNyRSxlQUFnQixFQUNoQixJQUFJMkQsTUFBUVEsRUFDUkcsT0FBU3JFLEdBQUdvRCxjQUFnQi9DLElBQUkrQyxjQXdCcEMsR0F0QkllLFVBR0ZULE1BQVEvQyxTQUFTTixJQUFJSyxJQUFJLFFBQVV3RCxFQUFJdkQsU0FBUzlDLEVBQUVtQixXQUFhLElBQU1xQixJQUFJK0MsY0FHekVNLE1BQVFZLEtBQUtDLElBQUlELEtBQUtFLElBQUlkLE1BQU8sR0FBSVcsUUFNckNYLE1BQVNRLEVBQUksRUFBS0ksS0FBS0csS0FBS2YsT0FBU1ksS0FBS0ksTUFBTWhCLE9BR2hEckQsSUFBSUssSUFBSSxDQUFFVyxJQUFLcUMsTUFBUSxRQUt6QkEsT0FEQTlELGNBQWdCZSxTQUFTTixJQUFJSyxJQUFJLFNBQVdWLEdBQUdvRCxjQUFnQi9DLElBQUkrQyxpQkFDMUNwRCxHQUFHLEdBQUcyRSxhQUFlM0UsR0FBR29ELGVBRTdDZ0IsT0FDSixDQUVFLElBQUlRLFdBREpsQixNQUFRUSxHQUNnQmxFLEdBQUcsR0FBRzJFLGFBQWUzRSxHQUFHb0QsY0FDaER3QixVQUFZTixLQUFLQyxJQUFJRCxLQUFLRSxJQUFJSSxVQUFXLEdBQUlQLFFBQzdDaEUsSUFBSUssSUFBSSxDQUFFVyxJQUFLdUQsVUFBWSxPQUk3QjVFLEdBQUdJLFVBQVVzRCxPQUdiMUQsR0FBRzZFLFFBQVEsa0JBQW1CbkIsT0FHOUJYLFVBR0FMLFVBZ0JGLFNBQVNsQyxlQUdQYixVQUFZMkUsS0FBS0UsSUFBS3hFLEdBQUdvRCxjQUFnQnBELEdBQUcsR0FBRzJFLGFBQWdCM0UsR0FBR29ELGNBdlRqRCxJQXdUakIvQyxJQUFJSyxJQUFJLENBQUUzQyxPQUFRNEIsVUFBWSxPQUc5QixJQUFJMkIsUUFBVTNCLFdBQWFLLEdBQUdvRCxjQUFnQixPQUFTLFFBQ3ZEL0MsSUFBSUssSUFBSSxDQUFFWSxRQUFTQSxVQUdyQixTQUFTeUIsVUFPUCxHQUpBdkMsZUFDQXNFLGFBQWFyRixXQUdURyxpQkFBbUJBLGVBTXJCLEdBSEFHLGNBQWdCbEMsRUFBRWtCLGdCQUdkYyxZQUFjRCxjQUNsQixDQUNFLElBQUltRixJQUEwQixLQUFqQm5GLGNBQXNCLE1BQVEsU0FDM0NJLEdBQUc2RSxRQUFRLGFBQWNFLFdBSzNCaEYsZUFBZ0IsRUFFbEJGLFdBQWFELGNBR1ZELFdBQWFLLEdBQUdvRCxjQUVqQnJELGVBQWdCLEdBR2xCTSxJQUFJMkUsTUFBSyxHQUFLLEdBQU1DLE9BQU8sUUFDdkJwSCxFQUFFVyxhQUFlK0IsS0FBS3lFLE1BQUssR0FBSyxHQUFNQyxPQUFPLFNBR25ELFNBQVN2QyxVQUdGN0UsRUFBRVMsZ0JBRUxtQixVQUFZeUYsWUFBVyxXQUNmckgsRUFBRVUsZ0JBQWtCZSxhQUFpQkMsV0FBY0MsVUFFdkRhLElBQUk4RSxRQUFRLFFBQ1o1RSxLQUFLNEUsUUFBUSxXQUVkLFVBT0YvRixRQUlYNUIsRUFBRUMsR0FBR0MsT0FBTyxDQUNWMEgsV0FBWTVILEVBQUVDLEdBQUdFLGFBM2NyQixDQThjRzBIIiwiZmlsZSI6InBsdWdpbnMvc2xpbXNjcm9sbC9qcXVlcnkuc2xpbXNjcm9sbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qISBDb3B5cmlnaHQgKGMpIDIwMTEgUGlvdHIgUm9jaGFsYSAoaHR0cDovL3JvY2hhLmxhKVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIChodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocClcbiAqIGFuZCBHUEwgKGh0dHA6Ly93d3cub3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvZ3BsLWxpY2Vuc2UucGhwKSBsaWNlbnNlcy5cbiAqXG4gKiBWZXJzaW9uOiAxLjMuNlxuICpcbiAqL1xuKGZ1bmN0aW9uKCQpIHtcblxuICAkLmZuLmV4dGVuZCh7XG4gICAgc2xpbVNjcm9sbDogZnVuY3Rpb24ob3B0aW9ucykge1xuXG4gICAgICB2YXIgZGVmYXVsdHMgPSB7XG5cbiAgICAgICAgLy8gd2lkdGggaW4gcGl4ZWxzIG9mIHRoZSB2aXNpYmxlIHNjcm9sbCBhcmVhXG4gICAgICAgIHdpZHRoIDogJ2F1dG8nLFxuXG4gICAgICAgIC8vIGhlaWdodCBpbiBwaXhlbHMgb2YgdGhlIHZpc2libGUgc2Nyb2xsIGFyZWFcbiAgICAgICAgaGVpZ2h0IDogJzI1MHB4JyxcblxuICAgICAgICAvLyB3aWR0aCBpbiBwaXhlbHMgb2YgdGhlIHNjcm9sbGJhciBhbmQgcmFpbFxuICAgICAgICBzaXplIDogJzdweCcsXG5cbiAgICAgICAgLy8gc2Nyb2xsYmFyIGNvbG9yLCBhY2NlcHRzIGFueSBoZXgvY29sb3IgdmFsdWVcbiAgICAgICAgY29sb3I6ICcjMDAwJyxcblxuICAgICAgICAvLyBzY3JvbGxiYXIgcG9zaXRpb24gLSBsZWZ0L3JpZ2h0XG4gICAgICAgIHBvc2l0aW9uIDogJ3JpZ2h0JyxcblxuICAgICAgICAvLyBkaXN0YW5jZSBpbiBwaXhlbHMgYmV0d2VlbiB0aGUgc2lkZSBlZGdlIGFuZCB0aGUgc2Nyb2xsYmFyXG4gICAgICAgIGRpc3RhbmNlIDogJzFweCcsXG5cbiAgICAgICAgLy8gZGVmYXVsdCBzY3JvbGwgcG9zaXRpb24gb24gbG9hZCAtIHRvcCAvIGJvdHRvbSAvICQoJ3NlbGVjdG9yJylcbiAgICAgICAgc3RhcnQgOiAndG9wJyxcblxuICAgICAgICAvLyBzZXRzIHNjcm9sbGJhciBvcGFjaXR5XG4gICAgICAgIG9wYWNpdHkgOiAuNCxcblxuICAgICAgICAvLyBlbmFibGVzIGFsd2F5cy1vbiBtb2RlIGZvciB0aGUgc2Nyb2xsYmFyXG4gICAgICAgIGFsd2F5c1Zpc2libGUgOiBmYWxzZSxcblxuICAgICAgICAvLyBjaGVjayBpZiB3ZSBzaG91bGQgaGlkZSB0aGUgc2Nyb2xsYmFyIHdoZW4gdXNlciBpcyBob3ZlcmluZyBvdmVyXG4gICAgICAgIGRpc2FibGVGYWRlT3V0IDogZmFsc2UsXG5cbiAgICAgICAgLy8gc2V0cyB2aXNpYmlsaXR5IG9mIHRoZSByYWlsXG4gICAgICAgIHJhaWxWaXNpYmxlIDogZmFsc2UsXG5cbiAgICAgICAgLy8gc2V0cyByYWlsIGNvbG9yXG4gICAgICAgIHJhaWxDb2xvciA6ICcjMzMzJyxcblxuICAgICAgICAvLyBzZXRzIHJhaWwgb3BhY2l0eVxuICAgICAgICByYWlsT3BhY2l0eSA6IC4yLFxuXG4gICAgICAgIC8vIHdoZXRoZXIgIHdlIHNob3VsZCB1c2UgalF1ZXJ5IFVJIERyYWdnYWJsZSB0byBlbmFibGUgYmFyIGRyYWdnaW5nXG4gICAgICAgIHJhaWxEcmFnZ2FibGUgOiB0cnVlLFxuXG4gICAgICAgIC8vIGRlZmF1dGx0IENTUyBjbGFzcyBvZiB0aGUgc2xpbXNjcm9sbCByYWlsXG4gICAgICAgIHJhaWxDbGFzcyA6ICdzbGltU2Nyb2xsUmFpbCcsXG5cbiAgICAgICAgLy8gZGVmYXV0bHQgQ1NTIGNsYXNzIG9mIHRoZSBzbGltc2Nyb2xsIGJhclxuICAgICAgICBiYXJDbGFzcyA6ICdzbGltU2Nyb2xsQmFyJyxcblxuICAgICAgICAvLyBkZWZhdXRsdCBDU1MgY2xhc3Mgb2YgdGhlIHNsaW1zY3JvbGwgd3JhcHBlclxuICAgICAgICB3cmFwcGVyQ2xhc3MgOiAnc2xpbVNjcm9sbERpdicsXG5cbiAgICAgICAgLy8gY2hlY2sgaWYgbW91c2V3aGVlbCBzaG91bGQgc2Nyb2xsIHRoZSB3aW5kb3cgaWYgd2UgcmVhY2ggdG9wL2JvdHRvbVxuICAgICAgICBhbGxvd1BhZ2VTY3JvbGwgOiBmYWxzZSxcblxuICAgICAgICAvLyBzY3JvbGwgYW1vdW50IGFwcGxpZWQgdG8gZWFjaCBtb3VzZSB3aGVlbCBzdGVwXG4gICAgICAgIHdoZWVsU3RlcCA6IDIwLFxuXG4gICAgICAgIC8vIHNjcm9sbCBhbW91bnQgYXBwbGllZCB3aGVuIHVzZXIgaXMgdXNpbmcgZ2VzdHVyZXNcbiAgICAgICAgdG91Y2hTY3JvbGxTdGVwIDogMjAwLFxuXG4gICAgICAgIC8vIHNldHMgYm9yZGVyIHJhZGl1c1xuICAgICAgICBib3JkZXJSYWRpdXM6ICc3cHgnLFxuXG4gICAgICAgIC8vIHNldHMgYm9yZGVyIHJhZGl1cyBvZiB0aGUgcmFpbFxuICAgICAgICByYWlsQm9yZGVyUmFkaXVzIDogJzdweCdcbiAgICAgIH07XG5cbiAgICAgIHZhciBvID0gJC5leHRlbmQoZGVmYXVsdHMsIG9wdGlvbnMpO1xuXG4gICAgICAvLyBkbyBpdCBmb3IgZXZlcnkgZWxlbWVudCB0aGF0IG1hdGNoZXMgc2VsZWN0b3JcbiAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpe1xuXG4gICAgICAgIHZhciBpc092ZXJQYW5lbCwgaXNPdmVyQmFyLCBpc0RyYWdnLCBxdWV1ZUhpZGUsIHRvdWNoRGlmLFxuICAgICAgICAgICAgYmFySGVpZ2h0LCBwZXJjZW50U2Nyb2xsLCBsYXN0U2Nyb2xsLFxuICAgICAgICAgICAgZGl2UyA9ICc8ZGl2PjwvZGl2PicsXG4gICAgICAgICAgICBtaW5CYXJIZWlnaHQgPSAzMCxcbiAgICAgICAgICAgIHJlbGVhc2VTY3JvbGwgPSBmYWxzZTtcblxuICAgICAgICAvLyB1c2VkIGluIGV2ZW50IGhhbmRsZXJzIGFuZCBmb3IgYmV0dGVyIG1pbmlmaWNhdGlvblxuICAgICAgICB2YXIgbWUgPSAkKHRoaXMpO1xuXG4gICAgICAgIC8vIGVuc3VyZSB3ZSBhcmUgbm90IGJpbmRpbmcgaXQgYWdhaW5cbiAgICAgICAgaWYgKG1lLnBhcmVudCgpLmhhc0NsYXNzKG8ud3JhcHBlckNsYXNzKSlcbiAgICAgICAge1xuICAgICAgICAgIC8vIHN0YXJ0IGZyb20gbGFzdCBiYXIgcG9zaXRpb25cbiAgICAgICAgICB2YXIgb2Zmc2V0ID0gbWUuc2Nyb2xsVG9wKCk7XG5cbiAgICAgICAgICAvLyBmaW5kIGJhciBhbmQgcmFpbFxuICAgICAgICAgIGJhciA9IG1lLmNsb3Nlc3QoJy4nICsgby5iYXJDbGFzcyk7XG4gICAgICAgICAgcmFpbCA9IG1lLmNsb3Nlc3QoJy4nICsgby5yYWlsQ2xhc3MpO1xuXG4gICAgICAgICAgZ2V0QmFySGVpZ2h0KCk7XG5cbiAgICAgICAgICAvLyBjaGVjayBpZiB3ZSBzaG91bGQgc2Nyb2xsIGV4aXN0aW5nIGluc3RhbmNlXG4gICAgICAgICAgaWYgKCQuaXNQbGFpbk9iamVjdChvcHRpb25zKSlcbiAgICAgICAgICB7XG4gICAgICAgICAgICAvLyBQYXNzIGhlaWdodDogYXV0byB0byBhbiBleGlzdGluZyBzbGltc2Nyb2xsIG9iamVjdCB0byBmb3JjZSBhIHJlc2l6ZSBhZnRlciBjb250ZW50cyBoYXZlIGNoYW5nZWRcbiAgICAgICAgICAgIGlmICggJ2hlaWdodCcgaW4gb3B0aW9ucyAmJiBvcHRpb25zLmhlaWdodCA9PSAnYXV0bycgKSB7XG4gICAgICAgICAgICAgIG1lLnBhcmVudCgpLmNzcygnaGVpZ2h0JywgJ2F1dG8nKTtcbiAgICAgICAgICAgICAgbWUuY3NzKCdoZWlnaHQnLCAnYXV0bycpO1xuICAgICAgICAgICAgICB2YXIgaGVpZ2h0ID0gbWUucGFyZW50KCkucGFyZW50KCkuaGVpZ2h0KCk7XG4gICAgICAgICAgICAgIG1lLnBhcmVudCgpLmNzcygnaGVpZ2h0JywgaGVpZ2h0KTtcbiAgICAgICAgICAgICAgbWUuY3NzKCdoZWlnaHQnLCBoZWlnaHQpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoJ3Njcm9sbFRvJyBpbiBvcHRpb25zKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAvLyBqdW1wIHRvIGEgc3RhdGljIHBvaW50XG4gICAgICAgICAgICAgIG9mZnNldCA9IHBhcnNlSW50KG8uc2Nyb2xsVG8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoJ3Njcm9sbEJ5JyBpbiBvcHRpb25zKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAvLyBqdW1wIGJ5IHZhbHVlIHBpeGVsc1xuICAgICAgICAgICAgICBvZmZzZXQgKz0gcGFyc2VJbnQoby5zY3JvbGxCeSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICgnZGVzdHJveScgaW4gb3B0aW9ucylcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgLy8gcmVtb3ZlIHNsaW1zY3JvbGwgZWxlbWVudHNcbiAgICAgICAgICAgICAgYmFyLnJlbW92ZSgpO1xuICAgICAgICAgICAgICByYWlsLnJlbW92ZSgpO1xuICAgICAgICAgICAgICBtZS51bndyYXAoKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBzY3JvbGwgY29udGVudCBieSB0aGUgZ2l2ZW4gb2Zmc2V0XG4gICAgICAgICAgICBzY3JvbGxDb250ZW50KG9mZnNldCwgZmFsc2UsIHRydWUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgkLmlzUGxhaW5PYmplY3Qob3B0aW9ucykpXG4gICAgICAgIHtcbiAgICAgICAgICBpZiAoJ2Rlc3Ryb3knIGluIG9wdGlvbnMpXG4gICAgICAgICAge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIG9wdGlvbmFsbHkgc2V0IGhlaWdodCB0byB0aGUgcGFyZW50J3MgaGVpZ2h0XG4gICAgICAgIG8uaGVpZ2h0ID0gKG8uaGVpZ2h0ID09ICdhdXRvJykgPyBtZS5wYXJlbnQoKS5oZWlnaHQoKSA6IG8uaGVpZ2h0O1xuXG4gICAgICAgIC8vIHdyYXAgY29udGVudFxuICAgICAgICB2YXIgd3JhcHBlciA9ICQoZGl2UylcbiAgICAgICAgICAgIC5hZGRDbGFzcyhvLndyYXBwZXJDbGFzcylcbiAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJyxcbiAgICAgICAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgICAgICAgICAgICB3aWR0aDogby53aWR0aCxcbiAgICAgICAgICAgICAgaGVpZ2h0OiBvLmhlaWdodFxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gdXBkYXRlIHN0eWxlIGZvciB0aGUgZGl2XG4gICAgICAgIG1lLmNzcyh7XG4gICAgICAgICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgICAgICAgIHdpZHRoOiBvLndpZHRoLFxuICAgICAgICAgIGhlaWdodDogby5oZWlnaHRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gY3JlYXRlIHNjcm9sbGJhciByYWlsXG4gICAgICAgIHZhciByYWlsID0gJChkaXZTKVxuICAgICAgICAgICAgLmFkZENsYXNzKG8ucmFpbENsYXNzKVxuICAgICAgICAgICAgLmNzcyh7XG4gICAgICAgICAgICAgIHdpZHRoOiBvLnNpemUsXG4gICAgICAgICAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICBkaXNwbGF5OiAoby5hbHdheXNWaXNpYmxlICYmIG8ucmFpbFZpc2libGUpID8gJ2Jsb2NrJyA6ICdub25lJyxcbiAgICAgICAgICAgICAgJ2JvcmRlci1yYWRpdXMnOiBvLnJhaWxCb3JkZXJSYWRpdXMsXG4gICAgICAgICAgICAgIGJhY2tncm91bmQ6IG8ucmFpbENvbG9yLFxuICAgICAgICAgICAgICBvcGFjaXR5OiBvLnJhaWxPcGFjaXR5LFxuICAgICAgICAgICAgICB6SW5kZXg6IDkwXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBjcmVhdGUgc2Nyb2xsYmFyXG4gICAgICAgIHZhciBiYXIgPSAkKGRpdlMpXG4gICAgICAgICAgICAuYWRkQ2xhc3Moby5iYXJDbGFzcylcbiAgICAgICAgICAgIC5jc3Moe1xuICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiBvLmNvbG9yLFxuICAgICAgICAgICAgICB3aWR0aDogby5zaXplLFxuICAgICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgICAgICBvcGFjaXR5OiBvLm9wYWNpdHksXG4gICAgICAgICAgICAgIGRpc3BsYXk6IG8uYWx3YXlzVmlzaWJsZSA/ICdibG9jaycgOiAnbm9uZScsXG4gICAgICAgICAgICAgICdib3JkZXItcmFkaXVzJyA6IG8uYm9yZGVyUmFkaXVzLFxuICAgICAgICAgICAgICBCb3JkZXJSYWRpdXM6IG8uYm9yZGVyUmFkaXVzLFxuICAgICAgICAgICAgICBNb3pCb3JkZXJSYWRpdXM6IG8uYm9yZGVyUmFkaXVzLFxuICAgICAgICAgICAgICBXZWJraXRCb3JkZXJSYWRpdXM6IG8uYm9yZGVyUmFkaXVzLFxuICAgICAgICAgICAgICB6SW5kZXg6IDk5XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAvLyBzZXQgcG9zaXRpb25cbiAgICAgICAgdmFyIHBvc0NzcyA9IChvLnBvc2l0aW9uID09ICdyaWdodCcpID8geyByaWdodDogby5kaXN0YW5jZSB9IDogeyBsZWZ0OiBvLmRpc3RhbmNlIH07XG4gICAgICAgIHJhaWwuY3NzKHBvc0Nzcyk7XG4gICAgICAgIGJhci5jc3MocG9zQ3NzKTtcblxuICAgICAgICAvLyB3cmFwIGl0XG4gICAgICAgIG1lLndyYXAod3JhcHBlcik7XG5cbiAgICAgICAgLy8gYXBwZW5kIHRvIHBhcmVudCBkaXZcbiAgICAgICAgbWUucGFyZW50KCkuYXBwZW5kKGJhcik7XG4gICAgICAgIG1lLnBhcmVudCgpLmFwcGVuZChyYWlsKTtcblxuICAgICAgICAvLyBtYWtlIGl0IGRyYWdnYWJsZSBhbmQgbm8gbG9uZ2VyIGRlcGVuZGVudCBvbiB0aGUganF1ZXJ5VUlcbiAgICAgICAgaWYgKG8ucmFpbERyYWdnYWJsZSl7XG4gICAgICAgICAgYmFyLmJpbmQoXCJtb3VzZWRvd25cIiwgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgdmFyICRkb2MgPSAkKGRvY3VtZW50KTtcbiAgICAgICAgICAgIGlzRHJhZ2cgPSB0cnVlO1xuICAgICAgICAgICAgdCA9IHBhcnNlRmxvYXQoYmFyLmNzcygndG9wJykpO1xuICAgICAgICAgICAgcGFnZVkgPSBlLnBhZ2VZO1xuXG4gICAgICAgICAgICAkZG9jLmJpbmQoXCJtb3VzZW1vdmUuc2xpbXNjcm9sbFwiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgICAgY3VyclRvcCA9IHQgKyBlLnBhZ2VZIC0gcGFnZVk7XG4gICAgICAgICAgICAgIGJhci5jc3MoJ3RvcCcsIGN1cnJUb3ApO1xuICAgICAgICAgICAgICBzY3JvbGxDb250ZW50KDAsIGJhci5wb3NpdGlvbigpLnRvcCwgZmFsc2UpOy8vIHNjcm9sbCBjb250ZW50XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJGRvYy5iaW5kKFwibW91c2V1cC5zbGltc2Nyb2xsXCIsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgaXNEcmFnZyA9IGZhbHNlO2hpZGVCYXIoKTtcbiAgICAgICAgICAgICAgJGRvYy51bmJpbmQoJy5zbGltc2Nyb2xsJyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICB9KS5iaW5kKFwic2VsZWN0c3RhcnQuc2xpbXNjcm9sbFwiLCBmdW5jdGlvbihlKXtcbiAgICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBvbiByYWlsIG92ZXJcbiAgICAgICAgcmFpbC5ob3ZlcihmdW5jdGlvbigpe1xuICAgICAgICAgIHNob3dCYXIoKTtcbiAgICAgICAgfSwgZnVuY3Rpb24oKXtcbiAgICAgICAgICBoaWRlQmFyKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIG9uIGJhciBvdmVyXG4gICAgICAgIGJhci5ob3ZlcihmdW5jdGlvbigpe1xuICAgICAgICAgIGlzT3ZlckJhciA9IHRydWU7XG4gICAgICAgIH0sIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgaXNPdmVyQmFyID0gZmFsc2U7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIHNob3cgb24gcGFyZW50IG1vdXNlb3ZlclxuICAgICAgICBtZS5ob3ZlcihmdW5jdGlvbigpe1xuICAgICAgICAgIGlzT3ZlclBhbmVsID0gdHJ1ZTtcbiAgICAgICAgICBzaG93QmFyKCk7XG4gICAgICAgICAgaGlkZUJhcigpO1xuICAgICAgICB9LCBmdW5jdGlvbigpe1xuICAgICAgICAgIGlzT3ZlclBhbmVsID0gZmFsc2U7XG4gICAgICAgICAgaGlkZUJhcigpO1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBzdXBwb3J0IGZvciBtb2JpbGVcbiAgICAgICAgbWUuYmluZCgndG91Y2hzdGFydCcsIGZ1bmN0aW9uKGUsYil7XG4gICAgICAgICAgaWYgKGUub3JpZ2luYWxFdmVudC50b3VjaGVzLmxlbmd0aClcbiAgICAgICAgICB7XG4gICAgICAgICAgICAvLyByZWNvcmQgd2hlcmUgdG91Y2ggc3RhcnRlZFxuICAgICAgICAgICAgdG91Y2hEaWYgPSBlLm9yaWdpbmFsRXZlbnQudG91Y2hlc1swXS5wYWdlWTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIG1lLmJpbmQoJ3RvdWNobW92ZScsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAgIC8vIHByZXZlbnQgc2Nyb2xsaW5nIHRoZSBwYWdlIGlmIG5lY2Vzc2FyeVxuICAgICAgICAgIGlmKCFyZWxlYXNlU2Nyb2xsKVxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGUub3JpZ2luYWxFdmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50LnRvdWNoZXMubGVuZ3RoKVxuICAgICAgICAgIHtcbiAgICAgICAgICAgIC8vIHNlZSBob3cgZmFyIHVzZXIgc3dpcGVkXG4gICAgICAgICAgICB2YXIgZGlmZiA9ICh0b3VjaERpZiAtIGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VZKSAvIG8udG91Y2hTY3JvbGxTdGVwO1xuICAgICAgICAgICAgLy8gc2Nyb2xsIGNvbnRlbnRcbiAgICAgICAgICAgIHNjcm9sbENvbnRlbnQoZGlmZiwgdHJ1ZSk7XG4gICAgICAgICAgICB0b3VjaERpZiA9IGUub3JpZ2luYWxFdmVudC50b3VjaGVzWzBdLnBhZ2VZO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gc2V0IHVwIGluaXRpYWwgaGVpZ2h0XG4gICAgICAgIGdldEJhckhlaWdodCgpO1xuXG4gICAgICAgIC8vIGNoZWNrIHN0YXJ0IHBvc2l0aW9uXG4gICAgICAgIGlmIChvLnN0YXJ0ID09PSAnYm90dG9tJylcbiAgICAgICAge1xuICAgICAgICAgIC8vIHNjcm9sbCBjb250ZW50IHRvIGJvdHRvbVxuICAgICAgICAgIGJhci5jc3MoeyB0b3A6IG1lLm91dGVySGVpZ2h0KCkgLSBiYXIub3V0ZXJIZWlnaHQoKSB9KTtcbiAgICAgICAgICBzY3JvbGxDb250ZW50KDAsIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG8uc3RhcnQgIT09ICd0b3AnKVxuICAgICAgICB7XG4gICAgICAgICAgLy8gYXNzdW1lIGpRdWVyeSBzZWxlY3RvclxuICAgICAgICAgIHNjcm9sbENvbnRlbnQoJChvLnN0YXJ0KS5wb3NpdGlvbigpLnRvcCwgbnVsbCwgdHJ1ZSk7XG5cbiAgICAgICAgICAvLyBtYWtlIHN1cmUgYmFyIHN0YXlzIGhpZGRlblxuICAgICAgICAgIGlmICghby5hbHdheXNWaXNpYmxlKSB7IGJhci5oaWRlKCk7IH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGF0dGFjaCBzY3JvbGwgZXZlbnRzXG4gICAgICAgIGF0dGFjaFdoZWVsKHRoaXMpO1xuXG4gICAgICAgIGZ1bmN0aW9uIF9vbldoZWVsKGUpXG4gICAgICAgIHtcbiAgICAgICAgICAvLyB1c2UgbW91c2Ugd2hlZWwgb25seSB3aGVuIG1vdXNlIGlzIG92ZXJcbiAgICAgICAgICBpZiAoIWlzT3ZlclBhbmVsKSB7IHJldHVybjsgfVxuXG4gICAgICAgICAgdmFyIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcblxuICAgICAgICAgIHZhciBkZWx0YSA9IDA7XG4gICAgICAgICAgaWYgKGUud2hlZWxEZWx0YSkgeyBkZWx0YSA9IC1lLndoZWVsRGVsdGEvMTIwOyB9XG4gICAgICAgICAgaWYgKGUuZGV0YWlsKSB7IGRlbHRhID0gZS5kZXRhaWwgLyAzOyB9XG5cbiAgICAgICAgICB2YXIgdGFyZ2V0ID0gZS50YXJnZXQgfHwgZS5zcmNUYXJnZXQgfHwgZS5zcmNFbGVtZW50O1xuICAgICAgICAgIGlmICgkKHRhcmdldCkuY2xvc2VzdCgnLicgKyBvLndyYXBwZXJDbGFzcykuaXMobWUucGFyZW50KCkpKSB7XG4gICAgICAgICAgICAvLyBzY3JvbGwgY29udGVudFxuICAgICAgICAgICAgc2Nyb2xsQ29udGVudChkZWx0YSwgdHJ1ZSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gc3RvcCB3aW5kb3cgc2Nyb2xsXG4gICAgICAgICAgaWYgKGUucHJldmVudERlZmF1bHQgJiYgIXJlbGVhc2VTY3JvbGwpIHsgZS5wcmV2ZW50RGVmYXVsdCgpOyB9XG4gICAgICAgICAgaWYgKCFyZWxlYXNlU2Nyb2xsKSB7IGUucmV0dXJuVmFsdWUgPSBmYWxzZTsgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2Nyb2xsQ29udGVudCh5LCBpc1doZWVsLCBpc0p1bXApXG4gICAgICAgIHtcbiAgICAgICAgICByZWxlYXNlU2Nyb2xsID0gZmFsc2U7XG4gICAgICAgICAgdmFyIGRlbHRhID0geTtcbiAgICAgICAgICB2YXIgbWF4VG9wID0gbWUub3V0ZXJIZWlnaHQoKSAtIGJhci5vdXRlckhlaWdodCgpO1xuXG4gICAgICAgICAgaWYgKGlzV2hlZWwpXG4gICAgICAgICAge1xuICAgICAgICAgICAgLy8gbW92ZSBiYXIgd2l0aCBtb3VzZSB3aGVlbFxuICAgICAgICAgICAgZGVsdGEgPSBwYXJzZUludChiYXIuY3NzKCd0b3AnKSkgKyB5ICogcGFyc2VJbnQoby53aGVlbFN0ZXApIC8gMTAwICogYmFyLm91dGVySGVpZ2h0KCk7XG5cbiAgICAgICAgICAgIC8vIG1vdmUgYmFyLCBtYWtlIHN1cmUgaXQgZG9lc24ndCBnbyBvdXRcbiAgICAgICAgICAgIGRlbHRhID0gTWF0aC5taW4oTWF0aC5tYXgoZGVsdGEsIDApLCBtYXhUb3ApO1xuXG4gICAgICAgICAgICAvLyBpZiBzY3JvbGxpbmcgZG93biwgbWFrZSBzdXJlIGEgZnJhY3Rpb25hbCBjaGFuZ2UgdG8gdGhlXG4gICAgICAgICAgICAvLyBzY3JvbGwgcG9zaXRpb24gaXNuJ3Qgcm91bmRlZCBhd2F5IHdoZW4gdGhlIHNjcm9sbGJhcidzIENTUyBpcyBzZXRcbiAgICAgICAgICAgIC8vIHRoaXMgZmxvb3Jpbmcgb2YgZGVsdGEgd291bGQgaGFwcGVuZWQgYXV0b21hdGljYWxseSB3aGVuXG4gICAgICAgICAgICAvLyBiYXIuY3NzIGlzIHNldCBiZWxvdywgYnV0IHdlIGZsb29yIGhlcmUgZm9yIGNsYXJpdHlcbiAgICAgICAgICAgIGRlbHRhID0gKHkgPiAwKSA/IE1hdGguY2VpbChkZWx0YSkgOiBNYXRoLmZsb29yKGRlbHRhKTtcblxuICAgICAgICAgICAgLy8gc2Nyb2xsIHRoZSBzY3JvbGxiYXJcbiAgICAgICAgICAgIGJhci5jc3MoeyB0b3A6IGRlbHRhICsgJ3B4JyB9KTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBjYWxjdWxhdGUgYWN0dWFsIHNjcm9sbCBhbW91bnRcbiAgICAgICAgICBwZXJjZW50U2Nyb2xsID0gcGFyc2VJbnQoYmFyLmNzcygndG9wJykpIC8gKG1lLm91dGVySGVpZ2h0KCkgLSBiYXIub3V0ZXJIZWlnaHQoKSk7XG4gICAgICAgICAgZGVsdGEgPSBwZXJjZW50U2Nyb2xsICogKG1lWzBdLnNjcm9sbEhlaWdodCAtIG1lLm91dGVySGVpZ2h0KCkpO1xuXG4gICAgICAgICAgaWYgKGlzSnVtcClcbiAgICAgICAgICB7XG4gICAgICAgICAgICBkZWx0YSA9IHk7XG4gICAgICAgICAgICB2YXIgb2Zmc2V0VG9wID0gZGVsdGEgLyBtZVswXS5zY3JvbGxIZWlnaHQgKiBtZS5vdXRlckhlaWdodCgpO1xuICAgICAgICAgICAgb2Zmc2V0VG9wID0gTWF0aC5taW4oTWF0aC5tYXgob2Zmc2V0VG9wLCAwKSwgbWF4VG9wKTtcbiAgICAgICAgICAgIGJhci5jc3MoeyB0b3A6IG9mZnNldFRvcCArICdweCcgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gc2Nyb2xsIGNvbnRlbnRcbiAgICAgICAgICBtZS5zY3JvbGxUb3AoZGVsdGEpO1xuXG4gICAgICAgICAgLy8gZmlyZSBzY3JvbGxpbmcgZXZlbnRcbiAgICAgICAgICBtZS50cmlnZ2VyKCdzbGltc2Nyb2xsaW5nJywgfn5kZWx0YSk7XG5cbiAgICAgICAgICAvLyBlbnN1cmUgYmFyIGlzIHZpc2libGVcbiAgICAgICAgICBzaG93QmFyKCk7XG5cbiAgICAgICAgICAvLyB0cmlnZ2VyIGhpZGUgd2hlbiBzY3JvbGwgaXMgc3RvcHBlZFxuICAgICAgICAgIGhpZGVCYXIoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGF0dGFjaFdoZWVsKHRhcmdldClcbiAgICAgICAge1xuICAgICAgICAgIGlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcilcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcignRE9NTW91c2VTY3JvbGwnLCBfb25XaGVlbCwgZmFsc2UgKTtcbiAgICAgICAgICAgIHRhcmdldC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXdoZWVsJywgX29uV2hlZWwsIGZhbHNlICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2VcbiAgICAgICAgICB7XG4gICAgICAgICAgICBkb2N1bWVudC5hdHRhY2hFdmVudChcIm9ubW91c2V3aGVlbFwiLCBfb25XaGVlbClcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRCYXJIZWlnaHQoKVxuICAgICAgICB7XG4gICAgICAgICAgLy8gY2FsY3VsYXRlIHNjcm9sbGJhciBoZWlnaHQgYW5kIG1ha2Ugc3VyZSBpdCBpcyBub3QgdG9vIHNtYWxsXG4gICAgICAgICAgYmFySGVpZ2h0ID0gTWF0aC5tYXgoKG1lLm91dGVySGVpZ2h0KCkgLyBtZVswXS5zY3JvbGxIZWlnaHQpICogbWUub3V0ZXJIZWlnaHQoKSwgbWluQmFySGVpZ2h0KTtcbiAgICAgICAgICBiYXIuY3NzKHsgaGVpZ2h0OiBiYXJIZWlnaHQgKyAncHgnIH0pO1xuXG4gICAgICAgICAgLy8gaGlkZSBzY3JvbGxiYXIgaWYgY29udGVudCBpcyBub3QgbG9uZyBlbm91Z2hcbiAgICAgICAgICB2YXIgZGlzcGxheSA9IGJhckhlaWdodCA9PSBtZS5vdXRlckhlaWdodCgpID8gJ25vbmUnIDogJ2Jsb2NrJztcbiAgICAgICAgICBiYXIuY3NzKHsgZGlzcGxheTogZGlzcGxheSB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNob3dCYXIoKVxuICAgICAgICB7XG4gICAgICAgICAgLy8gcmVjYWxjdWxhdGUgYmFyIGhlaWdodFxuICAgICAgICAgIGdldEJhckhlaWdodCgpO1xuICAgICAgICAgIGNsZWFyVGltZW91dChxdWV1ZUhpZGUpO1xuXG4gICAgICAgICAgLy8gd2hlbiBiYXIgcmVhY2hlZCB0b3Agb3IgYm90dG9tXG4gICAgICAgICAgaWYgKHBlcmNlbnRTY3JvbGwgPT0gfn5wZXJjZW50U2Nyb2xsKVxuICAgICAgICAgIHtcbiAgICAgICAgICAgIC8vcmVsZWFzZSB3aGVlbFxuICAgICAgICAgICAgcmVsZWFzZVNjcm9sbCA9IG8uYWxsb3dQYWdlU2Nyb2xsO1xuXG4gICAgICAgICAgICAvLyBwdWJsaXNoIGFwcHJvcG9yaWF0ZSBldmVudFxuICAgICAgICAgICAgaWYgKGxhc3RTY3JvbGwgIT0gcGVyY2VudFNjcm9sbClcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgdmFyIG1zZyA9ICh+fnBlcmNlbnRTY3JvbGwgPT0gMCkgPyAndG9wJyA6ICdib3R0b20nO1xuICAgICAgICAgICAgICBtZS50cmlnZ2VyKCdzbGltc2Nyb2xsJywgbXNnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZWxzZVxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJlbGVhc2VTY3JvbGwgPSBmYWxzZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGFzdFNjcm9sbCA9IHBlcmNlbnRTY3JvbGw7XG5cbiAgICAgICAgICAvLyBzaG93IG9ubHkgd2hlbiByZXF1aXJlZFxuICAgICAgICAgIGlmKGJhckhlaWdodCA+PSBtZS5vdXRlckhlaWdodCgpKSB7XG4gICAgICAgICAgICAvL2FsbG93IHdpbmRvdyBzY3JvbGxcbiAgICAgICAgICAgIHJlbGVhc2VTY3JvbGwgPSB0cnVlO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBiYXIuc3RvcCh0cnVlLHRydWUpLmZhZGVJbignZmFzdCcpO1xuICAgICAgICAgIGlmIChvLnJhaWxWaXNpYmxlKSB7IHJhaWwuc3RvcCh0cnVlLHRydWUpLmZhZGVJbignZmFzdCcpOyB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBoaWRlQmFyKClcbiAgICAgICAge1xuICAgICAgICAgIC8vIG9ubHkgaGlkZSB3aGVuIG9wdGlvbnMgYWxsb3cgaXRcbiAgICAgICAgICBpZiAoIW8uYWx3YXlzVmlzaWJsZSlcbiAgICAgICAgICB7XG4gICAgICAgICAgICBxdWV1ZUhpZGUgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgIGlmICghKG8uZGlzYWJsZUZhZGVPdXQgJiYgaXNPdmVyUGFuZWwpICYmICFpc092ZXJCYXIgJiYgIWlzRHJhZ2cpXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBiYXIuZmFkZU91dCgnc2xvdycpO1xuICAgICAgICAgICAgICAgIHJhaWwuZmFkZU91dCgnc2xvdycpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfSk7XG5cbiAgICAgIC8vIG1haW50YWluIGNoYWluYWJpbGl0eVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICB9KTtcblxuICAkLmZuLmV4dGVuZCh7XG4gICAgc2xpbXNjcm9sbDogJC5mbi5zbGltU2Nyb2xsXG4gIH0pO1xuXG59KShqUXVlcnkpOyJdfQ==
