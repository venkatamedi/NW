!function(){"use strict";function toastr($animate,$injector,$document,$rootScope,$sce,toastrConfig,$q){var container,index=0,toasts=[],previousToastMessage="",openToasts={},containerDefer=$q.defer();return{active:function(){return toasts.length},clear:function(toast){if(1===arguments.length&&!toast)return;if(toast)remove(toast.toastId);else for(var i=0;i<toasts.length;i++)remove(toasts[i].toastId)},error:function(message,title,optionsOverride){return _buildNotification(_getOptions().iconClasses.error,message,title,optionsOverride)},info:function(message,title,optionsOverride){return _buildNotification(_getOptions().iconClasses.info,message,title,optionsOverride)},remove:remove,success:function(message,title,optionsOverride){return _buildNotification(_getOptions().iconClasses.success,message,title,optionsOverride)},warning:function(message,title,optionsOverride){return _buildNotification(_getOptions().iconClasses.warning,message,title,optionsOverride)},refreshTimer:function(toast,newTime){toast&&toast.isOpened&&toasts.indexOf(toast)>=0&&toast.scope.refreshTimer(newTime)}};function remove(toastId,wasClicked){var toast=function(toastId){for(var i=0;i<toasts.length;i++)if(toasts[i].toastId===toastId)return toasts[i]}(toastId);toast&&!toast.deleting&&(toast.deleting=!0,toast.isOpened=!1,$animate.leave(toast.el).then((function(){toast.scope.options.onHidden&&toast.scope.options.onHidden(!!wasClicked,toast),toast.scope.$destroy();var index=toasts.indexOf(toast);delete openToasts[toast.scope.message],toasts.splice(index,1);var maxOpened=toastrConfig.maxOpened;maxOpened&&toasts.length>=maxOpened&&toasts[maxOpened-1].open.resolve(),toasts.length||(container.remove(),container=null,containerDefer=$q.defer())})))}function _buildNotification(type,message,title,optionsOverride){return angular.isObject(title)&&(optionsOverride=title,title=null),function(map){var options=_getOptions();if(function(){var isDuplicateOfLast=options.preventDuplicates&&map.message===previousToastMessage,isDuplicateOpen=options.preventOpenDuplicates&&openToasts[map.message];if(isDuplicateOfLast||isDuplicateOpen)return!0;return previousToastMessage=map.message,openToasts[map.message]=!0,!1}())return;var newToast=function(){var newToast={toastId:index++,isOpened:!1,scope:$rootScope.$new(),open:$q.defer()};newToast.iconClass=map.iconClass,map.optionsOverride&&(angular.extend(options,function(options){for(var badOptions=["containerId","iconClasses","maxOpened","newestOnTop","positionClass","preventDuplicates","preventOpenDuplicates","templates"],i=0,l=badOptions.length;i<l;i++)delete options[badOptions[i]];return options}(map.optionsOverride)),newToast.iconClass=map.optionsOverride.iconClass||newToast.iconClass);return function(toast,map,options){options.allowHtml?(toast.scope.allowHtml=!0,toast.scope.title=$sce.trustAsHtml(map.title),toast.scope.message=$sce.trustAsHtml(map.message)):(toast.scope.title=map.title,toast.scope.message=map.message);toast.scope.toastType=toast.iconClass,toast.scope.toastId=toast.toastId,toast.scope.extraData=options.extraData,toast.scope.options={extendedTimeOut:options.extendedTimeOut,messageClass:options.messageClass,onHidden:options.onHidden,onShown:generateEvent("onShown"),onTap:generateEvent("onTap"),progressBar:options.progressBar,tapToDismiss:options.tapToDismiss,timeOut:options.timeOut,titleClass:options.titleClass,toastClass:options.toastClass},options.closeButton&&(toast.scope.options.closeHtml=options.closeHtml);function generateEvent(event){if(options[event])return function(){options[event](toast)}}}(newToast,map,options),newToast.el=function(scope){var angularDomEl=angular.element("<div toast></div>");return $injector.get("$compile")(angularDomEl)(scope)}(newToast.scope),newToast}();if(toasts.push(newToast),function(){return options.autoDismiss&&options.maxOpened&&toasts.length>options.maxOpened}())for(var oldToasts=toasts.slice(0,toasts.length-options.maxOpened),i=0,len=oldToasts.length;i<len;i++)remove(oldToasts[i].toastId);(options.maxOpened&&toasts.length<=options.maxOpened||!options.maxOpened)&&newToast.open.resolve();return newToast.open.promise.then((function(){(function(options){if(container)return containerDefer.promise;(container=angular.element("<div></div>")).attr("id",options.containerId),container.addClass(options.positionClass),container.css({"pointer-events":"auto"});var target=angular.element(document.querySelector(options.target));if(!target||!target.length)throw"Target for toasts doesn't exist";return $animate.enter(container,target).then((function(){containerDefer.resolve()})),containerDefer.promise})(options).then((function(){if(newToast.isOpened=!0,options.newestOnTop)$animate.enter(newToast.el,container).then((function(){newToast.scope.init()}));else{var sibling=container[0].lastChild?angular.element(container[0].lastChild):null;$animate.enter(newToast.el,container,sibling).then((function(){newToast.scope.init()}))}}))})),newToast}({iconClass:type,message:message,optionsOverride:optionsOverride,title:title})}function _getOptions(){return angular.extend({},toastrConfig)}}angular.module("toastr",[]).factory("toastr",toastr),toastr.$inject=["$animate","$injector","$document","$rootScope","$sce","toastrConfig","$q"]}(),function(){"use strict";angular.module("toastr").constant("toastrConfig",{allowHtml:!1,autoDismiss:!1,closeButton:!1,closeHtml:"<button>&times;</button>",containerId:"toast-container",extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},maxOpened:0,messageClass:"toast-message",newestOnTop:!0,onHidden:null,onShown:null,onTap:null,positionClass:"toast-top-right",preventDuplicates:!1,preventOpenDuplicates:!1,progressBar:!1,tapToDismiss:!0,target:"body",templates:{toast:"directives/toast/toast.html",progressbar:"directives/progressbar/progressbar.html"},timeOut:5e3,titleClass:"toast-title",toastClass:"toast"})}(),function(){"use strict";function progressBar(toastrConfig){return{require:"^toast",templateUrl:function(){return toastrConfig.templates.progressbar},link:function(scope,element,attrs,toastCtrl){var intervalId,currentTimeOut,hideTime;function updateProgress(){var percentage=(hideTime-(new Date).getTime())/currentTimeOut*100;element.css("width",percentage+"%")}toastCtrl.progressBar=scope,scope.start=function(duration){intervalId&&clearInterval(intervalId),currentTimeOut=parseFloat(duration),hideTime=(new Date).getTime()+currentTimeOut,intervalId=setInterval(updateProgress,10)},scope.stop=function(){intervalId&&clearInterval(intervalId)},scope.$on("$destroy",(function(){clearInterval(intervalId)}))}}}angular.module("toastr").directive("progressBar",progressBar),progressBar.$inject=["toastrConfig"]}(),function(){"use strict";angular.module("toastr").controller("ToastController",(function(){this.progressBar=null,this.startProgressBar=function(duration){this.progressBar&&this.progressBar.start(duration)},this.stopProgressBar=function(){this.progressBar&&this.progressBar.stop()}}))}(),function(){"use strict";function toast($injector,$interval,toastrConfig,toastr){return{templateUrl:function(){return toastrConfig.templates.toast},controller:"ToastController",link:function(scope,element,attrs,toastCtrl){var timeout;if(scope.toastClass=scope.options.toastClass,scope.titleClass=scope.options.titleClass,scope.messageClass=scope.options.messageClass,scope.progressBar=scope.options.progressBar,function(){return scope.options.closeHtml}()){var button=angular.element(scope.options.closeHtml),$compile=$injector.get("$compile");button.addClass("toast-close-button"),button.attr("ng-click","close(true, $event)"),$compile(button)(scope),element.children().prepend(button)}function createTimeout(time){return toastCtrl.startProgressBar(time),$interval((function(){toastCtrl.stopProgressBar(),toastr.remove(scope.toastId)}),time,1)}scope.init=function(){scope.options.timeOut&&(timeout=createTimeout(scope.options.timeOut)),scope.options.onShown&&scope.options.onShown()},element.on("mouseenter",(function(){scope.progressBar=!1,toastCtrl.stopProgressBar(),timeout&&$interval.cancel(timeout)})),scope.tapToast=function(){angular.isFunction(scope.options.onTap)&&scope.options.onTap(),scope.options.tapToDismiss&&scope.close(!0)},scope.close=function(wasClicked,$event){$event&&angular.isFunction($event.stopPropagation)&&$event.stopPropagation(),toastr.remove(scope.toastId,wasClicked)},scope.refreshTimer=function(newTime){timeout&&($interval.cancel(timeout),timeout=createTimeout(newTime||scope.options.timeOut))},element.on("mouseleave",(function(){0===scope.options.timeOut&&0===scope.options.extendedTimeOut||(scope.$apply((function(){scope.progressBar=scope.options.progressBar})),timeout=createTimeout(scope.options.extendedTimeOut))}))}}}angular.module("toastr").directive("toast",toast),toast.$inject=["$injector","$interval","toastrConfig","toastr"]}(),angular.module("toastr").run(["$templateCache",function($templateCache){$templateCache.put("directives/progressbar/progressbar.html",'<div class="toast-progress"></div>\n'),$templateCache.put("directives/toast/toast.html",'<div class="{{toastClass}} {{toastType}}" ng-click="tapToast()">\n  <div ng-switch on="allowHtml">\n    <div ng-switch-default ng-if="title" class="{{titleClass}}" aria-label="{{title}}">{{title}}</div>\n    <div ng-switch-default class="{{messageClass}}" aria-label="{{message}}">{{message}}</div>\n    <div ng-switch-when="true" ng-if="title" class="{{titleClass}}" ng-bind-html="title"></div>\n    <div ng-switch-when="true" class="{{messageClass}}" ng-bind-html="message"></div>\n  </div>\n  <progress-bar ng-if="progressBar"></progress-bar>\n</div>\n')}]);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBsdWdpbnMvYW5ndWxhci10b2FzdHIvZGlzdC9hbmd1bGFyLXRvYXN0ci50cGxzLmpzIl0sIm5hbWVzIjpbInRvYXN0ciIsIiRhbmltYXRlIiwiJGluamVjdG9yIiwiJGRvY3VtZW50IiwiJHJvb3RTY29wZSIsIiRzY2UiLCJ0b2FzdHJDb25maWciLCIkcSIsImNvbnRhaW5lciIsImluZGV4IiwidG9hc3RzIiwicHJldmlvdXNUb2FzdE1lc3NhZ2UiLCJvcGVuVG9hc3RzIiwiY29udGFpbmVyRGVmZXIiLCJkZWZlciIsImFjdGl2ZSIsImxlbmd0aCIsImNsZWFyIiwidG9hc3QiLCJhcmd1bWVudHMiLCJyZW1vdmUiLCJ0b2FzdElkIiwiaSIsImVycm9yIiwibWVzc2FnZSIsInRpdGxlIiwib3B0aW9uc092ZXJyaWRlIiwiX2J1aWxkTm90aWZpY2F0aW9uIiwiX2dldE9wdGlvbnMiLCJpY29uQ2xhc3NlcyIsImluZm8iLCJzdWNjZXNzIiwid2FybmluZyIsInJlZnJlc2hUaW1lciIsIm5ld1RpbWUiLCJpc09wZW5lZCIsImluZGV4T2YiLCJzY29wZSIsIndhc0NsaWNrZWQiLCJmaW5kVG9hc3QiLCJkZWxldGluZyIsImxlYXZlIiwiZWwiLCJ0aGVuIiwib3B0aW9ucyIsIm9uSGlkZGVuIiwiJGRlc3Ryb3kiLCJzcGxpY2UiLCJtYXhPcGVuZWQiLCJvcGVuIiwicmVzb2x2ZSIsInR5cGUiLCJhbmd1bGFyIiwiaXNPYmplY3QiLCJtYXAiLCJpc0R1cGxpY2F0ZU9mTGFzdCIsInByZXZlbnREdXBsaWNhdGVzIiwiaXNEdXBsaWNhdGVPcGVuIiwicHJldmVudE9wZW5EdXBsaWNhdGVzIiwic2hvdWxkRXhpdCIsIm5ld1RvYXN0IiwiJG5ldyIsImljb25DbGFzcyIsImV4dGVuZCIsImJhZE9wdGlvbnMiLCJsIiwiY2xlYW5PcHRpb25zT3ZlcnJpZGUiLCJhbGxvd0h0bWwiLCJ0cnVzdEFzSHRtbCIsInRvYXN0VHlwZSIsImV4dHJhRGF0YSIsImV4dGVuZGVkVGltZU91dCIsIm1lc3NhZ2VDbGFzcyIsIm9uU2hvd24iLCJnZW5lcmF0ZUV2ZW50Iiwib25UYXAiLCJwcm9ncmVzc0JhciIsInRhcFRvRGlzbWlzcyIsInRpbWVPdXQiLCJ0aXRsZUNsYXNzIiwidG9hc3RDbGFzcyIsImNsb3NlQnV0dG9uIiwiY2xvc2VIdG1sIiwiZXZlbnQiLCJjcmVhdGVTY29wZSIsImFuZ3VsYXJEb21FbCIsImVsZW1lbnQiLCJnZXQiLCIkY29tcGlsZSIsImNyZWF0ZVRvYXN0RWwiLCJjcmVhdGVUb2FzdCIsInB1c2giLCJhdXRvRGlzbWlzcyIsImlmTWF4T3BlbmVkQW5kQXV0b0Rpc21pc3MiLCJvbGRUb2FzdHMiLCJzbGljZSIsImxlbiIsInByb21pc2UiLCJhdHRyIiwiY29udGFpbmVySWQiLCJhZGRDbGFzcyIsInBvc2l0aW9uQ2xhc3MiLCJjc3MiLCJwb2ludGVyLWV2ZW50cyIsInRhcmdldCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImVudGVyIiwiX2NyZWF0ZU9yR2V0Q29udGFpbmVyIiwibmV3ZXN0T25Ub3AiLCJpbml0Iiwic2libGluZyIsImxhc3RDaGlsZCIsIl9ub3RpZnkiLCJtb2R1bGUiLCJmYWN0b3J5IiwiJGluamVjdCIsImNvbnN0YW50IiwidGVtcGxhdGVzIiwicHJvZ3Jlc3NiYXIiLCJyZXF1aXJlIiwidGVtcGxhdGVVcmwiLCJsaW5rIiwiYXR0cnMiLCJ0b2FzdEN0cmwiLCJpbnRlcnZhbElkIiwiY3VycmVudFRpbWVPdXQiLCJoaWRlVGltZSIsInVwZGF0ZVByb2dyZXNzIiwicGVyY2VudGFnZSIsIkRhdGUiLCJnZXRUaW1lIiwic3RhcnQiLCJkdXJhdGlvbiIsImNsZWFySW50ZXJ2YWwiLCJwYXJzZUZsb2F0Iiwic2V0SW50ZXJ2YWwiLCJzdG9wIiwiJG9uIiwiZGlyZWN0aXZlIiwiY29udHJvbGxlciIsInRoaXMiLCJzdGFydFByb2dyZXNzQmFyIiwic3RvcFByb2dyZXNzQmFyIiwiJGludGVydmFsIiwidGltZW91dCIsIndhbnRzQ2xvc2VCdXR0b24iLCJidXR0b24iLCJjaGlsZHJlbiIsInByZXBlbmQiLCJjcmVhdGVUaW1lb3V0IiwidGltZSIsIm9uIiwiY2FuY2VsIiwidGFwVG9hc3QiLCJpc0Z1bmN0aW9uIiwiY2xvc2UiLCIkZXZlbnQiLCJzdG9wUHJvcGFnYXRpb24iLCIkYXBwbHkiLCJydW4iLCIkdGVtcGxhdGVDYWNoZSIsInB1dCJdLCJtYXBwaW5ncyI6IkNBQUMsV0FDQyxhQU9BLFNBQVNBLE9BQU9DLFNBQVVDLFVBQVdDLFVBQVdDLFdBQVlDLEtBQU1DLGFBQWNDLElBQzlFLElBQUlDLFVBQ0FDLE1BQVEsRUFDUkMsT0FBUyxHQUVUQyxxQkFBdUIsR0FDdkJDLFdBQWEsR0FFYkMsZUFBaUJOLEdBQUdPLFFBYXhCLE1BWFksQ0FDVkMsT0FhRixXQUNFLE9BQU9MLE9BQU9NLFFBYmRDLE1BZ0JGLFNBQWVDLE9BRWIsR0FBeUIsSUFBckJDLFVBQVVILFNBQWlCRSxNQUFTLE9BRXhDLEdBQUlBLE1BQ0ZFLE9BQU9GLE1BQU1HLGNBRWIsSUFBSyxJQUFJQyxFQUFJLEVBQUdBLEVBQUlaLE9BQU9NLE9BQVFNLElBQ2pDRixPQUFPVixPQUFPWSxHQUFHRCxVQXZCckJFLE1BNEJGLFNBQWVDLFFBQVNDLE1BQU9DLGlCQUU3QixPQUFPQyxtQkFESUMsY0FBY0MsWUFBWU4sTUFDTEMsUUFBU0MsTUFBT0Msa0JBN0JoREksS0FnQ0YsU0FBY04sUUFBU0MsTUFBT0MsaUJBRTVCLE9BQU9DLG1CQURJQyxjQUFjQyxZQUFZQyxLQUNMTixRQUFTQyxNQUFPQyxrQkFqQ2hETixPQUFRQSxPQUNSVyxRQW1DRixTQUFpQlAsUUFBU0MsTUFBT0MsaUJBRS9CLE9BQU9DLG1CQURJQyxjQUFjQyxZQUFZRSxRQUNMUCxRQUFTQyxNQUFPQyxrQkFwQ2hETSxRQXVDRixTQUFpQlIsUUFBU0MsTUFBT0MsaUJBRS9CLE9BQU9DLG1CQURJQyxjQUFjQyxZQUFZRyxRQUNMUixRQUFTQyxNQUFPQyxrQkF4Q2hETyxhQTJDRixTQUFzQmYsTUFBT2dCLFNBQ3ZCaEIs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QixrQkE5Q05FLFNBQ0ZELFVBQVVTLE9BQU9SLFlBSXJCNUcsTUFBTXFILFNBQVcsV0FDWHRHLFFBQVF1RyxXQUFXdEgsTUFBTU8sUUFBUStCLFFBQ25DdEMsTUFBTU8sUUFBUStCLFFBRVp0QyxNQUFNTyxRQUFRaUMsY0FDaEJ4QyxNQUFNdUgsT0FBTSxJQUloQnZILE1BQU11SCxNQUFRLFNBQVV0SCxXQUFZdUgsUUFDOUJBLFFBQVV6RyxRQUFRdUcsV0FBV0UsT0FBT0Msa0JBQ3RDRCxPQUFPQyxrQkFFVDlKLE9BQU9vQixPQUFPaUIsTUFBTWhCLFFBQVNpQixhQUcvQkQsTUFBTUosYUFBZSxTQUFTQyxTQUN4QitHLFVBQ0ZELFVBQVVTLE9BQU9SLFNBQ2pCQSxRQUFVSyxjQUFjcEgsU0FBV0csTUFBTU8sUUFBUWtDLFdBSXJEUSxRQUFRa0UsR0FBRyxjQUFjLFdBQ08sSUFBMUJuSCxNQUFNTyxRQUFRa0MsU0FBbUQsSUFBbEN6QyxNQUFNTyxRQUFRMkIsa0JBQ2pEbEMsTUFBTTBILFFBQU8sV0FDWDFILE1BQU11QyxZQUFjdkMsTUFBTU8sUUFBUWdDLGVBRXBDcUUsUUFBVUssY0FBY2pILE1BQU1PLFFBQVEyQix1QkEzRTVDbkIsUUFBUThELE9BQU8sVUFDWnlCLFVBQVUsUUFBU3pILE9BRXRCQSxNQUFNa0csUUFBVSxDQUFDLFlBQWEsWUFBYSxlQUFnQixVQU43RCxHQXFHQWhFLFFBQVE4RCxPQUFPLFVBQVU4QyxJQUFJLENBQUMsaUJBQWtCLFNBQVNDLGdCQUFpQkEsZUFBZUMsSUFBSSwwQ0FBMEMsd0NBQ3ZJRCxlQUFlQyxJQUFJLDhCQUE4QiIsImZpbGUiOiJwbHVnaW5zL2FuZ3VsYXItdG9hc3RyL2Rpc3QvYW5ndWxhci10b2FzdHIudHBscy5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCd0b2FzdHInLCBbXSlcbiAgICAuZmFjdG9yeSgndG9hc3RyJywgdG9hc3RyKTtcblxuICB0b2FzdHIuJGluamVjdCA9IFsnJGFuaW1hdGUnLCAnJGluamVjdG9yJywgJyRkb2N1bWVudCcsICckcm9vdFNjb3BlJywgJyRzY2UnLCAndG9hc3RyQ29uZmlnJywgJyRxJ107XG5cbiAgZnVuY3Rpb24gdG9hc3RyKCRhbmltYXRlLCAkaW5qZWN0b3IsICRkb2N1bWVudCwgJHJvb3RTY29wZSwgJHNjZSwgdG9hc3RyQ29uZmlnLCAkcSkge1xuICAgIHZhciBjb250YWluZXI7XG4gICAgdmFyIGluZGV4ID0gMDtcbiAgICB2YXIgdG9hc3RzID0gW107XG5cbiAgICB2YXIgcHJldmlvdXNUb2FzdE1lc3NhZ2UgPSAnJztcbiAgICB2YXIgb3BlblRvYXN0cyA9IHt9O1xuXG4gICAgdmFyIGNvbnRhaW5lckRlZmVyID0gJHEuZGVmZXIoKTtcblxuICAgIHZhciB0b2FzdCA9IHtcbiAgICAgIGFjdGl2ZTogYWN0aXZlLFxuICAgICAgY2xlYXI6IGNsZWFyLFxuICAgICAgZXJyb3I6IGVycm9yLFxuICAgICAgaW5mbzogaW5mbyxcbiAgICAgIHJlbW92ZTogcmVtb3ZlLFxuICAgICAgc3VjY2Vzczogc3VjY2VzcyxcbiAgICAgIHdhcm5pbmc6IHdhcm5pbmcsXG4gICAgICByZWZyZXNoVGltZXI6IHJlZnJlc2hUaW1lclxuICAgIH07XG5cbiAgICByZXR1cm4gdG9hc3Q7XG5cbiAgICAvKiBQdWJsaWMgQVBJICovXG4gICAgZnVuY3Rpb24gYWN0aXZlKCkge1xuICAgICAgcmV0dXJuIHRvYXN0cy5sZW5ndGg7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xlYXIodG9hc3QpIHtcbiAgICAgIC8vIEJpdCBvZiBhIGhhY2ssIEkgd2lsbCByZW1vdmUgdGhpcyBzb29uIHdpdGggYSBCQ1xuICAgICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPT09IDEgJiYgIXRvYXN0KSB7IHJldHVybjsgfVxuXG4gICAgICBpZiAodG9hc3QpIHtcbiAgICAgICAgcmVtb3ZlKHRvYXN0LnRvYXN0SWQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2FzdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICByZW1vdmUodG9hc3RzW2ldLnRvYXN0SWQpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gZXJyb3IobWVzc2FnZSwgdGl0bGUsIG9wdGlvbnNPdmVycmlkZSkge1xuICAgICAgdmFyIHR5cGUgPSBfZ2V0T3B0aW9ucygpLmljb25DbGFzc2VzLmVycm9yO1xuICAgICAgcmV0dXJuIF9idWlsZE5vdGlmaWNhdGlvbih0eXBlLCBtZXNzYWdlLCB0aXRsZSwgb3B0aW9uc092ZXJyaWRlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBpbmZvKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zT3ZlcnJpZGUpIHtcbiAgICAgIHZhciB0eXBlID0gX2dldE9wdGlvbnMoKS5pY29uQ2xhc3Nlcy5pbmZvO1xuICAgICAgcmV0dXJuIF9idWlsZE5vdGlmaWNhdGlvbih0eXBlLCBtZXNzYWdlLCB0aXRsZSwgb3B0aW9uc092ZXJyaWRlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzdWNjZXNzKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zT3ZlcnJpZGUpIHtcbiAgICAgIHZhciB0eXBlID0gX2dldE9wdGlvbnMoKS5pY29uQ2xhc3Nlcy5zdWNjZXNzO1xuICAgICAgcmV0dXJuIF9idWlsZE5vdGlmaWNhdGlvbih0eXBlLCBtZXNzYWdlLCB0aXRsZSwgb3B0aW9uc092ZXJyaWRlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiB3YXJuaW5nKG1lc3NhZ2UsIHRpdGxlLCBvcHRpb25zT3ZlcnJpZGUpIHtcbiAgICAgIHZhciB0eXBlID0gX2dldE9wdGlvbnMoKS5pY29uQ2xhc3Nlcy53YXJuaW5nO1xuICAgICAgcmV0dXJuIF9idWlsZE5vdGlmaWNhdGlvbih0eXBlLCBtZXNzYWdlLCB0aXRsZSwgb3B0aW9uc092ZXJyaWRlKTtcbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZWZyZXNoVGltZXIodG9hc3QsIG5ld1RpbWUpIHtcbiAgICAgIGlmICh0b2FzdCAmJiB0b2FzdC5pc09wZW5lZCAmJiB0b2FzdHMuaW5kZXhPZih0b2FzdCkgPj0gMCkge1xuICAgICAgICAgIHRvYXN0LnNjb3BlLnJlZnJlc2hUaW1lcihuZXdUaW1lKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiByZW1vdmUodG9hc3RJZCwgd2FzQ2xpY2tlZCkge1xuICAgICAgdmFyIHRvYXN0ID0gZmluZFRvYXN0KHRvYXN0SWQpO1xuXG4gICAgICBpZiAodG9hc3QgJiYgISB0b2FzdC5kZWxldGluZykgeyAvLyBBdm9pZCBjbGlja2luZyB3aGVuIGZhZGluZyBvdXRcbiAgICAgICAgdG9hc3QuZGVsZXRpbmcgPSB0cnVlO1xuICAgICAgICB0b2FzdC5pc09wZW5lZCA9IGZhbHNlO1xuICAgICAgICAkYW5pbWF0ZS5sZWF2ZSh0b2FzdC5lbCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICBpZiAodG9hc3Quc2NvcGUub3B0aW9ucy5vbkhpZGRlbikge1xuICAgICAgICAgICAgdG9hc3Quc2NvcGUub3B0aW9ucy5vbkhpZGRlbighIXdhc0NsaWNrZWQsIHRvYXN0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdG9hc3Quc2NvcGUuJGRlc3Ryb3koKTtcbiAgICAgICAgICB2YXIgaW5kZXggPSB0b2FzdHMuaW5kZXhPZih0b2FzdCk7XG4gICAgICAgICAgZGVsZXRlIG9wZW5Ub2FzdHNbdG9hc3Quc2NvcGUubWVzc2FnZV07XG4gICAgICAgICAgdG9hc3RzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgdmFyIG1heE9wZW5lZCA9IHRvYXN0ckNvbmZpZy5tYXhPcGVuZWQ7XG4gICAgICAgICAgaWYgKG1heE9wZW5lZCAmJiB0b2FzdHMubGVuZ3RoID49IG1heE9wZW5lZCkge1xuICAgICAgICAgICAgdG9hc3RzW21heE9wZW5lZCAtIDFdLm9wZW4ucmVzb2x2ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAobGFzdFRvYXN0KCkpIHtcbiAgICAgICAgICAgIGNvbnRhaW5lci5yZW1vdmUoKTtcbiAgICAgICAgICAgIGNvbnRhaW5lciA9IG51bGw7XG4gICAgICAgICAgICBjb250YWluZXJEZWZlciA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gZmluZFRvYXN0KHRvYXN0SWQpIHtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0b2FzdHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICBpZiAodG9hc3RzW2ldLnRvYXN0SWQgPT09IHRvYXN0SWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0b2FzdHNbaV07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGxhc3RUb2FzdCgpIHtcbiAgICAgICAgcmV0dXJuICF0b2FzdHMubGVuZ3RoO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8qIEludGVybmFsIGZ1bmN0aW9ucyAqL1xuICAgIGZ1bmN0aW9uIF9idWlsZE5vdGlmaWNhdGlvbih0eXBlLCBtZXNzYWdlLCB0aXRsZSwgb3B0aW9uc092ZXJyaWRlKSB7XG4gICAgICBpZiAoYW5ndWxhci5pc09iamVjdCh0aXRsZSkpIHtcbiAgICAgICAgb3B0aW9uc092ZXJyaWRlID0gdGl0bGU7XG4gICAgICAgIHRpdGxlID0gbnVsbDtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIF9ub3RpZnkoe1xuICAgICAgICBpY29uQ2xhc3M6IHR5cGUsXG4gICAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsXG4gICAgICAgIG9wdGlvbnNPdmVycmlkZTogb3B0aW9uc092ZXJyaWRlLFxuICAgICAgICB0aXRsZTogdGl0bGVcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9nZXRPcHRpb25zKCkge1xuICAgICAgcmV0dXJuIGFuZ3VsYXIuZXh0ZW5kKHt9LCB0b2FzdHJDb25maWcpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIF9jcmVhdGVPckdldENvbnRhaW5lcihvcHRpb25zKSB7XG4gICAgICBpZihjb250YWluZXIpIHsgcmV0dXJuIGNvbnRhaW5lckRlZmVyLnByb21pc2U7IH1cblxuICAgICAgY29udGFpbmVyID0gYW5ndWxhci5lbGVtZW50KCc8ZGl2PjwvZGl2PicpO1xuICAgICAgY29udGFpbmVyLmF0dHIoJ2lkJywgb3B0aW9ucy5jb250YWluZXJJZCk7XG4gICAgICBjb250YWluZXIuYWRkQ2xhc3Mob3B0aW9ucy5wb3NpdGlvbkNsYXNzKTtcbiAgICAgIGNvbnRhaW5lci5jc3Moeydwb2ludGVyLWV2ZW50cyc6ICdhdXRvJ30pO1xuXG4gICAgICB2YXIgdGFyZ2V0ID0gYW5ndWxhci5lbGVtZW50KGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3Iob3B0aW9ucy50YXJnZXQpKTtcblxuICAgICAgaWYgKCAhIHRhcmdldCB8fCAhIHRhcmdldC5sZW5ndGgpIHtcbiAgICAgICAgdGhyb3cgJ1RhcmdldCBmb3IgdG9hc3RzIGRvZXNuXFwndCBleGlzdCc7XG4gICAgICB9XG5cbiAgICAgICRhbmltYXRlLmVudGVyKGNvbnRhaW5lciwgdGFyZ2V0KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBjb250YWluZXJEZWZlci5yZXNvbHZlKCk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGNvbnRhaW5lckRlZmVyLnByb21pc2U7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gX25vdGlmeShtYXApIHtcbiAgICAgIHZhciBvcHRpb25zID0gX2dldE9wdGlvbnMoKTtcblxuICAgICAgaWYgKHNob3VsZEV4aXQoKSkgeyByZXR1cm47IH1cblxuICAgICAgdmFyIG5ld1RvYXN0ID0gY3JlYXRlVG9hc3QoKTtcblxuICAgICAgdG9hc3RzLnB1c2gobmV3VG9hc3QpO1xuXG4gICAgICBpZiAoaWZNYXhPcGVuZWRBbmRBdXRvRGlzbWlzcygpKSB7XG4gICAgICAgIHZhciBvbGRUb2FzdHMgPSB0b2FzdHMuc2xpY2UoMCwgKHRvYXN0cy5sZW5ndGggLSBvcHRpb25zLm1heE9wZW5lZCkpO1xuICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gb2xkVG9hc3RzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgICAgcmVtb3ZlKG9sZFRvYXN0c1tpXS50b2FzdElkKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBpZiAobWF4T3BlbmVkTm90UmVhY2hlZCgpKSB7XG4gICAgICAgIG5ld1RvYXN0Lm9wZW4ucmVzb2x2ZSgpO1xuICAgICAgfVxuXG4gICAgICBuZXdUb2FzdC5vcGVuLnByb21pc2UudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgX2NyZWF0ZU9yR2V0Q29udGFpbmVyKG9wdGlvbnMpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgbmV3VG9hc3QuaXNPcGVuZWQgPSB0cnVlO1xuICAgICAgICAgIGlmIChvcHRpb25zLm5ld2VzdE9uVG9wKSB7XG4gICAgICAgICAgICAkYW5pbWF0ZS5lbnRlcihuZXdUb2FzdC5lbCwgY29udGFpbmVyKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICBuZXdUb2FzdC5zY29wZS5pbml0KCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHNpYmxpbmcgPSBjb250YWluZXJbMF0ubGFzdENoaWxkID8gYW5ndWxhci5lbGVtZW50KGNvbnRhaW5lclswXS5sYXN0Q2hpbGQpIDogbnVsbDtcbiAgICAgICAgICAgICRhbmltYXRlLmVudGVyKG5ld1RvYXN0LmVsLCBjb250YWluZXIsIHNpYmxpbmcpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIG5ld1RvYXN0LnNjb3BlLmluaXQoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIG5ld1RvYXN0O1xuXG4gICAgICBmdW5jdGlvbiBpZk1heE9wZW5lZEFuZEF1dG9EaXNtaXNzKCkge1xuICAgICAgICByZXR1cm4gb3B0aW9ucy5hdXRvRGlzbWlzcyAmJiBvcHRpb25zLm1heE9wZW5lZCAmJiB0b2FzdHMubGVuZ3RoID4gb3B0aW9ucy5tYXhPcGVuZWQ7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVNjb3BlKHRvYXN0LCBtYXAsIG9wdGlvbnMpIHtcbiAgICAgICAgaWYgKG9wdGlvbnMuYWxsb3dIdG1sKSB7XG4gICAgICAgICAgdG9hc3Quc2NvcGUuYWxsb3dIdG1sID0gdHJ1ZTtcbiAgICAgICAgICB0b2FzdC5zY29wZS50aXRsZSA9ICRzY2UudHJ1c3RBc0h0bWwobWFwLnRpdGxlKTtcbiAgICAgICAgICB0b2FzdC5zY29wZS5tZXNzYWdlID0gJHNjZS50cnVzdEFzSHRtbChtYXAubWVzc2FnZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdG9hc3Quc2NvcGUudGl0bGUgPSBtYXAudGl0bGU7XG4gICAgICAgICAgdG9hc3Quc2NvcGUubWVzc2FnZSA9IG1hcC5tZXNzYWdlO1xuICAgICAgICB9XG5cbiAgICAgICAgdG9hc3Quc2NvcGUudG9hc3RUeXBlID0gdG9hc3QuaWNvbkNsYXNzO1xuICAgICAgICB0b2FzdC5zY29wZS50b2FzdElkID0gdG9hc3QudG9hc3RJZDtcbiAgICAgICAgdG9hc3Quc2NvcGUuZXh0cmFEYXRhID0gb3B0aW9ucy5leHRyYURhdGE7XG5cbiAgICAgICAgdG9hc3Quc2NvcGUub3B0aW9ucyA9IHtcbiAgICAgICAgICBleHRlbmRlZFRpbWVPdXQ6IG9wdGlvbnMuZXh0ZW5kZWRUaW1lT3V0LFxuICAgICAgICAgIG1lc3NhZ2VDbGFzczogb3B0aW9ucy5tZXNzYWdlQ2xhc3MsXG4gICAgICAgICAgb25IaWRkZW46IG9wdGlvbnMub25IaWRkZW4sXG4gICAgICAgICAgb25TaG93bjogZ2VuZXJhdGVFdmVudCgnb25TaG93bicpLFxuICAgICAgICAgIG9uVGFwOiBnZW5lcmF0ZUV2ZW50KCdvblRhcCcpLFxuICAgICAgICAgIHByb2dyZXNzQmFyOiBvcHRpb25zLnByb2dyZXNzQmFyLFxuICAgICAgICAgIHRhcFRvRGlzbWlzczogb3B0aW9ucy50YXBUb0Rpc21pc3MsXG4gICAgICAgICAgdGltZU91dDogb3B0aW9ucy50aW1lT3V0LFxuICAgICAgICAgIHRpdGxlQ2xhc3M6IG9wdGlvbnMudGl0bGVDbGFzcyxcbiAgICAgICAgICB0b2FzdENsYXNzOiBvcHRpb25zLnRvYXN0Q2xhc3NcbiAgICAgICAgfTtcblxuICAgICAgICBpZiAob3B0aW9ucy5jbG9zZUJ1dHRvbikge1xuICAgICAgICAgIHRvYXN0LnNjb3BlLm9wdGlvbnMuY2xvc2VIdG1sID0gb3B0aW9ucy5jbG9zZUh0bWw7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZW5lcmF0ZUV2ZW50KGV2ZW50KSB7XG4gICAgICAgICAgaWYgKG9wdGlvbnNbZXZlbnRdKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgIG9wdGlvbnNbZXZlbnRdKHRvYXN0KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIGNyZWF0ZVRvYXN0KCkge1xuICAgICAgICB2YXIgbmV3VG9hc3QgPSB7XG4gICAgICAgICAgdG9hc3RJZDogaW5kZXgrKyxcbiAgICAgICAgICBpc09wZW5lZDogZmFsc2UsXG4gICAgICAgICAgc2NvcGU6ICRyb290U2NvcGUuJG5ldygpLFxuICAgICAgICAgIG9wZW46ICRxLmRlZmVyKClcbiAgICAgICAgfTtcbiAgICAgICAgbmV3VG9hc3QuaWNvbkNsYXNzID0gbWFwLmljb25DbGFzcztcbiAgICAgICAgaWYgKG1hcC5vcHRpb25zT3ZlcnJpZGUpIHtcbiAgICAgICAgICBhbmd1bGFyLmV4dGVuZChvcHRpb25zLCBjbGVhbk9wdGlvbnNPdmVycmlkZShtYXAub3B0aW9uc092ZXJyaWRlKSk7XG4gICAgICAgICAgbmV3VG9hc3QuaWNvbkNsYXNzID0gbWFwLm9wdGlvbnNPdmVycmlkZS5pY29uQ2xhc3MgfHwgbmV3VG9hc3QuaWNvbkNsYXNzO1xuICAgICAgICB9XG5cbiAgICAgICAgY3JlYXRlU2NvcGUobmV3VG9hc3QsIG1hcCwgb3B0aW9ucyk7XG5cbiAgICAgICAgbmV3VG9hc3QuZWwgPSBjcmVhdGVUb2FzdEVsKG5ld1RvYXN0LnNjb3BlKTtcblxuICAgICAgICByZXR1cm4gbmV3VG9hc3Q7XG5cbiAgICAgICAgZnVuY3Rpb24gY2xlYW5PcHRpb25zT3ZlcnJpZGUob3B0aW9ucykge1xuICAgICAgICAgIHZhciBiYWRPcHRpb25zID0gWydjb250YWluZXJJZCcsICdpY29uQ2xhc3NlcycsICdtYXhPcGVuZWQnLCAnbmV3ZXN0T25Ub3AnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdwb3NpdGlvbkNsYXNzJywgJ3ByZXZlbnREdXBsaWNhdGVzJywgJ3ByZXZlbnRPcGVuRHVwbGljYXRlcycsICd0ZW1wbGF0ZXMnXTtcbiAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGJhZE9wdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgICAgICBkZWxldGUgb3B0aW9uc1tiYWRPcHRpb25zW2ldXTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBjcmVhdGVUb2FzdEVsKHNjb3BlKSB7XG4gICAgICAgIHZhciBhbmd1bGFyRG9tRWwgPSBhbmd1bGFyLmVsZW1lbnQoJzxkaXYgdG9hc3Q+PC9kaXY+JyksXG4gICAgICAgICAgJGNvbXBpbGUgPSAkaW5qZWN0b3IuZ2V0KCckY29tcGlsZScpO1xuICAgICAgICByZXR1cm4gJGNvbXBpbGUoYW5ndWxhckRvbUVsKShzY29wZSk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIG1heE9wZW5lZE5vdFJlYWNoZWQoKSB7XG4gICAgICAgIHJldHVybiBvcHRpb25zLm1heE9wZW5lZCAmJiB0b2FzdHMubGVuZ3RoIDw9IG9wdGlvbnMubWF4T3BlbmVkIHx8ICFvcHRpb25zLm1heE9wZW5lZDtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gc2hvdWxkRXhpdCgpIHtcbiAgICAgICAgdmFyIGlzRHVwbGljYXRlT2ZMYXN0ID0gb3B0aW9ucy5wcmV2ZW50RHVwbGljYXRlcyAmJiBtYXAubWVzc2FnZSA9PT0gcHJldmlvdXNUb2FzdE1lc3NhZ2U7XG4gICAgICAgIHZhciBpc0R1cGxpY2F0ZU9wZW4gPSBvcHRpb25zLnByZXZlbnRPcGVuRHVwbGljYXRlcyAmJiBvcGVuVG9hc3RzW21hcC5tZXNzYWdlXTtcblxuICAgICAgICBpZiAoaXNEdXBsaWNhdGVPZkxhc3QgfHwgaXNEdXBsaWNhdGVPcGVuKSB7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBwcmV2aW91c1RvYXN0TWVzc2FnZSA9IG1hcC5tZXNzYWdlO1xuICAgICAgICBvcGVuVG9hc3RzW21hcC5tZXNzYWdlXSA9IHRydWU7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgfVxufSgpKTtcblxuKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ3RvYXN0cicpXG4gICAgLmNvbnN0YW50KCd0b2FzdHJDb25maWcnLCB7XG4gICAgICBhbGxvd0h0bWw6IGZhbHNlLFxuICAgICAgYXV0b0Rpc21pc3M6IGZhbHNlLFxuICAgICAgY2xvc2VCdXR0b246IGZhbHNlLFxuICAgICAgY2xvc2VIdG1sOiAnPGJ1dHRvbj4mdGltZXM7PC9idXR0b24+JyxcbiAgICAgIGNvbnRhaW5lcklkOiAndG9hc3QtY29udGFpbmVyJyxcbiAgICAgIGV4dGVuZGVkVGltZU91dDogMTAwMCxcbiAgICAgIGljb25DbGFzc2VzOiB7XG4gICAgICAgIGVycm9yOiAndG9hc3QtZXJyb3InLFxuICAgICAgICBpbmZvOiAndG9hc3QtaW5mbycsXG4gICAgICAgIHN1Y2Nlc3M6ICd0b2FzdC1zdWNjZXNzJyxcbiAgICAgICAgd2FybmluZzogJ3RvYXN0LXdhcm5pbmcnXG4gICAgICB9LFxuICAgICAgbWF4T3BlbmVkOiAwLFxuICAgICAgbWVzc2FnZUNsYXNzOiAndG9hc3QtbWVzc2FnZScsXG4gICAgICBuZXdlc3RPblRvcDogdHJ1ZSxcbiAgICAgIG9uSGlkZGVuOiBudWxsLFxuICAgICAgb25TaG93bjogbnVsbCxcbiAgICAgIG9uVGFwOiBudWxsLFxuICAgICAgcG9zaXRpb25DbGFzczogJ3RvYXN0LXRvcC1yaWdodCcsXG4gICAgICBwcmV2ZW50RHVwbGljYXRlczogZmFsc2UsXG4gICAgICBwcmV2ZW50T3BlbkR1cGxpY2F0ZXM6IGZhbHNlLFxuICAgICAgcHJvZ3Jlc3NCYXI6IGZhbHNlLFxuICAgICAgdGFwVG9EaXNtaXNzOiB0cnVlLFxuICAgICAgdGFyZ2V0OiAnYm9keScsXG4gICAgICB0ZW1wbGF0ZXM6IHtcbiAgICAgICAgdG9hc3Q6ICdkaXJlY3RpdmVzL3RvYXN0L3RvYXN0Lmh0bWwnLFxuICAgICAgICBwcm9ncmVzc2JhcjogJ2RpcmVjdGl2ZXMvcHJvZ3Jlc3NiYXIvcHJvZ3Jlc3NiYXIuaHRtbCdcbiAgICAgIH0sXG4gICAgICB0aW1lT3V0OiA1MDAwLFxuICAgICAgdGl0bGVDbGFzczogJ3RvYXN0LXRpdGxlJyxcbiAgICAgIHRvYXN0Q2xhc3M6ICd0b2FzdCdcbiAgICB9KTtcbn0oKSk7XG5cbihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuXG4gIGFuZ3VsYXIubW9kdWxlKCd0b2FzdHInKVxuICAgIC5kaXJlY3RpdmUoJ3Byb2dyZXNzQmFyJywgcHJvZ3Jlc3NCYXIpO1xuXG4gIHByb2dyZXNzQmFyLiRpbmplY3QgPSBbJ3RvYXN0ckNvbmZpZyddO1xuXG4gIGZ1bmN0aW9uIHByb2dyZXNzQmFyKHRvYXN0ckNvbmZpZykge1xuICAgIHJldHVybiB7XG4gICAgICByZXF1aXJlOiAnXnRvYXN0JyxcbiAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRvYXN0ckNvbmZpZy50ZW1wbGF0ZXMucHJvZ3Jlc3NiYXI7XG4gICAgICB9LFxuICAgICAgbGluazogbGlua0Z1bmN0aW9uXG4gICAgfTtcblxuICAgIGZ1bmN0aW9uIGxpbmtGdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIHRvYXN0Q3RybCkge1xuICAgICAgdmFyIGludGVydmFsSWQsIGN1cnJlbnRUaW1lT3V0LCBoaWRlVGltZTtcblxuICAgICAgdG9hc3RDdHJsLnByb2dyZXNzQmFyID0gc2NvcGU7XG5cbiAgICAgIHNjb3BlLnN0YXJ0ID0gZnVuY3Rpb24oZHVyYXRpb24pIHtcbiAgICAgICAgaWYgKGludGVydmFsSWQpIHtcbiAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xuICAgICAgICB9XG5cbiAgICAgICAgY3VycmVudFRpbWVPdXQgPSBwYXJzZUZsb2F0KGR1cmF0aW9uKTtcbiAgICAgICAgaGlkZVRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSArIGN1cnJlbnRUaW1lT3V0O1xuICAgICAgICBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwodXBkYXRlUHJvZ3Jlc3MsIDEwKTtcbiAgICAgIH07XG5cbiAgICAgIHNjb3BlLnN0b3AgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKGludGVydmFsSWQpIHtcbiAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsSWQpO1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICBmdW5jdGlvbiB1cGRhdGVQcm9ncmVzcygpIHtcbiAgICAgICAgdmFyIHBlcmNlbnRhZ2UgPSAoKGhpZGVUaW1lIC0gKG5ldyBEYXRlKCkuZ2V0VGltZSgpKSkgLyBjdXJyZW50VGltZU91dCkgKiAxMDA7XG4gICAgICAgIGVsZW1lbnQuY3NzKCd3aWR0aCcsIHBlcmNlbnRhZ2UgKyAnJScpO1xuICAgICAgfVxuXG4gICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgZnVuY3Rpb24oKSB7XG4gICAgICAgIC8vIEZhaWxzYWZlIHN0b3BcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufSgpKTtcblxuKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ3RvYXN0cicpXG4gICAgLmNvbnRyb2xsZXIoJ1RvYXN0Q29udHJvbGxlcicsIFRvYXN0Q29udHJvbGxlcik7XG5cbiAgZnVuY3Rpb24gVG9hc3RDb250cm9sbGVyKCkge1xuICAgIHRoaXMucHJvZ3Jlc3NCYXIgPSBudWxsO1xuXG4gICAgdGhpcy5zdGFydFByb2dyZXNzQmFyID0gZnVuY3Rpb24oZHVyYXRpb24pIHtcbiAgICAgIGlmICh0aGlzLnByb2dyZXNzQmFyKSB7XG4gICAgICAgIHRoaXMucHJvZ3Jlc3NCYXIuc3RhcnQoZHVyYXRpb24pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICB0aGlzLnN0b3BQcm9ncmVzc0JhciA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMucHJvZ3Jlc3NCYXIpIHtcbiAgICAgICAgdGhpcy5wcm9ncmVzc0Jhci5zdG9wKCk7XG4gICAgICB9XG4gICAgfTtcbiAgfVxufSgpKTtcblxuKGZ1bmN0aW9uKCkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgYW5ndWxhci5tb2R1bGUoJ3RvYXN0cicpXG4gICAgLmRpcmVjdGl2ZSgndG9hc3QnLCB0b2FzdCk7XG5cbiAgdG9hc3QuJGluamVjdCA9IFsnJGluamVjdG9yJywgJyRpbnRlcnZhbCcsICd0b2FzdHJDb25maWcnLCAndG9hc3RyJ107XG5cbiAgZnVuY3Rpb24gdG9hc3QoJGluamVjdG9yLCAkaW50ZXJ2YWwsIHRvYXN0ckNvbmZpZywgdG9hc3RyKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHRlbXBsYXRlVXJsOiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHRvYXN0ckNvbmZpZy50ZW1wbGF0ZXMudG9hc3Q7XG4gICAgICB9LFxuICAgICAgY29udHJvbGxlcjogJ1RvYXN0Q29udHJvbGxlcicsXG4gICAgICBsaW5rOiB0b2FzdExpbmtGdW5jdGlvblxuICAgIH07XG5cbiAgICBmdW5jdGlvbiB0b2FzdExpbmtGdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMsIHRvYXN0Q3RybCkge1xuICAgICAgdmFyIHRpbWVvdXQ7XG5cbiAgICAgIHNjb3BlLnRvYXN0Q2xhc3MgPSBzY29wZS5vcHRpb25zLnRvYXN0Q2xhc3M7XG4gICAgICBzY29wZS50aXRsZUNsYXNzID0gc2NvcGUub3B0aW9ucy50aXRsZUNsYXNzO1xuICAgICAgc2NvcGUubWVzc2FnZUNsYXNzID0gc2NvcGUub3B0aW9ucy5tZXNzYWdlQ2xhc3M7XG4gICAgICBzY29wZS5wcm9ncmVzc0JhciA9IHNjb3BlLm9wdGlvbnMucHJvZ3Jlc3NCYXI7XG5cbiAgICAgIGlmICh3YW50c0Nsb3NlQnV0dG9uKCkpIHtcbiAgICAgICAgdmFyIGJ1dHRvbiA9IGFuZ3VsYXIuZWxlbWVudChzY29wZS5vcHRpb25zLmNsb3NlSHRtbCksXG4gICAgICAgICAgJGNvbXBpbGUgPSAkaW5qZWN0b3IuZ2V0KCckY29tcGlsZScpO1xuICAgICAgICBidXR0b24uYWRkQ2xhc3MoJ3RvYXN0LWNsb3NlLWJ1dHRvbicpO1xuICAgICAgICBidXR0b24uYXR0cignbmctY2xpY2snLCAnY2xvc2UodHJ1ZSwgJGV2ZW50KScpO1xuICAgICAgICAkY29tcGlsZShidXR0b24pKHNjb3BlKTtcbiAgICAgICAgZWxlbWVudC5jaGlsZHJlbigpLnByZXBlbmQoYnV0dG9uKTtcbiAgICAgIH1cblxuICAgICAgc2NvcGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoc2NvcGUub3B0aW9ucy50aW1lT3V0KSB7XG4gICAgICAgICAgdGltZW91dCA9IGNyZWF0ZVRpbWVvdXQoc2NvcGUub3B0aW9ucy50aW1lT3V0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2NvcGUub3B0aW9ucy5vblNob3duKSB7XG4gICAgICAgICAgc2NvcGUub3B0aW9ucy5vblNob3duKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGVsZW1lbnQub24oJ21vdXNlZW50ZXInLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaGlkZUFuZFN0b3BQcm9ncmVzc0JhcigpO1xuICAgICAgICBpZiAodGltZW91dCkge1xuICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwodGltZW91dCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBzY29wZS50YXBUb2FzdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbihzY29wZS5vcHRpb25zLm9uVGFwKSkge1xuICAgICAgICAgIHNjb3BlLm9wdGlvbnMub25UYXAoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2NvcGUub3B0aW9ucy50YXBUb0Rpc21pc3MpIHtcbiAgICAgICAgICBzY29wZS5jbG9zZSh0cnVlKTtcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgc2NvcGUuY2xvc2UgPSBmdW5jdGlvbiAod2FzQ2xpY2tlZCwgJGV2ZW50KSB7XG4gICAgICAgIGlmICgkZXZlbnQgJiYgYW5ndWxhci5pc0Z1bmN0aW9uKCRldmVudC5zdG9wUHJvcGFnYXRpb24pKSB7XG4gICAgICAgICAgJGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICB9XG4gICAgICAgIHRvYXN0ci5yZW1vdmUoc2NvcGUudG9hc3RJZCwgd2FzQ2xpY2tlZCk7XG4gICAgICB9O1xuICAgICAgXG4gICAgICBzY29wZS5yZWZyZXNoVGltZXIgPSBmdW5jdGlvbihuZXdUaW1lKSB7XG4gICAgICAgIGlmICh0aW1lb3V0KSB7XG4gICAgICAgICAgJGludGVydmFsLmNhbmNlbCh0aW1lb3V0KTtcbiAgICAgICAgICB0aW1lb3V0ID0gY3JlYXRlVGltZW91dChuZXdUaW1lIHx8IHNjb3BlLm9wdGlvbnMudGltZU91dCk7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIGVsZW1lbnQub24oJ21vdXNlbGVhdmUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHNjb3BlLm9wdGlvbnMudGltZU91dCA9PT0gMCAmJiBzY29wZS5vcHRpb25zLmV4dGVuZGVkVGltZU91dCA9PT0gMCkgeyByZXR1cm47IH1cbiAgICAgICAgc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHNjb3BlLnByb2dyZXNzQmFyID0gc2NvcGUub3B0aW9ucy5wcm9ncmVzc0JhcjtcbiAgICAgICAgfSk7XG4gICAgICAgIHRpbWVvdXQgPSBjcmVhdGVUaW1lb3V0KHNjb3BlLm9wdGlvbnMuZXh0ZW5kZWRUaW1lT3V0KTtcbiAgICAgIH0pO1xuXG4gICAgICBmdW5jdGlvbiBjcmVhdGVUaW1lb3V0KHRpbWUpIHtcbiAgICAgICAgdG9hc3RDdHJsLnN0YXJ0UHJvZ3Jlc3NCYXIodGltZSk7XG4gICAgICAgIHJldHVybiAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdG9hc3RDdHJsLnN0b3BQcm9ncmVzc0JhcigpO1xuICAgICAgICAgIHRvYXN0ci5yZW1vdmUoc2NvcGUudG9hc3RJZCk7XG4gICAgICAgIH0sIHRpbWUsIDEpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBoaWRlQW5kU3RvcFByb2dyZXNzQmFyKCkge1xuICAgICAgICBzY29wZS5wcm9ncmVzc0JhciA9IGZhbHNlO1xuICAgICAgICB0b2FzdEN0cmwuc3RvcFByb2dyZXNzQmFyKCk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIHdhbnRzQ2xvc2VCdXR0b24oKSB7XG4gICAgICAgIHJldHVybiBzY29wZS5vcHRpb25zLmNsb3NlSHRtbDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbn0oKSk7XG5cbmFuZ3VsYXIubW9kdWxlKFwidG9hc3RyXCIpLnJ1bihbXCIkdGVtcGxhdGVDYWNoZVwiLCBmdW5jdGlvbigkdGVtcGxhdGVDYWNoZSkgeyR0ZW1wbGF0ZUNhY2hlLnB1dChcImRpcmVjdGl2ZXMvcHJvZ3Jlc3NiYXIvcHJvZ3Jlc3NiYXIuaHRtbFwiLFwiPGRpdiBjbGFzcz1cXFwidG9hc3QtcHJvZ3Jlc3NcXFwiPjwvZGl2PlxcblwiKTtcbiR0ZW1wbGF0ZUNhY2hlLnB1dChcImRpcmVjdGl2ZXMvdG9hc3QvdG9hc3QuaHRtbFwiLFwiPGRpdiBjbGFzcz1cXFwie3t0b2FzdENsYXNzfX0ge3t0b2FzdFR5cGV9fVxcXCIgbmctY2xpY2s9XFxcInRhcFRvYXN0KClcXFwiPlxcbiAgPGRpdiBuZy1zd2l0Y2ggb249XFxcImFsbG93SHRtbFxcXCI+XFxuICAgIDxkaXYgbmctc3dpdGNoLWRlZmF1bHQgbmctaWY9XFxcInRpdGxlXFxcIiBjbGFzcz1cXFwie3t0aXRsZUNsYXNzfX1cXFwiIGFyaWEtbGFiZWw9XFxcInt7dGl0bGV9fVxcXCI+e3t0aXRsZX19PC9kaXY+XFxuICAgIDxkaXYgbmctc3dpdGNoLWRlZmF1bHQgY2xhc3M9XFxcInt7bWVzc2FnZUNsYXNzfX1cXFwiIGFyaWEtbGFiZWw9XFxcInt7bWVzc2FnZX19XFxcIj57e21lc3NhZ2V9fTwvZGl2PlxcbiAgICA8ZGl2IG5nLXN3aXRjaC13aGVuPVxcXCJ0cnVlXFxcIiBuZy1pZj1cXFwidGl0bGVcXFwiIGNsYXNzPVxcXCJ7e3RpdGxlQ2xhc3N9fVxcXCIgbmctYmluZC1odG1sPVxcXCJ0aXRsZVxcXCI+PC9kaXY+XFxuICAgIDxkaXYgbmctc3dpdGNoLXdoZW49XFxcInRydWVcXFwiIGNsYXNzPVxcXCJ7e21lc3NhZ2VDbGFzc319XFxcIiBuZy1iaW5kLWh0bWw9XFxcIm1lc3NhZ2VcXFwiPjwvZGl2PlxcbiAgPC9kaXY+XFxuICA8cHJvZ3Jlc3MtYmFyIG5nLWlmPVxcXCJwcm9ncmVzc0JhclxcXCI+PC9wcm9ncmVzcy1iYXI+XFxuPC9kaXY+XFxuXCIpO31dKTsiXX0=
